function Al(i,e){for(var n=0;n<e.length;n++){const o=e[n];if(typeof o!="string"&&!Array.isArray(o)){for(const s in o)if(s!=="default"&&!(s in i)){const h=Object.getOwnPropertyDescriptor(o,s);h&&Object.defineProperty(i,s,h.get?h:{enumerable:!0,get:()=>o[s]})}}}return Object.freeze(Object.defineProperty(i,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const h of s)if(h.type==="childList")for(const l of h.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&o(l)}).observe(document,{childList:!0,subtree:!0});function n(s){const h={};return s.integrity&&(h.integrity=s.integrity),s.referrerPolicy&&(h.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?h.credentials="include":s.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function o(s){if(s.ep)return;s.ep=!0;const h=n(s);fetch(s.href,h)}})();var Mi,q,Js,Qs,fi,Jo,ta,on={},ea=[],Ol=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i;function ie(i,e){for(var n in e)i[n]=e[n];return i}function ia(i){var e=i.parentNode;e&&e.removeChild(i)}function Re(i,e,n){var o,s,h,l={};for(h in e)h=="key"?o=e[h]:h=="ref"?s=e[h]:l[h]=e[h];if(arguments.length>2&&(l.children=arguments.length>3?Mi.call(arguments,2):n),typeof i=="function"&&i.defaultProps!=null)for(h in i.defaultProps)l[h]===void 0&&(l[h]=i.defaultProps[h]);return pi(i,l,o,s,null)}function pi(i,e,n,o,s){var h={type:i,props:e,key:n,ref:o,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:s??++Js};return s==null&&q.vnode!=null&&q.vnode(h),h}function Fl(){return{current:null}}function Li(i){return i.children}function Oe(i,e){this.props=i,this.context=e}function yi(i,e){if(e==null)return i.__?yi(i.__,i.__.__k.indexOf(i)+1):null;for(var n;e<i.__k.length;e++)if((n=i.__k[e])!=null&&n.__e!=null)return n.__e;return typeof i.type=="function"?yi(i):null}function na(i){var e,n;if((i=i.__)!=null&&i.__c!=null){for(i.__e=i.__c.base=null,e=0;e<i.__k.length;e++)if((n=i.__k[e])!=null&&n.__e!=null){i.__e=i.__c.base=n.__e;break}return na(i)}}function dr(i){(!i.__d&&(i.__d=!0)&&fi.push(i)&&!sn.__r++||Jo!==q.debounceRendering)&&((Jo=q.debounceRendering)||setTimeout)(sn)}function sn(){for(var i;sn.__r=fi.length;)i=fi.sort(function(e,n){return e.__v.__b-n.__v.__b}),fi=[],i.some(function(e){var n,o,s,h,l,c;e.__d&&(l=(h=(n=e).__v).__e,(c=n.__P)&&(o=[],(s=ie({},h)).__v=h.__v+1,Cr(c,h,s,n.__n,c.ownerSVGElement!==void 0,h.__h!=null?[l]:null,o,l??yi(h),h.__h),aa(o,h),h.__e!=l&&na(h)))})}function ra(i,e,n,o,s,h,l,c,d,_){var f,m,v,w,b,C,E,I=o&&o.__k||ea,x=I.length;for(n.__k=[],f=0;f<e.length;f++)if((w=n.__k[f]=(w=e[f])==null||typeof w=="boolean"?null:typeof w=="string"||typeof w=="number"||typeof w=="bigint"?pi(null,w,null,null,w):Array.isArray(w)?pi(Li,{children:w},null,null,null):w.__b>0?pi(w.type,w.props,w.key,w.ref?w.ref:null,w.__v):w)!=null){if(w.__=n,w.__b=n.__b+1,(v=I[f])===null||v&&w.key==v.key&&w.type===v.type)I[f]=void 0;else for(m=0;m<x;m++){if((v=I[m])&&w.key==v.key&&w.type===v.type){I[m]=void 0;break}v=null}Cr(i,w,v=v||on,s,h,l,c,d,_),b=w.__e,(m=w.ref)&&v.ref!=m&&(E||(E=[]),v.ref&&E.push(v.ref,null,w),E.push(m,w.__c||b,w)),b!=null?(C==null&&(C=b),typeof w.type=="function"&&w.__k===v.__k?w.__d=d=oa(w,d,i):d=sa(i,w,v,I,b,d),typeof n.type=="function"&&(n.__d=d)):d&&v.__e==d&&d.parentNode!=i&&(d=yi(v))}for(n.__e=C,f=x;f--;)I[f]!=null&&la(I[f],I[f]);if(E)for(f=0;f<E.length;f++)ha(E[f],E[++f],E[++f])}function oa(i,e,n){for(var o,s=i.__k,h=0;s&&h<s.length;h++)(o=s[h])&&(o.__=i,e=typeof o.type=="function"?oa(o,e,n):sa(n,o,o,s,o.__e,e));return e}function an(i,e){return e=e||[],i==null||typeof i=="boolean"||(Array.isArray(i)?i.some(function(n){an(n,e)}):e.push(i)),e}function sa(i,e,n,o,s,h){var l,c,d;if(e.__d!==void 0)l=e.__d,e.__d=void 0;else if(n==null||s!=h||s.parentNode==null)t:if(h==null||h.parentNode!==i)i.appendChild(s),l=null;else{for(c=h,d=0;(c=c.nextSibling)&&d<o.length;d+=1)if(c==s)break t;i.insertBefore(s,h),l=h}return l!==void 0?l:s.nextSibling}function Zl(i,e,n,o,s){var h;for(h in n)h==="children"||h==="key"||h in e||hn(i,h,null,n[h],o);for(h in e)s&&typeof e[h]!="function"||h==="children"||h==="key"||h==="value"||h==="checked"||n[h]===e[h]||hn(i,h,e[h],n[h],o)}function Qo(i,e,n){e[0]==="-"?i.setProperty(e,n):i[e]=n==null?"":typeof n!="number"||Ol.test(e)?n:n+"px"}function hn(i,e,n,o,s){var h;t:if(e==="style")if(typeof n=="string")i.style.cssText=n;else{if(typeof o=="string"&&(i.style.cssText=o=""),o)for(e in o)n&&e in n||Qo(i.style,e,"");if(n)for(e in n)o&&n[e]===o[e]||Qo(i.style,e,n[e])}else if(e[0]==="o"&&e[1]==="n")h=e!==(e=e.replace(/Capture$/,"")),e=e.toLowerCase()in i?e.toLowerCase().slice(2):e.slice(2),i.l||(i.l={}),i.l[e+h]=n,n?o||i.addEventListener(e,h?es:ts,h):i.removeEventListener(e,h?es:ts,h);else if(e!=="dangerouslySetInnerHTML"){if(s)e=e.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(e!=="href"&&e!=="list"&&e!=="form"&&e!=="tabIndex"&&e!=="download"&&e in i)try{i[e]=n??"";break t}catch{}typeof n=="function"||(n==null||n===!1&&e.indexOf("-")==-1?i.removeAttribute(e):i.setAttribute(e,n))}}function ts(i){this.l[i.type+!1](q.event?q.event(i):i)}function es(i){this.l[i.type+!0](q.event?q.event(i):i)}function Cr(i,e,n,o,s,h,l,c,d){var _,f,m,v,w,b,C,E,I,x,P,k,B,O,A,F=e.type;if(e.constructor!==void 0)return null;n.__h!=null&&(d=n.__h,c=e.__e=n.__e,e.__h=null,h=[c]),(_=q.__b)&&_(e);try{t:if(typeof F=="function"){if(E=e.props,I=(_=F.contextType)&&o[_.__c],x=_?I?I.props.value:_.__:o,n.__c?C=(f=e.__c=n.__c).__=f.__E:("prototype"in F&&F.prototype.render?e.__c=f=new F(E,x):(e.__c=f=new Oe(E,x),f.constructor=F,f.render=Nl),I&&I.sub(f),f.props=E,f.state||(f.state={}),f.context=x,f.__n=o,m=f.__d=!0,f.__h=[],f._sb=[]),f.__s==null&&(f.__s=f.state),F.getDerivedStateFromProps!=null&&(f.__s==f.state&&(f.__s=ie({},f.__s)),ie(f.__s,F.getDerivedStateFromProps(E,f.__s))),v=f.props,w=f.state,m)F.getDerivedStateFromProps==null&&f.componentWillMount!=null&&f.componentWillMount(),f.componentDidMount!=null&&f.__h.push(f.componentDidMount);else{if(F.getDerivedStateFromProps==null&&E!==v&&f.componentWillReceiveProps!=null&&f.componentWillReceiveProps(E,x),!f.__e&&f.shouldComponentUpdate!=null&&f.shouldComponentUpdate(E,f.__s,x)===!1||e.__v===n.__v){for(f.props=E,f.state=f.__s,e.__v!==n.__v&&(f.__d=!1),f.__v=e,e.__e=n.__e,e.__k=n.__k,e.__k.forEach(function(W){W&&(W.__=e)}),P=0;P<f._sb.length;P++)f.__h.push(f._sb[P]);f._sb=[],f.__h.length&&l.push(f);break t}f.componentWillUpdate!=null&&f.componentWillUpdate(E,f.__s,x),f.componentDidUpdate!=null&&f.__h.push(function(){f.componentDidUpdate(v,w,b)})}if(f.context=x,f.props=E,f.__v=e,f.__P=i,k=q.__r,B=0,"prototype"in F&&F.prototype.render){for(f.state=f.__s,f.__d=!1,k&&k(e),_=f.render(f.props,f.state,f.context),O=0;O<f._sb.length;O++)f.__h.push(f._sb[O]);f._sb=[]}else do f.__d=!1,k&&k(e),_=f.render(f.props,f.state,f.context),f.state=f.__s;while(f.__d&&++B<25);f.state=f.__s,f.getChildContext!=null&&(o=ie(ie({},o),f.getChildContext())),m||f.getSnapshotBeforeUpdate==null||(b=f.getSnapshotBeforeUpdate(v,w)),A=_!=null&&_.type===Li&&_.key==null?_.props.children:_,ra(i,Array.isArray(A)?A:[A],e,n,o,s,h,l,c,d),f.base=e.__e,e.__h=null,f.__h.length&&l.push(f),C&&(f.__E=f.__=null),f.__e=!1}else h==null&&e.__v===n.__v?(e.__k=n.__k,e.__e=n.__e):e.__e=Rl(n.__e,e,n,o,s,h,l,d);(_=q.diffed)&&_(e)}catch(W){e.__v=null,(d||h!=null)&&(e.__e=c,e.__h=!!d,h[h.indexOf(c)]=null),q.__e(W,e,n)}}function aa(i,e){q.__c&&q.__c(e,i),i.some(function(n){try{i=n.__h,n.__h=[],i.some(function(o){o.call(n)})}catch(o){q.__e(o,n.__v)}})}function Rl(i,e,n,o,s,h,l,c){var d,_,f,m=n.props,v=e.props,w=e.type,b=0;if(w==="svg"&&(s=!0),h!=null){for(;b<h.length;b++)if((d=h[b])&&"setAttribute"in d==!!w&&(w?d.localName===w:d.nodeType===3)){i=d,h[b]=null;break}}if(i==null){if(w===null)return document.createTextNode(v);i=s?document.createElementNS("http://www.w3.org/2000/svg",w):document.createElement(w,v.is&&v),h=null,c=!1}if(w===null)m===v||c&&i.data===v||(i.data=v);else{if(h=h&&Mi.call(i.childNodes),_=(m=n.props||on).dangerouslySetInnerHTML,f=v.dangerouslySetInnerHTML,!c){if(h!=null)for(m={},b=0;b<i.attributes.length;b++)m[i.attributes[b].name]=i.attributes[b].value;(f||_)&&(f&&(_&&f.__html==_.__html||f.__html===i.innerHTML)||(i.innerHTML=f&&f.__html||""))}if(Zl(i,v,m,s,c),f)e.__k=[];else if(b=e.props.children,ra(i,Array.isArray(b)?b:[b],e,n,o,s&&w!=="foreignObject",h,l,h?h[0]:n.__k&&yi(n,0),c),h!=null)for(b=h.length;b--;)h[b]!=null&&ia(h[b]);c||("value"in v&&(b=v.value)!==void 0&&(b!==i.value||w==="progress"&&!b||w==="option"&&b!==m.value)&&hn(i,"value",b,m.value,!1),"checked"in v&&(b=v.checked)!==void 0&&b!==i.checked&&hn(i,"checked",b,m.checked,!1))}return i}function ha(i,e,n){try{typeof i=="function"?i(e):i.current=e}catch(o){q.__e(o,n)}}function la(i,e,n){var o,s;if(q.unmount&&q.unmount(i),(o=i.ref)&&(o.current&&o.current!==i.__e||ha(o,null,e)),(o=i.__c)!=null){if(o.componentWillUnmount)try{o.componentWillUnmount()}catch(h){q.__e(h,e)}o.base=o.__P=null,i.__c=void 0}if(o=i.__k)for(s=0;s<o.length;s++)o[s]&&la(o[s],e,n||typeof i.type!="function");n||i.__e==null||ia(i.__e),i.__=i.__e=i.__d=void 0}function Nl(i,e,n){return this.constructor(i,n)}function Sr(i,e,n){var o,s,h;q.__&&q.__(i,e),s=(o=typeof n=="function")?null:n&&n.__k||e.__k,h=[],Cr(e,i=(!o&&n||e).__k=Re(Li,null,[i]),s||on,on,e.ownerSVGElement!==void 0,!o&&n?[n]:s?null:e.firstChild?Mi.call(e.childNodes):null,h,!o&&n?n:s?s.__e:e.firstChild,o),aa(h,i)}function kr(i,e){Sr(i,e,kr)}function ua(i,e,n){var o,s,h,l=ie({},i.props);for(h in e)h=="key"?o=e[h]:h=="ref"?s=e[h]:l[h]=e[h];return arguments.length>2&&(l.children=arguments.length>3?Mi.call(arguments,2):n),pi(i.type,l,o||i.key,s||i.ref,null)}function Er(i,e){var n={__c:e="__cC"+ta++,__:i,Consumer:function(o,s){return o.children(s)},Provider:function(o){var s,h;return this.getChildContext||(s=[],(h={})[e]=this,this.getChildContext=function(){return h},this.shouldComponentUpdate=function(l){this.props.value!==l.value&&s.some(dr)},this.sub=function(l){s.push(l);var c=l.componentWillUnmount;l.componentWillUnmount=function(){s.splice(s.indexOf(l),1),c&&c.call(l)}}),o.children}};return n.Provider.__=n.Consumer.contextType=n}Mi=ea.slice,q={__e:function(i,e,n,o){for(var s,h,l;e=e.__;)if((s=e.__c)&&!s.__)try{if((h=s.constructor)&&h.getDerivedStateFromError!=null&&(s.setState(h.getDerivedStateFromError(i)),l=s.__d),s.componentDidCatch!=null&&(s.componentDidCatch(i,o||{}),l=s.__d),l)return s.__E=s}catch(c){i=c}throw i}},Js=0,Qs=function(i){return i!=null&&i.constructor===void 0},Oe.prototype.setState=function(i,e){var n;n=this.__s!=null&&this.__s!==this.state?this.__s:this.__s=ie({},this.state),typeof i=="function"&&(i=i(ie({},n),this.props)),i&&ie(n,i),i!=null&&this.__v&&(e&&this._sb.push(e),dr(this))},Oe.prototype.forceUpdate=function(i){this.__v&&(this.__e=!0,i&&this.__h.push(i),dr(this))},Oe.prototype.render=Li,fi=[],sn.__r=0,ta=0;const jl=Object.freeze(Object.defineProperty({__proto__:null,Component:Oe,Fragment:Li,cloneElement:ua,createContext:Er,createElement:Re,createRef:Fl,h:Re,hydrate:kr,get isValidElement(){return Qs},get options(){return q},render:Sr,toChildArray:an},Symbol.toStringTag,{value:"Module"}));var Wl=0;function dt(i,e,n,o,s){var h,l,c={};for(l in e)l=="ref"?h=e[l]:c[l]=e[l];var d={type:i,props:c,key:n,ref:h,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,__h:null,constructor:void 0,__v:--Wl,__source:s,__self:o};if(typeof i=="function"&&(h=i.defaultProps))for(l in h)c[l]===void 0&&(c[l]=h[l]);return q.vnode&&q.vnode(d),d}var Ul=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Vl(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}function ca(i){if(i.__esModule)return i;var e=i.default;if(typeof e=="function"){var n=function o(){return this instanceof o?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(i).forEach(function(o){var s=Object.getOwnPropertyDescriptor(i,o);Object.defineProperty(n,o,s.get?s:{enumerable:!0,get:function(){return i[o]}})}),n}var Ne={};const Yl=ca(jl);var Hl={};function da(i,e){for(var n in e)i[n]=e[n];return i}function Tr(i,e,n){var o=/(?:\?([^#]*))?(#.*)?$/,s=i.match(o),h={},l;if(s&&s[1])for(var c=s[1].split("&"),d=0;d<c.length;d++){var _=c[d].split("=");h[decodeURIComponent(_[0])]=decodeURIComponent(_.slice(1).join("="))}i=fr(i.replace(o,"")),e=fr(e||"");for(var f=Math.max(i.length,e.length),m=0;m<f;m++)if(e[m]&&e[m].charAt(0)===":"){var v=e[m].replace(/(^:|[+*?]+$)/g,""),w=(e[m].match(/[+*?]+$/)||Hl)[0]||"",b=~w.indexOf("+"),C=~w.indexOf("*"),E=i[m]||"";if(!E&&!C&&(w.indexOf("?")<0||b)){l=!1;break}if(h[v]=decodeURIComponent(E),b||C){h[v]=i.slice(m).map(decodeURIComponent).join("/");break}}else if(e[m]!==i[m]){l=!1;break}return n.default!==!0&&l===!1?!1:h}function Xl(i,e){return i.rank<e.rank?1:i.rank>e.rank?-1:i.index-e.index}function Gl(i,e){return i.index=e,i.rank=Kl(i),i.props}function fr(i){return i.replace(/(^\/+|\/+$)/g,"").split("/")}function ql(i){return i.charAt(0)==":"?1+"*+?".indexOf(i.charAt(i.length-1))||4:5}function $l(i){return fr(i).map(ql).join("")}function Kl(i){return i.props.default?0:$l(i.props.path)}var kt=null,me=[],ln=[],Jl={};function Ql(i,e){e===void 0&&(e="push"),kt&&kt[e]?kt[e](i):typeof history<"u"&&history[e+"State"]&&history[e+"State"](null,null,i)}function mn(){var i;return kt&&kt.location?i=kt.location:kt&&kt.getCurrentLocation?i=kt.getCurrentLocation():i=typeof location<"u"?location:Jl,""+(i.pathname||"")+(i.search||"")}function Dr(i,e){return e===void 0&&(e=!1),typeof i!="string"&&i.url&&(e=i.replace,i=i.url),tu(i)&&Ql(i,e?"replace":"push"),fa(i)}function tu(i){for(var e=me.length;e--;)if(me[e].canRoute(i))return!0;return!1}function fa(i){for(var e=!1,n=0;n<me.length;n++)me[n].routeTo(i)===!0&&(e=!0);for(var o=ln.length;o--;)ln[o](i);return e}function pa(i){if(!(!i||!i.getAttribute)){var e=i.getAttribute("href"),n=i.getAttribute("target");if(!(!e||!e.match(/^\//g)||n&&!n.match(/^_?self$/i)))return Dr(e)}}function eu(i){if(!(i.ctrlKey||i.metaKey||i.altKey||i.shiftKey||i.button!==0))return pa(i.currentTarget||i.target||this),_a(i)}function _a(i){return i&&(i.stopImmediatePropagation&&i.stopImmediatePropagation(),i.stopPropagation&&i.stopPropagation(),i.preventDefault()),!1}function iu(i){if(!(i.ctrlKey||i.metaKey||i.altKey||i.shiftKey||i.button!==0)){var e=i.target;do if(String(e.nodeName).toUpperCase()==="A"&&e.getAttribute("href")){if(e.hasAttribute("native"))return;if(pa(e))return _a(i)}while(e=e.parentNode)}}var is=!1;function nu(){is||(typeof addEventListener=="function"&&(kt||addEventListener("popstate",function(){fa(mn())}),addEventListener("click",iu)),is=!0)}var $t=function(i){function e(n){i.call(this,n),n.history&&(kt=n.history),this.state={url:n.url||mn()},nu()}return i&&(e.__proto__=i),e.prototype=Object.create(i&&i.prototype),e.prototype.constructor=e,e.prototype.shouldComponentUpdate=function(o){return o.static!==!0?!0:o.url!==this.props.url||o.onChange!==this.props.onChange},e.prototype.canRoute=function(o){var s=an(this.props.children);return this.getMatchingChildren(s,o,!1).length>0},e.prototype.routeTo=function(o){this.setState({url:o});var s=this.canRoute(o);return this.updating||this.forceUpdate(),s},e.prototype.componentWillMount=function(){me.push(this),this.updating=!0},e.prototype.componentDidMount=function(){var o=this;kt&&(this.unlisten=kt.listen(function(s){o.routeTo(""+(s.pathname||"")+(s.search||""))})),this.updating=!1},e.prototype.componentWillUnmount=function(){typeof this.unlisten=="function"&&this.unlisten(),me.splice(me.indexOf(this),1)},e.prototype.componentWillUpdate=function(){this.updating=!0},e.prototype.componentDidUpdate=function(){this.updating=!1},e.prototype.getMatchingChildren=function(o,s,h){return o.filter(Gl).sort(Xl).map(function(l){var c=Tr(s,l.props.path,l.props);if(c){if(h!==!1){var d={url:s,matches:c};return da(d,c),delete d.ref,delete d.key,ua(l,d)}return l}}).filter(Boolean)},e.prototype.render=function(o,s){var h=o.children,l=o.onChange,c=s.url,d=this.getMatchingChildren(an(h),c,!0),_=d[0]||null,f=this.previousUrl;return c!==f&&(this.previousUrl=c,typeof l=="function"&&l({router:this,url:c,previous:f,active:d,current:_})),_},e}(Oe),ma=function(i){return Re("a",da({onClick:eu},i))},ga=function(i){return Re(i.component,i)};$t.subscribers=ln;$t.getCurrentUrl=mn;$t.route=Dr;$t.Router=$t;$t.Route=ga;$t.Link=ma;$t.exec=Tr;const ru=Object.freeze(Object.defineProperty({__proto__:null,Link:ma,Route:ga,Router:$t,default:$t,exec:Tr,getCurrentUrl:mn,route:Dr,subscribers:ln},Symbol.toStringTag,{value:"Module"})),ou=ca(ru);Object.defineProperty(Ne,"__esModule",{value:!0});var va=Ne.Link=Ne.Match=void 0,su=Object.assign||function(i){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(i[o]=n[o])}return i},pr=Yl,Ie=ou;function au(i,e){var n={};for(var o in i)e.indexOf(o)>=0||Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o]);return n}function hu(i,e){if(!(i instanceof e))throw new TypeError("Cannot call a class as a function")}function ns(i,e){if(!i)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e&&(typeof e=="object"||typeof e=="function")?e:i}function lu(i,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof e);i.prototype=Object.create(e&&e.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(i,e):i.__proto__=e)}var zr=Ne.Match=function(i){lu(e,i);function e(){var n,o,s;hu(this,e);for(var h=arguments.length,l=Array(h),c=0;c<h;c++)l[c]=arguments[c];return s=(n=(o=ns(this,i.call.apply(i,[this].concat(l))),o),o.update=function(d){o.nextUrl=d,o.setState({})},n),ns(o,s)}return e.prototype.componentDidMount=function(){Ie.subscribers.push(this.update)},e.prototype.componentWillUnmount=function(){Ie.subscribers.splice(Ie.subscribers.indexOf(this.update)>>>0,1)},e.prototype.render=function(o){var s=this.nextUrl||(0,Ie.getCurrentUrl)(),h=s.replace(/\?.+$/,"");return this.nextUrl=null,o.children({url:s,path:h,matches:(0,Ie.exec)(h,o.path,{})!==!1})},e}(pr.Component),ya=function(e){var n=e.activeClassName,o=e.path,s=au(e,["activeClassName","path"]);return(0,pr.h)(zr,{path:o||s.href},function(h){var l=h.matches;return(0,pr.h)(Ie.Link,su({},s,{class:[s.class||s.className,l&&n].filter(Boolean).join(" ")}))})};va=Ne.Link=ya;Ne.default=zr;zr.Link=ya;const uu="_header_19max_1",cu="_nav_19max_14",du="_github_19max_19",fu="_logo_19max_26",pu="_active_19max_66",ni={header:uu,nav:cu,github:du,logo:fu,active:pu},_u=""+new URL("logo-DQvm3LRv.png",import.meta.url).href,mu="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyRpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoTWFjaW50b3NoKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpFNTE3OEEyQTk5QTAxMUUyOUExNUJDMTA0NkE4OTA0RCIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpFNTE3OEEyQjk5QTAxMUUyOUExNUJDMTA0NkE4OTA0RCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkU1MTc4QTI4OTlBMDExRTI5QTE1QkMxMDQ2QTg5MDREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkU1MTc4QTI5OTlBMDExRTI5QTE1QkMxMDQ2QTg5MDREIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+m4QGuQAAAyRJREFUeNrEl21ojWEYx895TDPbMNlBK46IUiNmPvHBSUjaqc0H8pF5+aDUKPEBqU2NhRQpX5Rv5jWlDIWlMCv7MMSWsWwmb3tpXub4XXWdPHvc9/Gc41nu+nedc7/8r/99PffLdYdDPsvkwsgkTBwsA/PADJCnzX2gHTwBt8Hl7p537/3whn04XoDZDcpBlk+9P8AFcAghzRkJwPF4zGGw0Y9QS0mAM2AnQj77FqCzrtcwB1Hk81SYojHK4DyGuQ6mhIIrBWB9Xm7ug/6B/nZrBHBegrkFxoVGpnwBMSLR9EcEcC4qb8pP14BWcBcUgewMnF3T34VqhWMFkThLJAalwnENOAKiHpJq1FZgI2AT6HZtuxZwR9GidSHtI30jOrbawxlVX78/AbNfhHlomEUJJI89O2MqeE79T8/nk8nMBm/dK576hZgmA3cp/R4l9/UeSxiHLVIlNm4nFfT0bxyuIj7LHRTKai+zdJobwMKzcZSJb0ePV5PKN+BqAAKE47UlMnERELMM3EdYP/yrd+XYb2mOiYBiQ8OQnoRBlXrl9JZix7D1pHTazu4MoyBcnYamqAjIMTR8G4FT8LuhLsexXYYjICBiqhQBvYb6fLZIJCjPypVvaOoVAW2WcasCnL2Nq82xHJNSqlCeFcDshaPK0twkAhosjZL31QYw+1rlMpWGMArl23SBsZZO58F2tlJXmjOXS+s4WGvpMiBJT/I2PInZ6lIs9/hBsNS1hS6BG0DSqmYEDRlCXQrmy50P1oDRKTSegmNbUsA0zDMwRhPJXeCE3vWLPQMvan6X8AgIa1vcR4AkGZkDR4ejJ1UHpsaVI0g2LInpOsNFUud1rhxSV+fzC9Woz2EZkWQuja7/B+jUrgtIMpy9YCW4n4K41YfzRneW5E1KJTe4B2Zq1Q5EHEtj4U3AfEzR5SVY4l7QYQPJdN2as7RKBF0BPZqqH4VgMAMBL8Byxr7y8zCZiDlnOcEKIPmUpgB5Z2ww5RdOiiRiNajUmWda5IG6WbhsyY2fx6m8gLcoJDJFkH219M3We1+cnda93pfycZpIJEL/s/wSYADmOAwAQgdpBAAAAABJRU5ErkJggg==",gu=()=>dt("header",{class:ni.header,children:[dt("div",{class:ni.nav,children:[dt("img",{class:ni.logo,src:_u}),dt("nav",{children:dt(va,{activeClassName:ni.active,href:"/",children:"Home"})})]}),dt("div",{class:ni.github,children:dt("a",{href:"https://www.github.com/JamesLMilner/terra-draw",children:dt("img",{src:mu})})})]}),vu="_home_13jfp_1",yu="_map_13jfp_7",wu="_loading_13jfp_75",tr={home:vu,map:yu,loading:wu};var Ci,gt,er,rs,wi=0,wa=[],tn=[],os=q.__b,ss=q.__r,as=q.diffed,hs=q.__c,ls=q.unmount;function gn(i,e){q.__h&&q.__h(gt,i,wi||e),wi=0;var n=gt.__H||(gt.__H={__:[],__h:[]});return i>=n.__.length&&n.__.push({__V:tn}),n.__[i]}function ir(i){return wi=1,xa(ba,i)}function xa(i,e,n){var o=gn(Ci++,2);if(o.t=i,!o.__c&&(o.__=[ba(void 0,e),function(h){var l=o.__N?o.__N[0]:o.__[0],c=o.t(l,h);l!==c&&(o.__N=[c,o.__[1]],o.__c.setState({}))}],o.__c=gt,!gt.u)){gt.u=!0;var s=gt.shouldComponentUpdate;gt.shouldComponentUpdate=function(h,l,c){if(!o.__c.__H)return!0;var d=o.__c.__H.__.filter(function(f){return f.__c});if(d.every(function(f){return!f.__N}))return!s||s.call(this,h,l,c);var _=!1;return d.forEach(function(f){if(f.__N){var m=f.__[0];f.__=f.__N,f.__N=void 0,m!==f.__[0]&&(_=!0)}}),!(!_&&o.__c.props===h)&&(!s||s.call(this,h,l,c))}}return o.__N||o.__}function us(i,e){var n=gn(Ci++,3);!q.__s&&Ir(n.__H,e)&&(n.__=i,n.i=e,gt.__H.__h.push(n))}function xu(i,e){var n=gn(Ci++,4);!q.__s&&Ir(n.__H,e)&&(n.__=i,n.i=e,gt.__h.push(n))}function bu(i){return wi=5,vn(function(){return{current:i}},[])}function vn(i,e){var n=gn(Ci++,7);return Ir(n.__H,e)?(n.__V=i(),n.i=e,n.__h=i,n.__V):n.__}function Pu(i,e){return wi=8,vn(function(){return i},e)}function Mu(){for(var i;i=wa.shift();)if(i.__P&&i.__H)try{i.__H.__h.forEach(en),i.__H.__h.forEach(_r),i.__H.__h=[]}catch(e){i.__H.__h=[],q.__e(e,i.__v)}}q.__b=function(i){gt=null,os&&os(i)},q.__r=function(i){ss&&ss(i),Ci=0;var e=(gt=i.__c).__H;e&&(er===gt?(e.__h=[],gt.__h=[],e.__.forEach(function(n){n.__N&&(n.__=n.__N),n.__V=tn,n.__N=n.i=void 0})):(e.__h.forEach(en),e.__h.forEach(_r),e.__h=[])),er=gt},q.diffed=function(i){as&&as(i);var e=i.__c;e&&e.__H&&(e.__H.__h.length&&(wa.push(e)!==1&&rs===q.requestAnimationFrame||((rs=q.requestAnimationFrame)||Lu)(Mu)),e.__H.__.forEach(function(n){n.i&&(n.__H=n.i),n.__V!==tn&&(n.__=n.__V),n.i=void 0,n.__V=tn})),er=gt=null},q.__c=function(i,e){e.some(function(n){try{n.__h.forEach(en),n.__h=n.__h.filter(function(o){return!o.__||_r(o)})}catch(o){e.some(function(s){s.__h&&(s.__h=[])}),e=[],q.__e(o,n.__v)}}),hs&&hs(i,e)},q.unmount=function(i){ls&&ls(i);var e,n=i.__c;n&&n.__H&&(n.__H.__.forEach(function(o){try{en(o)}catch(s){e=s}}),n.__H=void 0,e&&q.__e(e,n.__v))};var cs=typeof requestAnimationFrame=="function";function Lu(i){var e,n=function(){clearTimeout(o),cs&&cancelAnimationFrame(e),setTimeout(i)},o=setTimeout(n,100);cs&&(e=requestAnimationFrame(n))}function en(i){var e=gt,n=i.__c;typeof n=="function"&&(i.__c=void 0,n()),gt=e}function _r(i){var e=gt;i.__c=i.__(),gt=e}function Ir(i,e){return!i||i.length!==e.length||e.some(function(n,o){return n!==i[o]})}function ba(i,e){return typeof e=="function"?e(i):e}function Wt(){return Wt=Object.assign?Object.assign.bind():function(i){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var o in n)({}).hasOwnProperty.call(n,o)&&(i[o]=n[o])}return i},Wt.apply(null,arguments)}var re;(function(i){i.Commit="commit",i.Provisional="provisional",i.Finish="finish"})(re||(re={}));const ne={SELECTED:"selected",MID_POINT:"midPoint",SELECTION_POINT:"selectionPoint"},Pa="coordinatePoint",Ma="coordinatePointIds";function nr(i){return!!(i&&typeof i=="object"&&i!==null&&!Array.isArray(i))}function ds(i){return!!(i&&typeof i=="object"&&"properties"in i&&typeof i.properties=="object"&&i.properties!==null&&"mode"in i.properties)}function fs(i){return!!function(e){return typeof e=="number"&&!isNaN(new Date(e).valueOf())}(i)}const Cu="Feature mode property does not match the mode being added to";var je;(function(i){i.Drawing="drawing",i.Select="select",i.Static="static",i.Render="render"})(je||(je={}));let La=class{get state(){return this._state}set state(e){throw new Error("Please use the modes lifecycle methods")}get styles(){return this._styles}set styles(e){if(typeof e!="object")throw new Error("Styling must be an object");this.onStyleChange&&this.onStyleChange([],"styling"),this._styles=e}registerBehaviors(e){}constructor(e,n=!1){this._state="unregistered",this._styles={},this.behaviors=[],this.validate=void 0,this.pointerDistance=40,this.coordinatePrecision=void 0,this.onStyleChange=void 0,this.store=void 0,this.projection="web-mercator",this.setDoubleClickToZoom=void 0,this.unproject=void 0,this.project=void 0,this.setCursor=void 0,this.type=je.Drawing,this.mode="base",n||this.updateOptions(e)}updateOptions(e){e!=null&&e.styles&&(this.styles=Wt({},this._styles,e.styles)),e!=null&&e.pointerDistance&&(this.pointerDistance=e.pointerDistance),e!=null&&e.validation&&(this.validate=e&&e.validation),e!=null&&e.projection&&(this.projection=e.projection)}setDrawing(){if(this._state!=="started")throw new Error("Mode must be unregistered or stopped to start");this._state="drawing"}setStarted(){if(this._state!=="stopped"&&this._state!=="registered"&&this._state!=="drawing"&&this._state!=="selecting")throw new Error("Mode must be unregistered or stopped to start");this._state="started",this.setDoubleClickToZoom(!1)}setStopped(){if(this._state!=="started")throw new Error("Mode must be started to be stopped");this._state="stopped",this.setDoubleClickToZoom(!0)}register(e){if(this._state!=="unregistered")throw new Error("Can not register unless mode is unregistered");this._state="registered",this.store=e.store,this.store.registerOnChange(e.onChange),this.setDoubleClickToZoom=e.setDoubleClickToZoom,this.project=e.project,this.unproject=e.unproject,this.onSelect=e.onSelect,this.onDeselect=e.onDeselect,this.setCursor=e.setCursor,this.onStyleChange=e.onChange,this.onFinish=e.onFinish,this.coordinatePrecision=e.coordinatePrecision,this.registerBehaviors({mode:e.mode,store:this.store,project:this.project,unproject:this.unproject,pointerDistance:this.pointerDistance,coordinatePrecision:e.coordinatePrecision,projection:this.projection})}validateFeature(e){return this.performFeatureValidation(e)}afterFeatureAdded(e){}performFeatureValidation(e){if(this._state==="unregistered")throw new Error("Mode must be registered");const n=function(o,s){let h;if(nr(o))if(o.id==null)h="Feature has no id";else if(typeof o.id!="string"&&typeof o.id!="number")h="Feature must be string or number as per GeoJSON spec";else if(s(o.id))if(nr(o.geometry))if(nr(o.properties))if(typeof o.geometry.type=="string"&&["Polygon","LineString","Point"].includes(o.geometry.type))if(Array.isArray(o.geometry.coordinates)){if(!o.properties.mode||typeof o.properties.mode!="string")return{valid:!1,reason:"Feature does not have a valid mode property"}}else h="Feature coordinates is not an array";else h="Feature is not Point, LineString or Polygon";else h="Feature has no properties";else h="Feature has no geometry";else h="Feature must match the id strategy (default is UUID4)";else h="Feature is not object";return h?{valid:!1,reason:h}:{valid:!0}}(e,this.store.idStrategy.isValidId);if(this.validate){const o=this.validate(e,{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:re.Provisional});return{valid:n.valid&&o.valid,reason:o.reason}}return{valid:n.valid,reason:n.reason}}validateModeFeature(e,n){const o=this.performFeatureValidation(e);return o.valid?e.properties.mode!==this.mode?{valid:!1,reason:Cu}:n(e):{valid:!1,reason:o.reason}}onFinish(e,n){}onDeselect(e){}onSelect(e){}onKeyDown(e){}onKeyUp(e){}onMouseMove(e){}onClick(e){}onDragStart(e,n){}onDrag(e,n){}onDragEnd(e,n){}getHexColorStylingValue(e,n,o){return this.getStylingValue(e,n,o)}getNumericStylingValue(e,n,o){return this.getStylingValue(e,n,o)}getStylingValue(e,n,o){return e===void 0?n:typeof e=="function"?e(o):e}};class Su extends La{constructor(...e){super(...e),this.type=je.Select}}function Ca(i,e){const n=_=>_*Math.PI/180,o=n(i[1]),s=n(i[0]),h=n(e[1]),l=h-o,c=n(e[0])-s,d=Math.sin(l/2)*Math.sin(l/2)+Math.cos(o)*Math.cos(h)*Math.sin(c/2)*Math.sin(c/2);return 2*Math.atan2(Math.sqrt(d),Math.sqrt(1-d))*6371e3/1e3}const Sa=63710088e-1;function _i(i){return i%360*Math.PI/180}function ku(i){return i%(2*Math.PI)*180/Math.PI}function St(i,e=9){const n=Math.pow(10,e);return Math.round(i*n)/n}const ps=57.29577951308232,_s=.017453292519943295,un=6378137,vt=(i,e)=>({x:i===0?0:i*_s*un,y:e===0?0:Math.log(Math.tan(Math.PI/4+e*_s/2))*un}),ge=(i,e)=>({lng:i===0?0:ps*(i/un),lat:e===0?0:(2*Math.atan(Math.exp(e/un))-Math.PI/2)*ps});function Eu(i){let e;if(i.geometry.type==="Polygon")e=i.geometry.coordinates;else{if(i.geometry.type!=="LineString")throw new Error("Self intersects only accepts Polygons and LineStrings");e=[i.geometry.coordinates]}const n=[];for(let h=0;h<e.length;h++)for(let l=0;l<e[h].length-1;l++)for(let c=0;c<e.length;c++)for(let d=0;d<e[c].length-1;d++)s(h,l,c,d);return n.length>0;function o(h){return h<0||h>1}function s(h,l,c,d){const _=e[h][l],f=e[h][l+1],m=e[c][d],v=e[c][d+1],w=function(E,I,x,P){if(Xi(E,x)||Xi(E,P)||Xi(I,x)||Xi(P,x))return null;const k=E[0],B=E[1],O=I[0],A=I[1],F=x[0],W=x[1],V=P[0],Y=P[1],$=(k-O)*(W-Y)-(B-A)*(F-V);return $===0?null:[((k*A-B*O)*(F-V)-(k-O)*(F*Y-W*V))/$,((k*A-B*O)*(W-Y)-(B-A)*(F*Y-W*V))/$]}(_,f,m,v);if(w===null)return;let b,C;b=f[0]!==_[0]?(w[0]-_[0])/(f[0]-_[0]):(w[1]-_[1])/(f[1]-_[1]),C=v[0]!==m[0]?(w[0]-m[0])/(v[0]-m[0]):(w[1]-m[1])/(v[1]-m[1]),o(b)||o(C)||(w.toString(),n.push(w))}}function Xi(i,e){return i[0]===e[0]&&i[1]===e[1]}function Tu(i,e){return ms(i[0])<=e&&ms(i[1])<=e}function ms(i){let e=1,n=0;for(;Math.round(i*e)/e!==i;)e*=10,n++;return n}const ve=(i,e)=>{const{x:n,y:o}=i,{x:s,y:h}=e,l=s-n,c=h-o;return Math.sqrt(c*c+l*l)};class At{constructor({store:e,mode:n,project:o,unproject:s,pointerDistance:h,coordinatePrecision:l,projection:c}){this.store=void 0,this.mode=void 0,this.project=void 0,this.unproject=void 0,this.pointerDistance=void 0,this.coordinatePrecision=void 0,this.projection=void 0,this.store=e,this.mode=n,this.project=o,this.unproject=s,this.pointerDistance=h,this.coordinatePrecision=l,this.projection=c}}function ka({unproject:i,point:e,pointerDistance:n}){const o=n/2,{x:s,y:h}=e;return{type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[[i(s-o,h-o),i(s+o,h-o),i(s+o,h+o),i(s-o,h+o),i(s-o,h-o)].map(l=>[l.lng,l.lat])]}}}class Du extends At{constructor(e){super(e)}create(e){const{containerX:n,containerY:o}=e;return ka({unproject:this.unproject,point:{x:n,y:o},pointerDistance:this.pointerDistance})}}class zu extends At{constructor(e){super(e)}measure(e,n){const{x:o,y:s}=this.project(n[0],n[1]);return ve({x:o,y:s},{x:e.containerX,y:e.containerY})}}class Iu extends At{constructor(e,n,o){super(e),this.config=void 0,this.pixelDistance=void 0,this.clickBoundingBox=void 0,this.getSnappableCoordinateFirstClick=s=>this.getSnappable(s,h=>!!(h.properties&&h.properties.mode===this.mode)).coordinate,this.getSnappableCoordinate=(s,h)=>this.getSnappable(s,l=>!!(l.properties&&l.properties.mode===this.mode&&l.id!==h)).coordinate,this.config=e,this.pixelDistance=n,this.clickBoundingBox=o}getSnappable(e,n){const o=this.clickBoundingBox.create(e),s=this.store.search(o,n),h={featureId:void 0,featureCoordinateIndex:void 0,coordinate:void 0,minDist:1/0};return s.forEach(l=>{let c;if(l.geometry.type==="Polygon")c=l.geometry.coordinates[0];else{if(l.geometry.type!=="LineString")return;c=l.geometry.coordinates}c.forEach((d,_)=>{const f=this.pixelDistance.measure(e,d);f<h.minDist&&f<this.pointerDistance&&(h.coordinate=d,h.minDist=f,h.featureId=l.id,h.featureCoordinateIndex=_)})}),h}}function Bu({x:i,y:e},{x:n,y:o}){let s=Math.atan2(o-e,n-i);return s*=180/Math.PI,s>180?s-=360:s<-180&&(s+=360),s}class Au extends At{constructor(e){super(e)}createOrUpdate(e){const n=this.store.getGeometryCopy(e),o=this.store.getPropertiesCopy(e);let s;if(n.type==="Polygon")s=n.coordinates[0].slice(0,-1);else{if(n.type!=="LineString")return;s=n.coordinates}const h=this.store.getPropertiesCopy(e);if(h.coordinatePointIds){const l=h.coordinatePointIds,c=l.map(d=>this.store.getGeometryCopy(d).coordinates);if(l.length!==s.length){this.deleteCoordinatePoints(l);const d=this.createPoints(s,o.mode);this.setFeatureCoordinatePoints(e,d)}else s.forEach((d,_)=>{d[0]===c[_][0]&&d[1]===c[_][1]||this.store.updateGeometry([{id:l[_],geometry:{type:"Point",coordinates:d}}])})}else{const l=this.createPoints(s,o.mode);this.setFeatureCoordinatePoints(e,l)}}deletePointsByFeatureIds(e){for(const n of e)this.deleteIfPresent(n)}getUpdated(e,n){const o=this.store.getPropertiesCopy(e);if(o.coordinatePointIds)return o.coordinatePointIds.map((s,h)=>({id:s,geometry:Wt({},this.store.getGeometryCopy(s),{coordinates:n[h]})}))}createPoints(e,n){return this.store.create(e.map(o=>({geometry:{type:"Point",coordinates:o},properties:{mode:n,[Pa]:!0}})))}setFeatureCoordinatePoints(e,n){this.store.updateProperty([{id:e,property:Ma,value:n}])}deleteCoordinatePoints(e){this.store.delete(e)}deleteIfPresent(e){const n=this.store.getPropertiesCopy(e);n.coordinatePointIds&&(this.deleteCoordinatePoints(n.coordinatePointIds),this.setFeatureCoordinatePoints(e,null))}}function cn(i,e){const n=i,o=e,s=_i(n[1]),h=_i(o[1]);let l=_i(o[0]-n[0]);l>Math.PI&&(l-=2*Math.PI),l<-Math.PI&&(l+=2*Math.PI);const c=Math.log(Math.tan(h/2+Math.PI/4)/Math.tan(s/2+Math.PI/4)),d=(ku(Math.atan2(l,c))+360)%360;return d>180?-(360-d):d}function Br(i,e,n){let o=e;e<0&&(o=-Math.abs(o));const s=o/Sa,h=i[0]*Math.PI/180,l=_i(i[1]),c=_i(n),d=s*Math.cos(c);let _=l+d;Math.abs(_)>Math.PI/2&&(_=_>0?Math.PI-_:-Math.PI-_);const f=Math.log(Math.tan(_/2+Math.PI/4)/Math.tan(l/2+Math.PI/4)),m=Math.abs(f)>1e-11?d/f:Math.cos(l),v=[(180*(h+s*Math.sin(c)/m)/Math.PI+540)%360-180,180*_/Math.PI];return v[0]+=v[0]-i[0]>180?-360:i[0]-v[0]>180?360:0,v}function Ou(i,e,n,o,s){const h=o(i[0],i[1]),l=o(e[0],e[1]),{lng:c,lat:d}=s((h.x+l.x)/2,(h.y+l.y)/2);return[St(c,n),St(d,n)]}function Fu(i,e,n){const o=Br(i,1e3*Ca(i,e)/2,cn(i,e));return[St(o[0],n),St(o[1],n)]}function gs({featureCoords:i,precision:e,unproject:n,project:o,projection:s}){const h=[];for(let l=0;l<i.length-1;l++){let c;if(s==="web-mercator")c=Ou(i[l],i[l+1],e,o,n);else{if(s!=="globe")throw new Error("Invalid projection");c=Fu(i[l],i[l+1],e)}h.push(c)}return h}class Zu extends At{constructor(e,n,o){super(e),this.config=void 0,this.selectionPointBehavior=void 0,this.coordinatePointBehavior=void 0,this._midPoints=[],this.config=e,this.selectionPointBehavior=n,this.coordinatePointBehavior=o}get ids(){return this._midPoints.concat()}set ids(e){}insert(e,n,o){const s=this.store.getGeometryCopy(n),{midPointFeatureId:h,midPointSegment:l}=this.store.getPropertiesCopy(n),c=this.store.getGeometryCopy(h),d=c.type==="Polygon"?c.coordinates[0]:c.coordinates;d.splice(l+1,0,s.coordinates),c.coordinates=c.type==="Polygon"?[d]:d,this.store.updateGeometry([{id:h,geometry:c}]),this.store.getPropertiesCopy(e)[Ma]&&this.coordinatePointBehavior.createOrUpdate(e),this.store.delete([...this._midPoints,...this.selectionPointBehavior.ids]),this.create(d,h,o),this.selectionPointBehavior.create(d,c.type,h)}create(e,n,o){if(!this.store.has(n))throw new Error("Store does not have feature with this id");this._midPoints=this.store.create(function(s,h,l,c,d,_){return gs({featureCoords:s,precision:l,project:c,unproject:d,projection:_}).map((f,m)=>({geometry:{type:"Point",coordinates:f},properties:h(m)}))}(e,s=>({mode:this.mode,[ne.MID_POINT]:!0,midPointSegment:s,midPointFeatureId:n}),o,this.config.project,this.config.unproject,this.projection))}delete(){this._midPoints.length&&(this.store.delete(this._midPoints),this._midPoints=[])}getUpdated(e){if(this._midPoints.length!==0)return gs({featureCoords:e,precision:this.coordinatePrecision,project:this.config.project,unproject:this.config.unproject,projection:this.config.projection}).map((n,o)=>({id:this._midPoints[o],geometry:{type:"Point",coordinates:n}}))}}class Ru extends At{constructor(e){super(e),this._selectionPoints=[]}get ids(){return this._selectionPoints.concat()}set ids(e){}create(e,n,o){this._selectionPoints=this.store.create(function(s,h,l){const c=[],d=h==="Polygon"?s.length-1:s.length;for(let _=0;_<d;_++)c.push({geometry:{type:"Point",coordinates:s[_]},properties:l(_)});return c}(e,n,s=>({mode:this.mode,selectionPoint:!0,selectionPointFeatureId:o,index:s})))}delete(){this.ids.length&&(this.store.delete(this.ids),this._selectionPoints=[])}getUpdated(e){if(this._selectionPoints.length!==0)return this._selectionPoints.map((n,o)=>({id:n,geometry:{type:"Point",coordinates:e[o]}}))}getOneUpdated(e,n){if(this._selectionPoints[e]!==void 0)return{id:this._selectionPoints[e],geometry:{type:"Point",coordinates:n}}}}function Ea(i,e){let n=!1;for(let l=0,c=e.length;l<c;l++){const d=e[l];for(let _=0,f=d.length,m=f-1;_<f;m=_++)(s=d[_])[1]>(o=i)[1]!=(h=d[m])[1]>o[1]&&o[0]<(h[0]-s[0])*(o[1]-s[1])/(h[1]-s[1])+s[0]&&(n=!n)}var o,s,h;return n}const Ta=(i,e,n)=>{const o=h=>h*h,s=(h,l)=>o(h.x-l.x)+o(h.y-l.y);return Math.sqrt(((h,l,c)=>{const d=s(l,c);if(d===0)return s(h,l);let _=((h.x-l.x)*(c.x-l.x)+(h.y-l.y)*(c.y-l.y))/d;return _=Math.max(0,Math.min(1,_)),s(h,{x:l.x+_*(c.x-l.x),y:l.y+_*(c.y-l.y)})})(i,e,n))};class Nu extends At{constructor(e,n,o){super(e),this.config=void 0,this.createClickBoundingBox=void 0,this.pixelDistance=void 0,this.config=e,this.createClickBoundingBox=n,this.pixelDistance=o}find(e,n){let o,s,h,l,c=1/0,d=1/0,_=1/0;const f=this.createClickBoundingBox.create(e),m=this.store.search(f);for(let v=0;v<m.length;v++){const w=m[v],b=w.geometry;if(b.type==="Point"){if(w.properties.selectionPoint||w.properties.coordinatePoint||!n&&w.properties[ne.MID_POINT])continue;const C=this.pixelDistance.measure(e,b.coordinates);w.properties[ne.MID_POINT]&&C<this.pointerDistance&&C<_?(_=C,h=w):!w.properties[ne.MID_POINT]&&C<this.pointerDistance&&C<c&&(c=C,o=w)}else if(b.type==="LineString"){if(o)continue;for(let C=0;C<b.coordinates.length-1;C++){const E=b.coordinates[C],I=b.coordinates[C+1],x=Ta({x:e.containerX,y:e.containerY},this.project(E[0],E[1]),this.project(I[0],I[1]));x<this.pointerDistance&&x<d&&(d=x,s=w)}}else if(b.type==="Polygon"){if(o||s)continue;Ea([e.lng,e.lat],b.coordinates)&&(l=w)}}return{clickedFeature:o||s||l,clickedMidPoint:h}}}class ju extends At{constructor(e,n,o,s,h){super(e),this.config=void 0,this.featuresAtCursorEvent=void 0,this.selectionPoints=void 0,this.midPoints=void 0,this.coordinatePoints=void 0,this.draggedFeatureId=null,this.dragPosition=void 0,this.config=e,this.featuresAtCursorEvent=n,this.selectionPoints=o,this.midPoints=s,this.coordinatePoints=h}startDragging(e,n){this.draggedFeatureId=n,this.dragPosition=[e.lng,e.lat]}stopDragging(){this.draggedFeatureId=null,this.dragPosition=void 0}isDragging(){return this.draggedFeatureId!==null}canDrag(e,n){const{clickedFeature:o}=this.featuresAtCursorEvent.find(e,!0);return!(!o||o.id!==n)}drag(e,n){if(!this.draggedFeatureId)return;const o=this.store.getGeometryCopy(this.draggedFeatureId),s=[e.lng,e.lat];if(o.type==="Polygon"||o.type==="LineString"){let h,l;if(o.type==="Polygon"?(h=o.coordinates[0],l=h.length-1):(h=o.coordinates,l=h.length),!this.dragPosition)return!1;for(let f=0;f<l;f++){const m=h[f];let v,w;if(this.config.projection==="web-mercator"){const b=vt(this.dragPosition[0],this.dragPosition[1]),C=vt(s[0],s[1]),E=vt(m[0],m[1]),I={x:b.x-C.x,y:b.y-C.y},x=E.x-I.x,P=E.y-I.y,{lng:k,lat:B}=ge(x,P);v=k,w=B}else{const b=[this.dragPosition[0]-s[0],this.dragPosition[1]-s[1]];v=m[0]-b[0],w=m[1]-b[1]}if(v=St(v,this.config.coordinatePrecision),w=St(w,this.config.coordinatePrecision),v>180||v<-180||w>90||w<-90)return!1;h[f]=[v,w]}o.type==="Polygon"&&(h[h.length-1]=[h[0][0],h[0][1]]);const c=this.selectionPoints.getUpdated(h)||[],d=this.midPoints.getUpdated(h)||[],_=this.coordinatePoints.getUpdated(this.draggedFeatureId,h)||[];if(n&&!n({type:"Feature",id:this.draggedFeatureId,geometry:o,properties:{}},{project:this.config.project,unproject:this.config.unproject,coordinatePrecision:this.config.coordinatePrecision,updateType:re.Provisional}).valid)return!1;this.store.updateGeometry([{id:this.draggedFeatureId,geometry:o},...c,...d,..._]),this.dragPosition=[e.lng,e.lat]}else o.type==="Point"&&(this.store.updateGeometry([{id:this.draggedFeatureId,geometry:{type:"Point",coordinates:s}}]),this.dragPosition=[e.lng,e.lat])}}class Wu extends At{constructor(e,n,o,s,h,l){super(e),this.config=void 0,this.pixelDistance=void 0,this.selectionPoints=void 0,this.midPoints=void 0,this.coordinatePoints=void 0,this.coordinateSnapping=void 0,this.draggedCoordinate={id:null,index:-1},this.config=e,this.pixelDistance=n,this.selectionPoints=o,this.midPoints=s,this.coordinatePoints=h,this.coordinateSnapping=l}getClosestCoordinate(e,n){const o={dist:1/0,index:-1,isFirstOrLastPolygonCoord:!1};let s;if(n.type==="LineString")s=n.coordinates;else{if(n.type!=="Polygon")return o;s=n.coordinates[0]}for(let h=0;h<s.length;h++){const l=this.pixelDistance.measure(e,s[h]);if(l<this.pointerDistance&&l<o.dist){const c=n.type==="Polygon"&&(h===s.length-1||h===0);o.dist=l,o.index=c?0:h,o.isFirstOrLastPolygonCoord=c}}return o}getDraggableIndex(e,n){const o=this.store.getGeometryCopy(n),s=this.getClosestCoordinate(e,o);return s.index===-1?-1:s.index}drag(e,n,o,s){if(this.draggedCoordinate.id===null)return!1;const h=this.draggedCoordinate.index,l=this.store.getGeometryCopy(this.draggedCoordinate.id),c=this.store.getPropertiesCopy(this.draggedCoordinate.id),d=l.type==="LineString"?l.coordinates:l.coordinates[0],_=l.type==="Polygon"&&(h===d.length-1||h===0);let f=[e.lng,e.lat];if(s){let C;C=this.coordinateSnapping.getSnappable(e,E=>!!(E.properties&&E.properties.mode===c.mode&&E.id!==this.draggedCoordinate.id)).coordinate,C&&(f=C)}if(e.lng>180||e.lng<-180||e.lat>90||e.lat<-90)return!1;if(_){const C=d.length-1;d[0]=f,d[C]=f}else d[h]=f;const m=this.selectionPoints.getOneUpdated(h,f),v=m?[m]:[],w=this.midPoints.getUpdated(d)||[],b=this.coordinatePoints.getUpdated(this.draggedCoordinate.id,d)||[];return!(l.type!=="Point"&&!n&&Eu({geometry:l})||o&&!o({type:"Feature",id:this.draggedCoordinate.id,geometry:l,properties:{}},{project:this.config.project,unproject:this.config.unproject,coordinatePrecision:this.config.coordinatePrecision,updateType:re.Provisional}).valid||(this.store.updateGeometry([{id:this.draggedCoordinate.id,geometry:l},...v,...w,...b]),0))}isDragging(){return this.draggedCoordinate.id!==null}startDragging(e,n){this.draggedCoordinate={id:e,index:n}}stopDragging(){this.draggedCoordinate={id:null,index:-1}}}function dn(i){let e=0,n=0,o=0;return(i.geometry.type==="Polygon"?i.geometry.coordinates[0].slice(0,-1):i.geometry.coordinates).forEach(s=>{e+=s[0],n+=s[1],o++},!0),[e/o,n/o]}function Da(i,e){i[0]+=i[0]-e[0]>180?-360:e[0]-i[0]>180?360:0;const n=Sa,o=e[1]*Math.PI/180,s=i[1]*Math.PI/180,h=s-o;let l=Math.abs(i[0]-e[0])*Math.PI/180;l>Math.PI&&(l-=2*Math.PI);const c=Math.log(Math.tan(s/2+Math.PI/4)/Math.tan(o/2+Math.PI/4)),d=Math.abs(c)>1e-11?h/c:Math.cos(o);return Math.sqrt(h*h+d*d*l*l)*n}function fn(i){const e=(i.geometry.type==="Polygon"?i.geometry.coordinates[0]:i.geometry.coordinates).map(n=>{const{x:o,y:s}=vt(n[0],n[1]);return[o,s]});return i.geometry.type==="Polygon"?function(n){let o=0,s=0,h=0;const l=n.length;for(let c=0;c<l-1;c++){const[d,_]=n[c],[f,m]=n[c+1],v=d*m-f*_;o+=v,s+=(d+f)*v,h+=(_+m)*v}return o/=2,s/=6*o,h/=6*o,{x:s,y:h}}(e):function(n){const o=n.length;let s=0,h=0;for(let l=0;l<o;l++){const[c,d]=n[l];s+=c,h+=d}return{x:s/o,y:h/o}}(e)}class Uu extends At{constructor(e,n,o,s){super(e),this.config=void 0,this.selectionPoints=void 0,this.midPoints=void 0,this.coordinatePoints=void 0,this.lastBearing=void 0,this.config=e,this.selectionPoints=n,this.midPoints=o,this.coordinatePoints=s}reset(){this.lastBearing=void 0}rotate(e,n,o){const s=this.store.getGeometryCopy(n);if(s.type!=="Polygon"&&s.type!=="LineString")return;const h=[e.lng,e.lat];let l;const c={type:"Feature",geometry:s,properties:{}};if(this.config.projection==="web-mercator"){if(l=Bu(fn(c),vt(e.lng,e.lat)),!this.lastBearing)return void(this.lastBearing=l);((v,w)=>{if(w===0||w===360||w===-360)return v;const b=.017453292519943295*w,C=(v.geometry.type==="Polygon"?v.geometry.coordinates[0]:v.geometry.coordinates).map(([x,P])=>vt(x,P)),E=C.reduce((x,P)=>({x:x.x+P.x,y:x.y+P.y}),{x:0,y:0});E.x/=C.length,E.y/=C.length;const I=C.map(x=>({x:E.x+(x.x-E.x)*Math.cos(b)-(x.y-E.y)*Math.sin(b),y:E.y+(x.x-E.x)*Math.sin(b)+(x.y-E.y)*Math.cos(b)})).map(({x,y:P})=>[ge(x,P).lng,ge(x,P).lat]);v.geometry.type==="Polygon"?v.geometry.coordinates[0]=I:v.geometry.coordinates=I})(c,-(this.lastBearing-l))}else{if(this.config.projection!=="globe")throw new Error("Unsupported projection");if(l=cn(dn({geometry:s}),h),!this.lastBearing)return void(this.lastBearing=l+180);(function(v,w){if(w===0||w===360||w===-360)return v;const b=dn(v);(v.geometry.type==="Polygon"?v.geometry.coordinates[0]:v.geometry.coordinates).forEach(C=>{const E=cn(b,C)+w,I=Da(b,C),x=Br(b,I,E);C[0]=x[0],C[1]=x[1]})})(c,-(this.lastBearing-(l+180)))}const d=s.type==="Polygon"?s.coordinates[0]:s.coordinates;d.forEach(v=>{v[0]=St(v[0],this.coordinatePrecision),v[1]=St(v[1],this.coordinatePrecision)});const _=this.midPoints.getUpdated(d)||[],f=this.selectionPoints.getUpdated(d)||[],m=this.coordinatePoints.getUpdated(n,d)||[];if(o&&!o({id:n,type:"Feature",geometry:s,properties:{}},{project:this.config.project,unproject:this.config.unproject,coordinatePrecision:this.config.coordinatePrecision,updateType:re.Provisional}))return!1;this.store.updateGeometry([{id:n,geometry:s},...f,..._,...m]),this.projection==="web-mercator"?this.lastBearing=l:this.projection==="globe"&&(this.lastBearing=l+180)}}class Vu extends At{constructor(e,n,o,s){super(e),this.config=void 0,this.selectionPoints=void 0,this.midPoints=void 0,this.coordinatePoints=void 0,this.lastDistance=void 0,this.config=e,this.selectionPoints=n,this.midPoints=o,this.coordinatePoints=s}reset(){this.lastDistance=void 0}scale(e,n,o){const s=this.store.getGeometryCopy(n);if(s.type!=="Polygon"&&s.type!=="LineString")return;const h=[e.lng,e.lat],l={type:"Feature",geometry:s,properties:{}};let c;const d=fn(l);if(this.config.projection==="web-mercator"){const b=vt(e.lng,e.lat);c=ve(d,b)}else{if(this.config.projection!=="globe")throw new Error("Invalid projection");c=Ca(dn({geometry:s}),h)}if(!this.lastDistance)return void(this.lastDistance=c);const _=1-(this.lastDistance-c)/c;if(this.config.projection==="web-mercator"){const{lng:b,lat:C}=ge(d.x,d.y);(function(E,I,x){if(I===1)return E;const P=(E.geometry.type==="Polygon"?E.geometry.coordinates[0]:E.geometry.coordinates).map(([O,A])=>vt(O,A)),k=vt(x[0],x[1]),B=P.map(O=>({x:k.x+(O.x-k.x)*I,y:k.y+(O.y-k.y)*I})).map(({x:O,y:A})=>[ge(O,A).lng,ge(O,A).lat]);E.geometry.type==="Polygon"?E.geometry.coordinates[0]=B:E.geometry.coordinates=B})(l,_,[b,C])}else this.config.projection==="globe"&&function(b,C,E,I="xy"){C===1||(b.geometry.type==="Polygon"?b.geometry.coordinates[0]:b.geometry.coordinates).forEach(x=>{const P=Da(E,x),k=cn(E,x),B=Br(E,P*C,k);I!=="x"&&I!=="xy"||(x[0]=B[0]),I!=="y"&&I!=="xy"||(x[1]=B[1])})}(l,_,dn(l));const f=s.type==="Polygon"?s.coordinates[0]:s.coordinates;f.forEach(b=>{b[0]=St(b[0],this.coordinatePrecision),b[1]=St(b[1],this.coordinatePrecision)});const m=this.midPoints.getUpdated(f)||[],v=this.selectionPoints.getUpdated(f)||[],w=this.coordinatePoints.getUpdated(n,f)||[];if(o&&!o({id:n,type:"Feature",geometry:s,properties:{}},{project:this.config.project,unproject:this.config.unproject,coordinatePrecision:this.config.coordinatePrecision,updateType:re.Provisional}))return!1;this.store.updateGeometry([{id:n,geometry:s},...v,...m,...w]),this.lastDistance=c}}class Yu extends At{constructor(e,n,o,s,h){super(e),this.config=void 0,this.pixelDistance=void 0,this.selectionPoints=void 0,this.midPoints=void 0,this.coordinatePoints=void 0,this.minimumScale=1e-4,this.draggedCoordinate={id:null,index:-1},this.boundingBoxMaps={opposite:{0:4,1:5,2:6,3:7,4:0,5:1,6:2,7:3}},this.config=e,this.pixelDistance=n,this.selectionPoints=o,this.midPoints=s,this.coordinatePoints=h}getClosestCoordinate(e,n){const o={dist:1/0,index:-1,isFirstOrLastPolygonCoord:!1};let s;if(n.type==="LineString")s=n.coordinates;else{if(n.type!=="Polygon")return o;s=n.coordinates[0]}for(let h=0;h<s.length;h++){const l=this.pixelDistance.measure(e,s[h]);if(l<this.pointerDistance&&l<o.dist){const c=n.type==="Polygon"&&(h===s.length-1||h===0);o.dist=l,o.index=c?0:h,o.isFirstOrLastPolygonCoord=c}}return o}isValidDragWebMercator(e,n,o){switch(e){case 0:if(n<=0||o>=0)return!1;break;case 1:if(o>=0)return!1;break;case 2:if(n>=0||o>=0)return!1;break;case 3:if(n>=0)return!1;break;case 4:if(n>=0||o<=0)return!1;break;case 5:if(o<=0)return!1;break;case 6:if(n<=0||o<=0)return!1;break;case 7:if(n<=0)return!1}return!0}getSelectedFeatureDataWebMercator(){if(!this.draggedCoordinate.id||this.draggedCoordinate.index===-1)return null;const e=this.getFeature(this.draggedCoordinate.id);if(!e)return null;const n=this.getNormalisedCoordinates(e.geometry);return{boundingBox:this.getBBoxWebMercator(n),feature:e,updatedCoords:n,selectedCoordinate:n[this.draggedCoordinate.index]}}centerWebMercatorDrag(e){const n=this.getSelectedFeatureDataWebMercator();if(!n)return null;const{feature:o,boundingBox:s,updatedCoords:h,selectedCoordinate:l}=n,c=fn(o);if(!c)return null;const d=vt(l[0],l[1]),{closestBBoxIndex:_}=this.getIndexesWebMercator(s,d),f=vt(e.lng,e.lat);return this.scaleWebMercator({closestBBoxIndex:_,updatedCoords:h,webMercatorCursor:f,webMercatorSelected:d,webMercatorOrigin:c}),h}centerFixedWebMercatorDrag(e){const n=this.getSelectedFeatureDataWebMercator();if(!n)return null;const{feature:o,boundingBox:s,updatedCoords:h,selectedCoordinate:l}=n,c=fn(o);if(!c)return null;const d=vt(l[0],l[1]),{closestBBoxIndex:_}=this.getIndexesWebMercator(s,d),f=vt(e.lng,e.lat);return this.scaleFixedWebMercator({closestBBoxIndex:_,updatedCoords:h,webMercatorCursor:f,webMercatorSelected:d,webMercatorOrigin:c}),h}scaleFixedWebMercator({closestBBoxIndex:e,webMercatorOrigin:n,webMercatorSelected:o,webMercatorCursor:s,updatedCoords:h}){if(!this.isValidDragWebMercator(e,n.x-s.x,n.y-s.y))return null;let l=ve(n,s)/ve(n,o);return l<0&&(l=this.minimumScale),this.performWebMercatorScale(h,n.x,n.y,l,l),h}oppositeFixedWebMercatorDrag(e){const n=this.getSelectedFeatureDataWebMercator();if(!n)return null;const{boundingBox:o,updatedCoords:s,selectedCoordinate:h}=n,l=vt(h[0],h[1]),{oppositeBboxIndex:c,closestBBoxIndex:d}=this.getIndexesWebMercator(o,l),_={x:o[c][0],y:o[c][1]},f=vt(e.lng,e.lat);return this.scaleFixedWebMercator({closestBBoxIndex:d,updatedCoords:s,webMercatorCursor:f,webMercatorSelected:l,webMercatorOrigin:_}),s}oppositeWebMercatorDrag(e){const n=this.getSelectedFeatureDataWebMercator();if(!n)return null;const{boundingBox:o,updatedCoords:s,selectedCoordinate:h}=n,l=vt(h[0],h[1]),{oppositeBboxIndex:c,closestBBoxIndex:d}=this.getIndexesWebMercator(o,l),_={x:o[c][0],y:o[c][1]},f=vt(e.lng,e.lat);return this.scaleWebMercator({closestBBoxIndex:d,updatedCoords:s,webMercatorCursor:f,webMercatorSelected:l,webMercatorOrigin:_}),s}scaleWebMercator({closestBBoxIndex:e,webMercatorOrigin:n,webMercatorSelected:o,webMercatorCursor:s,updatedCoords:h}){const l=n.x-s.x,c=n.y-s.y;if(!this.isValidDragWebMercator(e,l,c))return null;let d=1;l!==0&&e!==1&&e!==5&&(d=1-(n.x-o.x-l)/l);let _=1;return c!==0&&e!==3&&e!==7&&(_=1-(n.y-o.y-c)/c),this.validateScale(d,_)?(d<0&&(d=this.minimumScale),_<0&&(_=this.minimumScale),this.performWebMercatorScale(h,n.x,n.y,d,_),h):null}getFeature(e){if(this.draggedCoordinate.id===null)return null;const n=this.store.getGeometryCopy(e);return n.type!=="Polygon"&&n.type!=="LineString"?null:{id:e,type:"Feature",geometry:n,properties:{}}}getNormalisedCoordinates(e){return e.type==="Polygon"?e.coordinates[0]:e.coordinates}validateScale(e,n){const o=!isNaN(e)&&n<Number.MAX_SAFE_INTEGER,s=!isNaN(n)&&n<Number.MAX_SAFE_INTEGER;return o&&s}performWebMercatorScale(e,n,o,s,h){e.forEach(l=>{const{x:c,y:d}=vt(l[0],l[1]),_=n+(c-n)*s,f=o+(d-o)*h,{lng:m,lat:v}=ge(_,f);l[0]=m,l[1]=v})}getBBoxWebMercator(e){const n=[1/0,1/0,-1/0,-1/0];(e=e.map(c=>{const{x:d,y:_}=vt(c[0],c[1]);return[d,_]})).forEach(([c,d])=>{c<n[0]&&(n[0]=c),d<n[1]&&(n[1]=d),c>n[2]&&(n[2]=c),d>n[3]&&(n[3]=d)});const[o,s,h,l]=n;return[[o,l],[(o+h)/2,l],[h,l],[h,l+(s-l)/2],[h,s],[(o+h)/2,s],[o,s],[o,l+(s-l)/2]]}getIndexesWebMercator(e,n){let o,s=1/0;for(let h=0;h<e.length;h++){const l=ve({x:n.x,y:n.y},{x:e[h][0],y:e[h][1]});l<s&&(o=h,s=l)}if(o===void 0)throw new Error("No closest coordinate found");return{oppositeBboxIndex:this.boundingBoxMaps.opposite[o],closestBBoxIndex:o}}isDragging(){return this.draggedCoordinate.id!==null}startDragging(e,n){this.draggedCoordinate={id:e,index:n}}stopDragging(){this.draggedCoordinate={id:null,index:-1}}getDraggableIndex(e,n){const o=this.store.getGeometryCopy(n),s=this.getClosestCoordinate(e,o);return s.index===-1?-1:s.index}drag(e,n,o){if(!this.draggedCoordinate.id)return!1;const s=this.getFeature(this.draggedCoordinate.id);if(!s)return!1;let h=null;if(n==="center"?h=this.centerWebMercatorDrag(e):n==="opposite"?h=this.oppositeWebMercatorDrag(e):n==="center-fixed"?h=this.centerFixedWebMercatorDrag(e):n==="opposite-fixed"&&(h=this.oppositeFixedWebMercatorDrag(e)),!h)return!1;for(let f=0;f<h.length;f++){const m=h[f];if(m[0]=St(m[0],this.coordinatePrecision),m[1]=St(m[1],this.coordinatePrecision),!Tu(m,this.coordinatePrecision))return!1}const l=this.midPoints.getUpdated(h)||[],c=this.selectionPoints.getUpdated(h)||[],d=this.coordinatePoints.getUpdated(s.id,h)||[],_={type:s.geometry.type,coordinates:s.geometry.type==="Polygon"?[h]:h};return!(o&&!o({id:this.draggedCoordinate.id,type:"Feature",geometry:_,properties:{}},{project:this.config.project,unproject:this.config.unproject,coordinatePrecision:this.config.coordinatePrecision,updateType:re.Provisional}).valid||(this.store.updateGeometry([{id:this.draggedCoordinate.id,geometry:_},...c,...l,...d]),0))}}const Hu={deselect:"Escape",delete:"Delete",rotate:["Control","r"],scale:["Control","s"]},vs={pointerOver:"move",dragStart:"move",dragEnd:"move",insertMidpoint:"crosshair"};class Xu extends Su{constructor(e){super(e,!0),this.mode="select",this.allowManualDeselection=!0,this.dragEventThrottle=5,this.dragEventCount=0,this.selected=[],this.flags={},this.keyEvents=Hu,this.cursors=vs,this.validations={},this.selectionPoints=void 0,this.midPoints=void 0,this.coordinateSnap=void 0,this.featuresAtMouseEvent=void 0,this.pixelDistance=void 0,this.clickBoundingBox=void 0,this.dragFeature=void 0,this.dragCoordinate=void 0,this.rotateFeature=void 0,this.scaleFeature=void 0,this.dragCoordinateResizeFeature=void 0,this.coordinatePoints=void 0,this.updateOptions(e)}updateOptions(e){if(super.updateOptions(e),this.cursors=e&&e.cursors?Wt({},this.cursors,e.cursors):vs,(e==null?void 0:e.keyEvents)===null?this.keyEvents={deselect:null,delete:null,rotate:null,scale:null}:e!=null&&e.keyEvents&&(this.keyEvents=Wt({},this.keyEvents,e.keyEvents)),(e==null?void 0:e.dragEventThrottle)!==void 0&&(this.dragEventThrottle=e.dragEventThrottle),(e==null?void 0:e.allowManualDeselection)!==void 0&&(this.allowManualDeselection=e.allowManualDeselection),e!=null&&e.flags){this.flags=Wt({},this.flags,e.flags),this.validations={};for(const n in this.flags){const o=this.flags[n].feature;o&&o.validation&&(this.validations[n]=o.validation)}}}createOrUpdateCoordinatePoint(e){const n=this.store.getPropertiesCopy(e);n.coordinatePointIds&&this.store.delete(n.coordinatePointIds);const o=this.store.getGeometryCopy(e),s=this.store.create(o.coordinates[0].map(h=>({geometry:{type:"Point",coordinates:h},properties:{mode:this.mode,[Pa]:!0}})));this.store.updateProperty([{id:e,property:"coordinatePointIds",value:s}])}selectFeature(e){this.select(e,!1)}setSelecting(){if(this._state!=="started")throw new Error("Mode must be started to move to selecting state");this._state="selecting"}registerBehaviors(e){this.pixelDistance=new zu(e),this.clickBoundingBox=new Du(e),this.featuresAtMouseEvent=new Nu(e,this.clickBoundingBox,this.pixelDistance),this.selectionPoints=new Ru(e),this.coordinatePoints=new Au(e),this.midPoints=new Zu(e,this.selectionPoints,this.coordinatePoints),this.coordinateSnap=new Iu(e,this.pixelDistance,this.clickBoundingBox),this.rotateFeature=new Uu(e,this.selectionPoints,this.midPoints,this.coordinatePoints),this.scaleFeature=new Vu(e,this.selectionPoints,this.midPoints,this.coordinatePoints),this.dragFeature=new ju(e,this.featuresAtMouseEvent,this.selectionPoints,this.midPoints,this.coordinatePoints),this.dragCoordinate=new Wu(e,this.pixelDistance,this.selectionPoints,this.midPoints,this.coordinatePoints,this.coordinateSnap),this.dragCoordinateResizeFeature=new Yu(e,this.pixelDistance,this.selectionPoints,this.midPoints,this.coordinatePoints)}deselectFeature(){this.deselect()}deselect(){const e=this.selected.filter(n=>this.store.has(n)).map(n=>({id:n,property:ne.SELECTED,value:!1}));this.store.updateProperty(e),this.onDeselect(this.selected[0]),this.selected=[],this.selectionPoints.delete(),this.midPoints.delete()}deleteSelected(){this.store.delete(this.selected),this.selected=[]}onRightClick(e){if(!this.selectionPoints.ids.length)return;let n,o=1/0;if(this.selectionPoints.ids.forEach(v=>{const w=this.store.getGeometryCopy(v),b=this.pixelDistance.measure(e,w.coordinates);b<this.pointerDistance&&b<o&&(o=b,n=this.store.getPropertiesCopy(v))}),!n)return;const s=n.selectionPointFeatureId,h=n.index,l=this.store.getPropertiesCopy(s),c=this.flags[l.mode],d=this.validations[l.mode];if(!(c&&c.feature&&c.feature.coordinates&&c.feature.coordinates.deletable))return;const _=this.store.getGeometryCopy(s);let f;if(_.type==="Polygon"){if(f=_.coordinates[0],f.length<=4)return}else if(_.type==="LineString"&&(f=_.coordinates,f.length<=2))return;if(!f||(_.type!=="Polygon"||h!==0&&h!==f.length-1?f.splice(h,1):(f.shift(),f.pop(),f.push([f[0][0],f[0][1]])),d&&!d({id:s,type:"Feature",geometry:_,properties:l},{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:re.Commit}).valid))return;const m=[...this.midPoints.ids,...this.selectionPoints.ids];this.store.delete(m),this.store.updateGeometry([{id:s,geometry:_}]),l.coordinatePointIds&&this.coordinatePoints.createOrUpdate(s),this.selectionPoints.create(f,_.type,s),c&&c.feature&&c.feature.coordinates&&c.feature.coordinates.midpoints&&this.midPoints.create(f,s,this.coordinatePrecision)}select(e,n=!0){if(this.selected[0]===e)return;const{mode:o}=this.store.getPropertiesCopy(e),s=this.flags[o];if(!s||!s.feature)return;const h=this.selected[0];if(h){if(h===e)return;this.deselect()}n&&this.setCursor(this.cursors.pointerOver),this.selected=[e],this.store.updateProperty([{id:e,property:"selected",value:!0}]),this.onSelect(e);const{type:l,coordinates:c}=this.store.getGeometryCopy(e);if(l!=="LineString"&&l!=="Polygon")return;const d=l==="LineString"?c:c[0];d&&s&&s.feature.coordinates&&(this.selectionPoints.create(d,l,e),s.feature.coordinates.midpoints&&this.midPoints.create(d,e,this.coordinatePrecision))}onLeftClick(e){const{clickedFeature:n,clickedMidPoint:o}=this.featuresAtMouseEvent.find(e,this.selected.length>0);if(this.selected.length&&o)this.midPoints.insert(this.selected[0],o.id,this.coordinatePrecision);else if(n&&n.id)this.select(n.id,!0);else if(this.selected.length&&this.allowManualDeselection)return void this.deselect()}start(){this.setStarted(),this.setSelecting()}stop(){this.cleanUp(),this.setStarted(),this.setStopped()}onClick(e){e.button!=="right"?e.button==="left"&&this.onLeftClick(e):this.onRightClick(e)}canScale(e){return this.keyEvents.scale&&this.keyEvents.scale.every(n=>e.heldKeys.includes(n))}canRotate(e){return this.keyEvents.rotate&&this.keyEvents.rotate.every(n=>e.heldKeys.includes(n))}preventDefaultKeyEvent(e){const n=this.canRotate(e),o=this.canScale(e);(n||o)&&e.preventDefault()}onKeyDown(e){this.preventDefaultKeyEvent(e)}onKeyUp(e){if(this.preventDefaultKeyEvent(e),this.keyEvents.delete&&e.key===this.keyEvents.delete){if(!this.selected.length)return;this.onDeselect(this.selected[0]),this.deleteSelected(),this.selectionPoints.delete(),this.midPoints.delete()}else this.keyEvents.deselect&&e.key===this.keyEvents.deselect&&this.cleanUp()}cleanUp(){this.selected.length&&this.deselect()}onDragStart(e,n){if(!this.selected.length)return;const o=this.store.getPropertiesCopy(this.selected[0]),s=this.flags[o.mode];if(!(s&&s.feature&&(s.feature.draggable||s.feature.coordinates&&s.feature.coordinates.draggable||s.feature.coordinates&&s.feature.coordinates.resizable||s.feature.coordinates&&typeof s.feature.coordinates.midpoints=="object"&&s.feature.coordinates.midpoints.draggable)))return;this.dragEventCount=0;const h=this.selected[0],l=this.dragCoordinate.getDraggableIndex(e,h);if(s&&s.feature&&s.feature.coordinates&&(s.feature.coordinates.draggable||s.feature.coordinates.resizable)&&l!==-1)return this.setCursor(this.cursors.dragStart),s.feature.coordinates.resizable?this.dragCoordinateResizeFeature.startDragging(h,l):this.dragCoordinate.startDragging(h,l),void n(!1);if(s&&s.feature&&s.feature.coordinates&&typeof s.feature.coordinates.midpoints=="object"&&s.feature.coordinates.midpoints.draggable){const{clickedMidPoint:c}=this.featuresAtMouseEvent.find(e,this.selected.length>0);if(this.selected.length&&c){this.midPoints.insert(h,c.id,this.coordinatePrecision);const d=this.dragCoordinate.getDraggableIndex(e,h);return this.dragCoordinate.startDragging(h,d),void n(!1)}}return s&&s.feature&&s.feature.draggable&&this.dragFeature.canDrag(e,h)?(this.setCursor(this.cursors.dragStart),this.dragFeature.startDragging(e,h),void n(!1)):void 0}onDrag(e,n){const o=this.selected[0];if(!o)return;const s=this.store.getPropertiesCopy(o),h=this.flags[s.mode],l=(h&&h.feature&&h.feature.selfIntersectable)===!0;if(this.dragEventCount++,this.dragEventCount%this.dragEventThrottle==0)return;const c=this.validations[s.mode];if(h&&h.feature&&h.feature.rotateable&&this.canRotate(e))return n(!1),void this.rotateFeature.rotate(e,o,c);if(h&&h.feature&&h.feature.scaleable&&this.canScale(e))return n(!1),void this.scaleFeature.scale(e,o,c);if(this.dragCoordinateResizeFeature.isDragging()&&h.feature&&h.feature.coordinates&&h.feature.coordinates.resizable){if(this.projection==="globe")throw new Error("Globe is currently unsupported projection for resizable");return n(!1),void this.dragCoordinateResizeFeature.drag(e,h.feature.coordinates.resizable,c)}if(this.dragCoordinate.isDragging()){var d;const _=!!(!((d=h.feature)==null||(d=d.coordinates)==null)&&d.snappable);this.dragCoordinate.drag(e,l,c,_)}else this.dragFeature.isDragging()?this.dragFeature.drag(e,c):n(!0)}onDragEnd(e,n){this.setCursor(this.cursors.dragEnd),this.dragCoordinate.isDragging()?this.onFinish(this.selected[0],{mode:this.mode,action:"dragCoordinate"}):this.dragFeature.isDragging()?this.onFinish(this.selected[0],{mode:this.mode,action:"dragFeature"}):this.dragCoordinateResizeFeature.isDragging()&&this.onFinish(this.selected[0],{mode:this.mode,action:"dragCoordinateResize"}),this.dragCoordinate.stopDragging(),this.dragFeature.stopDragging(),this.dragCoordinateResizeFeature.stopDragging(),this.rotateFeature.reset(),this.scaleFeature.reset(),n(!0)}onMouseMove(e){if(!this.selected.length)return void this.setCursor("unset");if(this.dragFeature.isDragging())return;let n=!1;this.midPoints.ids.forEach(h=>{if(n)return;const l=this.store.getGeometryCopy(h);this.pixelDistance.measure(e,l.coordinates)<this.pointerDistance&&(n=!0)});let o=!1;if(this.selectionPoints.ids.forEach(h=>{const l=this.store.getGeometryCopy(h);this.pixelDistance.measure(e,l.coordinates)<this.pointerDistance&&(n=!1,o=!0)}),n)return void this.setCursor(this.cursors.insertMidpoint);const{clickedFeature:s}=this.featuresAtMouseEvent.find(e,!0);this.setCursor(this.selected.length>0&&(s&&s.id===this.selected[0]||o)?this.cursors.pointerOver:"unset")}styleFeature(e){const n=Wt({},{polygonFillColor:"#3f97e0",polygonOutlineColor:"#3f97e0",polygonOutlineWidth:4,polygonFillOpacity:.3,pointColor:"#3f97e0",pointOutlineColor:"#ffffff",pointOutlineWidth:0,pointWidth:6,lineStringColor:"#3f97e0",lineStringWidth:4,zIndex:0});if(e.properties.mode===this.mode&&e.geometry.type==="Point"){if(e.properties.selectionPoint)return n.pointColor=this.getHexColorStylingValue(this.styles.selectionPointColor,n.pointColor,e),n.pointOutlineColor=this.getHexColorStylingValue(this.styles.selectionPointOutlineColor,n.pointOutlineColor,e),n.pointWidth=this.getNumericStylingValue(this.styles.selectionPointWidth,n.pointWidth,e),n.pointOutlineWidth=this.getNumericStylingValue(this.styles.selectionPointOutlineWidth,2,e),n.zIndex=30,n;if(e.properties.midPoint)return n.pointColor=this.getHexColorStylingValue(this.styles.midPointColor,n.pointColor,e),n.pointOutlineColor=this.getHexColorStylingValue(this.styles.midPointOutlineColor,n.pointOutlineColor,e),n.pointWidth=this.getNumericStylingValue(this.styles.midPointWidth,4,e),n.pointOutlineWidth=this.getNumericStylingValue(this.styles.midPointOutlineWidth,2,e),n.zIndex=40,n}else if(e.properties[ne.SELECTED]){if(e.geometry.type==="Polygon")return n.polygonFillColor=this.getHexColorStylingValue(this.styles.selectedPolygonColor,n.polygonFillColor,e),n.polygonOutlineWidth=this.getNumericStylingValue(this.styles.selectedPolygonOutlineWidth,n.polygonOutlineWidth,e),n.polygonOutlineColor=this.getHexColorStylingValue(this.styles.selectedPolygonOutlineColor,n.polygonOutlineColor,e),n.polygonFillOpacity=this.getNumericStylingValue(this.styles.selectedPolygonFillOpacity,n.polygonFillOpacity,e),n.zIndex=10,n;if(e.geometry.type==="LineString")return n.lineStringColor=this.getHexColorStylingValue(this.styles.selectedLineStringColor,n.lineStringColor,e),n.lineStringWidth=this.getNumericStylingValue(this.styles.selectedLineStringWidth,n.lineStringWidth,e),n.zIndex=10,n;if(e.geometry.type==="Point")return n.pointWidth=this.getNumericStylingValue(this.styles.selectedPointWidth,n.pointWidth,e),n.pointColor=this.getHexColorStylingValue(this.styles.selectedPointColor,n.pointColor,e),n.pointOutlineColor=this.getHexColorStylingValue(this.styles.selectedPointOutlineColor,n.pointOutlineColor,e),n.pointOutlineWidth=this.getNumericStylingValue(this.styles.selectedPointOutlineWidth,n.pointOutlineWidth,e),n.zIndex=10,n}return n}}class Gu extends La{constructor(...e){super(...e),this.type=je.Static,this.mode="static"}start(){}stop(){}onKeyUp(){}onKeyDown(){}onClick(){}onDragStart(){}onDrag(){}onDragEnd(){}onMouseMove(){}cleanUp(){}styleFeature(){return Wt({},{polygonFillColor:"#3f97e0",polygonOutlineColor:"#3f97e0",polygonOutlineWidth:4,polygonFillOpacity:.3,pointColor:"#3f97e0",pointOutlineColor:"#ffffff",pointOutlineWidth:0,pointWidth:6,lineStringColor:"#3f97e0",lineStringWidth:4,zIndex:0})}}function za(i,e,n,o,s){for(;o>n;){if(o-n>600){const d=o-n+1,_=e-n+1,f=Math.log(d),m=.5*Math.exp(2*f/3),v=.5*Math.sqrt(f*m*(d-m)/d)*(_-d/2<0?-1:1);za(i,e,Math.max(n,Math.floor(e-_*m/d+v)),Math.min(o,Math.floor(e+(d-_)*m/d+v)),s)}const h=i[e];let l=n,c=o;for(ri(i,n,e),s(i[o],h)>0&&ri(i,n,o);l<c;){for(ri(i,l,c),l++,c--;s(i[l],h)<0;)l++;for(;s(i[c],h)>0;)c--}s(i[n],h)===0?ri(i,n,c):(c++,ri(i,c,o)),c<=e&&(n=c+1),e<=c&&(o=c-1)}}function ri(i,e,n){const o=i[e];i[e]=i[n],i[n]=o}function Ee(i,e){ui(i,0,i.children.length,e,i)}function ui(i,e,n,o,s){s||(s=Be([])),s.minX=1/0,s.minY=1/0,s.maxX=-1/0,s.maxY=-1/0;for(let h=e;h<n;h++){const l=i.children[h];ci(s,i.leaf?o(l):l)}return s}function ci(i,e){return i.minX=Math.min(i.minX,e.minX),i.minY=Math.min(i.minY,e.minY),i.maxX=Math.max(i.maxX,e.maxX),i.maxY=Math.max(i.maxY,e.maxY),i}function qu(i,e){return i.minX-e.minX}function $u(i,e){return i.minY-e.minY}function rr(i){return(i.maxX-i.minX)*(i.maxY-i.minY)}function Gi(i){return i.maxX-i.minX+(i.maxY-i.minY)}function Ku(i,e){const n=Math.max(i.minX,e.minX),o=Math.max(i.minY,e.minY),s=Math.min(i.maxX,e.maxX),h=Math.min(i.maxY,e.maxY);return Math.max(0,s-n)*Math.max(0,h-o)}function or(i,e){return i.minX<=e.minX&&i.minY<=e.minY&&e.maxX<=i.maxX&&e.maxY<=i.maxY}function qi(i,e){return e.minX<=i.maxX&&e.minY<=i.maxY&&e.maxX>=i.minX&&e.maxY>=i.minY}function Be(i){return{children:i,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function ys(i,e,n,o,s){const h=[e,n];for(;h.length;){if((n=h.pop())-(e=h.pop())<=o)continue;const l=e+Math.ceil((n-e)/o/2)*o;za(i,l,e,n,s),h.push(e,l,l,n)}}class Ju{constructor(e){this._maxEntries=void 0,this._minEntries=void 0,this.data=void 0,this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()}search(e){let n=this.data;const o=[];if(!qi(e,n))return o;const s=this.toBBox,h=[];for(;n;){for(let l=0;l<n.children.length;l++){const c=n.children[l],d=n.leaf?s(c):c;qi(e,d)&&(n.leaf?o.push(c):or(e,d)?this._all(c,o):h.push(c))}n=h.pop()}return o}collides(e){let n=this.data;if(qi(e,n)){const o=[];for(;n;){for(let s=0;s<n.children.length;s++){const h=n.children[s],l=n.leaf?this.toBBox(h):h;if(qi(e,l)){if(n.leaf||or(e,l))return!0;o.push(h)}}n=o.pop()}}return!1}load(e){if(e.length<this._minEntries){for(let o=0;o<e.length;o++)this.insert(e[o]);return}let n=this._build(e.slice(),0,e.length-1,0);if(this.data.children.length)if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){const o=this.data;this.data=n,n=o}this._insert(n,this.data.height-n.height-1,!0)}else this.data=n}insert(e){this._insert(e,this.data.height-1)}clear(){this.data=Be([])}remove(e){let n=this.data;const o=this.toBBox(e),s=[],h=[];let l,c,d=!1;for(;n||s.length;){if(n||(n=s.pop(),c=s[s.length-1],l=h.pop(),d=!0),n.leaf){const _=n.children.indexOf(e);_!==-1&&(n.children.splice(_,1),s.push(n),this._condense(s))}d||n.leaf||!or(n,o)?c?(l++,n=c.children[l],d=!1):n=null:(s.push(n),h.push(l),l=0,c=n,n=n.children[0])}}toBBox(e){return e}compareMinX(e,n){return e.minX-n.minX}compareMinY(e,n){return e.minY-n.minY}_all(e,n){const o=[];for(;e;)e.leaf?n.push(...e.children):o.push(...e.children),e=o.pop();return n}_build(e,n,o,s){const h=o-n+1;let l,c=this._maxEntries;if(h<=c)return l=Be(e.slice(n,o+1)),Ee(l,this.toBBox),l;s||(s=Math.ceil(Math.log(h)/Math.log(c)),c=Math.ceil(h/Math.pow(c,s-1))),l=Be([]),l.leaf=!1,l.height=s;const d=Math.ceil(h/c),_=d*Math.ceil(Math.sqrt(c));ys(e,n,o,_,this.compareMinX);for(let f=n;f<=o;f+=_){const m=Math.min(f+_-1,o);ys(e,f,m,d,this.compareMinY);for(let v=f;v<=m;v+=d){const w=Math.min(v+d-1,m);l.children.push(this._build(e,v,w,s-1))}}return Ee(l,this.toBBox),l}_chooseSubtree(e,n,o,s){for(;s.push(n),!n.leaf&&s.length-1!==o;){let c,d=1/0,_=1/0;for(let f=0;f<n.children.length;f++){const m=n.children[f],v=rr(m),w=(h=e,l=m,(Math.max(l.maxX,h.maxX)-Math.min(l.minX,h.minX))*(Math.max(l.maxY,h.maxY)-Math.min(l.minY,h.minY))-v);w<_?(_=w,d=v<d?v:d,c=m):w===_&&v<d&&(d=v,c=m)}n=c||n.children[0]}var h,l;return n}_insert(e,n,o){const s=o?e:this.toBBox(e),h=[],l=this._chooseSubtree(s,this.data,n,h);for(l.children.push(e),ci(l,s);n>=0&&h[n].children.length>this._maxEntries;)this._split(h,n),n--;this._adjustParentBBoxes(s,h,n)}_split(e,n){const o=e[n],s=o.children.length,h=this._minEntries;this._chooseSplitAxis(o,h,s);const l=this._chooseSplitIndex(o,h,s),c=Be(o.children.splice(l,o.children.length-l));c.height=o.height,c.leaf=o.leaf,Ee(o,this.toBBox),Ee(c,this.toBBox),n?e[n-1].children.push(c):this._splitRoot(o,c)}_splitRoot(e,n){this.data=Be([e,n]),this.data.height=e.height+1,this.data.leaf=!1,Ee(this.data,this.toBBox)}_chooseSplitIndex(e,n,o){let s,h=1/0,l=1/0;for(let c=n;c<=o-n;c++){const d=ui(e,0,c,this.toBBox),_=ui(e,c,o,this.toBBox),f=Ku(d,_),m=rr(d)+rr(_);f<h?(h=f,s=c,l=m<l?m:l):f===h&&m<l&&(l=m,s=c)}return s||o-n}_chooseSplitAxis(e,n,o){const s=e.leaf?this.compareMinX:qu,h=e.leaf?this.compareMinY:$u;this._allDistMargin(e,n,o,s)<this._allDistMargin(e,n,o,h)&&e.children.sort(s)}_allDistMargin(e,n,o,s){e.children.sort(s);const h=this.toBBox,l=ui(e,0,n,h),c=ui(e,o-n,o,h);let d=Gi(l)+Gi(c);for(let _=n;_<o-n;_++){const f=e.children[_];ci(l,e.leaf?h(f):f),d+=Gi(l)}for(let _=o-n-1;_>=n;_--){const f=e.children[_];ci(c,e.leaf?h(f):f),d+=Gi(c)}return d}_adjustParentBBoxes(e,n,o){for(let s=o;s>=0;s--)ci(n[s],e)}_condense(e){for(let n,o=e.length-1;o>=0;o--)e[o].children.length===0?o>0?(n=e[o-1].children,n.splice(n.indexOf(e[o]),1)):this.clear():Ee(e[o],this.toBBox)}}class Qu{constructor(e){this.tree=void 0,this.idToNode=void 0,this.nodeToId=void 0,this.tree=new Ju(e&&e.maxEntries?e.maxEntries:9),this.idToNode=new Map,this.nodeToId=new Map}setMaps(e,n){this.idToNode.set(e.id,n),this.nodeToId.set(n,e.id)}toBBox(e){const n=[],o=[];let s;if(e.geometry.type==="Polygon")s=e.geometry.coordinates[0];else if(e.geometry.type==="LineString")s=e.geometry.coordinates;else{if(e.geometry.type!=="Point")throw new Error("Not a valid feature to turn into a bounding box");s=[e.geometry.coordinates]}for(let c=0;c<s.length;c++)o.push(s[c][1]),n.push(s[c][0]);const h=Math.min(...o),l=Math.max(...o);return{minX:Math.min(...n),minY:h,maxX:Math.max(...n),maxY:l}}insert(e){if(this.idToNode.get(String(e.id)))throw new Error("Feature already exists");const n=this.toBBox(e);this.setMaps(e,n),this.tree.insert(n)}load(e){const n=[],o=new Set;e.forEach(s=>{const h=this.toBBox(s);if(this.setMaps(s,h),o.has(String(s.id)))throw new Error(`Duplicate feature ID found ${s.id}`);o.add(String(s.id)),n.push(h)}),this.tree.load(n)}update(e){this.remove(e.id);const n=this.toBBox(e);this.setMaps(e,n),this.tree.insert(n)}remove(e){const n=this.idToNode.get(e);if(!n)throw new Error(`${e} not inserted into the spatial index`);this.tree.remove(n)}clear(){this.tree.clear()}search(e){return this.tree.search(this.toBBox(e)).map(n=>this.nodeToId.get(n))}collides(e){return this.tree.collides(this.toBBox(e))}}const tc={getId:()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(i){const e=16*Math.random()|0;return(i=="x"?e:3&e|8).toString(16)}),isValidId:i=>typeof i=="string"&&i.length===36};class ec{constructor(e){this.idStrategy=void 0,this.tracked=void 0,this.spatialIndex=void 0,this.store=void 0,this._onChange=()=>{},this.store={},this.spatialIndex=new Qu,this.tracked=!e||e.tracked!==!1,this.idStrategy=e&&e.idStrategy?e.idStrategy:tc}clone(e){return JSON.parse(JSON.stringify(e))}getId(){return this.idStrategy.getId()}has(e){return!!this.store[e]}load(e,n,o){if(e.length===0)return[];let s=this.clone(e);const h=[],l=[];return s=s.filter(c=>{c.id==null&&(c.id=this.idStrategy.getId());const d=c.id;if(n){const _=n(c);if(!_.valid)return l.push({id:d,valid:!1,reason:_.reason}),!1}if(this.tracked){if(c.properties.createdAt){if(!fs(c.properties.createdAt))return l.push({id:c.id,valid:!1,reason:"createdAt is not a valid numeric timestamp"}),!1}else c.properties.createdAt=+new Date;if(c.properties.updatedAt){if(!fs(c.properties.updatedAt))return l.push({id:c.id,valid:!1,reason:"updatedAt is not a valid numeric timestamp"}),!1}else c.properties.updatedAt=+new Date}return this.has(d)?(l.push({id:d,valid:!1,reason:`Feature already exists with this id: ${d}`}),!1):(this.store[d]=c,h.push(d),o&&o(c),l.push({id:d,valid:!0}),!0)}),this.spatialIndex.load(s),this._onChange(h,"create"),l}search(e,n){const o=this.spatialIndex.search(e).map(s=>this.store[s]);return this.clone(n?o.filter(n):o)}registerOnChange(e){this._onChange=(n,o)=>{e(n,o)}}getGeometryCopy(e){const n=this.store[e];if(!n)throw new Error(`No feature with this id (${e}), can not get geometry copy`);return this.clone(n.geometry)}getPropertiesCopy(e){const n=this.store[e];if(!n)throw new Error(`No feature with this id (${e}), can not get properties copy`);return this.clone(n.properties)}updateProperty(e){const n=[];e.forEach(({id:o,property:s,value:h})=>{const l=this.store[o];if(!l)throw new Error(`No feature with this (${o}), can not update geometry`);n.push(o),l.properties[s]=h,this.tracked&&(l.properties.updatedAt=+new Date)}),this._onChange&&this._onChange(n,"update")}updateGeometry(e){const n=[];e.forEach(({id:o,geometry:s})=>{n.push(o);const h=this.store[o];if(!h)throw new Error(`No feature with this (${o}), can not update geometry`);h.geometry=this.clone(s),this.spatialIndex.update(h),this.tracked&&(h.properties.updatedAt=+new Date)}),this._onChange&&this._onChange(n,"update")}create(e){const n=[];return e.forEach(({geometry:o,properties:s})=>{let h,l=Wt({},s);this.tracked&&(h=+new Date,s?(l.createdAt=typeof s.createdAt=="number"?s.createdAt:h,l.updatedAt=typeof s.updatedAt=="number"?s.updatedAt:h):l={createdAt:h,updatedAt:h});const c=this.getId(),d={id:c,type:"Feature",geometry:o,properties:l};this.store[c]=d,this.spatialIndex.insert(d),n.push(c)}),this._onChange&&this._onChange([...n],"create"),n}delete(e){e.forEach(n=>{if(!this.store[n])throw new Error("No feature with this id, can not delete");delete this.store[n],this.spatialIndex.remove(n)}),this._onChange&&this._onChange([...e],"delete")}copy(e){return this.clone(this.store[e])}copyAll(){return this.clone(Object.keys(this.store).map(e=>this.store[e]))}copyAllWhere(e){return this.clone(Object.keys(this.store).map(n=>this.store[n]).filter(n=>n.properties&&e(n.properties)))}clear(){this.store={},this.spatialIndex.clear()}size(){return Object.keys(this.store).length}}class Te{constructor({name:e,callback:n,unregister:o,register:s}){this.name=void 0,this.callback=void 0,this.registered=!1,this.register=void 0,this.unregister=void 0,this.name=e,this.register=()=>{this.registered||(this.registered=!0,s(n))},this.unregister=()=>{this.register&&(this.registered=!1,o(n))},this.callback=n}}var ic={__proto__:null,TerraDrawBaseAdapter:class{constructor(i){this._minPixelDragDistance=void 0,this._minPixelDragDistanceDrawing=void 0,this._minPixelDragDistanceSelecting=void 0,this._lastDrawEvent=void 0,this._coordinatePrecision=void 0,this._heldKeys=new Set,this._listeners=[],this._dragState="not-dragging",this._currentModeCallbacks=void 0,this._minPixelDragDistance=typeof i.minPixelDragDistance=="number"?i.minPixelDragDistance:1,this._minPixelDragDistanceSelecting=typeof i.minPixelDragDistanceSelecting=="number"?i.minPixelDragDistanceSelecting:1,this._minPixelDragDistanceDrawing=typeof i.minPixelDragDistanceDrawing=="number"?i.minPixelDragDistanceDrawing:8,this._coordinatePrecision=typeof i.coordinatePrecision=="number"?i.coordinatePrecision:9}getButton(i){return i.button===-1?"neither":i.button===0?"left":i.button===1?"middle":i.button===2?"right":"neither"}getMapElementXYPosition(i){const e=this.getMapEventElement(),{left:n,top:o}=e.getBoundingClientRect();return{containerX:i.clientX-n,containerY:i.clientY-o}}getDrawEventFromEvent(i){const e=this.getLngLatFromEvent(i);if(!e)return null;const{lng:n,lat:o}=e,{containerX:s,containerY:h}=this.getMapElementXYPosition(i),l=this.getButton(i),c=Array.from(this._heldKeys);return{lng:St(n,this._coordinatePrecision),lat:St(o,this._coordinatePrecision),containerX:s,containerY:h,button:l,heldKeys:c}}register(i){this._currentModeCallbacks=i,this._listeners=this.getAdapterListeners(),this._listeners.forEach(e=>{e.register()})}getCoordinatePrecision(){return this._coordinatePrecision}getAdapterListeners(){return[new Te({name:"pointerdown",callback:i=>{if(!this._currentModeCallbacks||!i.isPrimary)return;const e=this.getDrawEventFromEvent(i);e&&(this._dragState="pre-dragging",this._lastDrawEvent=e)},register:i=>{this.getMapEventElement().addEventListener("pointerdown",i)},unregister:i=>{this.getMapEventElement().removeEventListener("pointerdown",i)}}),new Te({name:"pointermove",callback:i=>{if(!this._currentModeCallbacks||!i.isPrimary)return;i.preventDefault();const e=this.getDrawEventFromEvent(i);if(e)if(this._dragState==="not-dragging")this._currentModeCallbacks.onMouseMove(e),this._lastDrawEvent=e;else if(this._dragState==="pre-dragging"){if(!this._lastDrawEvent)return;const n={x:this._lastDrawEvent.containerX,y:this._lastDrawEvent.containerY},o={x:e.containerX,y:e.containerY},s=this._currentModeCallbacks.getState(),h=ve(n,o);let l=!1;if(l=s==="drawing"?h<this._minPixelDragDistanceDrawing:s==="selecting"?h<this._minPixelDragDistanceSelecting:h<this._minPixelDragDistance,l)return;this._dragState="dragging",this._currentModeCallbacks.onDragStart(e,c=>{this.setDraggability.bind(this)(c)})}else this._dragState==="dragging"&&this._currentModeCallbacks.onDrag(e,n=>{this.setDraggability.bind(this)(n)})},register:i=>{this.getMapEventElement().addEventListener("pointermove",i)},unregister:i=>{this.getMapEventElement().removeEventListener("pointermove",i)}}),new Te({name:"contextmenu",callback:i=>{this._currentModeCallbacks&&i.preventDefault()},register:i=>{this.getMapEventElement().addEventListener("contextmenu",i)},unregister:i=>{this.getMapEventElement().removeEventListener("contextmenu",i)}}),new Te({name:"pointerup",callback:i=>{if(!this._currentModeCallbacks||i.target!==this.getMapEventElement()||!i.isPrimary)return;const e=this.getDrawEventFromEvent(i);e&&(this._dragState==="dragging"?this._currentModeCallbacks.onDragEnd(e,n=>{this.setDraggability.bind(this)(n)}):this._dragState!=="not-dragging"&&this._dragState!=="pre-dragging"||this._currentModeCallbacks.onClick(e),this._dragState="not-dragging",this.setDraggability(!0))},register:i=>{this.getMapEventElement().addEventListener("pointerup",i)},unregister:i=>{this.getMapEventElement().removeEventListener("pointerup",i)}}),new Te({name:"keyup",callback:i=>{this._currentModeCallbacks&&(this._heldKeys.delete(i.key),this._currentModeCallbacks.onKeyUp({key:i.key,heldKeys:Array.from(this._heldKeys),preventDefault:()=>i.preventDefault()}))},register:i=>{this.getMapEventElement().addEventListener("keyup",i)},unregister:i=>{this.getMapEventElement().removeEventListener("keyup",i)}}),new Te({name:"keydown",callback:i=>{this._currentModeCallbacks&&(this._heldKeys.add(i.key),this._currentModeCallbacks.onKeyDown({key:i.key,heldKeys:Array.from(this._heldKeys),preventDefault:()=>i.preventDefault()}))},register:i=>{this.getMapEventElement().addEventListener("keydown",i)},unregister:i=>{this.getMapEventElement().removeEventListener("keydown",i)}})]}unregister(){this._listeners.forEach(i=>{i.unregister()}),this.clear()}}};class nc{constructor(e){this._modes=void 0,this._mode=void 0,this._adapter=void 0,this._enabled=!1,this._store=void 0,this._eventListeners=void 0,this._instanceSelectMode=void 0,this._adapter=e.adapter,this._mode=new Gu;const n=new Set,o=e.modes.reduce((f,m)=>{if(n.has(m.mode))throw new Error(`There is already a ${m.mode} mode provided`);return n.add(m.mode),f[m.mode]=m,f},{}),s=Object.keys(o);if(s.length===0)throw new Error("No modes provided");s.forEach(f=>{if(o[f].type===je.Select){if(this._instanceSelectMode)throw new Error("only one type of select mode can be provided");this._instanceSelectMode=f}}),this._modes=Wt({},o,{static:this._mode}),this._eventListeners={change:[],select:[],deselect:[],finish:[],ready:[]},this._store=new ec({tracked:!!e.tracked,idStrategy:e.idStrategy?e.idStrategy:void 0});const h=f=>{const m=[],v=this._store.copyAll().filter(w=>!f.includes(w.id)||(m.push(w),!1));return{changed:m,unchanged:v}},l=(f,m)=>{this._enabled&&this._eventListeners.finish.forEach(v=>{v(f,m)})},c=(f,m)=>{if(!this._enabled)return;this._eventListeners.change.forEach(b=>{b(f,m)});const{changed:v,unchanged:w}=h(f);m==="create"?this._adapter.render({created:v,deletedIds:[],unchanged:w,updated:[]},this.getModeStyles()):m==="update"?this._adapter.render({created:[],deletedIds:[],unchanged:w,updated:v},this.getModeStyles()):m==="delete"?this._adapter.render({created:[],deletedIds:f,unchanged:w,updated:[]},this.getModeStyles()):m==="styling"&&this._adapter.render({created:[],deletedIds:[],unchanged:w,updated:[]},this.getModeStyles())},d=f=>{if(!this._enabled)return;this._eventListeners.select.forEach(w=>{w(f)});const{changed:m,unchanged:v}=h([f]);this._adapter.render({created:[],deletedIds:[],unchanged:v,updated:m},this.getModeStyles())},_=f=>{if(!this._enabled)return;this._eventListeners.deselect.forEach(w=>{w()});const{changed:m,unchanged:v}=h([f]);m&&this._adapter.render({created:[],deletedIds:[],unchanged:v,updated:m},this.getModeStyles())};Object.keys(this._modes).forEach(f=>{this._modes[f].register({mode:f,store:this._store,setCursor:this._adapter.setCursor.bind(this._adapter),project:this._adapter.project.bind(this._adapter),unproject:this._adapter.unproject.bind(this._adapter),setDoubleClickToZoom:this._adapter.setDoubleClickToZoom.bind(this._adapter),onChange:c,onSelect:d,onDeselect:_,onFinish:l,coordinatePrecision:this._adapter.getCoordinatePrecision()})})}checkEnabled(){if(!this._enabled)throw new Error("Terra Draw is not enabled")}getModeStyles(){const e={};return Object.keys(this._modes).forEach(n=>{e[n]=o=>this._instanceSelectMode&&o.properties[ne.SELECTED]?this._modes[this._instanceSelectMode].styleFeature.bind(this._modes[this._instanceSelectMode])(o):this._modes[n].styleFeature.bind(this._modes[n])(o)}),e}featuresAtLocation({lng:e,lat:n},o){const s=o&&o.pointerDistance!==void 0?o.pointerDistance:30,h=!o||o.ignoreSelectFeatures===void 0||o.ignoreSelectFeatures,l=this._adapter.unproject.bind(this._adapter),c=this._adapter.project.bind(this._adapter),d=c(e,n),_=ka({unproject:l,point:d,pointerDistance:s});return this._store.search(_).filter(f=>{if(h&&(f.properties[ne.MID_POINT]||f.properties[ne.SELECTION_POINT]))return!1;if(f.geometry.type==="Point"){const m=f.geometry.coordinates,v=c(m[0],m[1]);return ve(d,v)<s}if(f.geometry.type==="LineString"){const m=f.geometry.coordinates;for(let v=0;v<m.length-1;v++){const w=m[v],b=m[v+1];if(Ta(d,c(w[0],w[1]),c(b[0],b[1]))<s)return!0}return!1}return!!Ea([e,n],f.geometry.coordinates)||void 0})}getSelectMode(){if(this.checkEnabled(),!this._instanceSelectMode)throw new Error("No select mode defined in instance");return this.getMode()!==this._instanceSelectMode&&this.setMode(this._instanceSelectMode),this._modes[this._instanceSelectMode]}setModeStyles(e,n){if(this.checkEnabled(),!this._modes[e])throw new Error("No mode with this name present");this._modes[e].styles=n}updateModeOptions(e,n){if(this.checkEnabled(),!this._modes[e])throw new Error("No mode with this name present");this._modes[e].updateOptions(n)}getSnapshot(){return this._store.copyAll()}getSnapshotFeature(e){if(this._store.has(e))return this._store.copy(e)}clear(){this.checkEnabled(),this._adapter.clear()}get enabled(){return this._enabled}set enabled(e){throw new Error("Enabled is read only")}getMode(){return this._mode.mode}setMode(e){if(this.checkEnabled(),!this._modes[e])throw new Error("No mode with this name present");this._mode.stop(),this._mode=this._modes[e],this._mode.start()}removeFeatures(e){this.checkEnabled(),this._store.delete(e)}selectFeature(e){this.getSelectMode().selectFeature(e)}deselectFeature(e){this.getSelectMode().deselectFeature(e)}getFeatureId(){return this._store.getId()}hasFeature(e){return this._store.has(e)}addFeatures(e){return this.checkEnabled(),e.length===0?[]:this._store.load(e,n=>{if(ds(n)){const o=n.properties.mode,s=this._modes[o];if(!s)return{id:n.id,valid:!1,reason:`${o} mode is not in the list of instantiated modes`};const h=s.validateFeature.bind(s)(n);return{id:n.id,valid:h.valid,reason:h.reason?h.reason:h.valid?void 0:"Feature is invalid"}}return{id:n.id,valid:!1,reason:"Mode property does not exist"}},n=>{if(ds(n)){const o=this._modes[n.properties.mode];o&&o.afterFeatureAdded&&o.afterFeatureAdded(n)}})}start(){this._enabled=!0,this._adapter.register({onReady:()=>{this._eventListeners.ready.forEach(e=>{e()})},getState:()=>this._mode.state,onClick:e=>{this._mode.onClick(e)},onMouseMove:e=>{this._mode.onMouseMove(e)},onKeyDown:e=>{this._mode.onKeyDown(e)},onKeyUp:e=>{this._mode.onKeyUp(e)},onDragStart:(e,n)=>{this._mode.onDragStart(e,n)},onDrag:(e,n)=>{this._mode.onDrag(e,n)},onDragEnd:(e,n)=>{this._mode.onDragEnd(e,n)},onClear:()=>{this._mode.cleanUp(),this._store.clear()}})}getFeaturesAtLngLat(e,n){const{lng:o,lat:s}=e;return this.featuresAtLocation({lng:o,lat:s},n)}getFeaturesAtPointerEvent(e,n){const o=this._adapter.getLngLatFromEvent.bind(this._adapter)(e);return o===null?[]:this.featuresAtLocation(o,n)}stop(){this._enabled=!1,this._adapter.unregister()}on(e,n){const o=this._eventListeners[e];o.includes(n)||o.push(n)}off(e,n){const o=this._eventListeners[e];o.includes(n)&&o.splice(o.indexOf(n),1)}}let rc=class extends ic.TerraDrawBaseAdapter{constructor(e){super(e),this._lib=void 0,this._map=void 0,this._panes={},this._container=void 0,this._layers={},this._lib=e.lib,this._map=e.map,this._container=this._map.getContainer()}createPaneStyleSheet(e,n){const o=document.createElement("style");return o.innerHTML=`.leaflet-${e}-pane {z-index: ${n+600}`,document.getElementsByTagName("head")[0].appendChild(o),this._map.createPane(e),o}clearPanes(){Object.values(this._panes).forEach(e=>{e&&e.remove()}),this._panes={}}clearLayers(){Object.values(this._layers).forEach(e=>{this._map.removeLayer(e)}),this._layers={}}styleGeoJSONLayer(e){return{pointToLayer:(n,o)=>{if(!n.properties)throw new Error("Feature has no properties");if(typeof n.properties.mode!="string")throw new Error("Feature mode is not a string");const s=(0,e[n.properties.mode])(n),h=String(s.zIndex);return this._panes[h]||(this._panes[h]=this.createPaneStyleSheet(h,s.zIndex)),this._lib.circleMarker(o,{radius:s.pointWidth,stroke:s.pointOutlineWidth||!1,color:s.pointOutlineColor,weight:s.pointOutlineWidth,fillOpacity:.8,fillColor:s.pointColor,pane:h,interactive:!1})},style:n=>{if(!n||!n.properties)return{};const o=n,s=(0,e[o.properties.mode])(o),h=String(s.zIndex);return this._panes[h]||(this._panes[h]=this.createPaneStyleSheet(h,s.zIndex)),o.geometry.type==="LineString"?{interactive:!1,color:s.lineStringColor,weight:s.lineStringWidth,pane:h}:o.geometry.type==="Polygon"?{interactive:!1,fillOpacity:s.polygonFillOpacity,fillColor:s.polygonFillColor,weight:s.polygonOutlineWidth,stroke:!0,color:s.polygonOutlineColor,pane:h}:{}}}}getLngLatFromEvent(e){const{containerX:n,containerY:o}=this.getMapElementXYPosition(e),s=this._map.containerPointToLatLng({x:n,y:o});return s.lng===null||isNaN(s.lng)||s.lat===null||isNaN(s.lat)?null:{lng:s.lng,lat:s.lat}}getMapEventElement(){return this._container}setDraggability(e){e?this._map.dragging.enable():this._map.dragging.disable()}project(e,n){const{x:o,y:s}=this._map.latLngToContainerPoint({lng:e,lat:n});return{x:o,y:s}}unproject(e,n){const{lng:o,lat:s}=this._map.containerPointToLatLng({x:e,y:n});return{lng:o,lat:s}}setCursor(e){e==="unset"?this.getMapEventElement().style.removeProperty("cursor"):this.getMapEventElement().style.cursor=e}setDoubleClickToZoom(e){e?this._map.doubleClickZoom.enable():this._map.doubleClickZoom.disable()}render(e,n){if(e.created.forEach(o=>{o.id&&(this._layers[o.id]=this._lib.geoJSON(o,this.styleGeoJSONLayer(n)),this._map.addLayer(this._layers[o.id]))}),e.deletedIds.forEach(o=>{this._layers[o]&&(this._map.removeLayer(this._layers[o]),delete this._layers[o])}),e.updated.forEach(o=>{o.id&&(this._layers[o.id]&&this._map.removeLayer(this._layers[o.id]),this._layers[o.id]=this._lib.geoJSON(o,this.styleGeoJSONLayer(n)),this._map.addLayer(this._layers[o.id]))}),e.created.length===0&&e.updated.length===0&&e.deletedIds.length===0){const o=[];Object.keys(this._layers).forEach(s=>{o.push(()=>{const h=this._layers[s],l=h.toGeoJSON();this._map.removeLayer(h);const c=this._lib.geoJSON(l,this.styleGeoJSONLayer(n));this._layers[s]=c,c.addTo(this._map),this._map.addLayer(this._layers[s])})}),setTimeout(()=>{o.forEach(s=>s())})}}clear(){this._currentModeCallbacks&&(this._currentModeCallbacks.onClear(),this.clearLayers(),this.clearPanes())}register(e){var n;super.register(e),(n=this._currentModeCallbacks)!=null&&n.onReady&&this._currentModeCallbacks.onReady()}getCoordinatePrecision(){return super.getCoordinatePrecision()}unregister(){return super.unregister()}};function mr(){return mr=Object.assign?Object.assign.bind():function(i){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var o in n)({}).hasOwnProperty.call(n,o)&&(i[o]=n[o])}return i},mr.apply(null,arguments)}var gr;(function(i){i.Commit="commit",i.Provisional="provisional",i.Finish="finish"})(gr||(gr={}));function sr(i){return!!(i&&typeof i=="object"&&i!==null&&!Array.isArray(i))}const oc="Feature mode property does not match the mode being added to";var vr;(function(i){i.Drawing="drawing",i.Select="select",i.Static="static",i.Render="render"})(vr||(vr={}));class sc{get state(){return this._state}set state(e){throw new Error("Please use the modes lifecycle methods")}get styles(){return this._styles}set styles(e){if(typeof e!="object")throw new Error("Styling must be an object");this.onStyleChange&&this.onStyleChange([],"styling"),this._styles=e}registerBehaviors(e){}constructor(e,n=!1){this._state="unregistered",this._styles={},this.behaviors=[],this.validate=void 0,this.pointerDistance=40,this.coordinatePrecision=void 0,this.onStyleChange=void 0,this.store=void 0,this.projection="web-mercator",this.setDoubleClickToZoom=void 0,this.unproject=void 0,this.project=void 0,this.setCursor=void 0,this.type=vr.Drawing,this.mode="base",n||this.updateOptions(e)}updateOptions(e){e!=null&&e.styles&&(this.styles=mr({},this._styles,e.styles)),e!=null&&e.pointerDistance&&(this.pointerDistance=e.pointerDistance),e!=null&&e.validation&&(this.validate=e&&e.validation),e!=null&&e.projection&&(this.projection=e.projection)}setDrawing(){if(this._state!=="started")throw new Error("Mode must be unregistered or stopped to start");this._state="drawing"}setStarted(){if(this._state!=="stopped"&&this._state!=="registered"&&this._state!=="drawing"&&this._state!=="selecting")throw new Error("Mode must be unregistered or stopped to start");this._state="started",this.setDoubleClickToZoom(!1)}setStopped(){if(this._state!=="started")throw new Error("Mode must be started to be stopped");this._state="stopped",this.setDoubleClickToZoom(!0)}register(e){if(this._state!=="unregistered")throw new Error("Can not register unless mode is unregistered");this._state="registered",this.store=e.store,this.store.registerOnChange(e.onChange),this.setDoubleClickToZoom=e.setDoubleClickToZoom,this.project=e.project,this.unproject=e.unproject,this.onSelect=e.onSelect,this.onDeselect=e.onDeselect,this.setCursor=e.setCursor,this.onStyleChange=e.onChange,this.onFinish=e.onFinish,this.coordinatePrecision=e.coordinatePrecision,this.registerBehaviors({mode:e.mode,store:this.store,project:this.project,unproject:this.unproject,pointerDistance:this.pointerDistance,coordinatePrecision:e.coordinatePrecision,projection:this.projection})}validateFeature(e){return this.performFeatureValidation(e)}afterFeatureAdded(e){}performFeatureValidation(e){if(this._state==="unregistered")throw new Error("Mode must be registered");const n=function(o,s){let h;if(sr(o))if(o.id==null)h="Feature has no id";else if(typeof o.id!="string"&&typeof o.id!="number")h="Feature must be string or number as per GeoJSON spec";else if(s(o.id))if(sr(o.geometry))if(sr(o.properties))if(typeof o.geometry.type=="string"&&["Polygon","LineString","Point"].includes(o.geometry.type))if(Array.isArray(o.geometry.coordinates)){if(!o.properties.mode||typeof o.properties.mode!="string")return{valid:!1,reason:"Feature does not have a valid mode property"}}else h="Feature coordinates is not an array";else h="Feature is not Point, LineString or Polygon";else h="Feature has no properties";else h="Feature has no geometry";else h="Feature must match the id strategy (default is UUID4)";else h="Feature is not object";return h?{valid:!1,reason:h}:{valid:!0}}(e,this.store.idStrategy.isValidId);if(this.validate){const o=this.validate(e,{project:this.project,unproject:this.unproject,coordinatePrecision:this.coordinatePrecision,updateType:gr.Provisional});return{valid:n.valid&&o.valid,reason:o.reason}}return{valid:n.valid,reason:n.reason}}validateModeFeature(e,n){const o=this.performFeatureValidation(e);return o.valid?e.properties.mode!==this.mode?{valid:!1,reason:oc}:n(e):{valid:!1,reason:o.reason}}onFinish(e,n){}onDeselect(e){}onSelect(e){}onKeyDown(e){}onKeyUp(e){}onMouseMove(e){}onClick(e){}onDragStart(e,n){}onDrag(e,n){}onDragEnd(e,n){}getHexColorStylingValue(e,n,o){return this.getStylingValue(e,n,o)}getNumericStylingValue(e,n,o){return this.getStylingValue(e,n,o)}getStylingValue(e,n,o){return e===void 0?n:typeof e=="function"?e(o):e}}var ac={__proto__:null,TerraDrawBaseDrawMode:sc};const{TerraDrawBaseDrawMode:hc}=ac;class lc extends hc{constructor(e){if(super(e),this.mode="routesnap",this.currentCoordinate=0,this.currentPointIds=[],this.pixelDistance=(n,o)=>{const{x:s,y:h}=n,{x:l,y:c}=o,d=l-s,_=c-h;return Math.sqrt(_*_+d*d)},this.routing=e.routing,this.maxPoints=e.maxPoints||1,(e==null?void 0:e.keyEvents)===null)this.keyEvents={cancel:null,finish:null};else{const n={cancel:"Escape",finish:"Enter"};this.keyEvents=e&&e.keyEvents?{...n,...e.keyEvents}:n}}measure(e,n){const{x:o,y:s}=this.project(n[0],n[1]);return this.pixelDistance({x:o,y:s},{x:e.containerX,y:e.containerY})}close(){this.currentId&&(this.currentCoordinate=0,this.currentId=void 0,this.currentPointIds=[],this.state==="drawing"&&this.setStarted())}registerBehaviors(e){}start(){this.setStarted(),this.setCursor("crosshair")}stop(){this.cleanUp(),this.setStopped(),this.setCursor("unset")}onMouseMove(e){if(this.setCursor("crosshair"),!this.currentId||this.currentCoordinate===0)return;if(this.currentId){const c=this.store.getGeometryCopy(this.currentId);if(this.measure(e,c.coordinates[c.coordinates.length-1])<this.pointerDistance){this.setCursor("pointer"),this.moveLineId&&(this.store.delete([this.moveLineId]),this.moveLineId=void 0);return}}const n=this.store.getGeometryCopy(this.currentId),o=[e.lng,e.lat];let s=this.routing.getClosestNetworkCoordinate(o);if(!s)return;const h=n.coordinates.length-1,l=this.routing.getRoute(n.coordinates[h],s);if(l)if(this.moveLineId)this.store.updateGeometry([{id:this.moveLineId,geometry:l.geometry}]);else{const[c]=this.store.create([{geometry:l.geometry,properties:{mode:this.mode,isDrawnRoute:!0}}]);this.moveLineId=c}}onClick(e){if(e.button==="right")return;this.setCursor("pointer");const n=[e.lng,e.lat];if(this.currentId){const s=this.store.getGeometryCopy(this.currentId);if(this.measure(e,s.coordinates[s.coordinates.length-1])<this.pointerDistance){this.currentCoordinate===1&&this.store.delete(this.currentPointIds),this.close();return}}let o=this.routing.getClosestNetworkCoordinate(n);if(this.currentCoordinate===0){if(o){const[s,h]=this.store.create([{geometry:{type:"LineString",coordinates:[o]},properties:{mode:this.mode,isDrawnRoute:!0}},{geometry:{type:"Point",coordinates:o},properties:{mode:this.mode,isDrawnRoute:!0}}]);this.currentId=s,this.currentPointIds.push(h),this.currentCoordinate++,this.state==="started"&&this.setDrawing()}}else if(this.currentCoordinate===1&&this.currentId&&o){const s=this.store.getGeometryCopy(this.currentId),h=this.routing.getRoute(s.coordinates[0],o);if(h){this.store.updateGeometry([{id:this.currentId,geometry:h==null?void 0:h.geometry}]);const[l]=this.store.create([{geometry:{type:"Point",coordinates:o},properties:{mode:this.mode,isDrawnRoute:!0}}]);this.currentCoordinate=2,this.currentPointIds.push(l)}if(this.maxPoints===1){this.close();return}}else if(this.currentCoordinate>1&&this.currentId&&o&&this.currentCoordinate<=this.maxPoints){const s=this.store.getGeometryCopy(this.currentId),h=s.coordinates.length-1,l=this.routing.getRoute(s.coordinates[h],o);if(l){const c={...s,coordinates:[...s.coordinates,...l.geometry.coordinates]};this.store.updateGeometry([{id:this.currentId,geometry:c}]);const[d]=this.store.create([{geometry:{type:"Point",coordinates:o},properties:{mode:this.mode,isDrawnRoute:!0}}]);this.maxPoints===this.currentCoordinate?this.close():(this.currentCoordinate++,this.currentPointIds.push(d))}}}onKeyDown(){}onKeyUp(e){e.key===this.keyEvents.cancel&&this.cleanUp(),e.key===this.keyEvents.finish&&this.close()}onDragStart(){}onDrag(){}onDragEnd(){}cleanUp(){try{this.currentId&&this.store.delete([this.currentId,...this.currentPointIds])}catch{}this.currentId=void 0,this.currentCoordinate=0,this.state==="drawing"&&this.setStarted()}styleFeature(e){const n={polygonFillColor:"#3f97e0",polygonOutlineColor:"#3f97e0",polygonOutlineWidth:4,polygonFillOpacity:.3,pointColor:"#B90E0A",pointOutlineColor:"#ffffff",pointOutlineWidth:2,pointWidth:5,lineStringColor:"#B90E0A",lineStringWidth:4,zIndex:0};return e.type==="Feature"&&e.geometry.type==="LineString"&&e.properties.mode===this.mode?(n.lineStringColor=this.styles.lineStringColor?this.styles.lineStringColor:n.lineStringColor,n.zIndex=10,n.lineStringWidth=this.styles.lineStringWidth?this.styles.lineStringWidth:n.lineStringWidth,n):(e.type==="Feature"&&e.geometry.type==="Point"&&e.properties.mode===this.mode&&(n.pointOutlineColor=this.styles.routePointColor!==void 0?this.styles.routePointColor:n.pointOutlineColor,n.pointOutlineWidth=this.styles.routePointOutlineWidth!==void 0?this.styles.routePointOutlineWidth:n.pointOutlineWidth),n)}}var Lt=63710088e-1,uc={centimeters:Lt*100,centimetres:Lt*100,degrees:Lt/111325,feet:Lt*3.28084,inches:Lt*39.37,kilometers:Lt/1e3,kilometres:Lt/1e3,meters:Lt,metres:Lt,miles:Lt/1609.344,millimeters:Lt*1e3,millimetres:Lt*1e3,nauticalmiles:Lt/1852,radians:1,yards:Lt*1.0936};function Ia(i,e,n){n===void 0&&(n={});var o={type:"Feature"};return(n.id===0||n.id)&&(o.id=n.id),n.bbox&&(o.bbox=n.bbox),o.properties=e||{},o.geometry=i,o}function pn(i,e,n){if(n===void 0&&(n={}),!i)throw new Error("coordinates is required");if(!Array.isArray(i))throw new Error("coordinates must be an Array");if(i.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!ws(i[0])||!ws(i[1]))throw new Error("coordinates must contain numbers");var o={type:"Point",coordinates:i};return Ia(o,e,n)}function cc(i,e,n){if(n===void 0&&(n={}),i.length<2)throw new Error("coordinates must be an array of two or more positions");var o={type:"LineString",coordinates:i};return Ia(o,e,n)}function Ba(i,e){e===void 0&&(e={});var n={type:"FeatureCollection"};return e.id&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.features=i,n}function dc(i,e){e===void 0&&(e="kilometers");var n=uc[e];if(!n)throw new Error(e+" units is invalid");return i*n}function $i(i){var e=i%360;return e*Math.PI/180}function ws(i){return!isNaN(i)&&i!==null&&!Array.isArray(i)}function fc(i,e,n,o={}){const s={vertices:Object.keys(i).reduce((m,v)=>(m[v]={...i[v]},m),{}),coordinates:Object.keys(i).reduce((m,v)=>{m[v]={};for(const w of Object.keys(i[v]))m[v][w]=[e[v]];return m},{}),edgeData:"edgeDataReducer"in o?Object.keys(i).reduce((m,v)=>(m[v]=Object.keys(i[v]).reduce((w,b)=>(w[b]=n[v][b],w),{}),m),{}):{}},{vertices:h,coordinates:l,edgeData:c}=s,d="edgeDataReducer"in o&&c,_=Object.keys(i).filter(m=>mc(i,m));for(const m of _){const v=h[m],w=Object.keys(v);if(w.length!==0){for(const b of w)for(const C of w)b!==C&&(f(m,b,C),f(m,C,b));for(const b of w){if(!h[b])throw new Error(`Missing neighbor vertex for ${b}`);delete h[b][m],delete l[b][m]}delete h[m],delete l[m]}}return s;function f(m,v,w){const b=h[m],C=h[v],E=C[m];if(!C[w]&&E){C[w]=E+b[w],l[v][w]=[...l[v][m],...l[m][w]];let I=d?c[v][m]:void 0;const x=d?c[m][w]:void 0;d&&I&&x&&(c[v][w]=o.edgeDataReducer(I,x))}}}function pc(i,e,n,o,s,h,l={}){const c=e[i];return Object.keys(c).reduce(d,{edges:{},incomingEdges:{},coordinates:{},incomingCoordinates:{},reducedEdges:{}});function d(_,f){const m=_c(i,f,e,n,o,s,h,l),v=m.weight,w=m.reverseWeight;if(m.vertexKey!==i&&((!_.edges[m.vertexKey]||_.edges[m.vertexKey]>v)&&(_.edges[m.vertexKey]=v,_.coordinates[m.vertexKey]=[o[i]].concat(m.coordinates),_.reducedEdges[m.vertexKey]=m.reducedEdge),!isNaN(w)&&(!_.incomingEdges[m.vertexKey]||_.incomingEdges[m.vertexKey]>w))){_.incomingEdges[m.vertexKey]=w;var b=[o[i]].concat(m.coordinates);b.reverse(),_.incomingCoordinates[m.vertexKey]=b}return _}}function _c(i,e,n,o,s,h,l,c={}){var C;let d=n[i][e],_=n[e][i];const f=[],m=[];let v="edgeDataReducer"in c?h[e][i]:void 0;for(;!o[e];){var w=n[e];if(!w)break;var b=Object.keys(w).filter(function(x){return x!==i})[0];d+=w[b];{if(_+=((C=n[b])==null?void 0:C[e])||1/0,m.indexOf(e)>=0){o[e]=n[e];break}m.push(e)}const E=h[e]&&h[e][b];"edgeDataReducer"in c&&v&&E&&(v=c.edgeDataReducer(v,E)),f.push(s[e]),i=e,e=b}return{vertexKey:e,weight:d,reverseWeight:_,coordinates:f,reducedEdge:v}}function mc(i,e){const n=i[e],o=Object.keys(n);switch(o.length){case 1:return!i[o[0]][e];case 2:return o.every(h=>i[h][e]);default:return!1}}let gc=class{constructor(e=[],n=vc){if(this.data=e,this.length=this.data.length,this.compare=n,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],n=this.data.pop();return this.length--,this.length>0&&(this.data[0]=n,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:n,compare:o}=this,s=n[e];for(;e>0;){const h=e-1>>1,l=n[h];if(o(s,l)>=0)break;n[e]=l,e=h}n[e]=s}_down(e){const{data:n,compare:o}=this,s=this.length>>1,h=n[e];for(;e<s;){let l=(e<<1)+1,c=n[l];const d=l+1;if(d<this.length&&o(n[d],c)<0&&(l=d,c=n[d]),o(c,h)>=0)break;n[e]=c,e=l}n[e]=h}};function vc(i,e){return i<e?-1:i>e?1:0}function yc(i,e,n){const o={[e]:0},s=[0,[e],e],h=new gc([s],(l,c)=>l[0]-c[0]);for(;;){const l=h.pop();if(!l)return;const c=l[0],d=l[2];if(d===n)return[l[0],l[1]];const _=i[d];Object.keys(_).forEach(function(f){var m=c+_[f];if(m<1/0&&(!(f in o)||m<o[f])){o[f]=m;const v=[m,l[1].concat([f]),f];h.push(v)}})}}function xs(i){if(!i)throw new Error("coord is required");if(!Array.isArray(i)){if(i.type==="Feature"&&i.geometry!==null&&i.geometry.type==="Point")return i.geometry.coordinates;if(i.type==="Point")return i.coordinates}if(Array.isArray(i)&&i.length>=2&&!Array.isArray(i[0])&&!Array.isArray(i[1]))return i;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function wc(i,e,n){n===void 0&&(n={});var o=xs(i),s=xs(e),h=$i(s[1]-o[1]),l=$i(s[0]-o[0]),c=$i(o[1]),d=$i(s[1]),_=Math.pow(Math.sin(h/2),2)+Math.pow(Math.sin(l/2),2)*Math.cos(c)*Math.cos(d);return dc(2*Math.atan2(Math.sqrt(_),Math.sqrt(1-_)),n.units)}function yr(i,e,n){if(i!==null)for(var o,s,h,l,c,d,_,f=0,m=0,v,w=i.type,b=w==="FeatureCollection",C=w==="Feature",E=b?i.features.length:1,I=0;I<E;I++){_=b?i.features[I].geometry:C?i.geometry:i,v=_?_.type==="GeometryCollection":!1,c=v?_.geometries.length:1;for(var x=0;x<c;x++){var P=0,k=0;if(l=v?_.geometries[x]:_,l!==null){d=l.coordinates;var B=l.type;switch(f=0,B){case null:break;case"Point":if(e(d,m,I,P,k)===!1)return!1;m++,P++;break;case"LineString":case"MultiPoint":for(o=0;o<d.length;o++){if(e(d[o],m,I,P,k)===!1)return!1;m++,B==="MultiPoint"&&P++}B==="LineString"&&P++;break;case"Polygon":case"MultiLineString":for(o=0;o<d.length;o++){for(s=0;s<d[o].length-f;s++){if(e(d[o][s],m,I,P,k)===!1)return!1;m++}B==="MultiLineString"&&P++,B==="Polygon"&&k++}B==="Polygon"&&P++;break;case"MultiPolygon":for(o=0;o<d.length;o++){for(k=0,s=0;s<d[o].length;s++){for(h=0;h<d[o][s].length-f;h++){if(e(d[o][s][h],m,I,P,k)===!1)return!1;m++}k++}P++}break;case"GeometryCollection":for(o=0;o<l.geometries.length;o++)if(yr(l.geometries[o],e)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function xc(i,e){if(i.type==="Feature")e(i,0);else if(i.type==="FeatureCollection")for(var n=0;n<i.features.length&&e(i.features[n],n)!==!1;n++);}function bc(i){var e=[];return i.type==="FeatureCollection"?xc(i,function(n){yr(n,function(o){e.push(pn(o,n.properties))})}):yr(i,function(n){e.push(pn(n,i.properties))}),Ba(e)}function mi(i,e){return[Math.round(i[0]/e)*e,Math.round(i[1]/e)*e]}function Pc(i,e={}){const{key:n=Oa}=e,{tolerance:o=1e-5}=e,s=Ba(i.features.filter(_=>_.geometry.type==="LineString")),l=bc(s).features.reduce(function(f,m,v,w){var b=mi(m.geometry.coordinates,o);return f[n(b)]=m.geometry.coordinates,v%1e3===0&&e.progress&&e.progress("topo:vertices",v,w.length),f},{}),c=Aa(s,d,[]);return{vertices:l,edges:c};function d(_,f){return f.geometry.coordinates.forEach(function(v,w,b){if(w>0){var C=n(mi(b[w-1],o)),E=n(mi(v,o));_.push([C,E,f.properties])}}),_}}function Aa(i,e,n){return i.type==="FeatureCollection"?i.features.reduce(function(s,h){return Aa(h,e,s)},n):e(n,i)}function Oa(i){return i.join(",")}function Mc(i,e={}){const n=Pc(i,e),{weight:o=Lc}=e,s=n.edges.reduce(d,{edgeData:{},vertices:{}}),{vertices:h,coordinates:l,edgeData:c}=fc(s.vertices,n.vertices,s.edgeData,e);return{vertices:s.vertices,edgeData:s.edgeData,sourceCoordinates:n.vertices,compactedVertices:h,compactedCoordinates:l,compactedEdges:c};function d(_,f,m,v){const[w,b,C]=f,E=o(n.vertices[w],n.vertices[b],C);return E&&(I(w),I(b),E instanceof Object?(x(w,b,E.forward||1/0),x(b,w,E.backward||1/0)):(x(w,b,E||1/0),x(b,w,E||1/0))),m%1e3===0&&e.progress&&e.progress("edgeweights",m,v.length),_;function I(P){_.vertices[P]||(_.vertices[P]={},_.edgeData[P]={})}function x(P,k,B){var O=_.vertices[P];O[k]=B,_.edgeData[P][k]="edgeDataReducer"in e?e.edgeDataSeed(C):void 0}}}function Lc(i,e){return wc(pn(i),pn(e))}class Cc{constructor(e,n={}){this.graph=Mc(e,n),this.options=n}findPath(e,n){const{key:o=Oa,tolerance:s=1e-5}=this.options,h=o(mi(e.geometry.coordinates,s)),l=o(mi(n.geometry.coordinates,s));if(!this.graph.vertices[h]||!this.graph.vertices[l])return;const c=this._createPhantom(h),d=this._createPhantom(l);try{const _=yc(this.graph.compactedVertices,h,l);if(_){const[f,m]=_;return{path:m.reduce((v,w,b,C)=>(b>0&&(v=v.concat(this.graph.compactedCoordinates[C[b-1]][w])),v),[]).concat([this.graph.sourceCoordinates[l]]),weight:f,edgeDatas:"edgeDataReducer"in this.options?m.reduce((v,w,b,C)=>(b>0&&v.push(this.graph.compactedEdges[C[b-1]][w]),v),[]):void 0}}else return}finally{this._removePhantom(c),this._removePhantom(d)}}_createPhantom(e){if(this.graph.compactedVertices[e])return;const n=pc(e,this.graph.vertices,this.graph.compactedVertices,this.graph.sourceCoordinates,this.graph.edgeData,!0,this.options);return this.graph.compactedVertices[e]=n.edges,this.graph.compactedCoordinates[e]=n.coordinates,"edgeDataReducer"in this.options&&(this.graph.compactedEdges[e]=n.reducedEdges),Object.keys(n.incomingEdges).forEach(o=>{this.graph.compactedVertices[o][e]=n.incomingEdges[o],this.graph.compactedCoordinates[o]||(this.graph.compactedCoordinates[o]={}),this.graph.compactedCoordinates[o][e]=[this.graph.sourceCoordinates[o],...n.incomingCoordinates[o].slice(0,-1)],this.graph.compactedEdges&&(this.graph.compactedEdges[o]||(this.graph.compactedEdges[o]={}),this.graph.compactedEdges[o][e]=n.reducedEdges[o])}),e}_removePhantom(e){e&&(Object.keys(this.graph.compactedVertices[e]).forEach(n=>{delete this.graph.compactedVertices[n][e]}),Object.keys(this.graph.compactedCoordinates[e]).forEach(n=>{delete this.graph.compactedCoordinates[n][e]}),"edgeDataReducer"in this.options&&Object.keys(this.graph.compactedEdges[e]).forEach(n=>{delete this.graph.compactedEdges[n][e]}),delete this.graph.compactedVertices[e],delete this.graph.compactedCoordinates[e],this.graph.compactedEdges&&delete this.graph.compactedEdges[e])}}function Sc(i){if(i){const{weight:e,edgeDatas:n}=i;return cc(i.path,{weight:e,edgeDatas:n})}}function wr(i,e,n,o,s,h){if(s-o<=n)return;const l=o+s>>1;Fa(i,e,l,o,s,h%2),wr(i,e,n,o,l-1,h+1),wr(i,e,n,l+1,s,h+1)}function Fa(i,e,n,o,s,h){for(;s>o;){if(s-o>600){const _=s-o+1,f=n-o+1,m=Math.log(_),v=.5*Math.exp(2*m/3),w=.5*Math.sqrt(m*v*(_-v)/_)*(f-_/2<0?-1:1),b=Math.max(o,Math.floor(n-f*v/_+w)),C=Math.min(s,Math.floor(n+(_-f)*v/_+w));Fa(i,e,n,b,C,h)}const l=e[2*n+h];let c=o,d=s;for(oi(i,e,o,n),e[2*s+h]>l&&oi(i,e,o,s);c<d;){for(oi(i,e,c,d),c++,d--;e[2*c+h]<l;)c++;for(;e[2*d+h]>l;)d--}e[2*o+h]===l?oi(i,e,o,d):(d++,oi(i,e,d,s)),d<=n&&(o=d+1),n<=d&&(s=d-1)}}function oi(i,e,n,o){ar(i,n,o),ar(e,2*n,2*o),ar(e,2*n+1,2*o+1)}function ar(i,e,n){const o=i[e];i[e]=i[n],i[n]=o}function kc(i,e,n,o,s,h,l){const c=[0,i.length-1,0],d=[];let _,f;for(;c.length;){const m=c.pop(),v=c.pop(),w=c.pop();if(v-w<=l){for(let E=w;E<=v;E++)_=e[2*E],f=e[2*E+1],_>=n&&_<=s&&f>=o&&f<=h&&d.push(i[E]);continue}const b=Math.floor((w+v)/2);_=e[2*b],f=e[2*b+1],_>=n&&_<=s&&f>=o&&f<=h&&d.push(i[b]);const C=(m+1)%2;(m===0?n<=_:o<=f)&&(c.push(w),c.push(b-1),c.push(C)),(m===0?s>=_:h>=f)&&(c.push(b+1),c.push(v),c.push(C))}return d}function Ec(i,e,n,o,s,h){const l=[0,i.length-1,0],c=[],d=s*s;for(;l.length;){const _=l.pop(),f=l.pop(),m=l.pop();if(f-m<=h){for(let E=m;E<=f;E++)bs(e[2*E],e[2*E+1],n,o)<=d&&c.push(i[E]);continue}const v=Math.floor((m+f)/2),w=e[2*v],b=e[2*v+1];bs(w,b,n,o)<=d&&c.push(i[v]);const C=(_+1)%2;(_===0?n-s<=w:o-s<=b)&&(l.push(m),l.push(v-1),l.push(C)),(_===0?n+s>=w:o+s>=b)&&(l.push(v+1),l.push(f),l.push(C))}return c}function bs(i,e,n,o){const s=i-n,h=e-o;return s*s+h*h}const Tc=i=>i[0],Dc=i=>i[1];class zc{constructor(e,n=Tc,o=Dc,s=64,h=Float64Array){this.nodeSize=s,this.points=e;const l=e.length<65536?Uint16Array:Uint32Array,c=this.ids=new l(e.length),d=this.coords=new h(e.length*2);for(let _=0;_<e.length;_++)c[_]=_,d[2*_]=n(e[_]),d[2*_+1]=o(e[_]);wr(c,d,s,0,c.length-1,0)}range(e,n,o,s){return kc(this.ids,this.coords,e,n,o,s,this.nodeSize)}within(e,n,o){return Ec(this.ids,this.coords,e,n,o,this.nodeSize)}}var Ar={},Or={exports:{}};Or.exports=xi;Or.exports.default=xi;function xi(i,e){if(!(this instanceof xi))return new xi(i,e);if(this.data=i||[],this.length=this.data.length,this.compare=e||Ic,this.length>0)for(var n=(this.length>>1)-1;n>=0;n--)this._down(n)}function Ic(i,e){return i<e?-1:i>e?1:0}xi.prototype={push:function(i){this.data.push(i),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var i=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),i}},peek:function(){return this.data[0]},_up:function(i){for(var e=this.data,n=this.compare,o=e[i];i>0;){var s=i-1>>1,h=e[s];if(n(o,h)>=0)break;e[i]=h,i=s}e[i]=o},_down:function(i){for(var e=this.data,n=this.compare,o=this.length>>1,s=e[i];i<o;){var h=(i<<1)+1,l=h+1,c=e[h];if(l<this.length&&n(e[l],c)<0&&(h=l,c=e[l]),n(c,s)>=0)break;e[i]=c,i=h}e[i]=s}};var Bc=Or.exports,Ac=Bc;Ar.around=Oc;Ar.distance=Zc;var Za=6371,Ps=40007,oe=Math.PI/180;function Oc(i,e,n,o,s,h){var l=[];o===void 0&&(o=1/0),s===void 0&&(s=1/0);for(var c=Math.cos(n*oe),d=Math.sin(n*oe),_=Ac(null,Fc),f={left:0,right:i.ids.length-1,axis:0,minLng:-180,minLat:-90,maxLng:180,maxLat:90};f;){var m=f.right,v=f.left;if(m-v<=i.nodeSize)for(var w=v;w<=m;w++){var b=i.points[i.ids[w]];(!h||h(b))&&_.push({item:b,dist:xr(e,n,i.coords[2*w],i.coords[2*w+1],c,d)})}else{var C=v+m>>1,E=i.coords[2*C],I=i.coords[2*C+1];b=i.points[i.ids[C]],(!h||h(b))&&_.push({item:b,dist:xr(e,n,E,I,c,d)});var x=(f.axis+1)%2,P={left:v,right:C-1,axis:x,minLng:f.minLng,minLat:f.minLat,maxLng:f.axis===0?E:f.maxLng,maxLat:f.axis===1?I:f.maxLat,dist:0},k={left:C+1,right:m,axis:x,minLng:f.axis===0?E:f.minLng,minLat:f.axis===1?I:f.minLat,maxLng:f.maxLng,maxLat:f.maxLat,dist:0};P.dist=Ms(e,n,P,c,d),k.dist=Ms(e,n,k,c,d),_.push(P),_.push(k)}for(;_.length&&_.peek().item;){var B=_.pop();if(B.dist>s||(l.push(B.item),l.length===o))return l}f=_.pop()}return l}function Ms(i,e,n,o,s){var h=n.minLng,l=n.maxLng,c=n.minLat,d=n.maxLat;if(i>=h&&i<=l)return e<=c?Ps*(c-e)/360:e>=d?Ps*(e-d)/360:0;var _=(h-i+360)%360<=(i-l+360)%360?h:l,f=Math.cos((_-i)*oe),m=Math.atan(s/(o*f))/oe,v=Math.max(nn(c,o,s,f),nn(d,o,s,f));return m>c&&m<d&&(v=Math.max(v,nn(m,o,s,f))),Za*Math.acos(v)}function Fc(i,e){return i.dist-e.dist}function xr(i,e,n,o,s,h){var l=Math.cos((n-i)*oe);return Za*Math.acos(nn(o,s,h,l))}function nn(i,e,n,o){var s=n*Math.sin(i*oe)+e*Math.cos(i*oe)*o;return Math.min(s,1)}function Zc(i,e,n,o){return xr(i,e,n,o,Math.cos(e*oe),Math.sin(e*oe))}class Rc{constructor(e,n){this.useCache=!0,this._routeCache={},this.useCache=n||!0,this.network=e,this.pathFinder=new Cc(e);const o=[];this.network.features.forEach(s=>{s.geometry.coordinates.forEach(h=>{o.push(h)})}),this.indexedNetworkPoints=zc(o)}getClosestNetworkCoordinate(e){const n=Ar.around(this.indexedNetworkPoints,e[0],e[1],1);return n?n[0]:void 0}getRoute(e,n){const o=`${e}-${n}`;if(this.useCache&&this._routeCache[o])return this._routeCache[o];const s={type:"Feature",geometry:{type:"Point",coordinates:e},properties:{}},h={type:"Feature",geometry:{type:"Point",coordinates:n},properties:{}},l=this.pathFinder.findPath(s,h);if(l&&l.path.length>1){const c=Sc(l);if(this.useCache&&c)return this._routeCache[o]=c,c}}}function Nc(i,e,n){return new nc({adapter:new rc({lib:e,map:i,coordinatePrecision:9}),modes:[new lc({routing:new Rc(n),maxPoints:5}),new Xu({flags:{routesnap:{feature:{coordinates:{}}}}})]})}var jc=Object.create,yn=Object.defineProperty,Wc=Object.getOwnPropertyDescriptor,Uc=Object.getOwnPropertyNames,Ls=Object.getOwnPropertySymbols,Vc=Object.getPrototypeOf,Ra=Object.prototype.hasOwnProperty,Yc=Object.prototype.propertyIsEnumerable,Cs=(i,e,n)=>e in i?yn(i,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):i[e]=n,Hc=(i,e)=>{for(var n in e||(e={}))Ra.call(e,n)&&Cs(i,n,e[n]);if(Ls)for(var n of Ls(e))Yc.call(e,n)&&Cs(i,n,e[n]);return i},Xc=i=>yn(i,"__esModule",{value:!0}),Vt=(i,e)=>function(){return e||(0,i[Object.keys(i)[0]])((e={exports:{}}).exports,e),e.exports},Gc=(i,e,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of Uc(e))!Ra.call(i,o)&&o!=="default"&&yn(i,o,{get:()=>e[o],enumerable:!(n=Wc(e,o))||n.enumerable});return i},Tt=i=>Gc(Xc(yn(i!=null?jc(Vc(i)):{},"default",i&&i.__esModule&&"default"in i?{get:()=>i.default,enumerable:!0}:{value:i,enumerable:!0})),i),We=(i,e,n)=>new Promise((o,s)=>{var h=d=>{try{c(n.next(d))}catch(_){s(_)}},l=d=>{try{c(n.throw(d))}catch(_){s(_)}},c=d=>d.done?o(d.value):Promise.resolve(d.value).then(h,l);c((n=n.apply(i,e)).next())}),se=Vt({"node_modules/@mapbox/point-geometry/index.js"(i,e){e.exports=n;function n(o,s){this.x=o,this.y=s}n.prototype={clone:function(){return new n(this.x,this.y)},add:function(o){return this.clone()._add(o)},sub:function(o){return this.clone()._sub(o)},multByPoint:function(o){return this.clone()._multByPoint(o)},divByPoint:function(o){return this.clone()._divByPoint(o)},mult:function(o){return this.clone()._mult(o)},div:function(o){return this.clone()._div(o)},rotate:function(o){return this.clone()._rotate(o)},rotateAround:function(o,s){return this.clone()._rotateAround(o,s)},matMult:function(o){return this.clone()._matMult(o)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(o){return this.x===o.x&&this.y===o.y},dist:function(o){return Math.sqrt(this.distSqr(o))},distSqr:function(o){var s=o.x-this.x,h=o.y-this.y;return s*s+h*h},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(o){return Math.atan2(this.y-o.y,this.x-o.x)},angleWith:function(o){return this.angleWithSep(o.x,o.y)},angleWithSep:function(o,s){return Math.atan2(this.x*s-this.y*o,this.x*o+this.y*s)},_matMult:function(o){var s=o[0]*this.x+o[1]*this.y,h=o[2]*this.x+o[3]*this.y;return this.x=s,this.y=h,this},_add:function(o){return this.x+=o.x,this.y+=o.y,this},_sub:function(o){return this.x-=o.x,this.y-=o.y,this},_mult:function(o){return this.x*=o,this.y*=o,this},_div:function(o){return this.x/=o,this.y/=o,this},_multByPoint:function(o){return this.x*=o.x,this.y*=o.y,this},_divByPoint:function(o){return this.x/=o.x,this.y/=o.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var o=this.y;return this.y=this.x,this.x=-o,this},_rotate:function(o){var s=Math.cos(o),h=Math.sin(o),l=s*this.x-h*this.y,c=h*this.x+s*this.y;return this.x=l,this.y=c,this},_rotateAround:function(o,s){var h=Math.cos(o),l=Math.sin(o),c=s.x+h*(this.x-s.x)-l*(this.y-s.y),d=s.y+l*(this.x-s.x)+h*(this.y-s.y);return this.x=c,this.y=d,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},n.convert=function(o){return o instanceof n?o:Array.isArray(o)?new n(o[0],o[1]):o}}}),Na=Vt({"node_modules/@mapbox/vector-tile/lib/vectortilefeature.js"(i,e){var n=se();e.exports=o;function o(d,_,f,m,v){this.properties={},this.extent=f,this.type=0,this._pbf=d,this._geometry=-1,this._keys=m,this._values=v,d.readFields(s,this,_)}function s(d,_,f){d==1?_.id=f.readVarint():d==2?h(f,_):d==3?_.type=f.readVarint():d==4&&(_._geometry=f.pos)}function h(d,_){for(var f=d.readVarint()+d.pos;d.pos<f;){var m=_._keys[d.readVarint()],v=_._values[d.readVarint()];_.properties[m]=v}}o.types=["Unknown","Point","LineString","Polygon"],o.prototype.loadGeometry=function(){var d=this._pbf;d.pos=this._geometry;for(var _=d.readVarint()+d.pos,f=1,m=0,v=0,w=0,b=[],C;d.pos<_;){if(m<=0){var E=d.readVarint();f=E&7,m=E>>3}if(m--,f===1||f===2)v+=d.readSVarint(),w+=d.readSVarint(),f===1&&(C&&b.push(C),C=[]),C.push(new n(v,w));else if(f===7)C&&C.push(C[0].clone());else throw new Error("unknown command "+f)}return C&&b.push(C),b},o.prototype.bbox=function(){var d=this._pbf;d.pos=this._geometry;for(var _=d.readVarint()+d.pos,f=1,m=0,v=0,w=0,b=1/0,C=-1/0,E=1/0,I=-1/0;d.pos<_;){if(m<=0){var x=d.readVarint();f=x&7,m=x>>3}if(m--,f===1||f===2)v+=d.readSVarint(),w+=d.readSVarint(),v<b&&(b=v),v>C&&(C=v),w<E&&(E=w),w>I&&(I=w);else if(f!==7)throw new Error("unknown command "+f)}return[b,E,C,I]},o.prototype.toGeoJSON=function(d,_,f){var m=this.extent*Math.pow(2,f),v=this.extent*d,w=this.extent*_,b=this.loadGeometry(),C=o.types[this.type],E,I;function x(B){for(var O=0;O<B.length;O++){var A=B[O],F=180-(A.y+w)*360/m;B[O]=[(A.x+v)*360/m-180,360/Math.PI*Math.atan(Math.exp(F*Math.PI/180))-90]}}switch(this.type){case 1:var P=[];for(E=0;E<b.length;E++)P[E]=b[E][0];b=P,x(b);break;case 2:for(E=0;E<b.length;E++)x(b[E]);break;case 3:for(b=l(b),E=0;E<b.length;E++)for(I=0;I<b[E].length;I++)x(b[E][I]);break}b.length===1?b=b[0]:C="Multi"+C;var k={type:"Feature",geometry:{type:C,coordinates:b},properties:this.properties};return"id"in this&&(k.id=this.id),k};function l(d){var _=d.length;if(_<=1)return[d];for(var f=[],m,v,w=0;w<_;w++){var b=c(d[w]);b!==0&&(v===void 0&&(v=b<0),v===b<0?(m&&f.push(m),m=[d[w]]):m.push(d[w]))}return m&&f.push(m),f}function c(d){for(var _=0,f=0,m=d.length,v=m-1,w,b;f<m;v=f++)w=d[f],b=d[v],_+=(b.x-w.x)*(w.y+b.y);return _}}}),ja=Vt({"node_modules/@mapbox/vector-tile/lib/vectortilelayer.js"(i,e){var n=Na();e.exports=o;function o(l,c){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=l,this._keys=[],this._values=[],this._features=[],l.readFields(s,this,c),this.length=this._features.length}function s(l,c,d){l===15?c.version=d.readVarint():l===1?c.name=d.readString():l===5?c.extent=d.readVarint():l===2?c._features.push(d.pos):l===3?c._keys.push(d.readString()):l===4&&c._values.push(h(d))}function h(l){for(var c=null,d=l.readVarint()+l.pos;l.pos<d;){var _=l.readVarint()>>3;c=_===1?l.readString():_===2?l.readFloat():_===3?l.readDouble():_===4?l.readVarint64():_===5?l.readVarint():_===6?l.readSVarint():_===7?l.readBoolean():null}return c}o.prototype.feature=function(l){if(l<0||l>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[l];var c=this._pbf.readVarint()+this._pbf.pos;return new n(this._pbf,c,this.extent,this._keys,this._values)}}}),qc=Vt({"node_modules/@mapbox/vector-tile/lib/vectortile.js"(i,e){var n=ja();e.exports=o;function o(h,l){this.layers=h.readFields(s,{},l)}function s(h,l,c){if(h===3){var d=new n(c,c.readVarint()+c.pos);d.length&&(l[d.name]=d)}}}}),$c=Vt({"node_modules/@mapbox/vector-tile/index.js"(i,e){e.exports.VectorTile=qc(),e.exports.VectorTileFeature=Na(),e.exports.VectorTileLayer=ja()}}),Kc=Vt({"node_modules/ieee754/index.js"(i){i.read=function(e,n,o,s,h){var l,c,d=h*8-s-1,_=(1<<d)-1,f=_>>1,m=-7,v=o?h-1:0,w=o?-1:1,b=e[n+v];for(v+=w,l=b&(1<<-m)-1,b>>=-m,m+=d;m>0;l=l*256+e[n+v],v+=w,m-=8);for(c=l&(1<<-m)-1,l>>=-m,m+=s;m>0;c=c*256+e[n+v],v+=w,m-=8);if(l===0)l=1-f;else{if(l===_)return c?NaN:(b?-1:1)*(1/0);c=c+Math.pow(2,s),l=l-f}return(b?-1:1)*c*Math.pow(2,l-s)},i.write=function(e,n,o,s,h,l){var c,d,_,f=l*8-h-1,m=(1<<f)-1,v=m>>1,w=h===23?Math.pow(2,-24)-Math.pow(2,-77):0,b=s?0:l-1,C=s?1:-1,E=n<0||n===0&&1/n<0?1:0;for(n=Math.abs(n),isNaN(n)||n===1/0?(d=isNaN(n)?1:0,c=m):(c=Math.floor(Math.log(n)/Math.LN2),n*(_=Math.pow(2,-c))<1&&(c--,_*=2),c+v>=1?n+=w/_:n+=w*Math.pow(2,1-v),n*_>=2&&(c++,_/=2),c+v>=m?(d=0,c=m):c+v>=1?(d=(n*_-1)*Math.pow(2,h),c=c+v):(d=n*Math.pow(2,v-1)*Math.pow(2,h),c=0));h>=8;e[o+b]=d&255,b+=C,d/=256,h-=8);for(c=c<<h|d,f+=h;f>0;e[o+b]=c&255,b+=C,c/=256,f-=8);e[o+b-C]|=E*128}}}),Jc=Vt({"node_modules/pbf/index.js"(i,e){e.exports=o;var n=Kc();function o(y){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(y)?y:new Uint8Array(y||0),this.pos=0,this.type=0,this.length=this.buf.length}o.Varint=0,o.Fixed64=1,o.Bytes=2,o.Fixed32=5;var s=65536*65536,h=1/s,l=12,c=typeof TextDecoder>"u"?null:new TextDecoder("utf8");o.prototype={destroy:function(){this.buf=null},readFields:function(y,S,T){for(T=T||this.length;this.pos<T;){var U=this.readVarint(),R=U>>3,K=this.pos;this.type=U&7,y(R,S,this),this.pos===K&&this.skip(U)}return S},readMessage:function(y,S){return this.readFields(y,S,this.readVarint()+this.pos)},readFixed32:function(){var y=F(this.buf,this.pos);return this.pos+=4,y},readSFixed32:function(){var y=V(this.buf,this.pos);return this.pos+=4,y},readFixed64:function(){var y=F(this.buf,this.pos)+F(this.buf,this.pos+4)*s;return this.pos+=8,y},readSFixed64:function(){var y=F(this.buf,this.pos)+V(this.buf,this.pos+4)*s;return this.pos+=8,y},readFloat:function(){var y=n.read(this.buf,this.pos,!0,23,4);return this.pos+=4,y},readDouble:function(){var y=n.read(this.buf,this.pos,!0,52,8);return this.pos+=8,y},readVarint:function(y){var S=this.buf,T,U;return U=S[this.pos++],T=U&127,U<128||(U=S[this.pos++],T|=(U&127)<<7,U<128)||(U=S[this.pos++],T|=(U&127)<<14,U<128)||(U=S[this.pos++],T|=(U&127)<<21,U<128)?T:(U=S[this.pos],T|=(U&15)<<28,d(T,y,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var y=this.readVarint();return y%2===1?(y+1)/-2:y/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var y=this.readVarint()+this.pos,S=this.pos;return this.pos=y,y-S>=l&&c?$(this.buf,S,y):Y(this.buf,S,y)},readBytes:function(){var y=this.readVarint()+this.pos,S=this.buf.subarray(this.pos,y);return this.pos=y,S},readPackedVarint:function(y,S){if(this.type!==o.Bytes)return y.push(this.readVarint(S));var T=_(this);for(y=y||[];this.pos<T;)y.push(this.readVarint(S));return y},readPackedSVarint:function(y){if(this.type!==o.Bytes)return y.push(this.readSVarint());var S=_(this);for(y=y||[];this.pos<S;)y.push(this.readSVarint());return y},readPackedBoolean:function(y){if(this.type!==o.Bytes)return y.push(this.readBoolean());var S=_(this);for(y=y||[];this.pos<S;)y.push(this.readBoolean());return y},readPackedFloat:function(y){if(this.type!==o.Bytes)return y.push(this.readFloat());var S=_(this);for(y=y||[];this.pos<S;)y.push(this.readFloat());return y},readPackedDouble:function(y){if(this.type!==o.Bytes)return y.push(this.readDouble());var S=_(this);for(y=y||[];this.pos<S;)y.push(this.readDouble());return y},readPackedFixed32:function(y){if(this.type!==o.Bytes)return y.push(this.readFixed32());var S=_(this);for(y=y||[];this.pos<S;)y.push(this.readFixed32());return y},readPackedSFixed32:function(y){if(this.type!==o.Bytes)return y.push(this.readSFixed32());var S=_(this);for(y=y||[];this.pos<S;)y.push(this.readSFixed32());return y},readPackedFixed64:function(y){if(this.type!==o.Bytes)return y.push(this.readFixed64());var S=_(this);for(y=y||[];this.pos<S;)y.push(this.readFixed64());return y},readPackedSFixed64:function(y){if(this.type!==o.Bytes)return y.push(this.readSFixed64());var S=_(this);for(y=y||[];this.pos<S;)y.push(this.readSFixed64());return y},skip:function(y){var S=y&7;if(S===o.Varint)for(;this.buf[this.pos++]>127;);else if(S===o.Bytes)this.pos=this.readVarint()+this.pos;else if(S===o.Fixed32)this.pos+=4;else if(S===o.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+S)},writeTag:function(y,S){this.writeVarint(y<<3|S)},realloc:function(y){for(var S=this.length||16;S<this.pos+y;)S*=2;if(S!==this.length){var T=new Uint8Array(S);T.set(this.buf),this.buf=T,this.length=S}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(y){this.realloc(4),W(this.buf,y,this.pos),this.pos+=4},writeSFixed32:function(y){this.realloc(4),W(this.buf,y,this.pos),this.pos+=4},writeFixed64:function(y){this.realloc(8),W(this.buf,y&-1,this.pos),W(this.buf,Math.floor(y*h),this.pos+4),this.pos+=8},writeSFixed64:function(y){this.realloc(8),W(this.buf,y&-1,this.pos),W(this.buf,Math.floor(y*h),this.pos+4),this.pos+=8},writeVarint:function(y){if(y=+y||0,y>268435455||y<0){m(y,this);return}this.realloc(4),this.buf[this.pos++]=y&127|(y>127?128:0),!(y<=127)&&(this.buf[this.pos++]=(y>>>=7)&127|(y>127?128:0),!(y<=127)&&(this.buf[this.pos++]=(y>>>=7)&127|(y>127?128:0),!(y<=127)&&(this.buf[this.pos++]=y>>>7&127)))},writeSVarint:function(y){this.writeVarint(y<0?-y*2-1:y*2)},writeBoolean:function(y){this.writeVarint(!!y)},writeString:function(y){y=String(y),this.realloc(y.length*4),this.pos++;var S=this.pos;this.pos=X(this.buf,y,this.pos);var T=this.pos-S;T>=128&&b(S,T,this),this.pos=S-1,this.writeVarint(T),this.pos+=T},writeFloat:function(y){this.realloc(4),n.write(this.buf,y,this.pos,!0,23,4),this.pos+=4},writeDouble:function(y){this.realloc(8),n.write(this.buf,y,this.pos,!0,52,8),this.pos+=8},writeBytes:function(y){var S=y.length;this.writeVarint(S),this.realloc(S);for(var T=0;T<S;T++)this.buf[this.pos++]=y[T]},writeRawMessage:function(y,S){this.pos++;var T=this.pos;y(S,this);var U=this.pos-T;U>=128&&b(T,U,this),this.pos=T-1,this.writeVarint(U),this.pos+=U},writeMessage:function(y,S,T){this.writeTag(y,o.Bytes),this.writeRawMessage(S,T)},writePackedVarint:function(y,S){S.length&&this.writeMessage(y,C,S)},writePackedSVarint:function(y,S){S.length&&this.writeMessage(y,E,S)},writePackedBoolean:function(y,S){S.length&&this.writeMessage(y,P,S)},writePackedFloat:function(y,S){S.length&&this.writeMessage(y,I,S)},writePackedDouble:function(y,S){S.length&&this.writeMessage(y,x,S)},writePackedFixed32:function(y,S){S.length&&this.writeMessage(y,k,S)},writePackedSFixed32:function(y,S){S.length&&this.writeMessage(y,B,S)},writePackedFixed64:function(y,S){S.length&&this.writeMessage(y,O,S)},writePackedSFixed64:function(y,S){S.length&&this.writeMessage(y,A,S)},writeBytesField:function(y,S){this.writeTag(y,o.Bytes),this.writeBytes(S)},writeFixed32Field:function(y,S){this.writeTag(y,o.Fixed32),this.writeFixed32(S)},writeSFixed32Field:function(y,S){this.writeTag(y,o.Fixed32),this.writeSFixed32(S)},writeFixed64Field:function(y,S){this.writeTag(y,o.Fixed64),this.writeFixed64(S)},writeSFixed64Field:function(y,S){this.writeTag(y,o.Fixed64),this.writeSFixed64(S)},writeVarintField:function(y,S){this.writeTag(y,o.Varint),this.writeVarint(S)},writeSVarintField:function(y,S){this.writeTag(y,o.Varint),this.writeSVarint(S)},writeStringField:function(y,S){this.writeTag(y,o.Bytes),this.writeString(S)},writeFloatField:function(y,S){this.writeTag(y,o.Fixed32),this.writeFloat(S)},writeDoubleField:function(y,S){this.writeTag(y,o.Fixed64),this.writeDouble(S)},writeBooleanField:function(y,S){this.writeVarintField(y,!!S)}};function d(y,S,T){var U=T.buf,R,K;if(K=U[T.pos++],R=(K&112)>>4,K<128||(K=U[T.pos++],R|=(K&127)<<3,K<128)||(K=U[T.pos++],R|=(K&127)<<10,K<128)||(K=U[T.pos++],R|=(K&127)<<17,K<128)||(K=U[T.pos++],R|=(K&127)<<24,K<128)||(K=U[T.pos++],R|=(K&1)<<31,K<128))return f(y,R,S);throw new Error("Expected varint not more than 10 bytes")}function _(y){return y.type===o.Bytes?y.readVarint()+y.pos:y.pos+1}function f(y,S,T){return T?S*4294967296+(y>>>0):(S>>>0)*4294967296+(y>>>0)}function m(y,S){var T,U;if(y>=0?(T=y%4294967296|0,U=y/4294967296|0):(T=~(-y%4294967296),U=~(-y/4294967296),T^4294967295?T=T+1|0:(T=0,U=U+1|0)),y>=18446744073709552e3||y<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");S.realloc(10),v(T,U,S),w(U,S)}function v(y,S,T){T.buf[T.pos++]=y&127|128,y>>>=7,T.buf[T.pos++]=y&127|128,y>>>=7,T.buf[T.pos++]=y&127|128,y>>>=7,T.buf[T.pos++]=y&127|128,y>>>=7,T.buf[T.pos]=y&127}function w(y,S){var T=(y&7)<<4;S.buf[S.pos++]|=T|((y>>>=3)?128:0),y&&(S.buf[S.pos++]=y&127|((y>>>=7)?128:0),y&&(S.buf[S.pos++]=y&127|((y>>>=7)?128:0),y&&(S.buf[S.pos++]=y&127|((y>>>=7)?128:0),y&&(S.buf[S.pos++]=y&127|((y>>>=7)?128:0),y&&(S.buf[S.pos++]=y&127)))))}function b(y,S,T){var U=S<=16383?1:S<=2097151?2:S<=268435455?3:Math.floor(Math.log(S)/(Math.LN2*7));T.realloc(U);for(var R=T.pos-1;R>=y;R--)T.buf[R+U]=T.buf[R]}function C(y,S){for(var T=0;T<y.length;T++)S.writeVarint(y[T])}function E(y,S){for(var T=0;T<y.length;T++)S.writeSVarint(y[T])}function I(y,S){for(var T=0;T<y.length;T++)S.writeFloat(y[T])}function x(y,S){for(var T=0;T<y.length;T++)S.writeDouble(y[T])}function P(y,S){for(var T=0;T<y.length;T++)S.writeBoolean(y[T])}function k(y,S){for(var T=0;T<y.length;T++)S.writeFixed32(y[T])}function B(y,S){for(var T=0;T<y.length;T++)S.writeSFixed32(y[T])}function O(y,S){for(var T=0;T<y.length;T++)S.writeFixed64(y[T])}function A(y,S){for(var T=0;T<y.length;T++)S.writeSFixed64(y[T])}function F(y,S){return(y[S]|y[S+1]<<8|y[S+2]<<16)+y[S+3]*16777216}function W(y,S,T){y[T]=S,y[T+1]=S>>>8,y[T+2]=S>>>16,y[T+3]=S>>>24}function V(y,S){return(y[S]|y[S+1]<<8|y[S+2]<<16)+(y[S+3]<<24)}function Y(y,S,T){for(var U="",R=S;R<T;){var K=y[R],N=null,tt=K>239?4:K>223?3:K>191?2:1;if(R+tt>T)break;var J,ut,ht;tt===1?K<128&&(N=K):tt===2?(J=y[R+1],(J&192)===128&&(N=(K&31)<<6|J&63,N<=127&&(N=null))):tt===3?(J=y[R+1],ut=y[R+2],(J&192)===128&&(ut&192)===128&&(N=(K&15)<<12|(J&63)<<6|ut&63,(N<=2047||N>=55296&&N<=57343)&&(N=null))):tt===4&&(J=y[R+1],ut=y[R+2],ht=y[R+3],(J&192)===128&&(ut&192)===128&&(ht&192)===128&&(N=(K&15)<<18|(J&63)<<12|(ut&63)<<6|ht&63,(N<=65535||N>=1114112)&&(N=null))),N===null?(N=65533,tt=1):N>65535&&(N-=65536,U+=String.fromCharCode(N>>>10&1023|55296),N=56320|N&1023),U+=String.fromCharCode(N),R+=tt}return U}function $(y,S,T){return c.decode(y.subarray(S,T))}function X(y,S,T){for(var U=0,R,K;U<S.length;U++){if(R=S.charCodeAt(U),R>55295&&R<57344)if(K)if(R<56320){y[T++]=239,y[T++]=191,y[T++]=189,K=R;continue}else R=K-55296<<10|R-56320|65536,K=null;else{R>56319||U+1===S.length?(y[T++]=239,y[T++]=191,y[T++]=189):K=R;continue}else K&&(y[T++]=239,y[T++]=191,y[T++]=189,K=null);R<128?y[T++]=R:(R<2048?y[T++]=R>>6|192:(R<65536?y[T++]=R>>12|224:(y[T++]=R>>18|240,y[T++]=R>>12&63|128),y[T++]=R>>6&63|128),y[T++]=R&63|128)}return T}}}),Qc=Vt({"node_modules/rbush/rbush.min.js"(i,e){(function(n,o){typeof i=="object"&&typeof e<"u"?e.exports=o():typeof define=="function"&&define.amd?define(o):(n=n||self).RBush=o()})(i,function(){function n(x,P,k,B,O){(function A(F,W,V,Y,$){for(;Y>V;){if(Y-V>600){var X=Y-V+1,y=W-V+1,S=Math.log(X),T=.5*Math.exp(2*S/3),U=.5*Math.sqrt(S*T*(X-T)/X)*(y-X/2<0?-1:1),R=Math.max(V,Math.floor(W-y*T/X+U)),K=Math.min(Y,Math.floor(W+(X-y)*T/X+U));A(F,W,R,K,$)}var N=F[W],tt=V,J=Y;for(o(F,V,W),$(F[Y],N)>0&&o(F,V,Y);tt<J;){for(o(F,tt,J),tt++,J--;$(F[tt],N)<0;)tt++;for(;$(F[J],N)>0;)J--}$(F[V],N)===0?o(F,V,J):o(F,++J,Y),J<=W&&(V=J+1),W<=J&&(Y=J-1)}})(x,P,k||0,B||x.length-1,O||s)}function o(x,P,k){var B=x[P];x[P]=x[k],x[k]=B}function s(x,P){return x<P?-1:x>P?1:0}var h=function(x){x===void 0&&(x=9),this._maxEntries=Math.max(4,x),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function l(x,P,k){if(!k)return P.indexOf(x);for(var B=0;B<P.length;B++)if(k(x,P[B]))return B;return-1}function c(x,P){d(x,0,x.children.length,P,x)}function d(x,P,k,B,O){O||(O=E(null)),O.minX=1/0,O.minY=1/0,O.maxX=-1/0,O.maxY=-1/0;for(var A=P;A<k;A++){var F=x.children[A];_(O,x.leaf?B(F):F)}return O}function _(x,P){return x.minX=Math.min(x.minX,P.minX),x.minY=Math.min(x.minY,P.minY),x.maxX=Math.max(x.maxX,P.maxX),x.maxY=Math.max(x.maxY,P.maxY),x}function f(x,P){return x.minX-P.minX}function m(x,P){return x.minY-P.minY}function v(x){return(x.maxX-x.minX)*(x.maxY-x.minY)}function w(x){return x.maxX-x.minX+(x.maxY-x.minY)}function b(x,P){return x.minX<=P.minX&&x.minY<=P.minY&&P.maxX<=x.maxX&&P.maxY<=x.maxY}function C(x,P){return P.minX<=x.maxX&&P.minY<=x.maxY&&P.maxX>=x.minX&&P.maxY>=x.minY}function E(x){return{children:x,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function I(x,P,k,B,O){for(var A=[P,k];A.length;)if(!((k=A.pop())-(P=A.pop())<=B)){var F=P+Math.ceil((k-P)/B/2)*B;n(x,F,P,k,O),A.push(P,F,F,k)}}return h.prototype.all=function(){return this._all(this.data,[])},h.prototype.search=function(x){var P=this.data,k=[];if(!C(x,P))return k;for(var B=this.toBBox,O=[];P;){for(var A=0;A<P.children.length;A++){var F=P.children[A],W=P.leaf?B(F):F;C(x,W)&&(P.leaf?k.push(F):b(x,W)?this._all(F,k):O.push(F))}P=O.pop()}return k},h.prototype.collides=function(x){var P=this.data;if(!C(x,P))return!1;for(var k=[];P;){for(var B=0;B<P.children.length;B++){var O=P.children[B],A=P.leaf?this.toBBox(O):O;if(C(x,A)){if(P.leaf||b(x,A))return!0;k.push(O)}}P=k.pop()}return!1},h.prototype.load=function(x){if(!x||!x.length)return this;if(x.length<this._minEntries){for(var P=0;P<x.length;P++)this.insert(x[P]);return this}var k=this._build(x.slice(),0,x.length-1,0);if(this.data.children.length)if(this.data.height===k.height)this._splitRoot(this.data,k);else{if(this.data.height<k.height){var B=this.data;this.data=k,k=B}this._insert(k,this.data.height-k.height-1,!0)}else this.data=k;return this},h.prototype.insert=function(x){return x&&this._insert(x,this.data.height-1),this},h.prototype.clear=function(){return this.data=E([]),this},h.prototype.remove=function(x,P){if(!x)return this;for(var k,B,O,A=this.data,F=this.toBBox(x),W=[],V=[];A||W.length;){if(A||(A=W.pop(),B=W[W.length-1],k=V.pop(),O=!0),A.leaf){var Y=l(x,A.children,P);if(Y!==-1)return A.children.splice(Y,1),W.push(A),this._condense(W),this}O||A.leaf||!b(A,F)?B?(k++,A=B.children[k],O=!1):A=null:(W.push(A),V.push(k),k=0,B=A,A=A.children[0])}return this},h.prototype.toBBox=function(x){return x},h.prototype.compareMinX=function(x,P){return x.minX-P.minX},h.prototype.compareMinY=function(x,P){return x.minY-P.minY},h.prototype.toJSON=function(){return this.data},h.prototype.fromJSON=function(x){return this.data=x,this},h.prototype._all=function(x,P){for(var k=[];x;)x.leaf?P.push.apply(P,x.children):k.push.apply(k,x.children),x=k.pop();return P},h.prototype._build=function(x,P,k,B){var O,A=k-P+1,F=this._maxEntries;if(A<=F)return c(O=E(x.slice(P,k+1)),this.toBBox),O;B||(B=Math.ceil(Math.log(A)/Math.log(F)),F=Math.ceil(A/Math.pow(F,B-1))),(O=E([])).leaf=!1,O.height=B;var W=Math.ceil(A/F),V=W*Math.ceil(Math.sqrt(F));I(x,P,k,V,this.compareMinX);for(var Y=P;Y<=k;Y+=V){var $=Math.min(Y+V-1,k);I(x,Y,$,W,this.compareMinY);for(var X=Y;X<=$;X+=W){var y=Math.min(X+W-1,$);O.children.push(this._build(x,X,y,B-1))}}return c(O,this.toBBox),O},h.prototype._chooseSubtree=function(x,P,k,B){for(;B.push(P),!P.leaf&&B.length-1!==k;){for(var O=1/0,A=1/0,F=void 0,W=0;W<P.children.length;W++){var V=P.children[W],Y=v(V),$=(X=x,y=V,(Math.max(y.maxX,X.maxX)-Math.min(y.minX,X.minX))*(Math.max(y.maxY,X.maxY)-Math.min(y.minY,X.minY))-Y);$<A?(A=$,O=Y<O?Y:O,F=V):$===A&&Y<O&&(O=Y,F=V)}P=F||P.children[0]}var X,y;return P},h.prototype._insert=function(x,P,k){var B=k?x:this.toBBox(x),O=[],A=this._chooseSubtree(B,this.data,P,O);for(A.children.push(x),_(A,B);P>=0&&O[P].children.length>this._maxEntries;)this._split(O,P),P--;this._adjustParentBBoxes(B,O,P)},h.prototype._split=function(x,P){var k=x[P],B=k.children.length,O=this._minEntries;this._chooseSplitAxis(k,O,B);var A=this._chooseSplitIndex(k,O,B),F=E(k.children.splice(A,k.children.length-A));F.height=k.height,F.leaf=k.leaf,c(k,this.toBBox),c(F,this.toBBox),P?x[P-1].children.push(F):this._splitRoot(k,F)},h.prototype._splitRoot=function(x,P){this.data=E([x,P]),this.data.height=x.height+1,this.data.leaf=!1,c(this.data,this.toBBox)},h.prototype._chooseSplitIndex=function(x,P,k){for(var B,O,A,F,W,V,Y,$=1/0,X=1/0,y=P;y<=k-P;y++){var S=d(x,0,y,this.toBBox),T=d(x,y,k,this.toBBox),U=(O=S,A=T,F=void 0,W=void 0,V=void 0,Y=void 0,F=Math.max(O.minX,A.minX),W=Math.max(O.minY,A.minY),V=Math.min(O.maxX,A.maxX),Y=Math.min(O.maxY,A.maxY),Math.max(0,V-F)*Math.max(0,Y-W)),R=v(S)+v(T);U<$?($=U,B=y,X=R<X?R:X):U===$&&R<X&&(X=R,B=y)}return B||k-P},h.prototype._chooseSplitAxis=function(x,P,k){var B=x.leaf?this.compareMinX:f,O=x.leaf?this.compareMinY:m;this._allDistMargin(x,P,k,B)<this._allDistMargin(x,P,k,O)&&x.children.sort(B)},h.prototype._allDistMargin=function(x,P,k,B){x.children.sort(B);for(var O=this.toBBox,A=d(x,0,P,O),F=d(x,k-P,k,O),W=w(A)+w(F),V=P;V<k-P;V++){var Y=x.children[V];_(A,x.leaf?O(Y):Y),W+=w(A)}for(var $=k-P-1;$>=P;$--){var X=x.children[$];_(F,x.leaf?O(X):X),W+=w(F)}return W},h.prototype._adjustParentBBoxes=function(x,P,k){for(var B=k;B>=0;B--)_(P[B],x)},h.prototype._condense=function(x){for(var P=x.length-1,k=void 0;P>=0;P--)x[P].children.length===0?P>0?(k=x[P-1].children).splice(k.indexOf(x[P]),1):this.clear():c(x[P],this.toBBox)},h})}}),td=Vt({"src/types/unitbezier.d.ts"(){}}),ed=Vt({"node_modules/tinyqueue/tinyqueue.js"(i,e){(function(n,o){typeof i=="object"&&typeof e<"u"?e.exports=o():typeof define=="function"&&define.amd?define(o):(n=n||self,n.TinyQueue=o())})(i,function(){var n=function(h,l){if(h===void 0&&(h=[]),l===void 0&&(l=o),this.data=h,this.length=this.data.length,this.compare=l,this.length>0)for(var c=(this.length>>1)-1;c>=0;c--)this._down(c)};n.prototype.push=function(h){this.data.push(h),this.length++,this._up(this.length-1)},n.prototype.pop=function(){if(this.length!==0){var h=this.data[0],l=this.data.pop();return this.length--,this.length>0&&(this.data[0]=l,this._down(0)),h}},n.prototype.peek=function(){return this.data[0]},n.prototype._up=function(h){for(var l=this,c=l.data,d=l.compare,_=c[h];h>0;){var f=h-1>>1,m=c[f];if(d(_,m)>=0)break;c[h]=m,h=f}c[h]=_},n.prototype._down=function(h){for(var l=this,c=l.data,d=l.compare,_=this.length>>1,f=c[h];h<_;){var m=(h<<1)+1,v=c[m],w=m+1;if(w<this.length&&d(c[w],v)<0&&(m=w,v=c[w]),d(v,f)>=0)break;c[h]=v,h=m}c[h]=f};function o(s,h){return s<h?-1:s>h?1:0}return n})}}),id=Vt({"node_modules/polylabel/polylabel.js"(i,e){var n=ed();n.default&&(n=n.default),e.exports=o,e.exports.default=o;function o(_,f,m){f=f||1;for(var v,w,b,C,E=0;E<_[0].length;E++){var I=_[0][E];(!E||I[0]<v)&&(v=I[0]),(!E||I[1]<w)&&(w=I[1]),(!E||I[0]>b)&&(b=I[0]),(!E||I[1]>C)&&(C=I[1])}var x=b-v,P=C-w,k=Math.min(x,P),B=k/2;if(k===0){var O=[v,w];return O.distance=0,O}for(var A=new n(void 0,s),F=v;F<b;F+=k)for(var W=w;W<C;W+=k)A.push(new h(F+B,W+B,B,_));var V=c(_),Y=new h(v+x/2,w+P/2,0,_);Y.d>V.d&&(V=Y);for(var $=A.length;A.length;){var X=A.pop();X.d>V.d&&(V=X,m&&console.log("found best %d after %d probes",Math.round(1e4*X.d)/1e4,$)),!(X.max-V.d<=f)&&(B=X.h/2,A.push(new h(X.x-B,X.y-B,B,_)),A.push(new h(X.x+B,X.y-B,B,_)),A.push(new h(X.x-B,X.y+B,B,_)),A.push(new h(X.x+B,X.y+B,B,_)),$+=4)}m&&(console.log("num probes: "+$),console.log("best distance: "+V.d));var y=[V.x,V.y];return y.distance=V.d,y}function s(_,f){return f.max-_.max}function h(_,f,m,v){this.x=_,this.y=f,this.h=m,this.d=l(_,f,v),this.max=this.d+this.h*Math.SQRT2}function l(_,f,m){for(var v=!1,w=1/0,b=0;b<m.length;b++)for(var C=m[b],E=0,I=C.length,x=I-1;E<I;x=E++){var P=C[E],k=C[x];P[1]>f!=k[1]>f&&_<(k[0]-P[0])*(f-P[1])/(k[1]-P[1])+P[0]&&(v=!v),w=Math.min(w,d(_,f,P,k))}return w===0?0:(v?1:-1)*Math.sqrt(w)}function c(_){for(var f=0,m=0,v=0,w=_[0],b=0,C=w.length,E=C-1;b<C;E=b++){var I=w[b],x=w[E],P=I[0]*x[1]-x[0]*I[1];m+=(I[0]+x[0])*P,v+=(I[1]+x[1])*P,f+=P*3}return f===0?new h(w[0][0],w[0][1],0,_):new h(m/f,v/f,0,_)}function d(_,f,m,v){var w=m[0],b=m[1],C=v[0]-w,E=v[1]-b;if(C!==0||E!==0){var I=((_-w)*C+(f-b)*E)/(C*C+E*E);I>1?(w=v[0],b=v[1]):I>0&&(w+=C*I,b+=E*I)}return C=_-w,E=f-b,C*C+E*E}}});Tt(se());var De=Tt(se()),bi=Tt(se()),nd=Tt($c()),rd=Tt(Jc()),Pt=(i,e,n)=>new Promise((o,s)=>{var h=d=>{try{c(n.next(d))}catch(_){s(_)}},l=d=>{try{c(n.throw(d))}catch(_){s(_)}},c=d=>d.done?o(d.value):Promise.resolve(d.value).then(h,l);c((n=n.apply(i,e)).next())}),Et=Uint8Array,Fe=Uint16Array,Wa=Uint32Array,Ua=new Et([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Va=new Et([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),od=new Et([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Ya=function(i,e){for(var n=new Fe(31),o=0;o<31;++o)n[o]=e+=1<<i[o-1];for(var s=new Wa(n[30]),o=1;o<30;++o)for(var h=n[o];h<n[o+1];++h)s[h]=h-n[o]<<5|o;return[n,s]},Ha=Ya(Ua,2),Xa=Ha[0],sd=Ha[1];Xa[28]=258,sd[258]=28;var ad=Ya(Va,0),hd=ad[0],Ga=new Fe(32768);for(at=0;at<32768;++at)ee=(at&43690)>>>1|(at&21845)<<1,ee=(ee&52428)>>>2|(ee&13107)<<2,ee=(ee&61680)>>>4|(ee&3855)<<4,Ga[at]=((ee&65280)>>>8|(ee&255)<<8)>>>1;var ee,at,gi=function(i,e,n){for(var o=i.length,s=0,h=new Fe(e);s<o;++s)i[s]&&++h[i[s]-1];var l=new Fe(e);for(s=0;s<e;++s)l[s]=l[s-1]+h[s-1]<<1;var c;{c=new Fe(1<<e);var d=15-e;for(s=0;s<o;++s)if(i[s])for(var _=s<<4|i[s],f=e-i[s],m=l[i[s]-1]++<<f,v=m|(1<<f)-1;m<=v;++m)c[Ga[m]>>>d]=_}return c},Si=new Et(288);for(at=0;at<144;++at)Si[at]=8;var at;for(at=144;at<256;++at)Si[at]=9;var at;for(at=256;at<280;++at)Si[at]=7;var at;for(at=280;at<288;++at)Si[at]=8;var at,qa=new Et(32);for(at=0;at<32;++at)qa[at]=5;var at,ld=gi(Si,9),ud=gi(qa,5),hr=function(i){for(var e=i[0],n=1;n<i.length;++n)i[n]>e&&(e=i[n]);return e},Rt=function(i,e,n){var o=e/8|0;return(i[o]|i[o+1]<<8)>>(e&7)&n},lr=function(i,e){var n=e/8|0;return(i[n]|i[n+1]<<8|i[n+2]<<16)>>(e&7)},cd=function(i){return(i+7)/8|0},dd=function(i,e,n){(n==null||n>i.length)&&(n=i.length);var o=new(i.BYTES_PER_ELEMENT==2?Fe:i.BYTES_PER_ELEMENT==4?Wa:Et)(n-e);return o.set(i.subarray(e,n)),o},fd=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],jt=function(i,e,n){var o=new Error(e||fd[i]);if(o.code=i,Error.captureStackTrace&&Error.captureStackTrace(o,jt),!n)throw o;return o},Fr=function(i,e,n){var o=i.length;if(!o||n&&n.f&&!n.l)return e||new Et(0);var s=!e||n,h=!n||n.i;n||(n={}),e||(e=new Et(o*3));var l=function(nt){var Dt=e.length;if(nt>Dt){var Ot=new Et(Math.max(Dt*2,nt));Ot.set(e),e=Ot}},c=n.f||0,d=n.p||0,_=n.b||0,f=n.l,m=n.d,v=n.m,w=n.n,b=o*8;do{if(!f){c=Rt(i,d,1);var C=Rt(i,d+1,3);if(d+=3,C)if(C==1)f=ld,m=ud,v=9,w=5;else if(C==2){var P=Rt(i,d,31)+257,k=Rt(i,d+10,15)+4,B=P+Rt(i,d+5,31)+1;d+=14;for(var O=new Et(B),A=new Et(19),F=0;F<k;++F)A[od[F]]=Rt(i,d+F*3,7);d+=k*3;for(var W=hr(A),V=(1<<W)-1,Y=gi(A,W),F=0;F<B;){var $=Y[Rt(i,d,V)];d+=$&15;var E=$>>>4;if(E<16)O[F++]=E;else{var X=0,y=0;for(E==16?(y=3+Rt(i,d,3),d+=2,X=O[F-1]):E==17?(y=3+Rt(i,d,7),d+=3):E==18&&(y=11+Rt(i,d,127),d+=7);y--;)O[F++]=X}}var S=O.subarray(0,P),T=O.subarray(P);v=hr(S),w=hr(T),f=gi(S,v),m=gi(T,w)}else jt(1);else{var E=cd(d)+4,I=i[E-4]|i[E-3]<<8,x=E+I;if(x>o){h&&jt(0);break}s&&l(_+I),e.set(i.subarray(E,x),_),n.b=_+=I,n.p=d=x*8,n.f=c;continue}if(d>b){h&&jt(0);break}}s&&l(_+131072);for(var U=(1<<v)-1,R=(1<<w)-1,K=d;;K=d){var X=f[lr(i,d)&U],N=X>>>4;if(d+=X&15,d>b){h&&jt(0);break}if(X||jt(2),N<256)e[_++]=N;else if(N==256){K=d,f=null;break}else{var tt=N-254;if(N>264){var F=N-257,J=Ua[F];tt=Rt(i,d,(1<<J)-1)+Xa[F],d+=J}var ut=m[lr(i,d)&R],ht=ut>>>4;ut||jt(3),d+=ut&15;var T=hd[ht];if(ht>3){var J=Va[ht];T+=lr(i,d)&(1<<J)-1,d+=J}if(d>b){h&&jt(0);break}s&&l(_+131072);for(var st=_+tt;_<st;_+=4)e[_]=e[_-T],e[_+1]=e[_+1-T],e[_+2]=e[_+2-T],e[_+3]=e[_+3-T];_=st}}n.l=f,n.p=K,n.b=_,n.f=c,f&&(c=1,n.m=v,n.d=m,n.n=w)}while(!c);return _==e.length?e:dd(e,0,_)},pd=new Et(0),_d=function(i){(i[0]!=31||i[1]!=139||i[2]!=8)&&jt(6,"invalid gzip data");var e=i[3],n=10;e&4&&(n+=i[10]|(i[11]<<8)+2);for(var o=(e>>3&1)+(e>>4&1);o>0;o-=!i[n++]);return n+(e&2)},md=function(i){var e=i.length;return(i[e-4]|i[e-3]<<8|i[e-2]<<16|i[e-1]<<24)>>>0},gd=function(i){((i[0]&15)!=8||i[0]>>>4>7||(i[0]<<8|i[1])%31)&&jt(6,"invalid zlib data"),i[1]&32&&jt(6,"invalid zlib data: preset dictionaries not supported")};function vd(i,e){return Fr(i,e)}function yd(i,e){return Fr(i.subarray(_d(i),-8),new Et(md(i)))}function wd(i,e){return Fr((gd(i),i.subarray(2,-4)),e)}function br(i,e){return i[0]==31&&i[1]==139&&i[2]==8?yd(i):(i[0]&15)!=8||i[0]>>4>7||(i[0]<<8|i[1])%31?vd(i,e):wd(i,e)}var xd=typeof TextDecoder<"u"&&new TextDecoder,bd=0;try{xd.decode(pd,{stream:!0}),bd=1}catch{}var $a=(i,e)=>i*Math.pow(2,e),si=(i,e)=>Math.floor(i/Math.pow(2,e)),_n=(i,e)=>$a(i.getUint16(e+1,!0),8)+i.getUint8(e),Ka=(i,e)=>$a(i.getUint32(e+2,!0),16)+i.getUint16(e,!0),Pd=(i,e,n,o,s)=>{if(i!=o.getUint8(s))return i-o.getUint8(s);const h=_n(o,s+1);if(e!=h)return e-h;const l=_n(o,s+4);return n!=l?n-l:0},Md=(i,e,n,o)=>{const s=Ja(i,e|128,n,o);return s?{z:e,x:n,y:o,offset:s[0],length:s[1],is_dir:!0}:null},Ss=(i,e,n,o)=>{const s=Ja(i,e,n,o);return s?{z:e,x:n,y:o,offset:s[0],length:s[1],is_dir:!1}:null},Ja=(i,e,n,o)=>{let s=0,h=i.byteLength/17-1;for(;s<=h;){const l=h+s>>1,c=Pd(e,n,o,i,l*17);if(c>0)s=l+1;else if(c<0)h=l-1;else return[Ka(i,l*17+7),i.getUint32(l*17+13,!0)]}return null},Ld=(i,e)=>i.is_dir&&!e.is_dir?1:!i.is_dir&&e.is_dir?-1:i.z!==e.z?i.z-e.z:i.x!==e.x?i.x-e.x:i.y-e.y,Qa=(i,e)=>{const n=i.getUint8(e*17);return{z:n&127,x:_n(i,e*17+1),y:_n(i,e*17+4),offset:Ka(i,e*17+7),length:i.getUint32(e*17+13,!0),is_dir:n>>7===1}},ks=i=>{const e=[],n=new DataView(i);for(let o=0;o<n.byteLength/17;o++)e.push(Qa(n,o));return Cd(e)},Cd=i=>{i.sort(Ld);const e=new ArrayBuffer(17*i.length),n=new Uint8Array(e);for(let o=0;o<i.length;o++){const s=i[o];let h=s.z;s.is_dir&&(h=h|128),n[o*17]=h,n[o*17+1]=s.x&255,n[o*17+2]=s.x>>8&255,n[o*17+3]=s.x>>16&255,n[o*17+4]=s.y&255,n[o*17+5]=s.y>>8&255,n[o*17+6]=s.y>>16&255,n[o*17+7]=s.offset&255,n[o*17+8]=si(s.offset,8)&255,n[o*17+9]=si(s.offset,16)&255,n[o*17+10]=si(s.offset,24)&255,n[o*17+11]=si(s.offset,32)&255,n[o*17+12]=si(s.offset,48)&255,n[o*17+13]=s.length&255,n[o*17+14]=s.length>>8&255,n[o*17+15]=s.length>>16&255,n[o*17+16]=s.length>>24&255}return e},Sd=(i,e)=>{if(i.byteLength<17)return null;const n=i.byteLength/17,o=Qa(i,n-1);if(o.is_dir){const s=o.z,h=e.z-s,l=Math.trunc(e.x/(1<<h)),c=Math.trunc(e.y/(1<<h));return{z:s,x:l,y:c}}return null};function kd(i){return Pt(this,null,function*(){const e=yield i.getBytes(0,512e3),n=new DataView(e.data),o=n.getUint32(4,!0),s=n.getUint16(8,!0),h=new TextDecoder("utf-8"),l=JSON.parse(h.decode(new DataView(e.data,10,o)));let c=0;l.compression==="gzip"&&(c=2);let d=0;"minzoom"in l&&(d=+l.minzoom);let _=0;"maxzoom"in l&&(_=+l.maxzoom);let f=0,m=0,v=0,w=-180,b=-85,C=180,E=85;if(l.bounds){const x=l.bounds.split(",");w=+x[0],b=+x[1],C=+x[2],E=+x[3]}if(l.center){const x=l.center.split(",");f=+x[0],m=+x[1],v=+x[2]}return{specVersion:n.getUint16(2,!0),rootDirectoryOffset:10+o,rootDirectoryLength:s*17,jsonMetadataOffset:10,jsonMetadataLength:o,leafDirectoryOffset:0,leafDirectoryLength:void 0,tileDataOffset:0,tileDataLength:void 0,numAddressedTiles:0,numTileEntries:0,numTileContents:0,clustered:!1,internalCompression:1,tileCompression:c,tileType:1,minZoom:d,maxZoom:_,minLon:w,minLat:b,maxLon:C,maxLat:E,centerZoom:v,centerLon:f,centerLat:m,etag:e.etag}})}function Ed(i,e,n,o,s,h,l){return Pt(this,null,function*(){let c=yield n.getArrayBuffer(e,i.rootDirectoryOffset,i.rootDirectoryLength,i);i.specVersion===1&&(c=ks(c));const d=Ss(new DataView(c),o,s,h);if(d){let m=(yield e.getBytes(d.offset,d.length,l)).data;const v=new DataView(m);return v.getUint8(0)==31&&v.getUint8(1)==139&&(m=br(new Uint8Array(m))),{data:m}}const _=Sd(new DataView(c),{z:o,x:s,y:h});if(_){const f=Md(new DataView(c),_.z,_.x,_.y);if(f){let m=yield n.getArrayBuffer(e,f.offset,f.length,i);i.specVersion===1&&(m=ks(m));const v=Ss(new DataView(m),o,s,h);if(v){let b=(yield e.getBytes(v.offset,v.length,l)).data;const C=new DataView(b);return C.getUint8(0)==31&&C.getUint8(1)==139&&(b=br(new Uint8Array(b))),{data:b}}}}})}var th={getHeader:kd,getZxy:Ed};function ze(i,e){return(e>>>0)*4294967296+(i>>>0)}function Td(i,e){const n=e.buf;let o,s;if(s=n[e.pos++],o=(s&112)>>4,s<128||(s=n[e.pos++],o|=(s&127)<<3,s<128)||(s=n[e.pos++],o|=(s&127)<<10,s<128)||(s=n[e.pos++],o|=(s&127)<<17,s<128)||(s=n[e.pos++],o|=(s&127)<<24,s<128)||(s=n[e.pos++],o|=(s&1)<<31,s<128))return ze(i,o);throw new Error("Expected varint not more than 10 bytes")}function ai(i){const e=i.buf;let n,o;return o=e[i.pos++],n=o&127,o<128||(o=e[i.pos++],n|=(o&127)<<7,o<128)||(o=e[i.pos++],n|=(o&127)<<14,o<128)||(o=e[i.pos++],n|=(o&127)<<21,o<128)?n:(o=e[i.pos],n|=(o&15)<<28,Td(n,i))}function Dd(i,e,n,o){if(o==0){n==1&&(e[0]=i-1-e[0],e[1]=i-1-e[1]);const s=e[0];e[0]=e[1],e[1]=s}}function zd(i,e,n){if(i>26)throw Error("Tile zoom level exceeds max safe number limit (26)");if(e>Math.pow(2,i)-1||n>Math.pow(2,i)-1)throw Error("tile x/y outside zoom level bounds");let o=0,s=0;for(;s<i;)o+=Math.pow(2,s)*Math.pow(2,s),s++;const h=Math.pow(2,i);let l=0,c=0,d=0;const _=[e,n];let f=h/2;for(;f>0;)l=(_[0]&f)>0?1:0,c=(_[1]&f)>0?1:0,d+=f*f*(3*l^c),Dd(f,_,l,c),f=f/2;return o+d}function eh(i,e){return Pt(this,null,function*(){if(e===1||e===0)return i;if(e===2)return br(new Uint8Array(i));throw Error("Compression method not supported")})}var Id=127;function Bd(i,e){let n=0,o=i.length-1;for(;n<=o;){const s=o+n>>1,h=e-i[s].tileId;if(h>0)n=s+1;else if(h<0)o=s-1;else return i[s]}return o>=0&&(i[o].runLength===0||e-i[o].tileId<i[o].runLength)?i[o]:null}var Ad=class{constructor(i){this.url=i}getKey(){return this.url}getBytes(i,e,n){return Pt(this,null,function*(){let o;n||(o=new AbortController,n=o.signal);let s=yield fetch(this.url,{signal:n,headers:{Range:"bytes="+i+"-"+(i+e-1)}});if(s.status===416&&i===0){const c=s.headers.get("Content-Range");if(!c||!c.startsWith("bytes */"))throw Error("Missing content-length on 416 response");const d=+c.substr(8);s=yield fetch(this.url,{signal:n,headers:{Range:"bytes=0-"+(d-1)}})}if(s.status>=300)throw Error("Bad response code: "+s.status);const h=s.headers.get("Content-Length");if(s.status===200&&(!h||+h>e))throw o&&o.abort(),Error("Server returned no content-length header or content-length exceeding request. Check that your storage backend supports HTTP Byte Serving.");return{data:yield s.arrayBuffer(),etag:s.headers.get("ETag")||void 0,cacheControl:s.headers.get("Cache-Control")||void 0,expires:s.headers.get("Expires")||void 0}})}};function Nt(i,e){const n=i.getUint32(e+4,!0),o=i.getUint32(e+0,!0);return n*Math.pow(2,32)+o}function Od(i,e){const n=new DataView(i),o=n.getUint8(7);if(o>3)throw Error(`Archive is spec version ${o} but this library supports up to spec version 3`);return{specVersion:o,rootDirectoryOffset:Nt(n,8),rootDirectoryLength:Nt(n,16),jsonMetadataOffset:Nt(n,24),jsonMetadataLength:Nt(n,32),leafDirectoryOffset:Nt(n,40),leafDirectoryLength:Nt(n,48),tileDataOffset:Nt(n,56),tileDataLength:Nt(n,64),numAddressedTiles:Nt(n,72),numTileEntries:Nt(n,80),numTileContents:Nt(n,88),clustered:n.getUint8(96)===1,internalCompression:n.getUint8(97),tileCompression:n.getUint8(98),tileType:n.getUint8(99),minZoom:n.getUint8(100),maxZoom:n.getUint8(101),minLon:n.getInt32(102,!0)/1e7,minLat:n.getInt32(106,!0)/1e7,maxLon:n.getInt32(110,!0)/1e7,maxLat:n.getInt32(114,!0)/1e7,centerZoom:n.getUint8(118),centerLon:n.getInt32(119,!0)/1e7,centerLat:n.getInt32(123,!0)/1e7,etag:e}}function ih(i){const e={buf:new Uint8Array(i),pos:0},n=ai(e),o=[];let s=0;for(let h=0;h<n;h++){const l=ai(e);o.push({tileId:s+l,offset:0,length:0,runLength:1}),s+=l}for(let h=0;h<n;h++)o[h].runLength=ai(e);for(let h=0;h<n;h++)o[h].length=ai(e);for(let h=0;h<n;h++){const l=ai(e);l===0&&h>0?o[h].offset=o[h-1].offset+o[h-1].length:o[h].offset=l-1}return o}function Fd(i){const e=new DataView(i);return e.getUint16(2,!0)===2?(console.warn("PMTiles spec version 2 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),2):e.getUint16(2,!0)===1?(console.warn("PMTiles spec version 1 has been deprecated; please see github.com/protomaps/PMTiles for tools to upgrade"),1):3}var Ae=class extends Error{};function Zd(i,e,n,o){return Pt(this,null,function*(){const s=yield i.getBytes(0,16384);if(new DataView(s.data).getUint16(0,!0)!==19792)throw new Error("Wrong magic number for PMTiles archive");if(Fd(s.data)<3)return[yield th.getHeader(i)];const l=s.data.slice(0,Id);let c=s.etag;o&&s.etag!=o&&(console.warn("ETag conflict detected; your HTTP server might not support content-based ETag headers. ETags disabled for "+i.getKey()),c=void 0);const d=Od(l,c);if(n){const _=s.data.slice(d.rootDirectoryOffset,d.rootDirectoryOffset+d.rootDirectoryLength),f=i.getKey()+"|"+(d.etag||"")+"|"+d.rootDirectoryOffset+"|"+d.rootDirectoryLength,m=ih(yield e(_,d.internalCompression));return[d,[f,m.length,m]]}return[d,void 0]})}function Rd(i,e,n,o,s){return Pt(this,null,function*(){const h=yield i.getBytes(n,o);if(s.etag&&s.etag!==h.etag)throw new Ae(h.etag);const l=yield e(h.data,s.internalCompression),c=ih(l);if(c.length===0)throw new Error("Empty directory is invalid");return c})}var Nd=class{constructor(i=100,e=!0,n=eh){this.cache=new Map,this.maxCacheEntries=i,this.counter=1,this.prefetch=e,this.decompress=n}getHeader(i,e){return Pt(this,null,function*(){const n=i.getKey();if(this.cache.has(n))return this.cache.get(n).lastUsed=this.counter++,yield this.cache.get(n).data;const o=new Promise((s,h)=>{Zd(i,this.decompress,this.prefetch,e).then(l=>{l[1]&&this.cache.set(l[1][0],{lastUsed:this.counter++,data:Promise.resolve(l[1][2])}),s(l[0]),this.prune()}).catch(l=>{h(l)})});return this.cache.set(n,{lastUsed:this.counter++,data:o}),o})}getDirectory(i,e,n,o){return Pt(this,null,function*(){const s=i.getKey()+"|"+(o.etag||"")+"|"+e+"|"+n;if(this.cache.has(s))return this.cache.get(s).lastUsed=this.counter++,yield this.cache.get(s).data;const h=new Promise((l,c)=>{Rd(i,this.decompress,e,n,o).then(d=>{l(d),this.prune()}).catch(d=>{c(d)})});return this.cache.set(s,{lastUsed:this.counter++,data:h}),h})}getArrayBuffer(i,e,n,o){return Pt(this,null,function*(){const s=i.getKey()+"|"+(o.etag||"")+"|"+e+"|"+n;if(this.cache.has(s))return this.cache.get(s).lastUsed=this.counter++,yield this.cache.get(s).data;const h=new Promise((l,c)=>{i.getBytes(e,n).then(d=>{if(o.etag&&o.etag!==d.etag)throw new Ae(d.etag);l(d.data),this.cache.has(s),this.prune()}).catch(d=>{c(d)})});return this.cache.set(s,{lastUsed:this.counter++,data:h}),h})}prune(){if(this.cache.size>=this.maxCacheEntries){let i=1/0,e;this.cache.forEach((n,o)=>{n.lastUsed<i&&(i=n.lastUsed,e=o)}),e&&this.cache.delete(e)}}invalidate(i,e){return Pt(this,null,function*(){this.cache.delete(i.getKey()),yield this.getHeader(i,e)})}},jd=class{constructor(i,e,n){typeof i=="string"?this.source=new Ad(i):this.source=i,n?this.decompress=n:this.decompress=eh,e?this.cache=e:this.cache=new Nd}getHeader(){return Pt(this,null,function*(){return yield this.cache.getHeader(this.source)})}getZxyAttempt(i,e,n,o){return Pt(this,null,function*(){const s=zd(i,e,n),h=yield this.cache.getHeader(this.source);if(h.specVersion<3)return th.getZxy(h,this.source,this.cache,i,e,n,o);if(i<h.minZoom||i>h.maxZoom)return;let l=h.rootDirectoryOffset,c=h.rootDirectoryLength;for(let d=0;d<=3;d++){const _=yield this.cache.getDirectory(this.source,l,c,h),f=Bd(_,s);if(f)if(f.runLength>0){const m=yield this.source.getBytes(h.tileDataOffset+f.offset,f.length,o);if(h.etag&&h.etag!==m.etag)throw new Ae(m.etag);return{data:yield this.decompress(m.data,h.tileCompression),cacheControl:m.cacheControl,expires:m.expires}}else l=h.leafDirectoryOffset+f.offset,c=f.length;else return}throw Error("Maximum directory depth exceeded")})}getZxy(i,e,n,o){return Pt(this,null,function*(){try{return yield this.getZxyAttempt(i,e,n,o)}catch(s){if(s instanceof Ae)return this.cache.invalidate(this.source,s.message),yield this.getZxyAttempt(i,e,n,o);throw s}})}getMetadataAttempt(){return Pt(this,null,function*(){const i=yield this.cache.getHeader(this.source),e=yield this.source.getBytes(i.jsonMetadataOffset,i.jsonMetadataLength);if(i.etag&&i.etag!==e.etag)throw new Ae(e.etag);const n=yield this.decompress(e.data,i.internalCompression),o=new TextDecoder("utf-8");return JSON.parse(o.decode(n))})}getMetadata(){return Pt(this,null,function*(){try{return yield this.getMetadataAttempt()}catch(i){if(i instanceof Ae)return this.cache.invalidate(this.source,i.message),yield this.getMetadataAttempt();throw i}})}},Ze;(function(i){i[i.Point=1]="Point",i[i.Line=2]="Line",i[i.Polygon=3]="Polygon"})(Ze||(Ze={}));function ye(i){return i.x+":"+i.y+":"+i.z}var Wd=(i,e,n)=>{i.pos=e;for(var o=i.readVarint()+i.pos,s=1,h=0,l=0,c=0,d=1/0,_=-1/0,f=1/0,m=-1/0,v=[],w=[];i.pos<o;){if(h<=0){var b=i.readVarint();s=b&7,h=b>>3}if(h--,s===1||s===2)l+=i.readSVarint()*n,c+=i.readSVarint()*n,l<d&&(d=l),l>_&&(_=l),c<f&&(f=c),c>m&&(m=c),s===1&&(w.length>0&&v.push(w),w=[]),w.push(new bi.default(l,c));else if(s===7)w&&w.push(w[0].clone());else throw new Error("unknown command "+s)}return w&&v.push(w),{geom:v,bbox:{minX:d,minY:f,maxX:_,maxY:m}}};function nh(i,e){let n=new nd.VectorTile(new rd.default(i)),o=new Map;for(let[s,h]of Object.entries(n.layers)){let l=[],c=h;for(let d=0;d<c.length;d++){let _=Wd(c.feature(d)._pbf,c.feature(d)._geometry,e/c.extent),f=0;for(let m of _.geom)f+=m.length;l.push({id:c.feature(d).id,geomType:c.feature(d).type,geom:_.geom,numVertices:f,bbox:_.bbox,props:c.feature(d).properties})}o.set(s,l)}return o}var Es=class{constructor(i,e){typeof i=="string"?this.p=new jd(i):this.p=i,this.controllers=[],this.shouldCancelZooms=e}get(i,e){return We(this,null,function*(){this.shouldCancelZooms&&(this.controllers=this.controllers.filter(h=>h[0]!=i.z?(h[1].abort(),!1):!0));const n=new AbortController;this.controllers.push([i.z,n]);const o=n.signal;let s=yield this.p.getZxy(i.z,i.x,i.y,o);return s?nh(s.data,e):new Map})}},Ud=class{constructor(i,e){this.url=i,this.controllers=[],this.shouldCancelZooms=e}get(i,e){return We(this,null,function*(){this.shouldCancelZooms&&(this.controllers=this.controllers.filter(h=>h[0]!=i.z?(h[1].abort(),!1):!0));let n=this.url.replace("{z}",i.z.toString()).replace("{x}",i.x.toString()).replace("{y}",i.y.toString());const o=new AbortController;this.controllers.push([i.z,o]);const s=o.signal;return new Promise((h,l)=>{fetch(n,{signal:s}).then(c=>c.arrayBuffer()).then(c=>{let d=nh(c,e);h(d)}).catch(c=>{l(c)})})})}},Pr=6378137,Vd=85.0511287798,Ki=Pr*Math.PI,Yd=i=>{let e=Math.PI/180,n=Math.max(Math.min(Vd,i[0]),-85.0511287798),o=Math.sin(n*e);return new bi.default(Pr*i[1]*e,Pr*Math.log((1+o)/(1-o))/2)};function Ts(i){return i*i}function rn(i,e){return Ts(i.x-e.x)+Ts(i.y-e.y)}function Hd(i,e,n){var o=rn(e,n);if(o===0)return rn(i,e);var s=((i.x-e.x)*(n.x-e.x)+(i.y-e.y)*(n.y-e.y))/o;return s=Math.max(0,Math.min(1,s)),rn(i,new bi.default(e.x+s*(n.x-e.x),e.y+s*(n.y-e.y)))}function Ds(i,e){for(var n=!1,o=0,s=e.length-1;o<e.length;s=o++){var h=e[o].x,l=e[o].y,c=e[s].x,d=e[s].y,_=l>i.y!=d>i.y&&i.x<(c-h)*(i.y-l)/(d-l)+h;_&&(n=!n)}return n}function Xd(i){for(var e=0,n=0;n<i.length;n++){let o=(n+1)%i.length;e+=i[n].x*i[o].y,e-=i[o].x*i[n].y}return e<0}function Gd(i,e){var n=!1;for(let o of e)if(Xd(o))Ds(i,o)&&(n=!1);else{if(n)return!0;Ds(i,o)&&(n=!0)}return n}function qd(i,e){let n=1/0;for(let o of e){let s=Math.sqrt(rn(i,o[0]));s<n&&(n=s)}return n}function $d(i,e){let n=1/0;for(let s of e)for(var o=0;o<s.length-1;o++){let h=Math.sqrt(Hd(i,s[o],s[o+1]));h<n&&(n=h)}return n}var Kd=class{constructor(i,e){this.source=i,this.cache=new Map,this.inflight=new Map,this.tileSize=e}queryFeatures(i,e,n,o){let s=Yd([e,i]);var h=new bi.default((s.x+Ki)/(Ki*2),1-(s.y+Ki)/(Ki*2));h.x>1&&(h.x=h.x-Math.floor(h.x));let l=h.mult(1<<n),c=Math.floor(l.x),d=Math.floor(l.y);const _=ye({z:n,x:c,y:d});let f=[],m=this.cache.get(_);if(m){const v=new bi.default((l.x-c)*this.tileSize,(l.y-d)*this.tileSize);for(let[w,b]of m.data.entries())for(let C of b)C.geomType==1?qd(v,C.geom)<o&&f.push({feature:C,layerName:w}):C.geomType==2?$d(v,C.geom)<o&&f.push({feature:C,layerName:w}):Gd(v,C.geom)&&f.push({feature:C,layerName:w})}return f}get(i){return We(this,null,function*(){const e=ye(i);return new Promise((n,o)=>{let s=this.cache.get(e);if(s)s.used=performance.now(),n(s.data);else{let h=this.inflight.get(e);h?h.push([n,o]):(this.inflight.set(e,[]),this.source.get(i,this.tileSize).then(l=>{this.cache.set(e,{used:performance.now(),data:l});let c=this.inflight.get(e);if(c&&c.forEach(d=>d[0](l)),this.inflight.delete(e),n(l),this.cache.size>=64){let d=1/0,_;this.cache.forEach((f,m)=>{f.used<d&&(d=f.used,_=m)}),_&&this.cache.delete(_)}}).catch(l=>{let c=this.inflight.get(e);c&&c.forEach(d=>d[1](l)),this.inflight.delete(e),o(l)}))}})})}},rh=(i,e,n)=>{let o=[];for(let s of i){let h=[];for(let l of s)h.push(l.clone().mult(e).add(n));o.push(h)}return o},Ji=(i,e)=>{let n=1<<e;return i<0&&(i=n+i),i>=n&&(i=i%n),i},Jd=class{constructor(i,e,n){this.tileCache=i,this.maxDataLevel=e,this.levelDiff=n}dataTilesForBounds(i,e){let n=Math.pow(2,i)/Math.pow(2,Math.ceil(i)),o=[];var s=1,h=this.tileCache.tileSize;if(i<this.levelDiff)s=1/(1<<this.levelDiff-i)*n,o.push({data_tile:{z:0,x:0,y:0},origin:new De.default(0,0),scale:s,dim:h*s});else if(i<=this.levelDiff+this.maxDataLevel){let d=1<<this.levelDiff,_=256*n,f=Math.ceil(i)-this.levelDiff,m=Math.floor(e.minX/d/_),v=Math.floor(e.minY/d/_),w=Math.floor(e.maxX/d/_),b=Math.floor(e.maxY/d/_);for(var l=m;l<=w;l++)for(var c=v;c<=b;c++){let C=new De.default(l*d*_,c*d*_);o.push({data_tile:{z:f,x:Ji(l,f),y:Ji(c,f)},origin:C,scale:n,dim:h*n})}}else{let d=1<<this.levelDiff;s=(1<<Math.ceil(i)-this.maxDataLevel-this.levelDiff)*n;let _=Math.floor(e.minX/d/256/s),f=Math.floor(e.minY/d/256/s),m=Math.floor(e.maxX/d/256/s),v=Math.floor(e.maxY/d/256/s);for(var l=_;l<=m;l++)for(var c=f;c<=v;c++){let C=new De.default(l*d*256*s,c*d*256*s);o.push({data_tile:{z:this.maxDataLevel,x:Ji(l,this.maxDataLevel),y:Ji(c,this.maxDataLevel)},origin:C,scale:s,dim:h*s})}}return o}dataTileForDisplayTile(i){var e,n=1,o=this.tileCache.tileSize,s;if(i.z<this.levelDiff)e={z:0,x:0,y:0},n=1/(1<<this.levelDiff-i.z),s=new De.default(0,0),o=o*n;else if(i.z<=this.levelDiff+this.maxDataLevel){let h=1<<this.levelDiff;e={z:i.z-this.levelDiff,x:Math.floor(i.x/h),y:Math.floor(i.y/h)},s=new De.default(e.x*h*256,e.y*h*256)}else{n=1<<i.z-this.maxDataLevel-this.levelDiff;let h=1<<this.levelDiff;e={z:this.maxDataLevel,x:Math.floor(i.x/h/n),y:Math.floor(i.y/h/n)},s=new De.default(e.x*h*n*256,e.y*h*n*256),o=o*n}return{data_tile:e,scale:n,origin:s,dim:o}}getBbox(i,e){return We(this,null,function*(){let n=this.dataTilesForBounds(i,e);return(yield Promise.all(n.map(s=>this.tileCache.get(s.data_tile)))).map((s,h)=>{let l=n[h];return{data:s,z:i,data_tile:l.data_tile,scale:l.scale,dim:l.dim,origin:l.origin}})})}getDisplayTile(i){return We(this,null,function*(){let e=this.dataTileForDisplayTile(i);return{data:yield this.tileCache.get(e.data_tile),z:i.z,data_tile:e.data_tile,scale:e.scale,origin:e.origin,dim:e.dim}})}queryFeatures(i,e,n){let o=Math.round(n),s=Math.min(o-this.levelDiff,this.maxDataLevel),h=16/(1<<o-s);return this.tileCache.queryFeatures(i,e,s,h)}},Qd=i=>{let e=o=>{let s=o.levelDiff===void 0?2:o.levelDiff,h=o.maxDataZoom||14,l;typeof o.url=="string"?o.url.endsWith(".pmtiles")?l=new Es(o.url,!0):l=new Ud(o.url,!0):l=new Es(o.url,!0);let c=new Kd(l,256*1<<s);return new Jd(c,h,s)},n=new Map;if(i.sources)for(const o in i.sources)n.set(o,e(i.sources[o]));else n.set("",e(i));return n},tf=Tt(se());function ef(i,e,n,o,s,h,l,c,d){let _=performance.now();i.save(),i.miterLimit=2;for(var f of s){if(f.minzoom&&e<f.minzoom||f.maxzoom&&e>f.maxzoom)continue;let b=n.get(f.dataSource||"");if(b)for(let C of b){var m=C.data.get(f.dataLayer);if(m===void 0)continue;f.symbolizer.before&&f.symbolizer.before(i,C.z);let E=C.origin;C.dim;let I=C.scale;i.save(),i.translate(E.x-l.x,E.y-l.y);for(var v of m){let x=v.geom,P=v.bbox;P.maxX*I+E.x<h.minX||P.minX*I+E.x>h.maxX||P.minY*I+E.y>h.maxY||P.maxY*I+E.y<h.minY||f.filter&&!f.filter(C.z,v)||(I!=1&&(x=rh(x,I,new tf.default(0,0))),f.symbolizer.draw(i,x,C.z,v))}i.restore()}}if(o){let b=o.searchBbox(h,1/0);for(var w of b)if(i.save(),i.translate(w.anchor.x-l.x,w.anchor.y-l.y),w.draw(i),i.restore(),d){i.lineWidth=.5,i.strokeStyle=d,i.fillStyle=d,i.globalAlpha=1,i.fillRect(w.anchor.x-l.x-2,w.anchor.y-l.y-2,4,4);for(let C of w.bboxes)i.strokeRect(C.minX-l.x,C.minY-l.y,C.maxX-C.minX,C.maxY-C.minY)}}return i.restore(),performance.now()-_}var nf=Tt(se()),rf=Tt(Qc()),of=(i,e,n)=>{let o=256,s=e/o,h=Math.floor(n.minX/o),l=Math.floor(n.minY/o),c=Math.floor(n.maxX/o),d=Math.floor(n.maxY/o),_=Math.log2(s),f=[];for(let m=h;m<=c;m++){let v=m%(1<<i);for(let w=l;w<=d;w++)f.push({display:ye({z:i,x:v,y:w}),key:ye({z:i-_,x:Math.floor(v/s),y:Math.floor(w/s)})})}return f},sf=class{constructor(i,e){this.tree=new rf.default,this.current=new Map,this.dim=i,this.maxLabeledTiles=e}hasPrefix(i){for(let e of this.current.keys())if(e.startsWith(i))return!0;return!1}has(i){return this.current.has(i)}size(){return this.current.size}keys(){return this.current.keys()}searchBbox(i,e){let n=new Set;for(let o of this.tree.search(i))o.indexed_label.order<=e&&n.add(o.indexed_label);return n}searchLabel(i,e){let n=new Set;for(let o of i.bboxes)for(let s of this.tree.search(o))s.indexed_label.order<=e&&n.add(s.indexed_label);return n}bboxCollides(i,e){for(let n of this.tree.search(i))if(n.indexed_label.order<=e)return!0;return!1}labelCollides(i,e){for(let n of i.bboxes)for(let o of this.tree.search(n))if(o.indexed_label.order<=e)return!0;return!1}deduplicationCollides(i){if(!i.deduplicationKey||!i.deduplicationDistance)return!1;let e=i.deduplicationDistance,n={minX:i.anchor.x-e,minY:i.anchor.y-e,maxX:i.anchor.x+e,maxY:i.anchor.y+e};for(let o of this.tree.search(n))if(o.indexed_label.deduplicationKey===i.deduplicationKey&&o.indexed_label.anchor.dist(i.anchor)<e)return!0;return!1}makeEntry(i){this.current.get(i)&&console.log("consistency error 1");let e=new Set;this.current.set(i,e)}insert(i,e,n){let o={anchor:i.anchor,bboxes:i.bboxes,draw:i.draw,order:e,tileKey:n,deduplicationKey:i.deduplicationKey,deduplicationDistance:i.deduplicationDistance},s=this.current.get(n);if(!s){let f=new Set;this.current.set(n,f),s=f}s.add(o);var h=!1,l=!1;for(let f of i.bboxes){var c=f;c.indexed_label=o,this.tree.insert(c),f.minX<0&&(h=!0),f.maxX>this.dim&&(l=!0)}if(h||l){var d=h?this.dim:-this.dim,_=[];for(let v of i.bboxes)_.push({minX:v.minX+d,minY:v.minY,maxX:v.maxX+d,maxY:v.maxY});let f={anchor:new nf.default(i.anchor.x+d,i.anchor.y),bboxes:_,draw:i.draw,order:e,tileKey:n},m=this.current.get(n);m&&m.add(f);for(let v of _){var c=v;c.indexed_label=f,this.tree.insert(c)}}}pruneOrNoop(i){let e=i.split(":"),n,o=0,s=0;for(var h of this.current.keys()){let l=h.split(":");if(l[3]===e[3]){s++;let c=Math.sqrt(Math.pow(+l[0]-+e[0],2)+Math.pow(+l[1]-+e[1],2));c>o&&(o=c,n=h)}n&&s>this.maxLabeledTiles&&this.pruneKey(n)}}pruneKey(i){let e=this.current.get(i);if(!e)return;let n=[];for(let o of this.tree.all())e.has(o.indexed_label)&&n.push(o);n.forEach(o=>{this.tree.remove(o)}),this.current.delete(i)}removeLabel(i){let e=[];for(let o of this.tree.all())i==o.indexed_label&&e.push(o);e.forEach(o=>{this.tree.remove(o)});let n=this.current.get(i.tileKey);n&&n.delete(i)}},af=class{constructor(i,e,n,o,s){this.index=new sf(256*1<<i,o),this.z=i,this.scratch=e,this.labelRules=n,this.callback=s}layout(i){let e=performance.now(),n=new Set;for(let[l,c]of i)for(let d of c){let _=ye(d.data_tile)+":"+l;this.index.has(_)||(this.index.makeEntry(_),n.add(_))}let o=new Set;for(let[l,c]of this.labelRules.entries()){if(c.visible==!1||c.minzoom&&this.z<c.minzoom||c.maxzoom&&this.z>c.maxzoom)continue;let d=c.dataSource||"",_=i.get(d);if(_)for(let f of _){let m=ye(f.data_tile)+":"+d;if(!n.has(m))continue;let v=f.data.get(c.dataLayer);if(v===void 0)continue;let w=v;c.sort&&w.sort((C,E)=>c.sort?c.sort(C.props,E.props):0);let b={index:this.index,zoom:this.z,scratch:this.scratch,order:l,overzoom:this.z-f.data_tile.z};for(let C of w){if(c.filter&&!c.filter(this.z,C))continue;let E=rh(C.geom,f.scale,f.origin),I=c.symbolizer.place(b,E,C);if(I)for(let x of I){var s=!1;if(!(x.deduplicationKey&&this.index.deduplicationCollides(x))){if(this.index.labelCollides(x,1/0)){if(!this.index.labelCollides(x,l)){let P=this.index.searchLabel(x,1/0);for(let k of P){this.index.removeLabel(k);for(let B of k.bboxes)this.findInvalidatedTiles(o,f.dim,B,m)}this.index.insert(x,l,m),s=!0}}else this.index.insert(x,l,m),s=!0;if(s)for(let P of x.bboxes)(P.maxX>f.origin.x+f.dim||P.minX<f.origin.x||P.minY<f.origin.y||P.maxY>f.origin.y+f.dim)&&this.findInvalidatedTiles(o,f.dim,P,m)}}}}}for(var h of n)this.index.pruneOrNoop(h);return o.size>0&&this.callback&&this.callback(o),performance.now()-e}findInvalidatedTiles(i,e,n,o){let s=of(this.z,e,n);for(let h of s)h.key!=o&&this.index.hasPrefix(h.key)&&i.add(h.display)}add(i){var e=!0;for(let[n,o]of i)for(let s of o)this.index.has(ye(s.data_tile)+":"+n)||(e=!1);return e?0:this.layout(i)}},zs=class{constructor(i,e,n,o){this.labelers=new Map,this.scratch=i,this.labelRules=e,this.maxLabeledTiles=n,this.callback=o}add(i,e){var n=this.labelers.get(i);return n||(n=new af(i,this.scratch,this.labelRules,this.maxLabeledTiles,this.callback),this.labelers.set(i,n)),n.add(e)}getIndex(i){let e=this.labelers.get(i);if(e)return e.index}},Is={earth:"#FFFBF6",glacier:"#ffffff",residential:"#F4F4F8",hospital:"#FFF6F6",cemetery:"#EFF2EE",school:"#F7F6FF",industrial:"#FFF9EF",wood:"#F4F9EF",grass:"#EBF9E3",park:"#E5F9D5",water:"#B7DFF2",sand:"#ebebeb",buildings:"#F2EDE8",highwayCasing:"#FFC3C3",majorRoadCasing:"#FFB9B9",mediumRoadCasing:"#FFCE8E",minorRoadCasing:"#cccccc",highway:"#FFCEBB",majorRoad:"#FFE4B3",mediumRoad:"#FFF2C8",minorRoad:"#ffffff",boundaries:"#9e9e9e",mask:"#dddddd",countryLabel:"#aaaaaa",cityLabel:"#6C6C6C",stateLabel:"#999999",neighbourhoodLabel:"#888888",landuseLabel:"#898989",waterLabel:"#41ABDC",naturalLabel:"#4B8F14",roadsLabel:"#888888",poisLabel:"#606060"},Bs={earth:"#151515",glacier:"#1c1c1c",residential:"#252B2F",hospital:"#3E2C2C",cemetery:"#36483D",school:"#2C3440",industrial:"#33312C",wood:"#3A3E38",grass:"#4E604D",park:"#2C4034",water:"#4D5B73",sand:"#777777",buildings:"#464545",highwayCasing:"#000000",majorRoadCasing:"#1C1B1B",mediumRoadCasing:"#3E3E3E",minorRoadCasing:"#000000",highway:"#5B5B5B",majorRoad:"#595959",mediumRoad:"#4F4F4F",minorRoad:"#393939",boundaries:"#666666",mask:"#dddddd",countryLabel:"#ffffff",cityLabel:"#FFFFFF",stateLabel:"#ffffff",neighbourhoodLabel:"#FDFDFD",landuseLabel:"#DDDDDD",waterLabel:"#707E95",naturalLabel:"#4c4c4c",roadsLabel:"#C4C4C4",poisLabel:"#959393"};function vi(i,e,n){return Math.min(Math.max(i,n),e)}var hi=class extends Error{constructor(i){super(`Failed to parse color: "${i}"`)}};function hf(i){if(typeof i!="string")throw new hi(i);if(i.trim().toLowerCase()==="transparent")return[0,0,0,0];let e=i.trim();e=pf.test(i)?function(l){const c=l.toLowerCase().trim(),d=lf[function(_){let f=5381,m=_.length;for(;m;)f=33*f^_.charCodeAt(--m);return(f>>>0)%2341}(c)];if(!d)throw new hi(l);return`#${d}`}(i):i;const n=uf.exec(e);if(n){const l=Array.from(n).slice(1);return[...l.slice(0,3).map(c=>parseInt(Pi(c,2),16)),parseInt(Pi(l[3]||"f",2),16)/255]}const o=cf.exec(e);if(o){const l=Array.from(o).slice(1);return[...l.slice(0,3).map(c=>parseInt(c,16)),parseInt(l[3]||"ff",16)/255]}const s=df.exec(e);if(s){const l=Array.from(s).slice(1);return[...l.slice(0,3).map(c=>parseInt(c,10)),parseFloat(l[3]||"1")]}const h=ff.exec(e);if(h){const[l,c,d,_]=Array.from(h).slice(1).map(parseFloat);if(vi(0,100,c)!==c)throw new hi(i);if(vi(0,100,d)!==d)throw new hi(i);return[..._f(l,c,d),_||1]}throw new hi(i)}var As=i=>parseInt(i.replace(/_/g,""),36),lf="1q29ehhb 1n09sgk7 1kl1ekf_ _yl4zsno 16z9eiv3 1p29lhp8 _bd9zg04 17u0____ _iw9zhe5 _to73___ _r45e31e _7l6g016 _jh8ouiv _zn3qba8 1jy4zshs 11u87k0u 1ro9yvyo 1aj3xael 1gz9zjz0 _3w8l4xo 1bf1ekf_ _ke3v___ _4rrkb__ 13j776yz _646mbhl _nrjr4__ _le6mbhl 1n37ehkb _m75f91n _qj3bzfz 1939yygw 11i5z6x8 _1k5f8xs 1509441m 15t5lwgf _ae2th1n _tg1ugcv 1lp1ugcv 16e14up_ _h55rw7n _ny9yavn _7a11xb_ 1ih442g9 _pv442g9 1mv16xof 14e6y7tu 1oo9zkds 17d1cisi _4v9y70f _y98m8kc 1019pq0v 12o9zda8 _348j4f4 1et50i2o _8epa8__ _ts6senj 1o350i2o 1mi9eiuo 1259yrp0 1ln80gnw _632xcoy 1cn9zldc _f29edu4 1n490c8q _9f9ziet 1b94vk74 _m49zkct 1kz6s73a 1eu9dtog _q58s1rz 1dy9sjiq __u89jo3 _aj5nkwg _ld89jo3 13h9z6wx _qa9z2ii _l119xgq _bs5arju 1hj4nwk9 1qt4nwk9 1ge6wau6 14j9zlcw 11p1edc_ _ms1zcxe _439shk6 _jt9y70f _754zsow 1la40eju _oq5p___ _x279qkz 1fa5r3rv _yd2d9ip _424tcku _8y1di2_ _zi2uabw _yy7rn9h 12yz980_ __39ljp6 1b59zg0x _n39zfzp 1fy9zest _b33k___ _hp9wq92 1il50hz4 _io472ub _lj9z3eo 19z9ykg0 _8t8iu3a 12b9bl4a 1ak5yw0o _896v4ku _tb8k8lv _s59zi6t _c09ze0p 1lg80oqn 1id9z8wb _238nba5 1kq6wgdi _154zssg _tn3zk49 _da9y6tc 1sg7cv4f _r12jvtt 1gq5fmkz 1cs9rvci _lp9jn1c _xw1tdnb 13f9zje6 16f6973h _vo7ir40 _bt5arjf _rc45e4t _hr4e100 10v4e100 _hc9zke2 _w91egv_ _sj2r1kk 13c87yx8 _vqpds__ _ni8ggk8 _tj9yqfb 1ia2j4r4 _7x9b10u 1fc9ld4j 1eq9zldr _5j9lhpx _ez9zl6o _md61fzm".split(" ").reduce((i,e)=>{const n=As(e.substring(0,3)),o=As(e.substring(3)).toString(16);let s="";for(let h=0;h<6-o.length;h++)s+="0";return i[n]=`${s}${o}`,i},{}),Pi=(i,e)=>Array.from(Array(e)).map(()=>i).join(""),uf=new RegExp(`^#${Pi("([a-f0-9])",3)}([a-f0-9])?$`,"i"),cf=new RegExp(`^#${Pi("([a-f0-9]{2})",3)}([a-f0-9]{2})?$`,"i"),df=new RegExp(`^rgba?\\(\\s*(\\d+)\\s*${Pi(",\\s*(\\d+)\\s*",2)}(?:,\\s*([\\d.]+))?\\s*\\)$`,"i"),ff=/^hsla?\(\s*([\d.]+)\s*,\s*([\d.]+)%\s*,\s*([\d.]+)%(?:\s*,\s*([\d.]+))?\s*\)$/i,pf=/^[a-z]+$/i,Os=i=>Math.round(255*i),_f=(i,e,n)=>{let o=n/100;if(e===0)return[o,o,o].map(Os);const s=(i%360+360)%360/60,h=(1-Math.abs(2*o-1))*(e/100),l=h*(1-Math.abs(s%2-1));let c=0,d=0,_=0;s>=0&&s<1?(c=h,d=l):s>=1&&s<2?(c=l,d=h):s>=2&&s<3?(d=h,_=l):s>=3&&s<4?(d=l,_=h):s>=4&&s<5?(c=l,_=h):s>=5&&s<6&&(c=h,_=l);const f=o-h/2;return[c+f,d+f,_+f].map(Os)};function Fs(i){const[e,n,o,s]=hf(i).map((_,f)=>f===3?_:_/255),h=Math.max(e,n,o),l=Math.min(e,n,o),c=(h+l)/2;if(h===l)return[0,0,c,s];const d=h-l;return[60*(e===h?(n-o)/d+(n<o?6:0):n===h?(o-e)/d+2:(e-n)/d+4),c>.5?d/(2-h-l):d/(h+l),c,s]}function mf(i,e,n,o){return`hsla(${(i%360).toFixed()}, ${vi(0,100,100*e).toFixed()}%, ${vi(0,100,100*n).toFixed()}%, ${parseFloat(vi(0,1,o).toFixed(3))})`}var Ut=Tt(se());Tt(td());var gf=Tt(id()),Ct=class{constructor(i,e){this.str=i??e,this.per_feature=typeof this.str=="function"&&this.str.length==2}get(i,e){return typeof this.str=="function"?this.str(i,e):this.str}},pt=class{constructor(i,e=1){this.value=i??e,this.per_feature=typeof this.value=="function"&&this.value.length==2}get(i,e){return typeof this.value=="function"?this.value(i,e):this.value}},Zr=class{constructor(i){var e;this.label_props=(e=i==null?void 0:i.label_props)!=null?e:["name"],this.textTransform=i==null?void 0:i.textTransform}get(i,e){let n,o;typeof this.label_props=="function"?o=this.label_props(i,e):o=this.label_props;for(let h of o)if(e.props.hasOwnProperty(h)&&typeof e.props[h]=="string"){n=e.props[h];break}let s;return typeof this.textTransform=="function"?s=this.textTransform(i,e):s=this.textTransform,n&&s==="uppercase"?n=n.toUpperCase():n&&s==="lowercase"?n=n.toLowerCase():n&&s==="capitalize"&&(n=n.toLowerCase().split(" ").map(c=>c[0].toUpperCase()+c.slice(1)).join(" ")),n}},Rr=class{constructor(i){var e,n;i!=null&&i.font?this.font=i.font:(this.family=(e=i==null?void 0:i.fontFamily)!=null?e:"sans-serif",this.size=(n=i==null?void 0:i.fontSize)!=null?n:12,this.weight=i==null?void 0:i.fontWeight,this.style=i==null?void 0:i.fontStyle)}get(i,e){if(this.font)return typeof this.font=="function"?this.font(i,e):this.font;var n="";this.style&&(typeof this.style=="function"?n=this.style(i,e)+" ":n=this.style+" ");var o="";this.weight&&(typeof this.weight=="function"?o=this.weight(i,e)+" ":o=this.weight+" ");var s;typeof this.size=="function"?s=this.size(i,e):s=this.size;var h;return typeof this.family=="function"?h=this.family(i,e):h=this.family,`${n}${o}${s}px ${h}`}},vf=class{constructor(i,e=[]){this.value=i??e,this.per_feature=typeof this.value=="function"&&this.value.length==2}get(i,e){return typeof this.value=="function"?this.value(i,e):this.value}},Zs=Tt(se()),yf=(i,e,n)=>{var o=[],s,h,l,c=0,d=0,_=0,f=0,m=0,v=0,w=0,b=0,C=0,E=0,I=0,x=0;if(i.length<2)return[];if(i.length===2)return _=Math.sqrt(Math.pow(i[1].x-i[0].x,2)+Math.pow(i[1].y-i[0].y,2)),[{length:_,beginIndex:0,beginDistance:0,endIndex:2,endDistance:_}];for(f=Math.sqrt(Math.pow(i[1].x-i[0].x,2)+Math.pow(i[1].y-i[0].y,2)),c=1,d=i.length-1;c<d;c++)s=i[c-1],h=i[c],l=i[c+1],v=h.x-s.x,w=h.y-s.y,b=l.x-h.x,C=l.y-h.y,m=Math.sqrt(b*b+C*C),_+=f,E=Math.acos((v*b+w*C)/(f*m)),(E>e||_-x>n)&&(o.push({length:_-x,beginDistance:x,beginIndex:I,endIndex:c+1,endDistance:_}),I=c,x=_),f=m;return c-I>0&&o.push({length:_-x+m,beginIndex:I,beginDistance:x,endIndex:c+1,endDistance:_+m}),o};function wf(i,e,n,o){let s=[];for(let l of i){let c=yf(l,Math.PI/45,e);for(let d of c)if(d.length>=e+o){let _=new Zs.default(l[d.beginIndex].x,l[d.beginIndex].y),f=l[d.endIndex-1],m=new Zs.default((f.x-_.x)/d.length,(f.y-_.y)/d.length);for(var h=o;h<d.length-e;h+=n)s.push({start:_.add(m.mult(h)),end:_.add(m.mult(h+e))})}}return s}function xf(i,e,n,o){let s=e.x-i.x,h=e.y-i.y,l=Math.sqrt(Math.pow(e.x-i.x,2)+Math.pow(e.y-i.y,2)),c=[];for(var d=0;d<n+o;d+=2*o){let _=d*1/l;c.push({x:i.x+_*s,y:i.y+_*h})}return c}function oh(i,e){if(i.length<=e)return[i];let n=e-1,o=i.lastIndexOf(" ",n),s=i.indexOf(" ",n);if(o==-1&&s==-1)return[i];let h,l;return s==-1||o>=0&&n-o<s-n?(h=i.substring(0,o),l=i.substring(o+1,i.length)):(h=i.substring(0,s),l=i.substring(s+1,i.length)),[h,...oh(l,e)]}var sh=5400,Rs;(function(i){i[i.Left=1]="Left",i[i.Center=2]="Center",i[i.Right=3]="Right"})(Rs||(Rs={}));var Ns;(function(i){i[i.N=1]="N",i[i.NE=2]="NE",i[i.E=3]="E",i[i.SE=4]="SE",i[i.S=5]="S",i[i.SW=6]="SW",i[i.W=7]="W",i[i.NW=8]="NW"})(Ns||(Ns={}));var bt=class{constructor(i){var e;this.pattern=i.pattern,this.fill=new Ct(i.fill,"black"),this.opacity=new pt(i.opacity,1),this.stroke=new Ct(i.stroke,"black"),this.width=new pt(i.width,0),this.per_feature=(e=this.fill.per_feature||this.opacity.per_feature||this.stroke.per_feature||this.width.per_feature||i.per_feature)!=null?e:!1,this.do_stroke=!1}before(i,e){if(!this.per_feature){i.globalAlpha=this.opacity.get(e),i.fillStyle=this.fill.get(e),i.strokeStyle=this.stroke.get(e);let n=this.width.get(e);n>0&&(this.do_stroke=!0),i.lineWidth=n}if(this.pattern){const n=i.createPattern(this.pattern,"repeat");n&&(i.fillStyle=n)}}draw(i,e,n,o){var s=!1;if(this.per_feature){i.globalAlpha=this.opacity.get(n,o),i.fillStyle=this.fill.get(n,o);var h=this.width.get(n,o);h&&(s=!0,i.strokeStyle=this.stroke.get(n,o),i.lineWidth=h)}let l=()=>{i.fill(),(s||this.do_stroke)&&i.stroke()};var c=0;i.beginPath();for(var d of e){c+d.length>sh&&(l(),c=0,i.beginPath());for(var _=0;_<d.length;_++){let f=d[_];_==0?i.moveTo(f.x,f.y):i.lineTo(f.x,f.y)}c+=d.length}c>0&&l()}};function bf(i,e){let n=0;for(;e[n+1][0]<i;)n++;return n}function Pf(i,e,n){return i*(n-e)+e}function Mf(i,e,n,o){const s=o[e+1][0]-o[e][0],h=i-o[e][0];return s===0?0:(Math.pow(n,h)-1)/(Math.pow(n,s)-1)}function le(i,e){return n=>{if(e.length<1)return 0;if(n<=e[0][0])return e[0][1];if(n>=e[e.length-1][0])return e[e.length-1][1];const o=bf(n,e),s=Mf(n,o,i,e);return Pf(s,e[o][1],e[o+1][1])}}var qt=class{constructor(i){var e;this.color=new Ct(i.color,"black"),this.width=new pt(i.width),this.opacity=new pt(i.opacity),this.dash=i.dash?new vf(i.dash):null,this.dashColor=new Ct(i.dashColor,"black"),this.dashWidth=new pt(i.dashWidth,1),this.lineCap=new Ct(i.lineCap,"butt"),this.lineJoin=new Ct(i.lineJoin,"miter"),this.skip=!1,this.per_feature=!!((e=this.dash)!=null&&e.per_feature||this.color.per_feature||this.opacity.per_feature||this.width.per_feature||this.lineCap.per_feature||this.lineJoin.per_feature||i.per_feature)}before(i,e){this.per_feature||(i.strokeStyle=this.color.get(e),i.lineWidth=this.width.get(e),i.globalAlpha=this.opacity.get(e),i.lineCap=this.lineCap.get(e),i.lineJoin=this.lineJoin.get(e))}draw(i,e,n,o){if(this.skip)return;let s=()=>{this.per_feature&&(i.globalAlpha=this.opacity.get(n,o),i.lineCap=this.lineCap.get(n,o),i.lineJoin=this.lineJoin.get(n,o)),this.dash?(i.save(),this.per_feature?(i.lineWidth=this.dashWidth.get(n,o),i.strokeStyle=this.dashColor.get(n,o),i.setLineDash(this.dash.get(n,o))):i.setLineDash(this.dash.get(n)),i.stroke(),i.restore()):(i.save(),this.per_feature&&(i.lineWidth=this.width.get(n,o),i.strokeStyle=this.color.get(n,o)),i.stroke(),i.restore())};var h=0;i.beginPath();for(var l of e){h+l.length>sh&&(s(),h=0,i.beginPath());for(var c=0;c<l.length;c++){let d=l[c];c==0?i.moveTo(d.x,d.y):i.lineTo(d.x,d.y)}h+=l.length}h>0&&s()}},Mr=class{constructor(i){this.radius=new pt(i.radius,3),this.fill=new Ct(i.fill,"black"),this.stroke=new Ct(i.stroke,"white"),this.width=new pt(i.width,0),this.opacity=new pt(i.opacity)}draw(i,e,n,o){i.globalAlpha=this.opacity.get(n,o);let s=this.radius.get(n,o),h=this.width.get(n,o);h>0&&(i.strokeStyle=this.stroke.get(n,o),i.lineWidth=h,i.beginPath(),i.arc(e[0][0].x,e[0][0].y,s+h/2,0,2*Math.PI),i.stroke()),i.fillStyle=this.fill.get(n,o),i.beginPath(),i.arc(e[0][0].x,e[0][0].y,s,0,2*Math.PI),i.fill()}place(i,e,n){e[0];let o=new Ut.default(e[0][0].x,e[0][0].y),s=this.radius.get(i.zoom,n),h={minX:o.x-s,minY:o.y-s,maxX:o.x+s,maxY:o.y+s};return[{anchor:o,bboxes:[h],draw:c=>{this.draw(c,[[new Ut.default(0,0)]],i.zoom,n)}}]}},Lf=class{constructor(i){this.font=new Rr(i),this.text=new Zr(i),this.fill=new Ct(i.fill,"black"),this.background=new Ct(i.background,"white"),this.padding=new pt(i.padding,0)}place(i,e,n){let o=this.text.get(i.zoom,n);if(!o)return;let s=this.font.get(i.zoom,n);i.scratch.font=s;let h=i.scratch.measureText(o),l=h.width,c=h.actualBoundingBoxAscent,d=h.actualBoundingBoxDescent;e[0];let _=new Ut.default(e[0][0].x,e[0][0].y),f=this.padding.get(i.zoom,n),m={minX:_.x-l/2-f,minY:_.y-c-f,maxX:_.x+l/2+f,maxY:_.y+d+f};return[{anchor:_,bboxes:[m],draw:w=>{w.globalAlpha=1,w.fillStyle=this.background.get(i.zoom,n),w.fillRect(-l/2-f,-c-f,l+2*f,c+d+2*f),w.fillStyle=this.fill.get(i.zoom,n),w.font=s,w.fillText(o,-l/2,0)}}]}},js=class{constructor(i){this.list=i}place(i,e,n){var o=this.list[0].place(i,e,n);if(!o)return;var s=o[0];let h=s.anchor,l=s.bboxes[0],c=l.maxY-l.minY,d=[{draw:s.draw,translate:{x:0,y:0}}],_=[[new Ut.default(e[0][0].x,e[0][0].y+c)]];for(let m=1;m<this.list.length;m++)o=this.list[m].place(i,_,n),o&&(s=o[0],l=ah(l,s.bboxes[0]),d.push({draw:s.draw,translate:{x:0,y:c}}));return[{anchor:h,bboxes:[l],draw:m=>{for(let v of d)m.save(),m.translate(v.translate.x,v.translate.y),v.draw(m),m.restore()}}]}},ah=(i,e)=>({minX:Math.min(i.minX,e.minX),minY:Math.min(i.minY,e.minY),maxX:Math.max(i.maxX,e.maxX),maxY:Math.max(i.maxY,e.maxY)}),Ws=class{constructor(i){this.list=i}place(i,e,n){let o=this.list[0];if(!o)return;var s=o.place(i,e,n);if(!s)return;var h=s[0];let l=h.anchor,c=h.bboxes[0],d=[h.draw];for(let f=1;f<this.list.length;f++){if(s=this.list[f].place(i,e,n),!s)return;h=s[0],c=ah(c,h.bboxes[0]),d.push(h.draw)}return[{anchor:l,bboxes:[c],draw:f=>{d.forEach(m=>m(f))}}]}},Cf=class{constructor(i){this.symbolizer=i}place(i,e,n){let o=e[0][0],s=this.symbolizer.place(i,[[new Ut.default(0,0)]],n);if(!s||s.length==0)return;let h=s[0],l=h.bboxes[0],c=l.maxX-l.minX,d=l.maxY-l.minY,_={minX:o.x-c/2,maxX:o.x+c/2,minY:o.y-d/2,maxY:o.y+d/2};return[{anchor:o,bboxes:[_],draw:m=>{m.translate(-c/2,d/2-l.maxY),h.draw(m,{justify:2})}}]}},Nr=class{constructor(i){this.font=new Rr(i),this.text=new Zr(i),this.fill=new Ct(i.fill,"black"),this.stroke=new Ct(i.stroke,"black"),this.width=new pt(i.width,0),this.lineHeight=new pt(i.lineHeight,1),this.letterSpacing=new pt(i.letterSpacing,0),this.maxLineCodeUnits=new pt(i.maxLineChars,15),this.justify=i.justify}place(i,e,n){let o=this.text.get(i.zoom,n);if(!o)return;let s=this.font.get(i.zoom,n);i.scratch.font=s;let h=this.letterSpacing.get(i.zoom,n),l=oh(o,this.maxLineCodeUnits.get(i.zoom,n));var c="",d=0;for(let I of l)I.length>d&&(d=I.length,c=I);let _=i.scratch.measureText(c),f=_.width+h*(d-1),m=_.actualBoundingBoxAscent,v=_.actualBoundingBoxDescent,w=(m+v)*this.lineHeight.get(i.zoom,n),b=new Ut.default(e[0][0].x,e[0][0].y),C={minX:b.x,minY:b.y-m,maxX:b.x+f,maxY:b.y+v+(l.length-1)*w};return[{anchor:b,bboxes:[C],draw:(I,x)=>{I.globalAlpha=1,I.font=s,I.fillStyle=this.fill.get(i.zoom,n);let P=this.width.get(i.zoom,n);var k=0;for(let F of l){var B=0;if(this.justify==2||x&&x.justify==2?B=(f-I.measureText(F).width)/2:(this.justify==3||x&&x.justify==3)&&(B=f-I.measureText(F).width),P)if(I.lineWidth=P*2,I.strokeStyle=this.stroke.get(i.zoom,n),h>0){var O=B;for(var A of F)I.strokeText(A,O,k),O+=I.measureText(A).width+h}else I.strokeText(F,B,k);if(h>0){var O=B;for(var A of F)I.fillText(A,O,k),O+=I.measureText(A).width+h}else I.fillText(F,B,k);k+=w}}}]}},li=class{constructor(i){this.centered=new Cf(new Nr(i))}place(i,e,n){return this.centered.place(i,e,n)}},Sf=class{constructor(i,e){var n,o,s;this.symbolizer=i,this.offsetX=new pt(e.offsetX,0),this.offsetY=new pt(e.offsetY,0),this.justify=(n=e.justify)!=null?n:void 0,this.placements=(o=e.placements)!=null?o:[2,6,8,4,1,3,5,7],this.ddValues=(s=e.ddValues)!=null?s:()=>({})}place(i,e,n){if(n.geomType!==Ze.Point)return;let o=e[0][0],s=this.symbolizer.place(i,[[new Ut.default(0,0)]],n);if(!s||s.length==0)return;let h=s[0],l=h.bboxes[0],c=this.offsetX,d=this.offsetY,_=this.justify,f=this.placements;const{offsetX:m,offsetY:v,justify:w,placements:b}=this.ddValues(i.zoom,n)||{};m&&(c=new pt(m,0)),v&&(d=new pt(v,0)),w&&(_=w),b&&(f=b);const C=c.get(i.zoom,n),E=d.get(i.zoom,n);let I=(O,A)=>({minX:O.x+A.x+l.minX,minY:O.y+A.y+l.minY,maxX:O.x+A.x+l.maxX,maxY:O.y+A.y+l.maxY});var x=new Ut.default(C,E),P;let k=O=>{O.translate(x.x,x.y),h.draw(O,{justify:P})};const B=(O,A)=>{const F=I(O,A);if(!i.index.bboxCollides(F,i.order))return[{anchor:o,bboxes:[F],draw:k}]};for(let O of f){const A=this.computeXAxisOffset(C,l,O),F=this.computeYAxisOffset(E,l,O);return P=this.computeJustify(_,O),x=new Ut.default(A,F),B(o,x)}}computeXAxisOffset(i,e,n){const o=e.maxX,s=o/2;return[1,5].includes(n)?i-s:[8,7,6].includes(n)?i-o:i}computeYAxisOffset(i,e,n){const o=Math.abs(e.minY),s=e.maxY,h=(e.minY+e.maxY)/2;return[3,7].includes(n)?i-h:[8,2,1].includes(n)?i-s:[6,4,5].includes(n)?i+o:i}computeJustify(i,e){return i||([1,5].includes(e)?2:[2,3,4].includes(e)?1:3)}},Qi=class{constructor(i){this.symbolizer=new Sf(new Nr(i),i)}place(i,e,n){return this.symbolizer.place(i,e,n)}},Us;(function(i){i[i.Above=1]="Above",i[i.Center=2]="Center",i[i.Below=3]="Below"})(Us||(Us={}));var kf=class{constructor(i){var e;this.font=new Rr(i),this.text=new Zr(i),this.fill=new Ct(i.fill,"black"),this.stroke=new Ct(i.stroke,"black"),this.width=new pt(i.width,0),this.offset=new pt(i.offset,0),this.position=(e=i.position)!=null?e:1,this.maxLabelCodeUnits=new pt(i.maxLabelChars,40),this.repeatDistance=new pt(i.repeatDistance,250)}place(i,e,n){let o=this.text.get(i.zoom,n);if(!o||o.length>this.maxLabelCodeUnits.get(i.zoom,n))return;let s=20,h=n.bbox;if(h.maxY-h.minY<s&&h.maxX-h.minX<s)return;let l=this.font.get(i.zoom,n);i.scratch.font=l;let c=i.scratch.measureText(o),d=c.width,_=c.actualBoundingBoxAscent+c.actualBoundingBoxDescent;var f=this.repeatDistance.get(i.zoom,n);i.overzoom>4&&(f*=1<<i.overzoom-4);let m=_*2,v=wf(e,d,f,m);if(v.length==0)return;let w=[];for(let b of v){let C=b.end.x-b.start.x,E=b.end.y-b.start.y,x=xf(b.start,b.end,d,m/2).map(k=>({minX:k.x-m/2,minY:k.y-m/2,maxX:k.x+m/2,maxY:k.y+m/2})),P=k=>{k.globalAlpha=1,k.rotate(Math.atan2(E,C)),C<0&&(k.scale(-1,-1),k.translate(-d,0));let B=0;this.position===3?B+=_:this.position===2&&(B+=_/2),k.translate(0,B-this.offset.get(i.zoom,n)),k.font=l;let O=this.width.get(i.zoom,n);O&&(k.lineWidth=O,k.strokeStyle=this.stroke.get(i.zoom,n),k.strokeText(o,0,0)),k.fillStyle=this.fill.get(i.zoom,n),k.fillText(o,0,0)};w.push({anchor:b.start,bboxes:x,draw:P,deduplicationKey:o,deduplicationDistance:f})}return w}},ur=class{constructor(i){this.symbolizer=new Nr(i)}place(i,e,n){let o=n.bbox;if((o.maxY-o.minY)*(o.maxX-o.minX)<2e4)return;let h=this.symbolizer.place(i,[[new Ut.default(0,0)]],n);if(!h||h.length==0)return;let l=h[0],c=l.bboxes[0],d=e[0],_=(0,gf.default)([d.map(w=>[w.x,w.y])]),f=new Ut.default(_[0],_[1]),m={minX:f.x-(c.maxX-c.minX)/2,minY:f.y-(c.maxY-c.minY)/2,maxX:f.x+(c.maxX-c.minX)/2,maxY:f.y+(c.maxY-c.minY)/2};return[{anchor:f,bboxes:[m],draw:w=>{w.translate(l.anchor.x-(c.maxX-c.minX)/2,l.anchor.y),l.draw(w)}}]}},hh=(i,e)=>{let n=Fs(e),o=Hc({},i);for(const[s,h]of Object.entries(i)){let l=Fs(h);o[s]=mf(n[0],n[1],l[2],l[3])}return o},Vs=(i,e)=>(e&&(i=hh(i,e)),[{dataLayer:"earth",symbolizer:new bt({fill:i.earth})},{dataLayer:"natural",symbolizer:new bt({fill:i.glacier}),filter:(n,o)=>o.props.natural=="glacier"},{dataLayer:"landuse",symbolizer:new bt({fill:i.residential}),filter:(n,o)=>o.props.landuse=="residential"||o.props.place=="neighbourhood"},{dataLayer:"landuse",symbolizer:new bt({fill:i.hospital}),filter:(n,o)=>o.props.amenity=="hospital"},{dataLayer:"landuse",symbolizer:new bt({fill:i.cemetery}),filter:(n,o)=>o.props.landuse=="cemetery"},{dataLayer:"landuse",symbolizer:new bt({fill:i.school}),filter:(n,o)=>o.props.amenity=="school"||o.props.amenity=="kindergarten"||o.props.amenity=="university"||o.props.amenity=="college"},{dataLayer:"landuse",symbolizer:new bt({fill:i.industrial}),filter:(n,o)=>o.props.landuse=="industrial"},{dataLayer:"natural",symbolizer:new bt({fill:i.wood}),filter:(n,o)=>o.props.natural=="wood"},{dataLayer:"landuse",symbolizer:new bt({fill:i.grass}),filter:(n,o)=>o.props.landuse=="grass"},{dataLayer:"landuse",symbolizer:new bt({fill:i.park}),filter:(n,o)=>o.props.leisure=="park"},{dataLayer:"water",symbolizer:new bt({fill:i.water})},{dataLayer:"natural",symbolizer:new bt({fill:i.sand}),filter:(n,o)=>o.props.natural=="sand"},{dataLayer:"buildings",symbolizer:new bt({fill:i.buildings})},{dataLayer:"roads",symbolizer:new qt({color:i.highwayCasing,width:le(1.4,[[5,1.5],[11,4],[16,9],[20,40]])}),filter:(n,o)=>o.props["pmap:kind"]=="highway"},{dataLayer:"roads",symbolizer:new qt({color:i.majorRoadCasing,width:le(1.4,[[9,3],[12,4],[17,8],[20,22]])}),filter:(n,o)=>o.props["pmap:kind"]=="major_road"},{dataLayer:"roads",symbolizer:new qt({color:i.mediumRoadCasing,width:le(1.4,[[13,3],[17,6],[20,18]])}),filter:(n,o)=>o.props["pmap:kind"]=="medium_road"},{dataLayer:"roads",symbolizer:new qt({color:i.minorRoadCasing,width:le(1.4,[[14,2],[17,5],[20,15]])}),filter:(n,o)=>o.props["pmap:kind"]=="minor_road"},{dataLayer:"roads",symbolizer:new qt({color:i.minorRoad,width:le(1.4,[[14,1],[17,3],[20,13]])}),filter:(n,o)=>o.props["pmap:kind"]=="minor_road"},{dataLayer:"roads",symbolizer:new qt({color:i.mediumRoad,width:le(1.4,[[13,2],[17,4],[20,15]])}),filter:(n,o)=>o.props["pmap:kind"]=="medium_road"},{dataLayer:"roads",symbolizer:new qt({color:i.majorRoad,width:le(1.4,[[9,2],[12,3],[17,6],[20,20]])}),filter:(n,o)=>o.props["pmap:kind"]=="major_road"},{dataLayer:"roads",symbolizer:new qt({color:i.highway,width:le(1.4,[[5,.5],[11,2.5],[16,7],[20,30]])}),filter:(n,o)=>o.props["pmap:kind"]=="highway"},{dataLayer:"boundaries",symbolizer:new qt({color:i.boundaries,width:2,opacity:.4})},{dataLayer:"mask",symbolizer:new bt({fill:i.mask})}]),Ys=(i,e,n,o)=>{e&&(i=hh(i,e));var s=["name"];n&&(s=n);let h=(l,c)=>o?l instanceof Qi?new js([l,new Qi({fill:c,label_props:o})]):new js([l,new li({fill:c,label_props:o})]):l;return[{dataLayer:"places",symbolizer:h(new li({label_props:s,fill:i.countryLabel,lineHeight:1.5,font:(l,c)=>l<6?"200 14px sans-serif":"200 20px sans-serif",textTransform:"uppercase"}),i.countryLabel),filter:(l,c)=>c.props["pmap:kind"]=="country"},{dataLayer:"places",symbolizer:h(new li({label_props:s,fill:i.stateLabel,font:"300 16px sans-serif"}),i.stateLabel),filter:(l,c)=>c.props["pmap:kind"]=="state"},{id:"cities_high",dataLayer:"places",filter:(l,c)=>c.props["pmap:kind"]=="city",minzoom:7,symbolizer:h(new li({label_props:s,fill:i.cityLabel,font:(l,c)=>(c==null?void 0:c.props["pmap:rank"])===1?l>8?"600 20px sans-serif":"600 12px sans-serif":l>8?"600 16px sans-serif":"600 10px sans-serif"}),i.cityLabel),sort:(l,c)=>l["pmap:rank"]-c["pmap:rank"]},{id:"cities_low",dataLayer:"places",filter:(l,c)=>c.props["pmap:kind"]=="city",maxzoom:6,symbolizer:new Ws([new Mr({radius:2,fill:i.cityLabel}),h(new Qi({label_props:s,fill:i.cityLabel,offsetX:2,offsetY:2,font:(l,c)=>(c==null?void 0:c.props["pmap:rank"])===1?l>8?"600 20px sans-serif":"600 12px sans-serif":l>8?"600 16px sans-serif":"600 10px sans-serif"}),i.cityLabel)]),sort:(l,c)=>l["pmap:rank"]-c["pmap:rank"]},{id:"neighbourhood",dataLayer:"places",symbolizer:h(new li({label_props:s,fill:i.neighbourhoodLabel,font:"500 10px sans-serif",textTransform:"uppercase"}),i.neighbourhoodLabel),filter:(l,c)=>c.props["pmap:kind"]=="neighbourhood"},{dataLayer:"landuse",symbolizer:h(new ur({label_props:s,fill:i.landuseLabel,font:"300 12px sans-serif"}),i.landuseLabel)},{dataLayer:"water",symbolizer:h(new ur({label_props:s,fill:i.waterLabel,font:"italic 600 12px sans-serif"}),i.waterLabel)},{dataLayer:"natural",symbolizer:h(new ur({label_props:s,fill:i.naturalLabel,font:"italic 300 12px sans-serif"}),i.naturalLabel)},{dataLayer:"roads",symbolizer:h(new kf({label_props:s,fill:i.roadsLabel,font:"500 12px sans-serif"}),i.roadsLabel),minzoom:12},{dataLayer:"roads",symbolizer:new Lf({label_props:["ref"],font:"600 9px sans-serif",background:i.highway,padding:2,fill:i.neighbourhoodLabel}),filter:(l,c)=>c.props["pmap:kind"]=="highway"},{dataLayer:"pois",symbolizer:new Ws([new Mr({radius:2,fill:i.poisLabel}),h(new Qi({label_props:s,fill:i.poisLabel,offsetX:2,offsetY:2,font:"300 10px sans-serif"}),i.poisLabel)])}]},Hs=(i,e,n)=>[{dataSource:i,dataLayer:e,symbolizer:new Mr({opacity:.2,fill:n,radius:4}),filter:(o,s)=>s.geomType==Ze.Point},{dataSource:i,dataLayer:e,symbolizer:new qt({opacity:.2,color:n,width:2}),filter:(o,s)=>s.geomType==Ze.Line},{dataSource:i,dataLayer:e,symbolizer:new bt({opacity:.2,fill:n,stroke:n,width:1}),filter:(o,s)=>s.geomType==Ze.Polygon}],Ef=(i,e)=>{var n=[];for(var[o,s]of i)for(var h of s)for(var l of h.data.keys())o===e.dataSource&&l===e.dataLayer||(n=n.concat(Hs(o,l,"steelblue")));return n=n.concat(Hs(e.dataSource||"",e.dataLayer,"red")),n},Tf=Tt(se()),Df=i=>new Promise((e,n)=>{setTimeout(()=>{e()},i)}),zf=i=>i.then(e=>({status:"fulfilled",value:e}),e=>({status:"rejected",reason:e})),If=(i={})=>{class e extends L.GridLayer{constructor(o={}){o.noWrap&&!o.bounds&&(o.bounds=[[-90,-180],[90,180]]),o.attribution==null&&(o.attribution='<a href="https://protomaps.com">Protomaps</a> © <a href="https://openstreetmap.org/copyright">OpenStreetMap</a>'),super(o);let s=o.dark?Bs:Is;this.paint_rules=o.paint_rules||Vs(s,o.shade),this.label_rules=o.label_rules||Ys(s,o.shade,o.language1,o.language2),this.backgroundColor=o.backgroundColor,this.lastRequestedZ=void 0,this.xray=o.xray,this.tasks=o.tasks||[],this.views=Qd(o),this.debug=o.debug;let h=document.createElement("canvas").getContext("2d");this.scratch=h,this.onTilesInvalidated=l=>{l.forEach(c=>{this.rerenderTile(c)})},this.labelers=new zs(this.scratch,this.label_rules,16,this.onTilesInvalidated),this.tile_size=256*window.devicePixelRatio,this.tileDelay=o.tileDelay||3,this.lang=o.lang,this.inspector=this.inspect(this)}setDefaultStyle(o,s,h,l){let c=o?Bs:Is;this.paint_rules=Vs(c,s),this.label_rules=Ys(c,s,h,l)}renderTile(o,s,h,l=()=>{}){return We(this,null,function*(){this.lastRequestedZ=o.z;let c=[];for(const[A,F]of this.views){let W=F.getDisplayTile(o);c.push({key:A,promise:W})}let d=yield Promise.all(c.map(A=>A.promise.then(F=>({status:"fulfilled",value:F,key:A.key}),F=>({status:"rejected",reason:F,key:A.key})))),_=new Map;for(const A of d)A.status==="fulfilled"?_.set(A.key,[A.value]):A.reason.name==="AbortError"||console.error(A.reason);if(s.key!=h||this.lastRequestedZ!==o.z||(yield Promise.all(this.tasks.map(zf)),s.key!=h)||this.lastRequestedZ!==o.z)return;let f=this.labelers.add(o.z,_);if(s.key!=h||this.lastRequestedZ!==o.z)return;let m=this.labelers.getIndex(o.z);if(!this._map)return;let v=this._map.getCenter().wrap(),w=this._getTiledPixelBounds(v),b=this._pxBoundsToTileRange(w),C=b.getCenter(),E=o.distanceTo(C)*this.tileDelay;if(yield Df(E),s.key!=h||this.lastRequestedZ!==o.z)return;let I=16,x={minX:256*o.x-I,minY:256*o.y-I,maxX:256*(o.x+1)+I,maxY:256*(o.y+1)+I},P=new Tf.default(256*o.x,256*o.y);s.width=this.tile_size,s.height=this.tile_size;let k=s.getContext("2d");k.setTransform(this.tile_size/256,0,0,this.tile_size/256,0,0),k.clearRect(0,0,256,256),this.backgroundColor&&(k.save(),k.fillStyle=this.backgroundColor,k.fillRect(0,0,256,256),k.restore());var B=0;let O=this.paint_rules;if(this.xray&&(O=Ef(_,this.xray)),B=ef(k,o.z,_,this.xray?null:m,O,x,P,!1,this.debug),this.debug){k.save(),k.fillStyle=this.debug,k.font="600 12px sans-serif",k.fillText(o.z+" "+o.x+" "+o.y,4,14),k.font="12px sans-serif";let A=28;for(let[F,W]of _){let V=W[0].data_tile;k.fillText(F+(F?" ":"")+V.z+" "+V.x+" "+V.y,4,A),A+=14}k.font="600 10px sans-serif",B>8&&(k.fillText(B.toFixed()+" ms paint",4,A),A+=14),f>8&&k.fillText(f.toFixed()+" ms layout",4,A),k.strokeStyle=this.debug,k.lineWidth=.5,k.beginPath(),k.moveTo(0,0),k.lineTo(0,256),k.stroke(),k.lineWidth=.5,k.beginPath(),k.moveTo(0,0),k.lineTo(256,0),k.stroke(),k.restore()}l()})}rerenderTile(o){for(let s in this._tiles){let h=this._wrapCoords(this._keyToTileCoords(s));o===this._tileCoordsToKey(h)&&this.renderTile(h,this._tiles[s].el,o)}}clearLayout(){this.labelers=new zs(this.scratch,this.label_rules,16,this.onTilesInvalidated)}rerenderTiles(){for(let o in this._tiles){let s=this._wrapCoords(this._keyToTileCoords(o)),h=this._tileCoordsToKey(s);this.renderTile(s,this._tiles[o].el,h)}}createTile(o,s){let h=L.DomUtil.create("canvas","leaflet-tile");h.lang=this.lang;let l=this._tileCoordsToKey(o);return h.key=l,this.renderTile(o,h,l,()=>{s(null,h)}),h}_removeTile(o){let s=this._tiles[o];s&&(s.el.removed=!0,s.el.key=void 0,L.DomUtil.removeClass(s.el,"leaflet-tile-loaded"),s.el.width=s.el.height=0,L.DomUtil.remove(s.el),delete this._tiles[o],this.fire("tileunload",{tile:s.el,coords:this._keyToTileCoords(o)}))}queryFeatures(o,s){let h=new Map;for(var[l,c]of this.views)h.set(l,c.queryFeatures(o,s,this._map.getZoom()));return h}inspect(o){return s=>{let h=["◎","⟍","◻"],l=o._map.wrapLatLng(s.latlng),c=o.queryFeatures(l.lng,l.lat);var d="";let _=!0;for(var[f,m]of c)for(var v of m)if(!(this.xray&&this.xray!==!0&&!((this.xray.dataSource||"")===f&&this.xray.dataLayer===v.layerName))){d=d+`<div style="margin-top:${_?0:.5}em">${h[v.feature.geomType-1]} <b>${f} ${f?"/":""} ${v.layerName}</b> ${v.feature.id||""}</div>`;for(const w in v.feature.props)d=d+`<div style="font-size:0.9em">${w} = ${v.feature.props[w]}</div>`;_=!1}_&&(d="No features."),L.popup().setLatLng(s.latlng).setContent('<div style="max-height:400px;overflow-y:scroll;padding-right:8px">'+d+"</div>").openOn(o._map)}}addInspector(o){return o.on("click",this.inspector)}removeInspector(o){return o.off("click",this.inspector)}}return new e(i)};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */function Bf({L:i,id:e,lat:n,lng:o,zoom:s}){const h=i.map(e,{center:[n,o],zoom:s,minZoom:3,maxZoom:20,tapTolerance:10});var c=If({url:"https://api.protomaps.com/tiles/v2/{z}/{x}/{y}.pbf?key=d23c43b7c56e123d"});return c.addTo(h),h}var Lr={exports:{}};/* @preserve
 * Leaflet 1.9.4, a JS library for interactive maps. https://leafletjs.com
 * (c) 2010-2023 Vladimir Agafonkin, (c) 2010-2011 CloudMade
 */(function(i,e){(function(n,o){o(e)})(Ul,function(n){var o="1.9.4";function s(t){var r,a,u,p;for(a=1,u=arguments.length;a<u;a++){p=arguments[a];for(r in p)t[r]=p[r]}return t}var h=Object.create||function(){function t(){}return function(r){return t.prototype=r,new t}}();function l(t,r){var a=Array.prototype.slice;if(t.bind)return t.bind.apply(t,a.call(arguments,1));var u=a.call(arguments,2);return function(){return t.apply(r,u.length?u.concat(a.call(arguments)):arguments)}}var c=0;function d(t){return"_leaflet_id"in t||(t._leaflet_id=++c),t._leaflet_id}function _(t,r,a){var u,p,g,M;return M=function(){u=!1,p&&(g.apply(a,p),p=!1)},g=function(){u?p=arguments:(t.apply(a,arguments),setTimeout(M,r),u=!0)},g}function f(t,r,a){var u=r[1],p=r[0],g=u-p;return t===u&&a?t:((t-p)%g+g)%g+p}function m(){return!1}function v(t,r){if(r===!1)return t;var a=Math.pow(10,r===void 0?6:r);return Math.round(t*a)/a}function w(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}function b(t){return w(t).split(/\s+/)}function C(t,r){Object.prototype.hasOwnProperty.call(t,"options")||(t.options=t.options?h(t.options):{});for(var a in r)t.options[a]=r[a];return t.options}function E(t,r,a){var u=[];for(var p in t)u.push(encodeURIComponent(a?p.toUpperCase():p)+"="+encodeURIComponent(t[p]));return(!r||r.indexOf("?")===-1?"?":"&")+u.join("&")}var I=/\{ *([\w_ -]+) *\}/g;function x(t,r){return t.replace(I,function(a,u){var p=r[u];if(p===void 0)throw new Error("No value provided for variable "+a);return typeof p=="function"&&(p=p(r)),p})}var P=Array.isArray||function(t){return Object.prototype.toString.call(t)==="[object Array]"};function k(t,r){for(var a=0;a<t.length;a++)if(t[a]===r)return a;return-1}var B="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function O(t){return window["webkit"+t]||window["moz"+t]||window["ms"+t]}var A=0;function F(t){var r=+new Date,a=Math.max(0,16-(r-A));return A=r+a,window.setTimeout(t,a)}var W=window.requestAnimationFrame||O("RequestAnimationFrame")||F,V=window.cancelAnimationFrame||O("CancelAnimationFrame")||O("CancelRequestAnimationFrame")||function(t){window.clearTimeout(t)};function Y(t,r,a){if(a&&W===F)t.call(r);else return W.call(window,l(t,r))}function $(t){t&&V.call(window,t)}var X={__proto__:null,extend:s,create:h,bind:l,get lastId(){return c},stamp:d,throttle:_,wrapNum:f,falseFn:m,formatNum:v,trim:w,splitWords:b,setOptions:C,getParamString:E,template:x,isArray:P,indexOf:k,emptyImageUrl:B,requestFn:W,cancelFn:V,requestAnimFrame:Y,cancelAnimFrame:$};function y(){}y.extend=function(t){var r=function(){C(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},a=r.__super__=this.prototype,u=h(a);u.constructor=r,r.prototype=u;for(var p in this)Object.prototype.hasOwnProperty.call(this,p)&&p!=="prototype"&&p!=="__super__"&&(r[p]=this[p]);return t.statics&&s(r,t.statics),t.includes&&(S(t.includes),s.apply(null,[u].concat(t.includes))),s(u,t),delete u.statics,delete u.includes,u.options&&(u.options=a.options?h(a.options):{},s(u.options,t.options)),u._initHooks=[],u.callInitHooks=function(){if(!this._initHooksCalled){a.callInitHooks&&a.callInitHooks.call(this),this._initHooksCalled=!0;for(var g=0,M=u._initHooks.length;g<M;g++)u._initHooks[g].call(this)}},r},y.include=function(t){var r=this.prototype.options;return s(this.prototype,t),t.options&&(this.prototype.options=r,this.mergeOptions(t.options)),this},y.mergeOptions=function(t){return s(this.prototype.options,t),this},y.addInitHook=function(t){var r=Array.prototype.slice.call(arguments,1),a=typeof t=="function"?t:function(){this[t].apply(this,r)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(a),this};function S(t){if(!(typeof L>"u"||!L||!L.Mixin)){t=P(t)?t:[t];for(var r=0;r<t.length;r++)t[r]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",new Error().stack)}}var T={on:function(t,r,a){if(typeof t=="object")for(var u in t)this._on(u,t[u],r);else{t=b(t);for(var p=0,g=t.length;p<g;p++)this._on(t[p],r,a)}return this},off:function(t,r,a){if(!arguments.length)delete this._events;else if(typeof t=="object")for(var u in t)this._off(u,t[u],r);else{t=b(t);for(var p=arguments.length===1,g=0,M=t.length;g<M;g++)p?this._off(t[g]):this._off(t[g],r,a)}return this},_on:function(t,r,a,u){if(typeof r!="function"){console.warn("wrong listener type: "+typeof r);return}if(this._listens(t,r,a)===!1){a===this&&(a=void 0);var p={fn:r,ctx:a};u&&(p.once=!0),this._events=this._events||{},this._events[t]=this._events[t]||[],this._events[t].push(p)}},_off:function(t,r,a){var u,p,g;if(this._events&&(u=this._events[t],!!u)){if(arguments.length===1){if(this._firingCount)for(p=0,g=u.length;p<g;p++)u[p].fn=m;delete this._events[t];return}if(typeof r!="function"){console.warn("wrong listener type: "+typeof r);return}var M=this._listens(t,r,a);if(M!==!1){var D=u[M];this._firingCount&&(D.fn=m,this._events[t]=u=u.slice()),u.splice(M,1)}}},fire:function(t,r,a){if(!this.listens(t,a))return this;var u=s({},r,{type:t,target:this,sourceTarget:r&&r.sourceTarget||this});if(this._events){var p=this._events[t];if(p){this._firingCount=this._firingCount+1||1;for(var g=0,M=p.length;g<M;g++){var D=p[g],z=D.fn;D.once&&this.off(t,z,D.ctx),z.call(D.ctx||this,u)}this._firingCount--}}return a&&this._propagateEvent(u),this},listens:function(t,r,a,u){typeof t!="string"&&console.warn('"string" type argument expected');var p=r;typeof r!="function"&&(u=!!r,p=void 0,a=void 0);var g=this._events&&this._events[t];if(g&&g.length&&this._listens(t,p,a)!==!1)return!0;if(u){for(var M in this._eventParents)if(this._eventParents[M].listens(t,r,a,u))return!0}return!1},_listens:function(t,r,a){if(!this._events)return!1;var u=this._events[t]||[];if(!r)return!!u.length;a===this&&(a=void 0);for(var p=0,g=u.length;p<g;p++)if(u[p].fn===r&&u[p].ctx===a)return p;return!1},once:function(t,r,a){if(typeof t=="object")for(var u in t)this._on(u,t[u],r,!0);else{t=b(t);for(var p=0,g=t.length;p<g;p++)this._on(t[p],r,a,!0)}return this},addEventParent:function(t){return this._eventParents=this._eventParents||{},this._eventParents[d(t)]=t,this},removeEventParent:function(t){return this._eventParents&&delete this._eventParents[d(t)],this},_propagateEvent:function(t){for(var r in this._eventParents)this._eventParents[r].fire(t.type,s({layer:t.target,propagatedFrom:t.target},t),!0)}};T.addEventListener=T.on,T.removeEventListener=T.clearAllEventListeners=T.off,T.addOneTimeEventListener=T.once,T.fireEvent=T.fire,T.hasEventListeners=T.listens;var U=y.extend(T);function R(t,r,a){this.x=a?Math.round(t):t,this.y=a?Math.round(r):r}var K=Math.trunc||function(t){return t>0?Math.floor(t):Math.ceil(t)};R.prototype={clone:function(){return new R(this.x,this.y)},add:function(t){return this.clone()._add(N(t))},_add:function(t){return this.x+=t.x,this.y+=t.y,this},subtract:function(t){return this.clone()._subtract(N(t))},_subtract:function(t){return this.x-=t.x,this.y-=t.y,this},divideBy:function(t){return this.clone()._divideBy(t)},_divideBy:function(t){return this.x/=t,this.y/=t,this},multiplyBy:function(t){return this.clone()._multiplyBy(t)},_multiplyBy:function(t){return this.x*=t,this.y*=t,this},scaleBy:function(t){return new R(this.x*t.x,this.y*t.y)},unscaleBy:function(t){return new R(this.x/t.x,this.y/t.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=K(this.x),this.y=K(this.y),this},distanceTo:function(t){t=N(t);var r=t.x-this.x,a=t.y-this.y;return Math.sqrt(r*r+a*a)},equals:function(t){return t=N(t),t.x===this.x&&t.y===this.y},contains:function(t){return t=N(t),Math.abs(t.x)<=Math.abs(this.x)&&Math.abs(t.y)<=Math.abs(this.y)},toString:function(){return"Point("+v(this.x)+", "+v(this.y)+")"}};function N(t,r,a){return t instanceof R?t:P(t)?new R(t[0],t[1]):t==null?t:typeof t=="object"&&"x"in t&&"y"in t?new R(t.x,t.y):new R(t,r,a)}function tt(t,r){if(t)for(var a=r?[t,r]:t,u=0,p=a.length;u<p;u++)this.extend(a[u])}tt.prototype={extend:function(t){var r,a;if(!t)return this;if(t instanceof R||typeof t[0]=="number"||"x"in t)r=a=N(t);else if(t=J(t),r=t.min,a=t.max,!r||!a)return this;return!this.min&&!this.max?(this.min=r.clone(),this.max=a.clone()):(this.min.x=Math.min(r.x,this.min.x),this.max.x=Math.max(a.x,this.max.x),this.min.y=Math.min(r.y,this.min.y),this.max.y=Math.max(a.y,this.max.y)),this},getCenter:function(t){return N((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,t)},getBottomLeft:function(){return N(this.min.x,this.max.y)},getTopRight:function(){return N(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(t){var r,a;return typeof t[0]=="number"||t instanceof R?t=N(t):t=J(t),t instanceof tt?(r=t.min,a=t.max):r=a=t,r.x>=this.min.x&&a.x<=this.max.x&&r.y>=this.min.y&&a.y<=this.max.y},intersects:function(t){t=J(t);var r=this.min,a=this.max,u=t.min,p=t.max,g=p.x>=r.x&&u.x<=a.x,M=p.y>=r.y&&u.y<=a.y;return g&&M},overlaps:function(t){t=J(t);var r=this.min,a=this.max,u=t.min,p=t.max,g=p.x>r.x&&u.x<a.x,M=p.y>r.y&&u.y<a.y;return g&&M},isValid:function(){return!!(this.min&&this.max)},pad:function(t){var r=this.min,a=this.max,u=Math.abs(r.x-a.x)*t,p=Math.abs(r.y-a.y)*t;return J(N(r.x-u,r.y-p),N(a.x+u,a.y+p))},equals:function(t){return t?(t=J(t),this.min.equals(t.getTopLeft())&&this.max.equals(t.getBottomRight())):!1}};function J(t,r){return!t||t instanceof tt?t:new tt(t,r)}function ut(t,r){if(t)for(var a=r?[t,r]:t,u=0,p=a.length;u<p;u++)this.extend(a[u])}ut.prototype={extend:function(t){var r=this._southWest,a=this._northEast,u,p;if(t instanceof st)u=t,p=t;else if(t instanceof ut){if(u=t._southWest,p=t._northEast,!u||!p)return this}else return t?this.extend(nt(t)||ht(t)):this;return!r&&!a?(this._southWest=new st(u.lat,u.lng),this._northEast=new st(p.lat,p.lng)):(r.lat=Math.min(u.lat,r.lat),r.lng=Math.min(u.lng,r.lng),a.lat=Math.max(p.lat,a.lat),a.lng=Math.max(p.lng,a.lng)),this},pad:function(t){var r=this._southWest,a=this._northEast,u=Math.abs(r.lat-a.lat)*t,p=Math.abs(r.lng-a.lng)*t;return new ut(new st(r.lat-u,r.lng-p),new st(a.lat+u,a.lng+p))},getCenter:function(){return new st((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new st(this.getNorth(),this.getWest())},getSouthEast:function(){return new st(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(t){typeof t[0]=="number"||t instanceof st||"lat"in t?t=nt(t):t=ht(t);var r=this._southWest,a=this._northEast,u,p;return t instanceof ut?(u=t.getSouthWest(),p=t.getNorthEast()):u=p=t,u.lat>=r.lat&&p.lat<=a.lat&&u.lng>=r.lng&&p.lng<=a.lng},intersects:function(t){t=ht(t);var r=this._southWest,a=this._northEast,u=t.getSouthWest(),p=t.getNorthEast(),g=p.lat>=r.lat&&u.lat<=a.lat,M=p.lng>=r.lng&&u.lng<=a.lng;return g&&M},overlaps:function(t){t=ht(t);var r=this._southWest,a=this._northEast,u=t.getSouthWest(),p=t.getNorthEast(),g=p.lat>r.lat&&u.lat<a.lat,M=p.lng>r.lng&&u.lng<a.lng;return g&&M},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(t,r){return t?(t=ht(t),this._southWest.equals(t.getSouthWest(),r)&&this._northEast.equals(t.getNorthEast(),r)):!1},isValid:function(){return!!(this._southWest&&this._northEast)}};function ht(t,r){return t instanceof ut?t:new ut(t,r)}function st(t,r,a){if(isNaN(t)||isNaN(r))throw new Error("Invalid LatLng object: ("+t+", "+r+")");this.lat=+t,this.lng=+r,a!==void 0&&(this.alt=+a)}st.prototype={equals:function(t,r){if(!t)return!1;t=nt(t);var a=Math.max(Math.abs(this.lat-t.lat),Math.abs(this.lng-t.lng));return a<=(r===void 0?1e-9:r)},toString:function(t){return"LatLng("+v(this.lat,t)+", "+v(this.lng,t)+")"},distanceTo:function(t){return Ot.distance(this,nt(t))},wrap:function(){return Ot.wrapLatLng(this)},toBounds:function(t){var r=180*t/40075017,a=r/Math.cos(Math.PI/180*this.lat);return ht([this.lat-r,this.lng-a],[this.lat+r,this.lng+a])},clone:function(){return new st(this.lat,this.lng,this.alt)}};function nt(t,r,a){return t instanceof st?t:P(t)&&typeof t[0]!="object"?t.length===3?new st(t[0],t[1],t[2]):t.length===2?new st(t[0],t[1]):null:t==null?t:typeof t=="object"&&"lat"in t?new st(t.lat,"lng"in t?t.lng:t.lon,t.alt):r===void 0?null:new st(t,r,a)}var Dt={latLngToPoint:function(t,r){var a=this.projection.project(t),u=this.scale(r);return this.transformation._transform(a,u)},pointToLatLng:function(t,r){var a=this.scale(r),u=this.transformation.untransform(t,a);return this.projection.unproject(u)},project:function(t){return this.projection.project(t)},unproject:function(t){return this.projection.unproject(t)},scale:function(t){return 256*Math.pow(2,t)},zoom:function(t){return Math.log(t/256)/Math.LN2},getProjectedBounds:function(t){if(this.infinite)return null;var r=this.projection.bounds,a=this.scale(t),u=this.transformation.transform(r.min,a),p=this.transformation.transform(r.max,a);return new tt(u,p)},infinite:!1,wrapLatLng:function(t){var r=this.wrapLng?f(t.lng,this.wrapLng,!0):t.lng,a=this.wrapLat?f(t.lat,this.wrapLat,!0):t.lat,u=t.alt;return new st(a,r,u)},wrapLatLngBounds:function(t){var r=t.getCenter(),a=this.wrapLatLng(r),u=r.lat-a.lat,p=r.lng-a.lng;if(u===0&&p===0)return t;var g=t.getSouthWest(),M=t.getNorthEast(),D=new st(g.lat-u,g.lng-p),z=new st(M.lat-u,M.lng-p);return new ut(D,z)}},Ot=s({},Dt,{wrapLng:[-180,180],R:6371e3,distance:function(t,r){var a=Math.PI/180,u=t.lat*a,p=r.lat*a,g=Math.sin((r.lat-t.lat)*a/2),M=Math.sin((r.lng-t.lng)*a/2),D=g*g+Math.cos(u)*Math.cos(p)*M*M,z=2*Math.atan2(Math.sqrt(D),Math.sqrt(1-D));return this.R*z}}),jr=6378137,wn={R:jr,MAX_LATITUDE:85.0511287798,project:function(t){var r=Math.PI/180,a=this.MAX_LATITUDE,u=Math.max(Math.min(a,t.lat),-a),p=Math.sin(u*r);return new R(this.R*t.lng*r,this.R*Math.log((1+p)/(1-p))/2)},unproject:function(t){var r=180/Math.PI;return new st((2*Math.atan(Math.exp(t.y/this.R))-Math.PI/2)*r,t.x*r/this.R)},bounds:function(){var t=jr*Math.PI;return new tt([-t,-t],[t,t])}()};function xn(t,r,a,u){if(P(t)){this._a=t[0],this._b=t[1],this._c=t[2],this._d=t[3];return}this._a=t,this._b=r,this._c=a,this._d=u}xn.prototype={transform:function(t,r){return this._transform(t.clone(),r)},_transform:function(t,r){return r=r||1,t.x=r*(this._a*t.x+this._b),t.y=r*(this._c*t.y+this._d),t},untransform:function(t,r){return r=r||1,new R((t.x/r-this._b)/this._a,(t.y/r-this._d)/this._c)}};function Ue(t,r,a,u){return new xn(t,r,a,u)}var bn=s({},Ot,{code:"EPSG:3857",projection:wn,transformation:function(){var t=.5/(Math.PI*wn.R);return Ue(t,.5,-t,.5)}()}),ch=s({},bn,{code:"EPSG:900913"});function Wr(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function Ur(t,r){var a="",u,p,g,M,D,z;for(u=0,g=t.length;u<g;u++){for(D=t[u],p=0,M=D.length;p<M;p++)z=D[p],a+=(p?"L":"M")+z.x+" "+z.y;a+=r?H.svg?"z":"x":""}return a||"M0 0"}var Pn=document.documentElement.style,ki="ActiveXObject"in window,dh=ki&&!document.addEventListener,Vr="msLaunchUri"in navigator&&!("documentMode"in document),Mn=Yt("webkit"),Yr=Yt("android"),Hr=Yt("android 2")||Yt("android 3"),fh=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),ph=Yr&&Yt("Google")&&fh<537&&!("AudioNode"in window),Ln=!!window.opera,Xr=!Vr&&Yt("chrome"),Gr=Yt("gecko")&&!Mn&&!Ln&&!ki,_h=!Xr&&Yt("safari"),qr=Yt("phantom"),$r="OTransition"in Pn,mh=navigator.platform.indexOf("Win")===0,Kr=ki&&"transition"in Pn,Cn="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!Hr,Jr="MozPerspective"in Pn,gh=!window.L_DISABLE_3D&&(Kr||Cn||Jr)&&!$r&&!qr,Ve=typeof orientation<"u"||Yt("mobile"),vh=Ve&&Mn,yh=Ve&&Cn,Qr=!window.PointerEvent&&window.MSPointerEvent,to=!!(window.PointerEvent||Qr),eo="ontouchstart"in window||!!window.TouchEvent,wh=!window.L_NO_TOUCH&&(eo||to),xh=Ve&&Ln,bh=Ve&&Gr,Ph=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,Mh=function(){var t=!1;try{var r=Object.defineProperty({},"passive",{get:function(){t=!0}});window.addEventListener("testPassiveEventSupport",m,r),window.removeEventListener("testPassiveEventSupport",m,r)}catch{}return t}(),Lh=function(){return!!document.createElement("canvas").getContext}(),Sn=!!(document.createElementNS&&Wr("svg").createSVGRect),Ch=!!Sn&&function(){var t=document.createElement("div");return t.innerHTML="<svg/>",(t.firstChild&&t.firstChild.namespaceURI)==="http://www.w3.org/2000/svg"}(),Sh=!Sn&&function(){try{var t=document.createElement("div");t.innerHTML='<v:shape adj="1"/>';var r=t.firstChild;return r.style.behavior="url(#default#VML)",r&&typeof r.adj=="object"}catch{return!1}}(),kh=navigator.platform.indexOf("Mac")===0,Eh=navigator.platform.indexOf("Linux")===0;function Yt(t){return navigator.userAgent.toLowerCase().indexOf(t)>=0}var H={ie:ki,ielt9:dh,edge:Vr,webkit:Mn,android:Yr,android23:Hr,androidStock:ph,opera:Ln,chrome:Xr,gecko:Gr,safari:_h,phantom:qr,opera12:$r,win:mh,ie3d:Kr,webkit3d:Cn,gecko3d:Jr,any3d:gh,mobile:Ve,mobileWebkit:vh,mobileWebkit3d:yh,msPointer:Qr,pointer:to,touch:wh,touchNative:eo,mobileOpera:xh,mobileGecko:bh,retina:Ph,passiveEvents:Mh,canvas:Lh,svg:Sn,vml:Sh,inlineSvg:Ch,mac:kh,linux:Eh},io=H.msPointer?"MSPointerDown":"pointerdown",no=H.msPointer?"MSPointerMove":"pointermove",ro=H.msPointer?"MSPointerUp":"pointerup",oo=H.msPointer?"MSPointerCancel":"pointercancel",kn={touchstart:io,touchmove:no,touchend:ro,touchcancel:oo},so={touchstart:Ah,touchmove:Ei,touchend:Ei,touchcancel:Ei},we={},ao=!1;function Th(t,r,a){return r==="touchstart"&&Bh(),so[r]?(a=so[r].bind(this,a),t.addEventListener(kn[r],a,!1),a):(console.warn("wrong event specified:",r),m)}function Dh(t,r,a){if(!kn[r]){console.warn("wrong event specified:",r);return}t.removeEventListener(kn[r],a,!1)}function zh(t){we[t.pointerId]=t}function Ih(t){we[t.pointerId]&&(we[t.pointerId]=t)}function ho(t){delete we[t.pointerId]}function Bh(){ao||(document.addEventListener(io,zh,!0),document.addEventListener(no,Ih,!0),document.addEventListener(ro,ho,!0),document.addEventListener(oo,ho,!0),ao=!0)}function Ei(t,r){if(r.pointerType!==(r.MSPOINTER_TYPE_MOUSE||"mouse")){r.touches=[];for(var a in we)r.touches.push(we[a]);r.changedTouches=[r],t(r)}}function Ah(t,r){r.MSPOINTER_TYPE_TOUCH&&r.pointerType===r.MSPOINTER_TYPE_TOUCH&&wt(r),Ei(t,r)}function Oh(t){var r={},a,u;for(u in t)a=t[u],r[u]=a&&a.bind?a.bind(t):a;return t=r,r.type="dblclick",r.detail=2,r.isTrusted=!1,r._simulated=!0,r}var Fh=200;function Zh(t,r){t.addEventListener("dblclick",r);var a=0,u;function p(g){if(g.detail!==1){u=g.detail;return}if(!(g.pointerType==="mouse"||g.sourceCapabilities&&!g.sourceCapabilities.firesTouchEvents)){var M=po(g);if(!(M.some(function(z){return z instanceof HTMLLabelElement&&z.attributes.for})&&!M.some(function(z){return z instanceof HTMLInputElement||z instanceof HTMLSelectElement}))){var D=Date.now();D-a<=Fh?(u++,u===2&&r(Oh(g))):u=1,a=D}}}return t.addEventListener("click",p),{dblclick:r,simDblclick:p}}function Rh(t,r){t.removeEventListener("dblclick",r.dblclick),t.removeEventListener("click",r.simDblclick)}var En=zi(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),Ye=zi(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),lo=Ye==="webkitTransition"||Ye==="OTransition"?Ye+"End":"transitionend";function uo(t){return typeof t=="string"?document.getElementById(t):t}function He(t,r){var a=t.style[r]||t.currentStyle&&t.currentStyle[r];if((!a||a==="auto")&&document.defaultView){var u=document.defaultView.getComputedStyle(t,null);a=u?u[r]:null}return a==="auto"?null:a}function ot(t,r,a){var u=document.createElement(t);return u.className=r||"",a&&a.appendChild(u),u}function ct(t){var r=t.parentNode;r&&r.removeChild(t)}function Ti(t){for(;t.firstChild;)t.removeChild(t.firstChild)}function xe(t){var r=t.parentNode;r&&r.lastChild!==t&&r.appendChild(t)}function be(t){var r=t.parentNode;r&&r.firstChild!==t&&r.insertBefore(t,r.firstChild)}function Tn(t,r){if(t.classList!==void 0)return t.classList.contains(r);var a=Di(t);return a.length>0&&new RegExp("(^|\\s)"+r+"(\\s|$)").test(a)}function et(t,r){if(t.classList!==void 0)for(var a=b(r),u=0,p=a.length;u<p;u++)t.classList.add(a[u]);else if(!Tn(t,r)){var g=Di(t);Dn(t,(g?g+" ":"")+r)}}function ft(t,r){t.classList!==void 0?t.classList.remove(r):Dn(t,w((" "+Di(t)+" ").replace(" "+r+" "," ")))}function Dn(t,r){t.className.baseVal===void 0?t.className=r:t.className.baseVal=r}function Di(t){return t.correspondingElement&&(t=t.correspondingElement),t.className.baseVal===void 0?t.className:t.className.baseVal}function zt(t,r){"opacity"in t.style?t.style.opacity=r:"filter"in t.style&&Nh(t,r)}function Nh(t,r){var a=!1,u="DXImageTransform.Microsoft.Alpha";try{a=t.filters.item(u)}catch{if(r===1)return}r=Math.round(r*100),a?(a.Enabled=r!==100,a.Opacity=r):t.style.filter+=" progid:"+u+"(opacity="+r+")"}function zi(t){for(var r=document.documentElement.style,a=0;a<t.length;a++)if(t[a]in r)return t[a];return!1}function ue(t,r,a){var u=r||new R(0,0);t.style[En]=(H.ie3d?"translate("+u.x+"px,"+u.y+"px)":"translate3d("+u.x+"px,"+u.y+"px,0)")+(a?" scale("+a+")":"")}function _t(t,r){t._leaflet_pos=r,H.any3d?ue(t,r):(t.style.left=r.x+"px",t.style.top=r.y+"px")}function ce(t){return t._leaflet_pos||new R(0,0)}var Xe,Ge,zn;if("onselectstart"in document)Xe=function(){Q(window,"selectstart",wt)},Ge=function(){lt(window,"selectstart",wt)};else{var qe=zi(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);Xe=function(){if(qe){var t=document.documentElement.style;zn=t[qe],t[qe]="none"}},Ge=function(){qe&&(document.documentElement.style[qe]=zn,zn=void 0)}}function In(){Q(window,"dragstart",wt)}function Bn(){lt(window,"dragstart",wt)}var Ii,An;function On(t){for(;t.tabIndex===-1;)t=t.parentNode;t.style&&(Bi(),Ii=t,An=t.style.outlineStyle,t.style.outlineStyle="none",Q(window,"keydown",Bi))}function Bi(){Ii&&(Ii.style.outlineStyle=An,Ii=void 0,An=void 0,lt(window,"keydown",Bi))}function co(t){do t=t.parentNode;while((!t.offsetWidth||!t.offsetHeight)&&t!==document.body);return t}function Fn(t){var r=t.getBoundingClientRect();return{x:r.width/t.offsetWidth||1,y:r.height/t.offsetHeight||1,boundingClientRect:r}}var jh={__proto__:null,TRANSFORM:En,TRANSITION:Ye,TRANSITION_END:lo,get:uo,getStyle:He,create:ot,remove:ct,empty:Ti,toFront:xe,toBack:be,hasClass:Tn,addClass:et,removeClass:ft,setClass:Dn,getClass:Di,setOpacity:zt,testProp:zi,setTransform:ue,setPosition:_t,getPosition:ce,get disableTextSelection(){return Xe},get enableTextSelection(){return Ge},disableImageDrag:In,enableImageDrag:Bn,preventOutline:On,restoreOutline:Bi,getSizedParentNode:co,getScale:Fn};function Q(t,r,a,u){if(r&&typeof r=="object")for(var p in r)Rn(t,p,r[p],a);else{r=b(r);for(var g=0,M=r.length;g<M;g++)Rn(t,r[g],a,u)}return this}var Ht="_leaflet_events";function lt(t,r,a,u){if(arguments.length===1)fo(t),delete t[Ht];else if(r&&typeof r=="object")for(var p in r)Nn(t,p,r[p],a);else if(r=b(r),arguments.length===2)fo(t,function(D){return k(r,D)!==-1});else for(var g=0,M=r.length;g<M;g++)Nn(t,r[g],a,u);return this}function fo(t,r){for(var a in t[Ht]){var u=a.split(/\d/)[0];(!r||r(u))&&Nn(t,u,null,null,a)}}var Zn={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function Rn(t,r,a,u){var p=r+d(a)+(u?"_"+d(u):"");if(t[Ht]&&t[Ht][p])return this;var g=function(D){return a.call(u||t,D||window.event)},M=g;!H.touchNative&&H.pointer&&r.indexOf("touch")===0?g=Th(t,r,g):H.touch&&r==="dblclick"?g=Zh(t,g):"addEventListener"in t?r==="touchstart"||r==="touchmove"||r==="wheel"||r==="mousewheel"?t.addEventListener(Zn[r]||r,g,H.passiveEvents?{passive:!1}:!1):r==="mouseenter"||r==="mouseleave"?(g=function(D){D=D||window.event,Wn(t,D)&&M(D)},t.addEventListener(Zn[r],g,!1)):t.addEventListener(r,M,!1):t.attachEvent("on"+r,g),t[Ht]=t[Ht]||{},t[Ht][p]=g}function Nn(t,r,a,u,p){p=p||r+d(a)+(u?"_"+d(u):"");var g=t[Ht]&&t[Ht][p];if(!g)return this;!H.touchNative&&H.pointer&&r.indexOf("touch")===0?Dh(t,r,g):H.touch&&r==="dblclick"?Rh(t,g):"removeEventListener"in t?t.removeEventListener(Zn[r]||r,g,!1):t.detachEvent("on"+r,g),t[Ht][p]=null}function de(t){return t.stopPropagation?t.stopPropagation():t.originalEvent?t.originalEvent._stopped=!0:t.cancelBubble=!0,this}function jn(t){return Rn(t,"wheel",de),this}function $e(t){return Q(t,"mousedown touchstart dblclick contextmenu",de),t._leaflet_disable_click=!0,this}function wt(t){return t.preventDefault?t.preventDefault():t.returnValue=!1,this}function fe(t){return wt(t),de(t),this}function po(t){if(t.composedPath)return t.composedPath();for(var r=[],a=t.target;a;)r.push(a),a=a.parentNode;return r}function _o(t,r){if(!r)return new R(t.clientX,t.clientY);var a=Fn(r),u=a.boundingClientRect;return new R((t.clientX-u.left)/a.x-r.clientLeft,(t.clientY-u.top)/a.y-r.clientTop)}var Wh=H.linux&&H.chrome?window.devicePixelRatio:H.mac?window.devicePixelRatio*3:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function mo(t){return H.edge?t.wheelDeltaY/2:t.deltaY&&t.deltaMode===0?-t.deltaY/Wh:t.deltaY&&t.deltaMode===1?-t.deltaY*20:t.deltaY&&t.deltaMode===2?-t.deltaY*60:t.deltaX||t.deltaZ?0:t.wheelDelta?(t.wheelDeltaY||t.wheelDelta)/2:t.detail&&Math.abs(t.detail)<32765?-t.detail*20:t.detail?t.detail/-32765*60:0}function Wn(t,r){var a=r.relatedTarget;if(!a)return!0;try{for(;a&&a!==t;)a=a.parentNode}catch{return!1}return a!==t}var Uh={__proto__:null,on:Q,off:lt,stopPropagation:de,disableScrollPropagation:jn,disableClickPropagation:$e,preventDefault:wt,stop:fe,getPropagationPath:po,getMousePosition:_o,getWheelDelta:mo,isExternalTarget:Wn,addListener:Q,removeListener:lt},go=U.extend({run:function(t,r,a,u){this.stop(),this._el=t,this._inProgress=!0,this._duration=a||.25,this._easeOutPower=1/Math.max(u||.5,.2),this._startPos=ce(t),this._offset=r.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=Y(this._animate,this),this._step()},_step:function(t){var r=+new Date-this._startTime,a=this._duration*1e3;r<a?this._runFrame(this._easeOut(r/a),t):(this._runFrame(1),this._complete())},_runFrame:function(t,r){var a=this._startPos.add(this._offset.multiplyBy(t));r&&a._round(),_t(this._el,a),this.fire("step")},_complete:function(){$(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(t){return 1-Math.pow(1-t,this._easeOutPower)}}),rt=U.extend({options:{crs:bn,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(t,r){r=C(this,r),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(t),this._initLayout(),this._onResize=l(this._onResize,this),this._initEvents(),r.maxBounds&&this.setMaxBounds(r.maxBounds),r.zoom!==void 0&&(this._zoom=this._limitZoom(r.zoom)),r.center&&r.zoom!==void 0&&this.setView(nt(r.center),r.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=Ye&&H.any3d&&!H.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),Q(this._proxy,lo,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(t,r,a){if(r=r===void 0?this._zoom:this._limitZoom(r),t=this._limitCenter(nt(t),r,this.options.maxBounds),a=a||{},this._stop(),this._loaded&&!a.reset&&a!==!0){a.animate!==void 0&&(a.zoom=s({animate:a.animate},a.zoom),a.pan=s({animate:a.animate,duration:a.duration},a.pan));var u=this._zoom!==r?this._tryAnimatedZoom&&this._tryAnimatedZoom(t,r,a.zoom):this._tryAnimatedPan(t,a.pan);if(u)return clearTimeout(this._sizeTimer),this}return this._resetView(t,r,a.pan&&a.pan.noMoveStart),this},setZoom:function(t,r){return this._loaded?this.setView(this.getCenter(),t,{zoom:r}):(this._zoom=t,this)},zoomIn:function(t,r){return t=t||(H.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+t,r)},zoomOut:function(t,r){return t=t||(H.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-t,r)},setZoomAround:function(t,r,a){var u=this.getZoomScale(r),p=this.getSize().divideBy(2),g=t instanceof R?t:this.latLngToContainerPoint(t),M=g.subtract(p).multiplyBy(1-1/u),D=this.containerPointToLatLng(p.add(M));return this.setView(D,r,{zoom:a})},_getBoundsCenterZoom:function(t,r){r=r||{},t=t.getBounds?t.getBounds():ht(t);var a=N(r.paddingTopLeft||r.padding||[0,0]),u=N(r.paddingBottomRight||r.padding||[0,0]),p=this.getBoundsZoom(t,!1,a.add(u));if(p=typeof r.maxZoom=="number"?Math.min(r.maxZoom,p):p,p===1/0)return{center:t.getCenter(),zoom:p};var g=u.subtract(a).divideBy(2),M=this.project(t.getSouthWest(),p),D=this.project(t.getNorthEast(),p),z=this.unproject(M.add(D).divideBy(2).add(g),p);return{center:z,zoom:p}},fitBounds:function(t,r){if(t=ht(t),!t.isValid())throw new Error("Bounds are not valid.");var a=this._getBoundsCenterZoom(t,r);return this.setView(a.center,a.zoom,r)},fitWorld:function(t){return this.fitBounds([[-90,-180],[90,180]],t)},panTo:function(t,r){return this.setView(t,this._zoom,{pan:r})},panBy:function(t,r){if(t=N(t).round(),r=r||{},!t.x&&!t.y)return this.fire("moveend");if(r.animate!==!0&&!this.getSize().contains(t))return this._resetView(this.unproject(this.project(this.getCenter()).add(t)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new go,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),r.noMoveStart||this.fire("movestart"),r.animate!==!1){et(this._mapPane,"leaflet-pan-anim");var a=this._getMapPanePos().subtract(t).round();this._panAnim.run(this._mapPane,a,r.duration||.25,r.easeLinearity)}else this._rawPanBy(t),this.fire("move").fire("moveend");return this},flyTo:function(t,r,a){if(a=a||{},a.animate===!1||!H.any3d)return this.setView(t,r,a);this._stop();var u=this.project(this.getCenter()),p=this.project(t),g=this.getSize(),M=this._zoom;t=nt(t),r=r===void 0?M:r;var D=Math.max(g.x,g.y),z=D*this.getZoomScale(M,r),Z=p.distanceTo(u)||1,j=1.42,G=j*j;function it(mt){var Hi=mt?-1:1,Dl=mt?z:D,zl=z*z-D*D+Hi*G*G*Z*Z,Il=2*Dl*G*Z,Qn=zl/Il,Ko=Math.sqrt(Qn*Qn+1)-Qn,Bl=Ko<1e-9?-18:Math.log(Ko);return Bl}function xt(mt){return(Math.exp(mt)-Math.exp(-mt))/2}function yt(mt){return(Math.exp(mt)+Math.exp(-mt))/2}function Bt(mt){return xt(mt)/yt(mt)}var Mt=it(0);function ke(mt){return D*(yt(Mt)/yt(Mt+j*mt))}function Sl(mt){return D*(yt(Mt)*Bt(Mt+j*mt)-xt(Mt))/G}function kl(mt){return 1-Math.pow(1-mt,1.5)}var El=Date.now(),qo=(it(1)-Mt)/j,Tl=a.duration?1e3*a.duration:1e3*qo*.8;function $o(){var mt=(Date.now()-El)/Tl,Hi=kl(mt)*qo;mt<=1?(this._flyToFrame=Y($o,this),this._move(this.unproject(u.add(p.subtract(u).multiplyBy(Sl(Hi)/Z)),M),this.getScaleZoom(D/ke(Hi),M),{flyTo:!0})):this._move(t,r)._moveEnd(!0)}return this._moveStart(!0,a.noMoveStart),$o.call(this),this},flyToBounds:function(t,r){var a=this._getBoundsCenterZoom(t,r);return this.flyTo(a.center,a.zoom,r)},setMaxBounds:function(t){return t=ht(t),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),t.isValid()?(this.options.maxBounds=t,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(t){var r=this.options.minZoom;return this.options.minZoom=t,this._loaded&&r!==t&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(t):this},setMaxZoom:function(t){var r=this.options.maxZoom;return this.options.maxZoom=t,this._loaded&&r!==t&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(t):this},panInsideBounds:function(t,r){this._enforcingBounds=!0;var a=this.getCenter(),u=this._limitCenter(a,this._zoom,ht(t));return a.equals(u)||this.panTo(u,r),this._enforcingBounds=!1,this},panInside:function(t,r){r=r||{};var a=N(r.paddingTopLeft||r.padding||[0,0]),u=N(r.paddingBottomRight||r.padding||[0,0]),p=this.project(this.getCenter()),g=this.project(t),M=this.getPixelBounds(),D=J([M.min.add(a),M.max.subtract(u)]),z=D.getSize();if(!D.contains(g)){this._enforcingBounds=!0;var Z=g.subtract(D.getCenter()),j=D.extend(g).getSize().subtract(z);p.x+=Z.x<0?-j.x:j.x,p.y+=Z.y<0?-j.y:j.y,this.panTo(this.unproject(p),r),this._enforcingBounds=!1}return this},invalidateSize:function(t){if(!this._loaded)return this;t=s({animate:!1,pan:!0},t===!0?{animate:!0}:t);var r=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var a=this.getSize(),u=r.divideBy(2).round(),p=a.divideBy(2).round(),g=u.subtract(p);return!g.x&&!g.y?this:(t.animate&&t.pan?this.panBy(g):(t.pan&&this._rawPanBy(g),this.fire("move"),t.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(l(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:r,newSize:a}))},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(t){if(t=this._locateOptions=s({timeout:1e4,watch:!1},t),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var r=l(this._handleGeolocationResponse,this),a=l(this._handleGeolocationError,this);return t.watch?this._locationWatchId=navigator.geolocation.watchPosition(r,a,t):navigator.geolocation.getCurrentPosition(r,a,t),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(t){if(this._container._leaflet_id){var r=t.code,a=t.message||(r===1?"permission denied":r===2?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:r,message:"Geolocation error: "+a+"."})}},_handleGeolocationResponse:function(t){if(this._container._leaflet_id){var r=t.coords.latitude,a=t.coords.longitude,u=new st(r,a),p=u.toBounds(t.coords.accuracy*2),g=this._locateOptions;if(g.setView){var M=this.getBoundsZoom(p);this.setView(u,g.maxZoom?Math.min(M,g.maxZoom):M)}var D={latlng:u,bounds:p,timestamp:t.timestamp};for(var z in t.coords)typeof t.coords[z]=="number"&&(D[z]=t.coords[z]);this.fire("locationfound",D)}},addHandler:function(t,r){if(!r)return this;var a=this[t]=new r(this);return this._handlers.push(a),this.options[t]&&a.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch{this._container._leaflet_id=void 0,this._containerId=void 0}this._locationWatchId!==void 0&&this.stopLocate(),this._stop(),ct(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&($(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload");var t;for(t in this._layers)this._layers[t].remove();for(t in this._panes)ct(this._panes[t]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(t,r){var a="leaflet-pane"+(t?" leaflet-"+t.replace("Pane","")+"-pane":""),u=ot("div",a,r||this._mapPane);return t&&(this._panes[t]=u),u},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var t=this.getPixelBounds(),r=this.unproject(t.getBottomLeft()),a=this.unproject(t.getTopRight());return new ut(r,a)},getMinZoom:function(){return this.options.minZoom===void 0?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===void 0?this._layersMaxZoom===void 0?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(t,r,a){t=ht(t),a=N(a||[0,0]);var u=this.getZoom()||0,p=this.getMinZoom(),g=this.getMaxZoom(),M=t.getNorthWest(),D=t.getSouthEast(),z=this.getSize().subtract(a),Z=J(this.project(D,u),this.project(M,u)).getSize(),j=H.any3d?this.options.zoomSnap:1,G=z.x/Z.x,it=z.y/Z.y,xt=r?Math.max(G,it):Math.min(G,it);return u=this.getScaleZoom(xt,u),j&&(u=Math.round(u/(j/100))*(j/100),u=r?Math.ceil(u/j)*j:Math.floor(u/j)*j),Math.max(p,Math.min(g,u))},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new R(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(t,r){var a=this._getTopLeftPoint(t,r);return new tt(a,a.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(t){return this.options.crs.getProjectedBounds(t===void 0?this.getZoom():t)},getPane:function(t){return typeof t=="string"?this._panes[t]:t},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(t,r){var a=this.options.crs;return r=r===void 0?this._zoom:r,a.scale(t)/a.scale(r)},getScaleZoom:function(t,r){var a=this.options.crs;r=r===void 0?this._zoom:r;var u=a.zoom(t*a.scale(r));return isNaN(u)?1/0:u},project:function(t,r){return r=r===void 0?this._zoom:r,this.options.crs.latLngToPoint(nt(t),r)},unproject:function(t,r){return r=r===void 0?this._zoom:r,this.options.crs.pointToLatLng(N(t),r)},layerPointToLatLng:function(t){var r=N(t).add(this.getPixelOrigin());return this.unproject(r)},latLngToLayerPoint:function(t){var r=this.project(nt(t))._round();return r._subtract(this.getPixelOrigin())},wrapLatLng:function(t){return this.options.crs.wrapLatLng(nt(t))},wrapLatLngBounds:function(t){return this.options.crs.wrapLatLngBounds(ht(t))},distance:function(t,r){return this.options.crs.distance(nt(t),nt(r))},containerPointToLayerPoint:function(t){return N(t).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(t){return N(t).add(this._getMapPanePos())},containerPointToLatLng:function(t){var r=this.containerPointToLayerPoint(N(t));return this.layerPointToLatLng(r)},latLngToContainerPoint:function(t){return this.layerPointToContainerPoint(this.latLngToLayerPoint(nt(t)))},mouseEventToContainerPoint:function(t){return _o(t,this._container)},mouseEventToLayerPoint:function(t){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(t))},mouseEventToLatLng:function(t){return this.layerPointToLatLng(this.mouseEventToLayerPoint(t))},_initContainer:function(t){var r=this._container=uo(t);if(r){if(r._leaflet_id)throw new Error("Map container is already initialized.")}else throw new Error("Map container not found.");Q(r,"scroll",this._onScroll,this),this._containerId=d(r)},_initLayout:function(){var t=this._container;this._fadeAnimated=this.options.fadeAnimation&&H.any3d,et(t,"leaflet-container"+(H.touch?" leaflet-touch":"")+(H.retina?" leaflet-retina":"")+(H.ielt9?" leaflet-oldie":"")+(H.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var r=He(t,"position");r!=="absolute"&&r!=="relative"&&r!=="fixed"&&r!=="sticky"&&(t.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var t=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),_t(this._mapPane,new R(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(et(t.markerPane,"leaflet-zoom-hide"),et(t.shadowPane,"leaflet-zoom-hide"))},_resetView:function(t,r,a){_t(this._mapPane,new R(0,0));var u=!this._loaded;this._loaded=!0,r=this._limitZoom(r),this.fire("viewprereset");var p=this._zoom!==r;this._moveStart(p,a)._move(t,r)._moveEnd(p),this.fire("viewreset"),u&&this.fire("load")},_moveStart:function(t,r){return t&&this.fire("zoomstart"),r||this.fire("movestart"),this},_move:function(t,r,a,u){r===void 0&&(r=this._zoom);var p=this._zoom!==r;return this._zoom=r,this._lastCenter=t,this._pixelOrigin=this._getNewPixelOrigin(t),u?a&&a.pinch&&this.fire("zoom",a):((p||a&&a.pinch)&&this.fire("zoom",a),this.fire("move",a)),this},_moveEnd:function(t){return t&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return $(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(t){_t(this._mapPane,this._getMapPanePos().subtract(t))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(t){this._targets={},this._targets[d(this._container)]=this;var r=t?lt:Q;r(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&r(window,"resize",this._onResize,this),H.any3d&&this.options.transform3DLimit&&(t?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){$(this._resizeRequest),this._resizeRequest=Y(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var t=this._getMapPanePos();Math.max(Math.abs(t.x),Math.abs(t.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(t,r){for(var a=[],u,p=r==="mouseout"||r==="mouseover",g=t.target||t.srcElement,M=!1;g;){if(u=this._targets[d(g)],u&&(r==="click"||r==="preclick")&&this._draggableMoved(u)){M=!0;break}if(u&&u.listens(r,!0)&&(p&&!Wn(g,t)||(a.push(u),p))||g===this._container)break;g=g.parentNode}return!a.length&&!M&&!p&&this.listens(r,!0)&&(a=[this]),a},_isClickDisabled:function(t){for(;t&&t!==this._container;){if(t._leaflet_disable_click)return!0;t=t.parentNode}},_handleDOMEvent:function(t){var r=t.target||t.srcElement;if(!(!this._loaded||r._leaflet_disable_events||t.type==="click"&&this._isClickDisabled(r))){var a=t.type;a==="mousedown"&&On(r),this._fireDOMEvent(t,a)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(t,r,a){if(t.type==="click"){var u=s({},t);u.type="preclick",this._fireDOMEvent(u,u.type,a)}var p=this._findEventTargets(t,r);if(a){for(var g=[],M=0;M<a.length;M++)a[M].listens(r,!0)&&g.push(a[M]);p=g.concat(p)}if(p.length){r==="contextmenu"&&wt(t);var D=p[0],z={originalEvent:t};if(t.type!=="keypress"&&t.type!=="keydown"&&t.type!=="keyup"){var Z=D.getLatLng&&(!D._radius||D._radius<=10);z.containerPoint=Z?this.latLngToContainerPoint(D.getLatLng()):this.mouseEventToContainerPoint(t),z.layerPoint=this.containerPointToLayerPoint(z.containerPoint),z.latlng=Z?D.getLatLng():this.layerPointToLatLng(z.layerPoint)}for(M=0;M<p.length;M++)if(p[M].fire(r,z,!0),z.originalEvent._stopped||p[M].options.bubblingMouseEvents===!1&&k(this._mouseEvents,r)!==-1)return}},_draggableMoved:function(t){return t=t.dragging&&t.dragging.enabled()?t:this,t.dragging&&t.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var t=0,r=this._handlers.length;t<r;t++)this._handlers[t].disable()},whenReady:function(t,r){return this._loaded?t.call(r||this,{target:this}):this.on("load",t,r),this},_getMapPanePos:function(){return ce(this._mapPane)||new R(0,0)},_moved:function(){var t=this._getMapPanePos();return t&&!t.equals([0,0])},_getTopLeftPoint:function(t,r){var a=t&&r!==void 0?this._getNewPixelOrigin(t,r):this.getPixelOrigin();return a.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(t,r){var a=this.getSize()._divideBy(2);return this.project(t,r)._subtract(a)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(t,r,a){var u=this._getNewPixelOrigin(a,r);return this.project(t,r)._subtract(u)},_latLngBoundsToNewLayerBounds:function(t,r,a){var u=this._getNewPixelOrigin(a,r);return J([this.project(t.getSouthWest(),r)._subtract(u),this.project(t.getNorthWest(),r)._subtract(u),this.project(t.getSouthEast(),r)._subtract(u),this.project(t.getNorthEast(),r)._subtract(u)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(t){return this.latLngToLayerPoint(t).subtract(this._getCenterLayerPoint())},_limitCenter:function(t,r,a){if(!a)return t;var u=this.project(t,r),p=this.getSize().divideBy(2),g=new tt(u.subtract(p),u.add(p)),M=this._getBoundsOffset(g,a,r);return Math.abs(M.x)<=1&&Math.abs(M.y)<=1?t:this.unproject(u.add(M),r)},_limitOffset:function(t,r){if(!r)return t;var a=this.getPixelBounds(),u=new tt(a.min.add(t),a.max.add(t));return t.add(this._getBoundsOffset(u,r))},_getBoundsOffset:function(t,r,a){var u=J(this.project(r.getNorthEast(),a),this.project(r.getSouthWest(),a)),p=u.min.subtract(t.min),g=u.max.subtract(t.max),M=this._rebound(p.x,-g.x),D=this._rebound(p.y,-g.y);return new R(M,D)},_rebound:function(t,r){return t+r>0?Math.round(t-r)/2:Math.max(0,Math.ceil(t))-Math.max(0,Math.floor(r))},_limitZoom:function(t){var r=this.getMinZoom(),a=this.getMaxZoom(),u=H.any3d?this.options.zoomSnap:1;return u&&(t=Math.round(t/u)*u),Math.max(r,Math.min(a,t))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){ft(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(t,r){var a=this._getCenterOffset(t)._trunc();return(r&&r.animate)!==!0&&!this.getSize().contains(a)?!1:(this.panBy(a,r),!0)},_createAnimProxy:function(){var t=this._proxy=ot("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(t),this.on("zoomanim",function(r){var a=En,u=this._proxy.style[a];ue(this._proxy,this.project(r.center,r.zoom),this.getZoomScale(r.zoom,1)),u===this._proxy.style[a]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){ct(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var t=this.getCenter(),r=this.getZoom();ue(this._proxy,this.project(t,r),this.getZoomScale(r,1))},_catchTransitionEnd:function(t){this._animatingZoom&&t.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(t,r,a){if(this._animatingZoom)return!0;if(a=a||{},!this._zoomAnimated||a.animate===!1||this._nothingToAnimate()||Math.abs(r-this._zoom)>this.options.zoomAnimationThreshold)return!1;var u=this.getZoomScale(r),p=this._getCenterOffset(t)._divideBy(1-1/u);return a.animate!==!0&&!this.getSize().contains(p)?!1:(Y(function(){this._moveStart(!0,a.noMoveStart||!1)._animateZoom(t,r,!0)},this),!0)},_animateZoom:function(t,r,a,u){this._mapPane&&(a&&(this._animatingZoom=!0,this._animateToCenter=t,this._animateToZoom=r,et(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:t,zoom:r,noUpdate:u}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(l(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&ft(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function Vh(t,r){return new rt(t,r)}var Ft=y.extend({options:{position:"topright"},initialize:function(t){C(this,t)},getPosition:function(){return this.options.position},setPosition:function(t){var r=this._map;return r&&r.removeControl(this),this.options.position=t,r&&r.addControl(this),this},getContainer:function(){return this._container},addTo:function(t){this.remove(),this._map=t;var r=this._container=this.onAdd(t),a=this.getPosition(),u=t._controlCorners[a];return et(r,"leaflet-control"),a.indexOf("bottom")!==-1?u.insertBefore(r,u.firstChild):u.appendChild(r),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(ct(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(t){this._map&&t&&t.screenX>0&&t.screenY>0&&this._map.getContainer().focus()}}),Ke=function(t){return new Ft(t)};rt.include({addControl:function(t){return t.addTo(this),this},removeControl:function(t){return t.remove(),this},_initControlPos:function(){var t=this._controlCorners={},r="leaflet-",a=this._controlContainer=ot("div",r+"control-container",this._container);function u(p,g){var M=r+p+" "+r+g;t[p+g]=ot("div",M,a)}u("top","left"),u("top","right"),u("bottom","left"),u("bottom","right")},_clearControlPos:function(){for(var t in this._controlCorners)ct(this._controlCorners[t]);ct(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var vo=Ft.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(t,r,a,u){return a<u?-1:u<a?1:0}},initialize:function(t,r,a){C(this,a),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1;for(var u in t)this._addLayer(t[u],u);for(u in r)this._addLayer(r[u],u,!0)},onAdd:function(t){this._initLayout(),this._update(),this._map=t,t.on("zoomend",this._checkDisabledLayers,this);for(var r=0;r<this._layers.length;r++)this._layers[r].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(t){return Ft.prototype.addTo.call(this,t),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var t=0;t<this._layers.length;t++)this._layers[t].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(t,r){return this._addLayer(t,r),this._map?this._update():this},addOverlay:function(t,r){return this._addLayer(t,r,!0),this._map?this._update():this},removeLayer:function(t){t.off("add remove",this._onLayerChange,this);var r=this._getLayer(d(t));return r&&this._layers.splice(this._layers.indexOf(r),1),this._map?this._update():this},expand:function(){et(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var t=this._map.getSize().y-(this._container.offsetTop+50);return t<this._section.clientHeight?(et(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=t+"px"):ft(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return ft(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var t="leaflet-control-layers",r=this._container=ot("div",t),a=this.options.collapsed;r.setAttribute("aria-haspopup",!0),$e(r),jn(r);var u=this._section=ot("section",t+"-list");a&&(this._map.on("click",this.collapse,this),Q(r,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var p=this._layersLink=ot("a",t+"-toggle",r);p.href="#",p.title="Layers",p.setAttribute("role","button"),Q(p,{keydown:function(g){g.keyCode===13&&this._expandSafely()},click:function(g){wt(g),this._expandSafely()}},this),a||this.expand(),this._baseLayersList=ot("div",t+"-base",u),this._separator=ot("div",t+"-separator",u),this._overlaysList=ot("div",t+"-overlays",u),r.appendChild(u)},_getLayer:function(t){for(var r=0;r<this._layers.length;r++)if(this._layers[r]&&d(this._layers[r].layer)===t)return this._layers[r]},_addLayer:function(t,r,a){this._map&&t.on("add remove",this._onLayerChange,this),this._layers.push({layer:t,name:r,overlay:a}),this.options.sortLayers&&this._layers.sort(l(function(u,p){return this.options.sortFunction(u.layer,p.layer,u.name,p.name)},this)),this.options.autoZIndex&&t.setZIndex&&(this._lastZIndex++,t.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;Ti(this._baseLayersList),Ti(this._overlaysList),this._layerControlInputs=[];var t,r,a,u,p=0;for(a=0;a<this._layers.length;a++)u=this._layers[a],this._addItem(u),r=r||u.overlay,t=t||!u.overlay,p+=u.overlay?0:1;return this.options.hideSingleBase&&(t=t&&p>1,this._baseLayersList.style.display=t?"":"none"),this._separator.style.display=r&&t?"":"none",this},_onLayerChange:function(t){this._handlingClick||this._update();var r=this._getLayer(d(t.target)),a=r.overlay?t.type==="add"?"overlayadd":"overlayremove":t.type==="add"?"baselayerchange":null;a&&this._map.fire(a,r)},_createRadioElement:function(t,r){var a='<input type="radio" class="leaflet-control-layers-selector" name="'+t+'"'+(r?' checked="checked"':"")+"/>",u=document.createElement("div");return u.innerHTML=a,u.firstChild},_addItem:function(t){var r=document.createElement("label"),a=this._map.hasLayer(t.layer),u;t.overlay?(u=document.createElement("input"),u.type="checkbox",u.className="leaflet-control-layers-selector",u.defaultChecked=a):u=this._createRadioElement("leaflet-base-layers_"+d(this),a),this._layerControlInputs.push(u),u.layerId=d(t.layer),Q(u,"click",this._onInputClick,this);var p=document.createElement("span");p.innerHTML=" "+t.name;var g=document.createElement("span");r.appendChild(g),g.appendChild(u),g.appendChild(p);var M=t.overlay?this._overlaysList:this._baseLayersList;return M.appendChild(r),this._checkDisabledLayers(),r},_onInputClick:function(){if(!this._preventClick){var t=this._layerControlInputs,r,a,u=[],p=[];this._handlingClick=!0;for(var g=t.length-1;g>=0;g--)r=t[g],a=this._getLayer(r.layerId).layer,r.checked?u.push(a):r.checked||p.push(a);for(g=0;g<p.length;g++)this._map.hasLayer(p[g])&&this._map.removeLayer(p[g]);for(g=0;g<u.length;g++)this._map.hasLayer(u[g])||this._map.addLayer(u[g]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var t=this._layerControlInputs,r,a,u=this._map.getZoom(),p=t.length-1;p>=0;p--)r=t[p],a=this._getLayer(r.layerId).layer,r.disabled=a.options.minZoom!==void 0&&u<a.options.minZoom||a.options.maxZoom!==void 0&&u>a.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var t=this._section;this._preventClick=!0,Q(t,"click",wt),this.expand();var r=this;setTimeout(function(){lt(t,"click",wt),r._preventClick=!1})}}),Yh=function(t,r,a){return new vo(t,r,a)},Un=Ft.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(t){var r="leaflet-control-zoom",a=ot("div",r+" leaflet-bar"),u=this.options;return this._zoomInButton=this._createButton(u.zoomInText,u.zoomInTitle,r+"-in",a,this._zoomIn),this._zoomOutButton=this._createButton(u.zoomOutText,u.zoomOutTitle,r+"-out",a,this._zoomOut),this._updateDisabled(),t.on("zoomend zoomlevelschange",this._updateDisabled,this),a},onRemove:function(t){t.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(t){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(t.shiftKey?3:1))},_zoomOut:function(t){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(t.shiftKey?3:1))},_createButton:function(t,r,a,u,p){var g=ot("a",a,u);return g.innerHTML=t,g.href="#",g.title=r,g.setAttribute("role","button"),g.setAttribute("aria-label",r),$e(g),Q(g,"click",fe),Q(g,"click",p,this),Q(g,"click",this._refocusOnMap,this),g},_updateDisabled:function(){var t=this._map,r="leaflet-disabled";ft(this._zoomInButton,r),ft(this._zoomOutButton,r),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||t._zoom===t.getMinZoom())&&(et(this._zoomOutButton,r),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||t._zoom===t.getMaxZoom())&&(et(this._zoomInButton,r),this._zoomInButton.setAttribute("aria-disabled","true"))}});rt.mergeOptions({zoomControl:!0}),rt.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new Un,this.addControl(this.zoomControl))});var Hh=function(t){return new Un(t)},yo=Ft.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(t){var r="leaflet-control-scale",a=ot("div",r),u=this.options;return this._addScales(u,r+"-line",a),t.on(u.updateWhenIdle?"moveend":"move",this._update,this),t.whenReady(this._update,this),a},onRemove:function(t){t.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(t,r,a){t.metric&&(this._mScale=ot("div",r,a)),t.imperial&&(this._iScale=ot("div",r,a))},_update:function(){var t=this._map,r=t.getSize().y/2,a=t.distance(t.containerPointToLatLng([0,r]),t.containerPointToLatLng([this.options.maxWidth,r]));this._updateScales(a)},_updateScales:function(t){this.options.metric&&t&&this._updateMetric(t),this.options.imperial&&t&&this._updateImperial(t)},_updateMetric:function(t){var r=this._getRoundNum(t),a=r<1e3?r+" m":r/1e3+" km";this._updateScale(this._mScale,a,r/t)},_updateImperial:function(t){var r=t*3.2808399,a,u,p;r>5280?(a=r/5280,u=this._getRoundNum(a),this._updateScale(this._iScale,u+" mi",u/a)):(p=this._getRoundNum(r),this._updateScale(this._iScale,p+" ft",p/r))},_updateScale:function(t,r,a){t.style.width=Math.round(this.options.maxWidth*a)+"px",t.innerHTML=r},_getRoundNum:function(t){var r=Math.pow(10,(Math.floor(t)+"").length-1),a=t/r;return a=a>=10?10:a>=5?5:a>=3?3:a>=2?2:1,r*a}}),Xh=function(t){return new yo(t)},Gh='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',Vn=Ft.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(H.inlineSvg?Gh+" ":"")+"Leaflet</a>"},initialize:function(t){C(this,t),this._attributions={}},onAdd:function(t){t.attributionControl=this,this._container=ot("div","leaflet-control-attribution"),$e(this._container);for(var r in t._layers)t._layers[r].getAttribution&&this.addAttribution(t._layers[r].getAttribution());return this._update(),t.on("layeradd",this._addAttribution,this),this._container},onRemove:function(t){t.off("layeradd",this._addAttribution,this)},_addAttribution:function(t){t.layer.getAttribution&&(this.addAttribution(t.layer.getAttribution()),t.layer.once("remove",function(){this.removeAttribution(t.layer.getAttribution())},this))},setPrefix:function(t){return this.options.prefix=t,this._update(),this},addAttribution:function(t){return t?(this._attributions[t]||(this._attributions[t]=0),this._attributions[t]++,this._update(),this):this},removeAttribution:function(t){return t?(this._attributions[t]&&(this._attributions[t]--,this._update()),this):this},_update:function(){if(this._map){var t=[];for(var r in this._attributions)this._attributions[r]&&t.push(r);var a=[];this.options.prefix&&a.push(this.options.prefix),t.length&&a.push(t.join(", ")),this._container.innerHTML=a.join(' <span aria-hidden="true">|</span> ')}}});rt.mergeOptions({attributionControl:!0}),rt.addInitHook(function(){this.options.attributionControl&&new Vn().addTo(this)});var qh=function(t){return new Vn(t)};Ft.Layers=vo,Ft.Zoom=Un,Ft.Scale=yo,Ft.Attribution=Vn,Ke.layers=Yh,Ke.zoom=Hh,Ke.scale=Xh,Ke.attribution=qh;var Xt=y.extend({initialize:function(t){this._map=t},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});Xt.addTo=function(t,r){return t.addHandler(r,this),this};var $h={Events:T},wo=H.touch?"touchstart mousedown":"mousedown",ae=U.extend({options:{clickTolerance:3},initialize:function(t,r,a,u){C(this,u),this._element=t,this._dragStartTarget=r||t,this._preventOutline=a},enable:function(){this._enabled||(Q(this._dragStartTarget,wo,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(ae._dragging===this&&this.finishDrag(!0),lt(this._dragStartTarget,wo,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(t){if(this._enabled&&(this._moved=!1,!Tn(this._element,"leaflet-zoom-anim"))){if(t.touches&&t.touches.length!==1){ae._dragging===this&&this.finishDrag();return}if(!(ae._dragging||t.shiftKey||t.which!==1&&t.button!==1&&!t.touches)&&(ae._dragging=this,this._preventOutline&&On(this._element),In(),Xe(),!this._moving)){this.fire("down");var r=t.touches?t.touches[0]:t,a=co(this._element);this._startPoint=new R(r.clientX,r.clientY),this._startPos=ce(this._element),this._parentScale=Fn(a);var u=t.type==="mousedown";Q(document,u?"mousemove":"touchmove",this._onMove,this),Q(document,u?"mouseup":"touchend touchcancel",this._onUp,this)}}},_onMove:function(t){if(this._enabled){if(t.touches&&t.touches.length>1){this._moved=!0;return}var r=t.touches&&t.touches.length===1?t.touches[0]:t,a=new R(r.clientX,r.clientY)._subtract(this._startPoint);!a.x&&!a.y||Math.abs(a.x)+Math.abs(a.y)<this.options.clickTolerance||(a.x/=this._parentScale.x,a.y/=this._parentScale.y,wt(t),this._moved||(this.fire("dragstart"),this._moved=!0,et(document.body,"leaflet-dragging"),this._lastTarget=t.target||t.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),et(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(a),this._moving=!0,this._lastEvent=t,this._updatePosition())}},_updatePosition:function(){var t={originalEvent:this._lastEvent};this.fire("predrag",t),_t(this._element,this._newPos),this.fire("drag",t)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(t){ft(document.body,"leaflet-dragging"),this._lastTarget&&(ft(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),lt(document,"mousemove touchmove",this._onMove,this),lt(document,"mouseup touchend touchcancel",this._onUp,this),Bn(),Ge();var r=this._moved&&this._moving;this._moving=!1,ae._dragging=!1,r&&this.fire("dragend",{noInertia:t,distance:this._newPos.distanceTo(this._startPos)})}});function xo(t,r,a){var u,p=[1,4,2,8],g,M,D,z,Z,j,G,it;for(g=0,j=t.length;g<j;g++)t[g]._code=pe(t[g],r);for(D=0;D<4;D++){for(G=p[D],u=[],g=0,j=t.length,M=j-1;g<j;M=g++)z=t[g],Z=t[M],z._code&G?Z._code&G||(it=Ai(Z,z,G,r,a),it._code=pe(it,r),u.push(it)):(Z._code&G&&(it=Ai(Z,z,G,r,a),it._code=pe(it,r),u.push(it)),u.push(z));t=u}return t}function bo(t,r){var a,u,p,g,M,D,z,Z,j;if(!t||t.length===0)throw new Error("latlngs not passed");It(t)||(console.warn("latlngs are not flat! Only the first ring will be used"),t=t[0]);var G=nt([0,0]),it=ht(t),xt=it.getNorthWest().distanceTo(it.getSouthWest())*it.getNorthEast().distanceTo(it.getNorthWest());xt<1700&&(G=Yn(t));var yt=t.length,Bt=[];for(a=0;a<yt;a++){var Mt=nt(t[a]);Bt.push(r.project(nt([Mt.lat-G.lat,Mt.lng-G.lng])))}for(D=z=Z=0,a=0,u=yt-1;a<yt;u=a++)p=Bt[a],g=Bt[u],M=p.y*g.x-g.y*p.x,z+=(p.x+g.x)*M,Z+=(p.y+g.y)*M,D+=M*3;D===0?j=Bt[0]:j=[z/D,Z/D];var ke=r.unproject(N(j));return nt([ke.lat+G.lat,ke.lng+G.lng])}function Yn(t){for(var r=0,a=0,u=0,p=0;p<t.length;p++){var g=nt(t[p]);r+=g.lat,a+=g.lng,u++}return nt([r/u,a/u])}var Kh={__proto__:null,clipPolygon:xo,polygonCenter:bo,centroid:Yn};function Po(t,r){if(!r||!t.length)return t.slice();var a=r*r;return t=tl(t,a),t=Qh(t,a),t}function Mo(t,r,a){return Math.sqrt(Je(t,r,a,!0))}function Jh(t,r,a){return Je(t,r,a)}function Qh(t,r){var a=t.length,u=typeof Uint8Array<"u"?Uint8Array:Array,p=new u(a);p[0]=p[a-1]=1,Hn(t,p,r,0,a-1);var g,M=[];for(g=0;g<a;g++)p[g]&&M.push(t[g]);return M}function Hn(t,r,a,u,p){var g=0,M,D,z;for(D=u+1;D<=p-1;D++)z=Je(t[D],t[u],t[p],!0),z>g&&(M=D,g=z);g>a&&(r[M]=1,Hn(t,r,a,u,M),Hn(t,r,a,M,p))}function tl(t,r){for(var a=[t[0]],u=1,p=0,g=t.length;u<g;u++)el(t[u],t[p])>r&&(a.push(t[u]),p=u);return p<g-1&&a.push(t[g-1]),a}var Lo;function Co(t,r,a,u,p){var g=u?Lo:pe(t,a),M=pe(r,a),D,z,Z;for(Lo=M;;){if(!(g|M))return[t,r];if(g&M)return!1;D=g||M,z=Ai(t,r,D,a,p),Z=pe(z,a),D===g?(t=z,g=Z):(r=z,M=Z)}}function Ai(t,r,a,u,p){var g=r.x-t.x,M=r.y-t.y,D=u.min,z=u.max,Z,j;return a&8?(Z=t.x+g*(z.y-t.y)/M,j=z.y):a&4?(Z=t.x+g*(D.y-t.y)/M,j=D.y):a&2?(Z=z.x,j=t.y+M*(z.x-t.x)/g):a&1&&(Z=D.x,j=t.y+M*(D.x-t.x)/g),new R(Z,j,p)}function pe(t,r){var a=0;return t.x<r.min.x?a|=1:t.x>r.max.x&&(a|=2),t.y<r.min.y?a|=4:t.y>r.max.y&&(a|=8),a}function el(t,r){var a=r.x-t.x,u=r.y-t.y;return a*a+u*u}function Je(t,r,a,u){var p=r.x,g=r.y,M=a.x-p,D=a.y-g,z=M*M+D*D,Z;return z>0&&(Z=((t.x-p)*M+(t.y-g)*D)/z,Z>1?(p=a.x,g=a.y):Z>0&&(p+=M*Z,g+=D*Z)),M=t.x-p,D=t.y-g,u?M*M+D*D:new R(p,g)}function It(t){return!P(t[0])||typeof t[0][0]!="object"&&typeof t[0][0]<"u"}function So(t){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),It(t)}function ko(t,r){var a,u,p,g,M,D,z,Z;if(!t||t.length===0)throw new Error("latlngs not passed");It(t)||(console.warn("latlngs are not flat! Only the first ring will be used"),t=t[0]);var j=nt([0,0]),G=ht(t),it=G.getNorthWest().distanceTo(G.getSouthWest())*G.getNorthEast().distanceTo(G.getNorthWest());it<1700&&(j=Yn(t));var xt=t.length,yt=[];for(a=0;a<xt;a++){var Bt=nt(t[a]);yt.push(r.project(nt([Bt.lat-j.lat,Bt.lng-j.lng])))}for(a=0,u=0;a<xt-1;a++)u+=yt[a].distanceTo(yt[a+1])/2;if(u===0)Z=yt[0];else for(a=0,g=0;a<xt-1;a++)if(M=yt[a],D=yt[a+1],p=M.distanceTo(D),g+=p,g>u){z=(g-u)/p,Z=[D.x-z*(D.x-M.x),D.y-z*(D.y-M.y)];break}var Mt=r.unproject(N(Z));return nt([Mt.lat+j.lat,Mt.lng+j.lng])}var il={__proto__:null,simplify:Po,pointToSegmentDistance:Mo,closestPointOnSegment:Jh,clipSegment:Co,_getEdgeIntersection:Ai,_getBitCode:pe,_sqClosestPointOnSegment:Je,isFlat:It,_flat:So,polylineCenter:ko},Xn={project:function(t){return new R(t.lng,t.lat)},unproject:function(t){return new st(t.y,t.x)},bounds:new tt([-180,-90],[180,90])},Gn={R:6378137,R_MINOR:6356752314245179e-9,bounds:new tt([-2003750834279e-5,-1549657073972e-5],[2003750834279e-5,1876465623138e-5]),project:function(t){var r=Math.PI/180,a=this.R,u=t.lat*r,p=this.R_MINOR/a,g=Math.sqrt(1-p*p),M=g*Math.sin(u),D=Math.tan(Math.PI/4-u/2)/Math.pow((1-M)/(1+M),g/2);return u=-a*Math.log(Math.max(D,1e-10)),new R(t.lng*r*a,u)},unproject:function(t){for(var r=180/Math.PI,a=this.R,u=this.R_MINOR/a,p=Math.sqrt(1-u*u),g=Math.exp(-t.y/a),M=Math.PI/2-2*Math.atan(g),D=0,z=.1,Z;D<15&&Math.abs(z)>1e-7;D++)Z=p*Math.sin(M),Z=Math.pow((1-Z)/(1+Z),p/2),z=Math.PI/2-2*Math.atan(g*Z)-M,M+=z;return new st(M*r,t.x*r/a)}},nl={__proto__:null,LonLat:Xn,Mercator:Gn,SphericalMercator:wn},rl=s({},Ot,{code:"EPSG:3395",projection:Gn,transformation:function(){var t=.5/(Math.PI*Gn.R);return Ue(t,.5,-t,.5)}()}),Eo=s({},Ot,{code:"EPSG:4326",projection:Xn,transformation:Ue(1/180,1,-1/180,.5)}),ol=s({},Dt,{projection:Xn,transformation:Ue(1,0,-1,0),scale:function(t){return Math.pow(2,t)},zoom:function(t){return Math.log(t)/Math.LN2},distance:function(t,r){var a=r.lng-t.lng,u=r.lat-t.lat;return Math.sqrt(a*a+u*u)},infinite:!0});Dt.Earth=Ot,Dt.EPSG3395=rl,Dt.EPSG3857=bn,Dt.EPSG900913=ch,Dt.EPSG4326=Eo,Dt.Simple=ol;var Zt=U.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(t){return t.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(t){return t&&t.removeLayer(this),this},getPane:function(t){return this._map.getPane(t?this.options[t]||t:this.options.pane)},addInteractiveTarget:function(t){return this._map._targets[d(t)]=this,this},removeInteractiveTarget:function(t){return delete this._map._targets[d(t)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(t){var r=t.target;if(r.hasLayer(this)){if(this._map=r,this._zoomAnimated=r._zoomAnimated,this.getEvents){var a=this.getEvents();r.on(a,this),this.once("remove",function(){r.off(a,this)},this)}this.onAdd(r),this.fire("add"),r.fire("layeradd",{layer:this})}}});rt.include({addLayer:function(t){if(!t._layerAdd)throw new Error("The provided object is not a Layer.");var r=d(t);return this._layers[r]?this:(this._layers[r]=t,t._mapToAdd=this,t.beforeAdd&&t.beforeAdd(this),this.whenReady(t._layerAdd,t),this)},removeLayer:function(t){var r=d(t);return this._layers[r]?(this._loaded&&t.onRemove(this),delete this._layers[r],this._loaded&&(this.fire("layerremove",{layer:t}),t.fire("remove")),t._map=t._mapToAdd=null,this):this},hasLayer:function(t){return d(t)in this._layers},eachLayer:function(t,r){for(var a in this._layers)t.call(r,this._layers[a]);return this},_addLayers:function(t){t=t?P(t)?t:[t]:[];for(var r=0,a=t.length;r<a;r++)this.addLayer(t[r])},_addZoomLimit:function(t){(!isNaN(t.options.maxZoom)||!isNaN(t.options.minZoom))&&(this._zoomBoundLayers[d(t)]=t,this._updateZoomLevels())},_removeZoomLimit:function(t){var r=d(t);this._zoomBoundLayers[r]&&(delete this._zoomBoundLayers[r],this._updateZoomLevels())},_updateZoomLevels:function(){var t=1/0,r=-1/0,a=this._getZoomSpan();for(var u in this._zoomBoundLayers){var p=this._zoomBoundLayers[u].options;t=p.minZoom===void 0?t:Math.min(t,p.minZoom),r=p.maxZoom===void 0?r:Math.max(r,p.maxZoom)}this._layersMaxZoom=r===-1/0?void 0:r,this._layersMinZoom=t===1/0?void 0:t,a!==this._getZoomSpan()&&this.fire("zoomlevelschange"),this.options.maxZoom===void 0&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),this.options.minZoom===void 0&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var Pe=Zt.extend({initialize:function(t,r){C(this,r),this._layers={};var a,u;if(t)for(a=0,u=t.length;a<u;a++)this.addLayer(t[a])},addLayer:function(t){var r=this.getLayerId(t);return this._layers[r]=t,this._map&&this._map.addLayer(t),this},removeLayer:function(t){var r=t in this._layers?t:this.getLayerId(t);return this._map&&this._layers[r]&&this._map.removeLayer(this._layers[r]),delete this._layers[r],this},hasLayer:function(t){var r=typeof t=="number"?t:this.getLayerId(t);return r in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(t){var r=Array.prototype.slice.call(arguments,1),a,u;for(a in this._layers)u=this._layers[a],u[t]&&u[t].apply(u,r);return this},onAdd:function(t){this.eachLayer(t.addLayer,t)},onRemove:function(t){this.eachLayer(t.removeLayer,t)},eachLayer:function(t,r){for(var a in this._layers)t.call(r,this._layers[a]);return this},getLayer:function(t){return this._layers[t]},getLayers:function(){var t=[];return this.eachLayer(t.push,t),t},setZIndex:function(t){return this.invoke("setZIndex",t)},getLayerId:function(t){return d(t)}}),sl=function(t,r){return new Pe(t,r)},Kt=Pe.extend({addLayer:function(t){return this.hasLayer(t)?this:(t.addEventParent(this),Pe.prototype.addLayer.call(this,t),this.fire("layeradd",{layer:t}))},removeLayer:function(t){return this.hasLayer(t)?(t in this._layers&&(t=this._layers[t]),t.removeEventParent(this),Pe.prototype.removeLayer.call(this,t),this.fire("layerremove",{layer:t})):this},setStyle:function(t){return this.invoke("setStyle",t)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var t=new ut;for(var r in this._layers){var a=this._layers[r];t.extend(a.getBounds?a.getBounds():a.getLatLng())}return t}}),al=function(t,r){return new Kt(t,r)},Me=y.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(t){C(this,t)},createIcon:function(t){return this._createIcon("icon",t)},createShadow:function(t){return this._createIcon("shadow",t)},_createIcon:function(t,r){var a=this._getIconUrl(t);if(!a){if(t==="icon")throw new Error("iconUrl not set in Icon options (see the docs).");return null}var u=this._createImg(a,r&&r.tagName==="IMG"?r:null);return this._setIconStyles(u,t),(this.options.crossOrigin||this.options.crossOrigin==="")&&(u.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),u},_setIconStyles:function(t,r){var a=this.options,u=a[r+"Size"];typeof u=="number"&&(u=[u,u]);var p=N(u),g=N(r==="shadow"&&a.shadowAnchor||a.iconAnchor||p&&p.divideBy(2,!0));t.className="leaflet-marker-"+r+" "+(a.className||""),g&&(t.style.marginLeft=-g.x+"px",t.style.marginTop=-g.y+"px"),p&&(t.style.width=p.x+"px",t.style.height=p.y+"px")},_createImg:function(t,r){return r=r||document.createElement("img"),r.src=t,r},_getIconUrl:function(t){return H.retina&&this.options[t+"RetinaUrl"]||this.options[t+"Url"]}});function hl(t){return new Me(t)}var Qe=Me.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(t){return typeof Qe.imagePath!="string"&&(Qe.imagePath=this._detectIconPath()),(this.options.imagePath||Qe.imagePath)+Me.prototype._getIconUrl.call(this,t)},_stripUrl:function(t){var r=function(a,u,p){var g=u.exec(a);return g&&g[p]};return t=r(t,/^url\((['"])?(.+)\1\)$/,2),t&&r(t,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var t=ot("div","leaflet-default-icon-path",document.body),r=He(t,"background-image")||He(t,"backgroundImage");if(document.body.removeChild(t),r=this._stripUrl(r),r)return r;var a=document.querySelector('link[href$="leaflet.css"]');return a?a.href.substring(0,a.href.length-11-1):""}}),To=Xt.extend({initialize:function(t){this._marker=t},addHooks:function(){var t=this._marker._icon;this._draggable||(this._draggable=new ae(t,t,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),et(t,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&ft(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(t){var r=this._marker,a=r._map,u=this._marker.options.autoPanSpeed,p=this._marker.options.autoPanPadding,g=ce(r._icon),M=a.getPixelBounds(),D=a.getPixelOrigin(),z=J(M.min._subtract(D).add(p),M.max._subtract(D).subtract(p));if(!z.contains(g)){var Z=N((Math.max(z.max.x,g.x)-z.max.x)/(M.max.x-z.max.x)-(Math.min(z.min.x,g.x)-z.min.x)/(M.min.x-z.min.x),(Math.max(z.max.y,g.y)-z.max.y)/(M.max.y-z.max.y)-(Math.min(z.min.y,g.y)-z.min.y)/(M.min.y-z.min.y)).multiplyBy(u);a.panBy(Z,{animate:!1}),this._draggable._newPos._add(Z),this._draggable._startPos._add(Z),_t(r._icon,this._draggable._newPos),this._onDrag(t),this._panRequest=Y(this._adjustPan.bind(this,t))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(t){this._marker.options.autoPan&&($(this._panRequest),this._panRequest=Y(this._adjustPan.bind(this,t)))},_onDrag:function(t){var r=this._marker,a=r._shadow,u=ce(r._icon),p=r._map.layerPointToLatLng(u);a&&_t(a,u),r._latlng=p,t.latlng=p,t.oldLatLng=this._oldLatLng,r.fire("move",t).fire("drag",t)},_onDragEnd:function(t){$(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",t)}}),Oi=Zt.extend({options:{icon:new Qe,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(t,r){C(this,r),this._latlng=nt(t)},onAdd:function(t){this._zoomAnimated=this._zoomAnimated&&t.options.markerZoomAnimation,this._zoomAnimated&&t.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(t){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&t.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(t){var r=this._latlng;return this._latlng=nt(t),this.update(),this.fire("move",{oldLatLng:r,latlng:this._latlng})},setZIndexOffset:function(t){return this.options.zIndexOffset=t,this.update()},getIcon:function(){return this.options.icon},setIcon:function(t){return this.options.icon=t,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var t=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(t)}return this},_initIcon:function(){var t=this.options,r="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),a=t.icon.createIcon(this._icon),u=!1;a!==this._icon&&(this._icon&&this._removeIcon(),u=!0,t.title&&(a.title=t.title),a.tagName==="IMG"&&(a.alt=t.alt||"")),et(a,r),t.keyboard&&(a.tabIndex="0",a.setAttribute("role","button")),this._icon=a,t.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&Q(a,"focus",this._panOnFocus,this);var p=t.icon.createShadow(this._shadow),g=!1;p!==this._shadow&&(this._removeShadow(),g=!0),p&&(et(p,r),p.alt=""),this._shadow=p,t.opacity<1&&this._updateOpacity(),u&&this.getPane().appendChild(this._icon),this._initInteraction(),p&&g&&this.getPane(t.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&lt(this._icon,"focus",this._panOnFocus,this),ct(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&ct(this._shadow),this._shadow=null},_setPos:function(t){this._icon&&_t(this._icon,t),this._shadow&&_t(this._shadow,t),this._zIndex=t.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(t){this._icon&&(this._icon.style.zIndex=this._zIndex+t)},_animateZoom:function(t){var r=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center).round();this._setPos(r)},_initInteraction:function(){if(this.options.interactive&&(et(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),To)){var t=this.options.draggable;this.dragging&&(t=this.dragging.enabled(),this.dragging.disable()),this.dragging=new To(this),t&&this.dragging.enable()}},setOpacity:function(t){return this.options.opacity=t,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var t=this.options.opacity;this._icon&&zt(this._icon,t),this._shadow&&zt(this._shadow,t)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var t=this._map;if(t){var r=this.options.icon.options,a=r.iconSize?N(r.iconSize):N(0,0),u=r.iconAnchor?N(r.iconAnchor):N(0,0);t.panInside(this._latlng,{paddingTopLeft:u,paddingBottomRight:a.subtract(u)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function ll(t,r){return new Oi(t,r)}var he=Zt.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(t){this._renderer=t.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(t){return C(this,t),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&t&&Object.prototype.hasOwnProperty.call(t,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),Fi=he.extend({options:{fill:!0,radius:10},initialize:function(t,r){C(this,r),this._latlng=nt(t),this._radius=this.options.radius},setLatLng:function(t){var r=this._latlng;return this._latlng=nt(t),this.redraw(),this.fire("move",{oldLatLng:r,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(t){return this.options.radius=this._radius=t,this.redraw()},getRadius:function(){return this._radius},setStyle:function(t){var r=t&&t.radius||this._radius;return he.prototype.setStyle.call(this,t),this.setRadius(r),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var t=this._radius,r=this._radiusY||t,a=this._clickTolerance(),u=[t+a,r+a];this._pxBounds=new tt(this._point.subtract(u),this._point.add(u))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(t){return t.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function ul(t,r){return new Fi(t,r)}var qn=Fi.extend({initialize:function(t,r,a){if(typeof r=="number"&&(r=s({},a,{radius:r})),C(this,r),this._latlng=nt(t),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(t){return this._mRadius=t,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var t=[this._radius,this._radiusY||this._radius];return new ut(this._map.layerPointToLatLng(this._point.subtract(t)),this._map.layerPointToLatLng(this._point.add(t)))},setStyle:he.prototype.setStyle,_project:function(){var t=this._latlng.lng,r=this._latlng.lat,a=this._map,u=a.options.crs;if(u.distance===Ot.distance){var p=Math.PI/180,g=this._mRadius/Ot.R/p,M=a.project([r+g,t]),D=a.project([r-g,t]),z=M.add(D).divideBy(2),Z=a.unproject(z).lat,j=Math.acos((Math.cos(g*p)-Math.sin(r*p)*Math.sin(Z*p))/(Math.cos(r*p)*Math.cos(Z*p)))/p;(isNaN(j)||j===0)&&(j=g/Math.cos(Math.PI/180*r)),this._point=z.subtract(a.getPixelOrigin()),this._radius=isNaN(j)?0:z.x-a.project([Z,t-j]).x,this._radiusY=z.y-M.y}else{var G=u.unproject(u.project(this._latlng).subtract([this._mRadius,0]));this._point=a.latLngToLayerPoint(this._latlng),this._radius=this._point.x-a.latLngToLayerPoint(G).x}this._updateBounds()}});function cl(t,r,a){return new qn(t,r,a)}var Jt=he.extend({options:{smoothFactor:1,noClip:!1},initialize:function(t,r){C(this,r),this._setLatLngs(t)},getLatLngs:function(){return this._latlngs},setLatLngs:function(t){return this._setLatLngs(t),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(t){for(var r=1/0,a=null,u=Je,p,g,M=0,D=this._parts.length;M<D;M++)for(var z=this._parts[M],Z=1,j=z.length;Z<j;Z++){p=z[Z-1],g=z[Z];var G=u(t,p,g,!0);G<r&&(r=G,a=u(t,p,g))}return a&&(a.distance=Math.sqrt(r)),a},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return ko(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(t,r){return r=r||this._defaultShape(),t=nt(t),r.push(t),this._bounds.extend(t),this.redraw()},_setLatLngs:function(t){this._bounds=new ut,this._latlngs=this._convertLatLngs(t)},_defaultShape:function(){return It(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(t){for(var r=[],a=It(t),u=0,p=t.length;u<p;u++)a?(r[u]=nt(t[u]),this._bounds.extend(r[u])):r[u]=this._convertLatLngs(t[u]);return r},_project:function(){var t=new tt;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,t),this._bounds.isValid()&&t.isValid()&&(this._rawPxBounds=t,this._updateBounds())},_updateBounds:function(){var t=this._clickTolerance(),r=new R(t,t);this._rawPxBounds&&(this._pxBounds=new tt([this._rawPxBounds.min.subtract(r),this._rawPxBounds.max.add(r)]))},_projectLatlngs:function(t,r,a){var u=t[0]instanceof st,p=t.length,g,M;if(u){for(M=[],g=0;g<p;g++)M[g]=this._map.latLngToLayerPoint(t[g]),a.extend(M[g]);r.push(M)}else for(g=0;g<p;g++)this._projectLatlngs(t[g],r,a)},_clipPoints:function(){var t=this._renderer._bounds;if(this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(t))){if(this.options.noClip){this._parts=this._rings;return}var r=this._parts,a,u,p,g,M,D,z;for(a=0,p=0,g=this._rings.length;a<g;a++)for(z=this._rings[a],u=0,M=z.length;u<M-1;u++)D=Co(z[u],z[u+1],t,u,!0),D&&(r[p]=r[p]||[],r[p].push(D[0]),(D[1]!==z[u+1]||u===M-2)&&(r[p].push(D[1]),p++))}},_simplifyPoints:function(){for(var t=this._parts,r=this.options.smoothFactor,a=0,u=t.length;a<u;a++)t[a]=Po(t[a],r)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(t,r){var a,u,p,g,M,D,z=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(t))return!1;for(a=0,g=this._parts.length;a<g;a++)for(D=this._parts[a],u=0,M=D.length,p=M-1;u<M;p=u++)if(!(!r&&u===0)&&Mo(t,D[p],D[u])<=z)return!0;return!1}});function dl(t,r){return new Jt(t,r)}Jt._flat=So;var Le=Jt.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return bo(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(t){var r=Jt.prototype._convertLatLngs.call(this,t),a=r.length;return a>=2&&r[0]instanceof st&&r[0].equals(r[a-1])&&r.pop(),r},_setLatLngs:function(t){Jt.prototype._setLatLngs.call(this,t),It(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return It(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var t=this._renderer._bounds,r=this.options.weight,a=new R(r,r);if(t=new tt(t.min.subtract(a),t.max.add(a)),this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(t))){if(this.options.noClip){this._parts=this._rings;return}for(var u=0,p=this._rings.length,g;u<p;u++)g=xo(this._rings[u],t,!0),g.length&&this._parts.push(g)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(t){var r=!1,a,u,p,g,M,D,z,Z;if(!this._pxBounds||!this._pxBounds.contains(t))return!1;for(g=0,z=this._parts.length;g<z;g++)for(a=this._parts[g],M=0,Z=a.length,D=Z-1;M<Z;D=M++)u=a[M],p=a[D],u.y>t.y!=p.y>t.y&&t.x<(p.x-u.x)*(t.y-u.y)/(p.y-u.y)+u.x&&(r=!r);return r||Jt.prototype._containsPoint.call(this,t,!0)}});function fl(t,r){return new Le(t,r)}var Qt=Kt.extend({initialize:function(t,r){C(this,r),this._layers={},t&&this.addData(t)},addData:function(t){var r=P(t)?t:t.features,a,u,p;if(r){for(a=0,u=r.length;a<u;a++)p=r[a],(p.geometries||p.geometry||p.features||p.coordinates)&&this.addData(p);return this}var g=this.options;if(g.filter&&!g.filter(t))return this;var M=Zi(t,g);return M?(M.feature=ji(t),M.defaultOptions=M.options,this.resetStyle(M),g.onEachFeature&&g.onEachFeature(t,M),this.addLayer(M)):this},resetStyle:function(t){return t===void 0?this.eachLayer(this.resetStyle,this):(t.options=s({},t.defaultOptions),this._setLayerStyle(t,this.options.style),this)},setStyle:function(t){return this.eachLayer(function(r){this._setLayerStyle(r,t)},this)},_setLayerStyle:function(t,r){t.setStyle&&(typeof r=="function"&&(r=r(t.feature)),t.setStyle(r))}});function Zi(t,r){var a=t.type==="Feature"?t.geometry:t,u=a?a.coordinates:null,p=[],g=r&&r.pointToLayer,M=r&&r.coordsToLatLng||$n,D,z,Z,j;if(!u&&!a)return null;switch(a.type){case"Point":return D=M(u),Do(g,t,D,r);case"MultiPoint":for(Z=0,j=u.length;Z<j;Z++)D=M(u[Z]),p.push(Do(g,t,D,r));return new Kt(p);case"LineString":case"MultiLineString":return z=Ri(u,a.type==="LineString"?0:1,M),new Jt(z,r);case"Polygon":case"MultiPolygon":return z=Ri(u,a.type==="Polygon"?1:2,M),new Le(z,r);case"GeometryCollection":for(Z=0,j=a.geometries.length;Z<j;Z++){var G=Zi({geometry:a.geometries[Z],type:"Feature",properties:t.properties},r);G&&p.push(G)}return new Kt(p);case"FeatureCollection":for(Z=0,j=a.features.length;Z<j;Z++){var it=Zi(a.features[Z],r);it&&p.push(it)}return new Kt(p);default:throw new Error("Invalid GeoJSON object.")}}function Do(t,r,a,u){return t?t(r,a):new Oi(a,u&&u.markersInheritOptions&&u)}function $n(t){return new st(t[1],t[0],t[2])}function Ri(t,r,a){for(var u=[],p=0,g=t.length,M;p<g;p++)M=r?Ri(t[p],r-1,a):(a||$n)(t[p]),u.push(M);return u}function Kn(t,r){return t=nt(t),t.alt!==void 0?[v(t.lng,r),v(t.lat,r),v(t.alt,r)]:[v(t.lng,r),v(t.lat,r)]}function Ni(t,r,a,u){for(var p=[],g=0,M=t.length;g<M;g++)p.push(r?Ni(t[g],It(t[g])?0:r-1,a,u):Kn(t[g],u));return!r&&a&&p.length>0&&p.push(p[0].slice()),p}function Ce(t,r){return t.feature?s({},t.feature,{geometry:r}):ji(r)}function ji(t){return t.type==="Feature"||t.type==="FeatureCollection"?t:{type:"Feature",properties:{},geometry:t}}var Jn={toGeoJSON:function(t){return Ce(this,{type:"Point",coordinates:Kn(this.getLatLng(),t)})}};Oi.include(Jn),qn.include(Jn),Fi.include(Jn),Jt.include({toGeoJSON:function(t){var r=!It(this._latlngs),a=Ni(this._latlngs,r?1:0,!1,t);return Ce(this,{type:(r?"Multi":"")+"LineString",coordinates:a})}}),Le.include({toGeoJSON:function(t){var r=!It(this._latlngs),a=r&&!It(this._latlngs[0]),u=Ni(this._latlngs,a?2:r?1:0,!0,t);return r||(u=[u]),Ce(this,{type:(a?"Multi":"")+"Polygon",coordinates:u})}}),Pe.include({toMultiPoint:function(t){var r=[];return this.eachLayer(function(a){r.push(a.toGeoJSON(t).geometry.coordinates)}),Ce(this,{type:"MultiPoint",coordinates:r})},toGeoJSON:function(t){var r=this.feature&&this.feature.geometry&&this.feature.geometry.type;if(r==="MultiPoint")return this.toMultiPoint(t);var a=r==="GeometryCollection",u=[];return this.eachLayer(function(p){if(p.toGeoJSON){var g=p.toGeoJSON(t);if(a)u.push(g.geometry);else{var M=ji(g);M.type==="FeatureCollection"?u.push.apply(u,M.features):u.push(M)}}}),a?Ce(this,{geometries:u,type:"GeometryCollection"}):{type:"FeatureCollection",features:u}}});function zo(t,r){return new Qt(t,r)}var pl=zo,Wi=Zt.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(t,r,a){this._url=t,this._bounds=ht(r),C(this,a)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(et(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){ct(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(t){return this.options.opacity=t,this._image&&this._updateOpacity(),this},setStyle:function(t){return t.opacity&&this.setOpacity(t.opacity),this},bringToFront:function(){return this._map&&xe(this._image),this},bringToBack:function(){return this._map&&be(this._image),this},setUrl:function(t){return this._url=t,this._image&&(this._image.src=t),this},setBounds:function(t){return this._bounds=ht(t),this._map&&this._reset(),this},getEvents:function(){var t={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var t=this._url.tagName==="IMG",r=this._image=t?this._url:ot("img");if(et(r,"leaflet-image-layer"),this._zoomAnimated&&et(r,"leaflet-zoom-animated"),this.options.className&&et(r,this.options.className),r.onselectstart=m,r.onmousemove=m,r.onload=l(this.fire,this,"load"),r.onerror=l(this._overlayOnError,this,"error"),(this.options.crossOrigin||this.options.crossOrigin==="")&&(r.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),t){this._url=r.src;return}r.src=this._url,r.alt=this.options.alt},_animateZoom:function(t){var r=this._map.getZoomScale(t.zoom),a=this._map._latLngBoundsToNewLayerBounds(this._bounds,t.zoom,t.center).min;ue(this._image,a,r)},_reset:function(){var t=this._image,r=new tt(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),a=r.getSize();_t(t,r.min),t.style.width=a.x+"px",t.style.height=a.y+"px"},_updateOpacity:function(){zt(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var t=this.options.errorOverlayUrl;t&&this._url!==t&&(this._url=t,this._image.src=t)},getCenter:function(){return this._bounds.getCenter()}}),_l=function(t,r,a){return new Wi(t,r,a)},Io=Wi.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var t=this._url.tagName==="VIDEO",r=this._image=t?this._url:ot("video");if(et(r,"leaflet-image-layer"),this._zoomAnimated&&et(r,"leaflet-zoom-animated"),this.options.className&&et(r,this.options.className),r.onselectstart=m,r.onmousemove=m,r.onloadeddata=l(this.fire,this,"load"),t){for(var a=r.getElementsByTagName("source"),u=[],p=0;p<a.length;p++)u.push(a[p].src);this._url=a.length>0?u:[r.src];return}P(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(r.style,"objectFit")&&(r.style.objectFit="fill"),r.autoplay=!!this.options.autoplay,r.loop=!!this.options.loop,r.muted=!!this.options.muted,r.playsInline=!!this.options.playsInline;for(var g=0;g<this._url.length;g++){var M=ot("source");M.src=this._url[g],r.appendChild(M)}}});function ml(t,r,a){return new Io(t,r,a)}var Bo=Wi.extend({_initImage:function(){var t=this._image=this._url;et(t,"leaflet-image-layer"),this._zoomAnimated&&et(t,"leaflet-zoom-animated"),this.options.className&&et(t,this.options.className),t.onselectstart=m,t.onmousemove=m}});function gl(t,r,a){return new Bo(t,r,a)}var Gt=Zt.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(t,r){t&&(t instanceof st||P(t))?(this._latlng=nt(t),C(this,r)):(C(this,t),this._source=r),this.options.content&&(this._content=this.options.content)},openOn:function(t){return t=arguments.length?t:this._source._map,t.hasLayer(this)||t.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(t){return this._map?this.close():(arguments.length?this._source=t:t=this._source,this._prepareOpen(),this.openOn(t._map)),this},onAdd:function(t){this._zoomAnimated=t._zoomAnimated,this._container||this._initLayout(),t._fadeAnimated&&zt(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),t._fadeAnimated&&zt(this._container,1),this.bringToFront(),this.options.interactive&&(et(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(t){t._fadeAnimated?(zt(this._container,0),this._removeTimeout=setTimeout(l(ct,void 0,this._container),200)):ct(this._container),this.options.interactive&&(ft(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(t){return this._latlng=nt(t),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(t){return this._content=t,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var t={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&xe(this._container),this},bringToBack:function(){return this._map&&be(this._container),this},_prepareOpen:function(t){var r=this._source;if(!r._map)return!1;if(r instanceof Kt){r=null;var a=this._source._layers;for(var u in a)if(a[u]._map){r=a[u];break}if(!r)return!1;this._source=r}if(!t)if(r.getCenter)t=r.getCenter();else if(r.getLatLng)t=r.getLatLng();else if(r.getBounds)t=r.getBounds().getCenter();else throw new Error("Unable to get source layer LatLng.");return this.setLatLng(t),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var t=this._contentNode,r=typeof this._content=="function"?this._content(this._source||this):this._content;if(typeof r=="string")t.innerHTML=r;else{for(;t.hasChildNodes();)t.removeChild(t.firstChild);t.appendChild(r)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var t=this._map.latLngToLayerPoint(this._latlng),r=N(this.options.offset),a=this._getAnchor();this._zoomAnimated?_t(this._container,t.add(a)):r=r.add(t).add(a);var u=this._containerBottom=-r.y,p=this._containerLeft=-Math.round(this._containerWidth/2)+r.x;this._container.style.bottom=u+"px",this._container.style.left=p+"px"}},_getAnchor:function(){return[0,0]}});rt.include({_initOverlay:function(t,r,a,u){var p=r;return p instanceof t||(p=new t(u).setContent(r)),a&&p.setLatLng(a),p}}),Zt.include({_initOverlay:function(t,r,a,u){var p=a;return p instanceof t?(C(p,u),p._source=this):(p=r&&!u?r:new t(u,this),p.setContent(a)),p}});var Ui=Gt.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(t){return t=arguments.length?t:this._source._map,!t.hasLayer(this)&&t._popup&&t._popup.options.autoClose&&t.removeLayer(t._popup),t._popup=this,Gt.prototype.openOn.call(this,t)},onAdd:function(t){Gt.prototype.onAdd.call(this,t),t.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof he||this._source.on("preclick",de))},onRemove:function(t){Gt.prototype.onRemove.call(this,t),t.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof he||this._source.off("preclick",de))},getEvents:function(){var t=Gt.prototype.getEvents.call(this);return(this.options.closeOnClick!==void 0?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(t.preclick=this.close),this.options.keepInView&&(t.moveend=this._adjustPan),t},_initLayout:function(){var t="leaflet-popup",r=this._container=ot("div",t+" "+(this.options.className||"")+" leaflet-zoom-animated"),a=this._wrapper=ot("div",t+"-content-wrapper",r);if(this._contentNode=ot("div",t+"-content",a),$e(r),jn(this._contentNode),Q(r,"contextmenu",de),this._tipContainer=ot("div",t+"-tip-container",r),this._tip=ot("div",t+"-tip",this._tipContainer),this.options.closeButton){var u=this._closeButton=ot("a",t+"-close-button",r);u.setAttribute("role","button"),u.setAttribute("aria-label","Close popup"),u.href="#close",u.innerHTML='<span aria-hidden="true">&#215;</span>',Q(u,"click",function(p){wt(p),this.close()},this)}},_updateLayout:function(){var t=this._contentNode,r=t.style;r.width="",r.whiteSpace="nowrap";var a=t.offsetWidth;a=Math.min(a,this.options.maxWidth),a=Math.max(a,this.options.minWidth),r.width=a+1+"px",r.whiteSpace="",r.height="";var u=t.offsetHeight,p=this.options.maxHeight,g="leaflet-popup-scrolled";p&&u>p?(r.height=p+"px",et(t,g)):ft(t,g),this._containerWidth=this._container.offsetWidth},_animateZoom:function(t){var r=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center),a=this._getAnchor();_t(this._container,r.add(a))},_adjustPan:function(){if(this.options.autoPan){if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning){this._autopanning=!1;return}var t=this._map,r=parseInt(He(this._container,"marginBottom"),10)||0,a=this._container.offsetHeight+r,u=this._containerWidth,p=new R(this._containerLeft,-a-this._containerBottom);p._add(ce(this._container));var g=t.layerPointToContainerPoint(p),M=N(this.options.autoPanPadding),D=N(this.options.autoPanPaddingTopLeft||M),z=N(this.options.autoPanPaddingBottomRight||M),Z=t.getSize(),j=0,G=0;g.x+u+z.x>Z.x&&(j=g.x+u-Z.x+z.x),g.x-j-D.x<0&&(j=g.x-D.x),g.y+a+z.y>Z.y&&(G=g.y+a-Z.y+z.y),g.y-G-D.y<0&&(G=g.y-D.y),(j||G)&&(this.options.keepInView&&(this._autopanning=!0),t.fire("autopanstart").panBy([j,G]))}},_getAnchor:function(){return N(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),vl=function(t,r){return new Ui(t,r)};rt.mergeOptions({closePopupOnClick:!0}),rt.include({openPopup:function(t,r,a){return this._initOverlay(Ui,t,r,a).openOn(this),this},closePopup:function(t){return t=arguments.length?t:this._popup,t&&t.close(),this}}),Zt.include({bindPopup:function(t,r){return this._popup=this._initOverlay(Ui,this._popup,t,r),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(t){return this._popup&&(this instanceof Kt||(this._popup._source=this),this._popup._prepareOpen(t||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return this._popup?this._popup.isOpen():!1},setPopupContent:function(t){return this._popup&&this._popup.setContent(t),this},getPopup:function(){return this._popup},_openPopup:function(t){if(!(!this._popup||!this._map)){fe(t);var r=t.layer||t.target;if(this._popup._source===r&&!(r instanceof he)){this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(t.latlng);return}this._popup._source=r,this.openPopup(t.latlng)}},_movePopup:function(t){this._popup.setLatLng(t.latlng)},_onKeyPress:function(t){t.originalEvent.keyCode===13&&this._openPopup(t)}});var Vi=Gt.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(t){Gt.prototype.onAdd.call(this,t),this.setOpacity(this.options.opacity),t.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(t){Gt.prototype.onRemove.call(this,t),t.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var t=Gt.prototype.getEvents.call(this);return this.options.permanent||(t.preclick=this.close),t},_initLayout:function(){var t="leaflet-tooltip",r=t+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=ot("div",r),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+d(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(t){var r,a,u=this._map,p=this._container,g=u.latLngToContainerPoint(u.getCenter()),M=u.layerPointToContainerPoint(t),D=this.options.direction,z=p.offsetWidth,Z=p.offsetHeight,j=N(this.options.offset),G=this._getAnchor();D==="top"?(r=z/2,a=Z):D==="bottom"?(r=z/2,a=0):D==="center"?(r=z/2,a=Z/2):D==="right"?(r=0,a=Z/2):D==="left"?(r=z,a=Z/2):M.x<g.x?(D="right",r=0,a=Z/2):(D="left",r=z+(j.x+G.x)*2,a=Z/2),t=t.subtract(N(r,a,!0)).add(j).add(G),ft(p,"leaflet-tooltip-right"),ft(p,"leaflet-tooltip-left"),ft(p,"leaflet-tooltip-top"),ft(p,"leaflet-tooltip-bottom"),et(p,"leaflet-tooltip-"+D),_t(p,t)},_updatePosition:function(){var t=this._map.latLngToLayerPoint(this._latlng);this._setPosition(t)},setOpacity:function(t){this.options.opacity=t,this._container&&zt(this._container,t)},_animateZoom:function(t){var r=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center);this._setPosition(r)},_getAnchor:function(){return N(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),yl=function(t,r){return new Vi(t,r)};rt.include({openTooltip:function(t,r,a){return this._initOverlay(Vi,t,r,a).openOn(this),this},closeTooltip:function(t){return t.close(),this}}),Zt.include({bindTooltip:function(t,r){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(Vi,this._tooltip,t,r),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(t){if(!(!t&&this._tooltipHandlersAdded)){var r=t?"off":"on",a={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?a.add=this._openTooltip:(a.mouseover=this._openTooltip,a.mouseout=this.closeTooltip,a.click=this._openTooltip,this._map?this._addFocusListeners():a.add=this._addFocusListeners),this._tooltip.options.sticky&&(a.mousemove=this._moveTooltip),this[r](a),this._tooltipHandlersAdded=!t}},openTooltip:function(t){return this._tooltip&&(this instanceof Kt||(this._tooltip._source=this),this._tooltip._prepareOpen(t)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(t){return this._tooltip&&this._tooltip.setContent(t),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(t){var r=typeof t.getElement=="function"&&t.getElement();r&&(Q(r,"focus",function(){this._tooltip._source=t,this.openTooltip()},this),Q(r,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(t){var r=typeof t.getElement=="function"&&t.getElement();r&&r.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(t){if(!(!this._tooltip||!this._map)){if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var r=this;this._map.once("moveend",function(){r._openOnceFlag=!1,r._openTooltip(t)});return}this._tooltip._source=t.layer||t.target,this.openTooltip(this._tooltip.options.sticky?t.latlng:void 0)}},_moveTooltip:function(t){var r=t.latlng,a,u;this._tooltip.options.sticky&&t.originalEvent&&(a=this._map.mouseEventToContainerPoint(t.originalEvent),u=this._map.containerPointToLayerPoint(a),r=this._map.layerPointToLatLng(u)),this._tooltip.setLatLng(r)}});var Ao=Me.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(t){var r=t&&t.tagName==="DIV"?t:document.createElement("div"),a=this.options;if(a.html instanceof Element?(Ti(r),r.appendChild(a.html)):r.innerHTML=a.html!==!1?a.html:"",a.bgPos){var u=N(a.bgPos);r.style.backgroundPosition=-u.x+"px "+-u.y+"px"}return this._setIconStyles(r,"icon"),r},createShadow:function(){return null}});function wl(t){return new Ao(t)}Me.Default=Qe;var ti=Zt.extend({options:{tileSize:256,opacity:1,updateWhenIdle:H.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(t){C(this,t)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(t){t._addZoomLimit(this)},onRemove:function(t){this._removeAllTiles(),ct(this._container),t._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(xe(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(be(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(t){return this.options.opacity=t,this._updateOpacity(),this},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var t=this._clampZoom(this._map.getZoom());t!==this._tileZoom&&(this._tileZoom=t,this._updateLevels()),this._update()}return this},getEvents:function(){var t={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=_(this._onMoveEnd,this.options.updateInterval,this)),t.move=this._onMove),this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},createTile:function(){return document.createElement("div")},getTileSize:function(){var t=this.options.tileSize;return t instanceof R?t:new R(t,t)},_updateZIndex:function(){this._container&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(t){for(var r=this.getPane().children,a=-t(-1/0,1/0),u=0,p=r.length,g;u<p;u++)g=r[u].style.zIndex,r[u]!==this._container&&g&&(a=t(a,+g));isFinite(a)&&(this.options.zIndex=a+t(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!H.ielt9){zt(this._container,this.options.opacity);var t=+new Date,r=!1,a=!1;for(var u in this._tiles){var p=this._tiles[u];if(!(!p.current||!p.loaded)){var g=Math.min(1,(t-p.loaded)/200);zt(p.el,g),g<1?r=!0:(p.active?a=!0:this._onOpaqueTile(p),p.active=!0)}}a&&!this._noPrune&&this._pruneTiles(),r&&($(this._fadeFrame),this._fadeFrame=Y(this._updateOpacity,this))}},_onOpaqueTile:m,_initContainer:function(){this._container||(this._container=ot("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var t=this._tileZoom,r=this.options.maxZoom;if(t!==void 0){for(var a in this._levels)a=Number(a),this._levels[a].el.children.length||a===t?(this._levels[a].el.style.zIndex=r-Math.abs(t-a),this._onUpdateLevel(a)):(ct(this._levels[a].el),this._removeTilesAtZoom(a),this._onRemoveLevel(a),delete this._levels[a]);var u=this._levels[t],p=this._map;return u||(u=this._levels[t]={},u.el=ot("div","leaflet-tile-container leaflet-zoom-animated",this._container),u.el.style.zIndex=r,u.origin=p.project(p.unproject(p.getPixelOrigin()),t).round(),u.zoom=t,this._setZoomTransform(u,p.getCenter(),p.getZoom()),m(u.el.offsetWidth),this._onCreateLevel(u)),this._level=u,u}},_onUpdateLevel:m,_onRemoveLevel:m,_onCreateLevel:m,_pruneTiles:function(){if(this._map){var t,r,a=this._map.getZoom();if(a>this.options.maxZoom||a<this.options.minZoom){this._removeAllTiles();return}for(t in this._tiles)r=this._tiles[t],r.retain=r.current;for(t in this._tiles)if(r=this._tiles[t],r.current&&!r.active){var u=r.coords;this._retainParent(u.x,u.y,u.z,u.z-5)||this._retainChildren(u.x,u.y,u.z,u.z+2)}for(t in this._tiles)this._tiles[t].retain||this._removeTile(t)}},_removeTilesAtZoom:function(t){for(var r in this._tiles)this._tiles[r].coords.z===t&&this._removeTile(r)},_removeAllTiles:function(){for(var t in this._tiles)this._removeTile(t)},_invalidateAll:function(){for(var t in this._levels)ct(this._levels[t].el),this._onRemoveLevel(Number(t)),delete this._levels[t];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(t,r,a,u){var p=Math.floor(t/2),g=Math.floor(r/2),M=a-1,D=new R(+p,+g);D.z=+M;var z=this._tileCoordsToKey(D),Z=this._tiles[z];return Z&&Z.active?(Z.retain=!0,!0):(Z&&Z.loaded&&(Z.retain=!0),M>u?this._retainParent(p,g,M,u):!1)},_retainChildren:function(t,r,a,u){for(var p=2*t;p<2*t+2;p++)for(var g=2*r;g<2*r+2;g++){var M=new R(p,g);M.z=a+1;var D=this._tileCoordsToKey(M),z=this._tiles[D];if(z&&z.active){z.retain=!0;continue}else z&&z.loaded&&(z.retain=!0);a+1<u&&this._retainChildren(p,g,a+1,u)}},_resetView:function(t){var r=t&&(t.pinch||t.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),r,r)},_animateZoom:function(t){this._setView(t.center,t.zoom,!0,t.noUpdate)},_clampZoom:function(t){var r=this.options;return r.minNativeZoom!==void 0&&t<r.minNativeZoom?r.minNativeZoom:r.maxNativeZoom!==void 0&&r.maxNativeZoom<t?r.maxNativeZoom:t},_setView:function(t,r,a,u){var p=Math.round(r);this.options.maxZoom!==void 0&&p>this.options.maxZoom||this.options.minZoom!==void 0&&p<this.options.minZoom?p=void 0:p=this._clampZoom(p);var g=this.options.updateWhenZooming&&p!==this._tileZoom;(!u||g)&&(this._tileZoom=p,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),p!==void 0&&this._update(t),a||this._pruneTiles(),this._noPrune=!!a),this._setZoomTransforms(t,r)},_setZoomTransforms:function(t,r){for(var a in this._levels)this._setZoomTransform(this._levels[a],t,r)},_setZoomTransform:function(t,r,a){var u=this._map.getZoomScale(a,t.zoom),p=t.origin.multiplyBy(u).subtract(this._map._getNewPixelOrigin(r,a)).round();H.any3d?ue(t.el,p,u):_t(t.el,p)},_resetGrid:function(){var t=this._map,r=t.options.crs,a=this._tileSize=this.getTileSize(),u=this._tileZoom,p=this._map.getPixelWorldBounds(this._tileZoom);p&&(this._globalTileRange=this._pxBoundsToTileRange(p)),this._wrapX=r.wrapLng&&!this.options.noWrap&&[Math.floor(t.project([0,r.wrapLng[0]],u).x/a.x),Math.ceil(t.project([0,r.wrapLng[1]],u).x/a.y)],this._wrapY=r.wrapLat&&!this.options.noWrap&&[Math.floor(t.project([r.wrapLat[0],0],u).y/a.x),Math.ceil(t.project([r.wrapLat[1],0],u).y/a.y)]},_onMoveEnd:function(){!this._map||this._map._animatingZoom||this._update()},_getTiledPixelBounds:function(t){var r=this._map,a=r._animatingZoom?Math.max(r._animateToZoom,r.getZoom()):r.getZoom(),u=r.getZoomScale(a,this._tileZoom),p=r.project(t,this._tileZoom).floor(),g=r.getSize().divideBy(u*2);return new tt(p.subtract(g),p.add(g))},_update:function(t){var r=this._map;if(r){var a=this._clampZoom(r.getZoom());if(t===void 0&&(t=r.getCenter()),this._tileZoom!==void 0){var u=this._getTiledPixelBounds(t),p=this._pxBoundsToTileRange(u),g=p.getCenter(),M=[],D=this.options.keepBuffer,z=new tt(p.getBottomLeft().subtract([D,-D]),p.getTopRight().add([D,-D]));if(!(isFinite(p.min.x)&&isFinite(p.min.y)&&isFinite(p.max.x)&&isFinite(p.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var Z in this._tiles){var j=this._tiles[Z].coords;(j.z!==this._tileZoom||!z.contains(new R(j.x,j.y)))&&(this._tiles[Z].current=!1)}if(Math.abs(a-this._tileZoom)>1){this._setView(t,a);return}for(var G=p.min.y;G<=p.max.y;G++)for(var it=p.min.x;it<=p.max.x;it++){var xt=new R(it,G);if(xt.z=this._tileZoom,!!this._isValidTile(xt)){var yt=this._tiles[this._tileCoordsToKey(xt)];yt?yt.current=!0:M.push(xt)}}if(M.sort(function(Mt,ke){return Mt.distanceTo(g)-ke.distanceTo(g)}),M.length!==0){this._loading||(this._loading=!0,this.fire("loading"));var Bt=document.createDocumentFragment();for(it=0;it<M.length;it++)this._addTile(M[it],Bt);this._level.el.appendChild(Bt)}}}},_isValidTile:function(t){var r=this._map.options.crs;if(!r.infinite){var a=this._globalTileRange;if(!r.wrapLng&&(t.x<a.min.x||t.x>a.max.x)||!r.wrapLat&&(t.y<a.min.y||t.y>a.max.y))return!1}if(!this.options.bounds)return!0;var u=this._tileCoordsToBounds(t);return ht(this.options.bounds).overlaps(u)},_keyToBounds:function(t){return this._tileCoordsToBounds(this._keyToTileCoords(t))},_tileCoordsToNwSe:function(t){var r=this._map,a=this.getTileSize(),u=t.scaleBy(a),p=u.add(a),g=r.unproject(u,t.z),M=r.unproject(p,t.z);return[g,M]},_tileCoordsToBounds:function(t){var r=this._tileCoordsToNwSe(t),a=new ut(r[0],r[1]);return this.options.noWrap||(a=this._map.wrapLatLngBounds(a)),a},_tileCoordsToKey:function(t){return t.x+":"+t.y+":"+t.z},_keyToTileCoords:function(t){var r=t.split(":"),a=new R(+r[0],+r[1]);return a.z=+r[2],a},_removeTile:function(t){var r=this._tiles[t];r&&(ct(r.el),delete this._tiles[t],this.fire("tileunload",{tile:r.el,coords:this._keyToTileCoords(t)}))},_initTile:function(t){et(t,"leaflet-tile");var r=this.getTileSize();t.style.width=r.x+"px",t.style.height=r.y+"px",t.onselectstart=m,t.onmousemove=m,H.ielt9&&this.options.opacity<1&&zt(t,this.options.opacity)},_addTile:function(t,r){var a=this._getTilePos(t),u=this._tileCoordsToKey(t),p=this.createTile(this._wrapCoords(t),l(this._tileReady,this,t));this._initTile(p),this.createTile.length<2&&Y(l(this._tileReady,this,t,null,p)),_t(p,a),this._tiles[u]={el:p,coords:t,current:!0},r.appendChild(p),this.fire("tileloadstart",{tile:p,coords:t})},_tileReady:function(t,r,a){r&&this.fire("tileerror",{error:r,tile:a,coords:t});var u=this._tileCoordsToKey(t);a=this._tiles[u],a&&(a.loaded=+new Date,this._map._fadeAnimated?(zt(a.el,0),$(this._fadeFrame),this._fadeFrame=Y(this._updateOpacity,this)):(a.active=!0,this._pruneTiles()),r||(et(a.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:a.el,coords:t})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),H.ielt9||!this._map._fadeAnimated?Y(this._pruneTiles,this):setTimeout(l(this._pruneTiles,this),250)))},_getTilePos:function(t){return t.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(t){var r=new R(this._wrapX?f(t.x,this._wrapX):t.x,this._wrapY?f(t.y,this._wrapY):t.y);return r.z=t.z,r},_pxBoundsToTileRange:function(t){var r=this.getTileSize();return new tt(t.min.unscaleBy(r).floor(),t.max.unscaleBy(r).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var t in this._tiles)if(!this._tiles[t].loaded)return!1;return!0}});function xl(t){return new ti(t)}var Se=ti.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(t,r){this._url=t,r=C(this,r),r.detectRetina&&H.retina&&r.maxZoom>0?(r.tileSize=Math.floor(r.tileSize/2),r.zoomReverse?(r.zoomOffset--,r.minZoom=Math.min(r.maxZoom,r.minZoom+1)):(r.zoomOffset++,r.maxZoom=Math.max(r.minZoom,r.maxZoom-1)),r.minZoom=Math.max(0,r.minZoom)):r.zoomReverse?r.minZoom=Math.min(r.maxZoom,r.minZoom):r.maxZoom=Math.max(r.minZoom,r.maxZoom),typeof r.subdomains=="string"&&(r.subdomains=r.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(t,r){return this._url===t&&r===void 0&&(r=!0),this._url=t,r||this.redraw(),this},createTile:function(t,r){var a=document.createElement("img");return Q(a,"load",l(this._tileOnLoad,this,r,a)),Q(a,"error",l(this._tileOnError,this,r,a)),(this.options.crossOrigin||this.options.crossOrigin==="")&&(a.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),typeof this.options.referrerPolicy=="string"&&(a.referrerPolicy=this.options.referrerPolicy),a.alt="",a.src=this.getTileUrl(t),a},getTileUrl:function(t){var r={r:H.retina?"@2x":"",s:this._getSubdomain(t),x:t.x,y:t.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var a=this._globalTileRange.max.y-t.y;this.options.tms&&(r.y=a),r["-y"]=a}return x(this._url,s(r,this.options))},_tileOnLoad:function(t,r){H.ielt9?setTimeout(l(t,this,null,r),0):t(null,r)},_tileOnError:function(t,r,a){var u=this.options.errorTileUrl;u&&r.getAttribute("src")!==u&&(r.src=u),t(a,r)},_onTileRemove:function(t){t.tile.onload=null},_getZoomForUrl:function(){var t=this._tileZoom,r=this.options.maxZoom,a=this.options.zoomReverse,u=this.options.zoomOffset;return a&&(t=r-t),t+u},_getSubdomain:function(t){var r=Math.abs(t.x+t.y)%this.options.subdomains.length;return this.options.subdomains[r]},_abortLoading:function(){var t,r;for(t in this._tiles)if(this._tiles[t].coords.z!==this._tileZoom&&(r=this._tiles[t].el,r.onload=m,r.onerror=m,!r.complete)){r.src=B;var a=this._tiles[t].coords;ct(r),delete this._tiles[t],this.fire("tileabort",{tile:r,coords:a})}},_removeTile:function(t){var r=this._tiles[t];if(r)return r.el.setAttribute("src",B),ti.prototype._removeTile.call(this,t)},_tileReady:function(t,r,a){if(!(!this._map||a&&a.getAttribute("src")===B))return ti.prototype._tileReady.call(this,t,r,a)}});function Oo(t,r){return new Se(t,r)}var Fo=Se.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(t,r){this._url=t;var a=s({},this.defaultWmsParams);for(var u in r)u in this.options||(a[u]=r[u]);r=C(this,r);var p=r.detectRetina&&H.retina?2:1,g=this.getTileSize();a.width=g.x*p,a.height=g.y*p,this.wmsParams=a},onAdd:function(t){this._crs=this.options.crs||t.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var r=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[r]=this._crs.code,Se.prototype.onAdd.call(this,t)},getTileUrl:function(t){var r=this._tileCoordsToNwSe(t),a=this._crs,u=J(a.project(r[0]),a.project(r[1])),p=u.min,g=u.max,M=(this._wmsVersion>=1.3&&this._crs===Eo?[p.y,p.x,g.y,g.x]:[p.x,p.y,g.x,g.y]).join(","),D=Se.prototype.getTileUrl.call(this,t);return D+E(this.wmsParams,D,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+M},setParams:function(t,r){return s(this.wmsParams,t),r||this.redraw(),this}});function bl(t,r){return new Fo(t,r)}Se.WMS=Fo,Oo.wms=bl;var te=Zt.extend({options:{padding:.1},initialize:function(t){C(this,t),d(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),et(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var t={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(t.zoomanim=this._onAnimZoom),t},_onAnimZoom:function(t){this._updateTransform(t.center,t.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(t,r){var a=this._map.getZoomScale(r,this._zoom),u=this._map.getSize().multiplyBy(.5+this.options.padding),p=this._map.project(this._center,r),g=u.multiplyBy(-a).add(p).subtract(this._map._getNewPixelOrigin(t,r));H.any3d?ue(this._container,g,a):_t(this._container,g)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);for(var t in this._layers)this._layers[t]._reset()},_onZoomEnd:function(){for(var t in this._layers)this._layers[t]._project()},_updatePaths:function(){for(var t in this._layers)this._layers[t]._update()},_update:function(){var t=this.options.padding,r=this._map.getSize(),a=this._map.containerPointToLayerPoint(r.multiplyBy(-t)).round();this._bounds=new tt(a,a.add(r.multiplyBy(1+t*2)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),Zo=te.extend({options:{tolerance:0},getEvents:function(){var t=te.prototype.getEvents.call(this);return t.viewprereset=this._onViewPreReset,t},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){te.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var t=this._container=document.createElement("canvas");Q(t,"mousemove",this._onMouseMove,this),Q(t,"click dblclick mousedown mouseup contextmenu",this._onClick,this),Q(t,"mouseout",this._handleMouseOut,this),t._leaflet_disable_events=!0,this._ctx=t.getContext("2d")},_destroyContainer:function(){$(this._redrawRequest),delete this._ctx,ct(this._container),lt(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){var t;this._redrawBounds=null;for(var r in this._layers)t=this._layers[r],t._update();this._redraw()}},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){te.prototype._update.call(this);var t=this._bounds,r=this._container,a=t.getSize(),u=H.retina?2:1;_t(r,t.min),r.width=u*a.x,r.height=u*a.y,r.style.width=a.x+"px",r.style.height=a.y+"px",H.retina&&this._ctx.scale(2,2),this._ctx.translate(-t.min.x,-t.min.y),this.fire("update")}},_reset:function(){te.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(t){this._updateDashArray(t),this._layers[d(t)]=t;var r=t._order={layer:t,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=r),this._drawLast=r,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(t){this._requestRedraw(t)},_removePath:function(t){var r=t._order,a=r.next,u=r.prev;a?a.prev=u:this._drawLast=u,u?u.next=a:this._drawFirst=a,delete t._order,delete this._layers[d(t)],this._requestRedraw(t)},_updatePath:function(t){this._extendRedrawBounds(t),t._project(),t._update(),this._requestRedraw(t)},_updateStyle:function(t){this._updateDashArray(t),this._requestRedraw(t)},_updateDashArray:function(t){if(typeof t.options.dashArray=="string"){var r=t.options.dashArray.split(/[, ]+/),a=[],u,p;for(p=0;p<r.length;p++){if(u=Number(r[p]),isNaN(u))return;a.push(u)}t.options._dashArray=a}else t.options._dashArray=t.options.dashArray},_requestRedraw:function(t){this._map&&(this._extendRedrawBounds(t),this._redrawRequest=this._redrawRequest||Y(this._redraw,this))},_extendRedrawBounds:function(t){if(t._pxBounds){var r=(t.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new tt,this._redrawBounds.extend(t._pxBounds.min.subtract([r,r])),this._redrawBounds.extend(t._pxBounds.max.add([r,r]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var t=this._redrawBounds;if(t){var r=t.getSize();this._ctx.clearRect(t.min.x,t.min.y,r.x,r.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var t,r=this._redrawBounds;if(this._ctx.save(),r){var a=r.getSize();this._ctx.beginPath(),this._ctx.rect(r.min.x,r.min.y,a.x,a.y),this._ctx.clip()}this._drawing=!0;for(var u=this._drawFirst;u;u=u.next)t=u.layer,(!r||t._pxBounds&&t._pxBounds.intersects(r))&&t._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(t,r){if(this._drawing){var a,u,p,g,M=t._parts,D=M.length,z=this._ctx;if(D){for(z.beginPath(),a=0;a<D;a++){for(u=0,p=M[a].length;u<p;u++)g=M[a][u],z[u?"lineTo":"moveTo"](g.x,g.y);r&&z.closePath()}this._fillStroke(z,t)}}},_updateCircle:function(t){if(!(!this._drawing||t._empty())){var r=t._point,a=this._ctx,u=Math.max(Math.round(t._radius),1),p=(Math.max(Math.round(t._radiusY),1)||u)/u;p!==1&&(a.save(),a.scale(1,p)),a.beginPath(),a.arc(r.x,r.y/p,u,0,Math.PI*2,!1),p!==1&&a.restore(),this._fillStroke(a,t)}},_fillStroke:function(t,r){var a=r.options;a.fill&&(t.globalAlpha=a.fillOpacity,t.fillStyle=a.fillColor||a.color,t.fill(a.fillRule||"evenodd")),a.stroke&&a.weight!==0&&(t.setLineDash&&t.setLineDash(r.options&&r.options._dashArray||[]),t.globalAlpha=a.opacity,t.lineWidth=a.weight,t.strokeStyle=a.color,t.lineCap=a.lineCap,t.lineJoin=a.lineJoin,t.stroke())},_onClick:function(t){for(var r=this._map.mouseEventToLayerPoint(t),a,u,p=this._drawFirst;p;p=p.next)a=p.layer,a.options.interactive&&a._containsPoint(r)&&(!(t.type==="click"||t.type==="preclick")||!this._map._draggableMoved(a))&&(u=a);this._fireEvent(u?[u]:!1,t)},_onMouseMove:function(t){if(!(!this._map||this._map.dragging.moving()||this._map._animatingZoom)){var r=this._map.mouseEventToLayerPoint(t);this._handleMouseHover(t,r)}},_handleMouseOut:function(t){var r=this._hoveredLayer;r&&(ft(this._container,"leaflet-interactive"),this._fireEvent([r],t,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(t,r){if(!this._mouseHoverThrottled){for(var a,u,p=this._drawFirst;p;p=p.next)a=p.layer,a.options.interactive&&a._containsPoint(r)&&(u=a);u!==this._hoveredLayer&&(this._handleMouseOut(t),u&&(et(this._container,"leaflet-interactive"),this._fireEvent([u],t,"mouseover"),this._hoveredLayer=u)),this._fireEvent(this._hoveredLayer?[this._hoveredLayer]:!1,t),this._mouseHoverThrottled=!0,setTimeout(l(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(t,r,a){this._map._fireDOMEvent(r,a||r.type,t)},_bringToFront:function(t){var r=t._order;if(r){var a=r.next,u=r.prev;if(a)a.prev=u;else return;u?u.next=a:a&&(this._drawFirst=a),r.prev=this._drawLast,this._drawLast.next=r,r.next=null,this._drawLast=r,this._requestRedraw(t)}},_bringToBack:function(t){var r=t._order;if(r){var a=r.next,u=r.prev;if(u)u.next=a;else return;a?a.prev=u:u&&(this._drawLast=u),r.prev=null,r.next=this._drawFirst,this._drawFirst.prev=r,this._drawFirst=r,this._requestRedraw(t)}}});function Ro(t){return H.canvas?new Zo(t):null}var ei=function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(t){return document.createElement("<lvml:"+t+' class="lvml">')}}catch{}return function(t){return document.createElement("<"+t+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}(),Pl={_initContainer:function(){this._container=ot("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(te.prototype._update.call(this),this.fire("update"))},_initPath:function(t){var r=t._container=ei("shape");et(r,"leaflet-vml-shape "+(this.options.className||"")),r.coordsize="1 1",t._path=ei("path"),r.appendChild(t._path),this._updateStyle(t),this._layers[d(t)]=t},_addPath:function(t){var r=t._container;this._container.appendChild(r),t.options.interactive&&t.addInteractiveTarget(r)},_removePath:function(t){var r=t._container;ct(r),t.removeInteractiveTarget(r),delete this._layers[d(t)]},_updateStyle:function(t){var r=t._stroke,a=t._fill,u=t.options,p=t._container;p.stroked=!!u.stroke,p.filled=!!u.fill,u.stroke?(r||(r=t._stroke=ei("stroke")),p.appendChild(r),r.weight=u.weight+"px",r.color=u.color,r.opacity=u.opacity,u.dashArray?r.dashStyle=P(u.dashArray)?u.dashArray.join(" "):u.dashArray.replace(/( *, *)/g," "):r.dashStyle="",r.endcap=u.lineCap.replace("butt","flat"),r.joinstyle=u.lineJoin):r&&(p.removeChild(r),t._stroke=null),u.fill?(a||(a=t._fill=ei("fill")),p.appendChild(a),a.color=u.fillColor||u.color,a.opacity=u.fillOpacity):a&&(p.removeChild(a),t._fill=null)},_updateCircle:function(t){var r=t._point.round(),a=Math.round(t._radius),u=Math.round(t._radiusY||a);this._setPath(t,t._empty()?"M0 0":"AL "+r.x+","+r.y+" "+a+","+u+" 0,"+65535*360)},_setPath:function(t,r){t._path.v=r},_bringToFront:function(t){xe(t._container)},_bringToBack:function(t){be(t._container)}},Yi=H.vml?ei:Wr,ii=te.extend({_initContainer:function(){this._container=Yi("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=Yi("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){ct(this._container),lt(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){te.prototype._update.call(this);var t=this._bounds,r=t.getSize(),a=this._container;(!this._svgSize||!this._svgSize.equals(r))&&(this._svgSize=r,a.setAttribute("width",r.x),a.setAttribute("height",r.y)),_t(a,t.min),a.setAttribute("viewBox",[t.min.x,t.min.y,r.x,r.y].join(" ")),this.fire("update")}},_initPath:function(t){var r=t._path=Yi("path");t.options.className&&et(r,t.options.className),t.options.interactive&&et(r,"leaflet-interactive"),this._updateStyle(t),this._layers[d(t)]=t},_addPath:function(t){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(t._path),t.addInteractiveTarget(t._path)},_removePath:function(t){ct(t._path),t.removeInteractiveTarget(t._path),delete this._layers[d(t)]},_updatePath:function(t){t._project(),t._update()},_updateStyle:function(t){var r=t._path,a=t.options;r&&(a.stroke?(r.setAttribute("stroke",a.color),r.setAttribute("stroke-opacity",a.opacity),r.setAttribute("stroke-width",a.weight),r.setAttribute("stroke-linecap",a.lineCap),r.setAttribute("stroke-linejoin",a.lineJoin),a.dashArray?r.setAttribute("stroke-dasharray",a.dashArray):r.removeAttribute("stroke-dasharray"),a.dashOffset?r.setAttribute("stroke-dashoffset",a.dashOffset):r.removeAttribute("stroke-dashoffset")):r.setAttribute("stroke","none"),a.fill?(r.setAttribute("fill",a.fillColor||a.color),r.setAttribute("fill-opacity",a.fillOpacity),r.setAttribute("fill-rule",a.fillRule||"evenodd")):r.setAttribute("fill","none"))},_updatePoly:function(t,r){this._setPath(t,Ur(t._parts,r))},_updateCircle:function(t){var r=t._point,a=Math.max(Math.round(t._radius),1),u=Math.max(Math.round(t._radiusY),1)||a,p="a"+a+","+u+" 0 1,0 ",g=t._empty()?"M0 0":"M"+(r.x-a)+","+r.y+p+a*2+",0 "+p+-a*2+",0 ";this._setPath(t,g)},_setPath:function(t,r){t._path.setAttribute("d",r)},_bringToFront:function(t){xe(t._path)},_bringToBack:function(t){be(t._path)}});H.vml&&ii.include(Pl);function No(t){return H.svg||H.vml?new ii(t):null}rt.include({getRenderer:function(t){var r=t.options.renderer||this._getPaneRenderer(t.options.pane)||this.options.renderer||this._renderer;return r||(r=this._renderer=this._createRenderer()),this.hasLayer(r)||this.addLayer(r),r},_getPaneRenderer:function(t){if(t==="overlayPane"||t===void 0)return!1;var r=this._paneRenderers[t];return r===void 0&&(r=this._createRenderer({pane:t}),this._paneRenderers[t]=r),r},_createRenderer:function(t){return this.options.preferCanvas&&Ro(t)||No(t)}});var jo=Le.extend({initialize:function(t,r){Le.prototype.initialize.call(this,this._boundsToLatLngs(t),r)},setBounds:function(t){return this.setLatLngs(this._boundsToLatLngs(t))},_boundsToLatLngs:function(t){return t=ht(t),[t.getSouthWest(),t.getNorthWest(),t.getNorthEast(),t.getSouthEast()]}});function Ml(t,r){return new jo(t,r)}ii.create=Yi,ii.pointsToPath=Ur,Qt.geometryToLayer=Zi,Qt.coordsToLatLng=$n,Qt.coordsToLatLngs=Ri,Qt.latLngToCoords=Kn,Qt.latLngsToCoords=Ni,Qt.getFeature=Ce,Qt.asFeature=ji,rt.mergeOptions({boxZoom:!0});var Wo=Xt.extend({initialize:function(t){this._map=t,this._container=t._container,this._pane=t._panes.overlayPane,this._resetStateTimeout=0,t.on("unload",this._destroy,this)},addHooks:function(){Q(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){lt(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){ct(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){this._resetStateTimeout!==0&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(t){if(!t.shiftKey||t.which!==1&&t.button!==1)return!1;this._clearDeferredResetState(),this._resetState(),Xe(),In(),this._startPoint=this._map.mouseEventToContainerPoint(t),Q(document,{contextmenu:fe,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(t){this._moved||(this._moved=!0,this._box=ot("div","leaflet-zoom-box",this._container),et(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(t);var r=new tt(this._point,this._startPoint),a=r.getSize();_t(this._box,r.min),this._box.style.width=a.x+"px",this._box.style.height=a.y+"px"},_finish:function(){this._moved&&(ct(this._box),ft(this._container,"leaflet-crosshair")),Ge(),Bn(),lt(document,{contextmenu:fe,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(t){if(!(t.which!==1&&t.button!==1)&&(this._finish(),!!this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(l(this._resetState,this),0);var r=new ut(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(r).fire("boxzoomend",{boxZoomBounds:r})}},_onKeyDown:function(t){t.keyCode===27&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});rt.addInitHook("addHandler","boxZoom",Wo),rt.mergeOptions({doubleClickZoom:!0});var Uo=Xt.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(t){var r=this._map,a=r.getZoom(),u=r.options.zoomDelta,p=t.originalEvent.shiftKey?a-u:a+u;r.options.doubleClickZoom==="center"?r.setZoom(p):r.setZoomAround(t.containerPoint,p)}});rt.addInitHook("addHandler","doubleClickZoom",Uo),rt.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var Vo=Xt.extend({addHooks:function(){if(!this._draggable){var t=this._map;this._draggable=new ae(t._mapPane,t._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),t.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),t.on("zoomend",this._onZoomEnd,this),t.whenReady(this._onZoomEnd,this))}et(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){ft(this._map._container,"leaflet-grab"),ft(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var t=this._map;if(t._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var r=ht(this._map.options.maxBounds);this._offsetLimit=J(this._map.latLngToContainerPoint(r.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(r.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;t.fire("movestart").fire("dragstart"),t.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(t){if(this._map.options.inertia){var r=this._lastTime=+new Date,a=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(a),this._times.push(r),this._prunePositions(r)}this._map.fire("move",t).fire("drag",t)},_prunePositions:function(t){for(;this._positions.length>1&&t-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var t=this._map.getSize().divideBy(2),r=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=r.subtract(t).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(t,r){return t-(t-r)*this._viscosity},_onPreDragLimit:function(){if(!(!this._viscosity||!this._offsetLimit)){var t=this._draggable._newPos.subtract(this._draggable._startPos),r=this._offsetLimit;t.x<r.min.x&&(t.x=this._viscousLimit(t.x,r.min.x)),t.y<r.min.y&&(t.y=this._viscousLimit(t.y,r.min.y)),t.x>r.max.x&&(t.x=this._viscousLimit(t.x,r.max.x)),t.y>r.max.y&&(t.y=this._viscousLimit(t.y,r.max.y)),this._draggable._newPos=this._draggable._startPos.add(t)}},_onPreDragWrap:function(){var t=this._worldWidth,r=Math.round(t/2),a=this._initialWorldOffset,u=this._draggable._newPos.x,p=(u-r+a)%t+r-a,g=(u+r+a)%t-r-a,M=Math.abs(p+a)<Math.abs(g+a)?p:g;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=M},_onDragEnd:function(t){var r=this._map,a=r.options,u=!a.inertia||t.noInertia||this._times.length<2;if(r.fire("dragend",t),u)r.fire("moveend");else{this._prunePositions(+new Date);var p=this._lastPos.subtract(this._positions[0]),g=(this._lastTime-this._times[0])/1e3,M=a.easeLinearity,D=p.multiplyBy(M/g),z=D.distanceTo([0,0]),Z=Math.min(a.inertiaMaxSpeed,z),j=D.multiplyBy(Z/z),G=Z/(a.inertiaDeceleration*M),it=j.multiplyBy(-G/2).round();!it.x&&!it.y?r.fire("moveend"):(it=r._limitOffset(it,r.options.maxBounds),Y(function(){r.panBy(it,{duration:G,easeLinearity:M,noMoveStart:!0,animate:!0})}))}}});rt.addInitHook("addHandler","dragging",Vo),rt.mergeOptions({keyboard:!0,keyboardPanDelta:80});var Yo=Xt.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(t){this._map=t,this._setPanDelta(t.options.keyboardPanDelta),this._setZoomDelta(t.options.zoomDelta)},addHooks:function(){var t=this._map._container;t.tabIndex<=0&&(t.tabIndex="0"),Q(t,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),lt(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var t=document.body,r=document.documentElement,a=t.scrollTop||r.scrollTop,u=t.scrollLeft||r.scrollLeft;this._map._container.focus(),window.scrollTo(u,a)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(t){var r=this._panKeys={},a=this.keyCodes,u,p;for(u=0,p=a.left.length;u<p;u++)r[a.left[u]]=[-1*t,0];for(u=0,p=a.right.length;u<p;u++)r[a.right[u]]=[t,0];for(u=0,p=a.down.length;u<p;u++)r[a.down[u]]=[0,t];for(u=0,p=a.up.length;u<p;u++)r[a.up[u]]=[0,-1*t]},_setZoomDelta:function(t){var r=this._zoomKeys={},a=this.keyCodes,u,p;for(u=0,p=a.zoomIn.length;u<p;u++)r[a.zoomIn[u]]=t;for(u=0,p=a.zoomOut.length;u<p;u++)r[a.zoomOut[u]]=-t},_addHooks:function(){Q(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){lt(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(t){if(!(t.altKey||t.ctrlKey||t.metaKey)){var r=t.keyCode,a=this._map,u;if(r in this._panKeys){if(!a._panAnim||!a._panAnim._inProgress)if(u=this._panKeys[r],t.shiftKey&&(u=N(u).multiplyBy(3)),a.options.maxBounds&&(u=a._limitOffset(N(u),a.options.maxBounds)),a.options.worldCopyJump){var p=a.wrapLatLng(a.unproject(a.project(a.getCenter()).add(u)));a.panTo(p)}else a.panBy(u)}else if(r in this._zoomKeys)a.setZoom(a.getZoom()+(t.shiftKey?3:1)*this._zoomKeys[r]);else if(r===27&&a._popup&&a._popup.options.closeOnEscapeKey)a.closePopup();else return;fe(t)}}});rt.addInitHook("addHandler","keyboard",Yo),rt.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var Ho=Xt.extend({addHooks:function(){Q(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){lt(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(t){var r=mo(t),a=this._map.options.wheelDebounceTime;this._delta+=r,this._lastMousePos=this._map.mouseEventToContainerPoint(t),this._startTime||(this._startTime=+new Date);var u=Math.max(a-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(l(this._performZoom,this),u),fe(t)},_performZoom:function(){var t=this._map,r=t.getZoom(),a=this._map.options.zoomSnap||0;t._stop();var u=this._delta/(this._map.options.wheelPxPerZoomLevel*4),p=4*Math.log(2/(1+Math.exp(-Math.abs(u))))/Math.LN2,g=a?Math.ceil(p/a)*a:p,M=t._limitZoom(r+(this._delta>0?g:-g))-r;this._delta=0,this._startTime=null,M&&(t.options.scrollWheelZoom==="center"?t.setZoom(r+M):t.setZoomAround(this._lastMousePos,r+M))}});rt.addInitHook("addHandler","scrollWheelZoom",Ho);var Ll=600;rt.mergeOptions({tapHold:H.touchNative&&H.safari&&H.mobile,tapTolerance:15});var Xo=Xt.extend({addHooks:function(){Q(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){lt(this._map._container,"touchstart",this._onDown,this)},_onDown:function(t){if(clearTimeout(this._holdTimeout),t.touches.length===1){var r=t.touches[0];this._startPos=this._newPos=new R(r.clientX,r.clientY),this._holdTimeout=setTimeout(l(function(){this._cancel(),this._isTapValid()&&(Q(document,"touchend",wt),Q(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",r))},this),Ll),Q(document,"touchend touchcancel contextmenu",this._cancel,this),Q(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function t(){lt(document,"touchend",wt),lt(document,"touchend touchcancel",t)},_cancel:function(){clearTimeout(this._holdTimeout),lt(document,"touchend touchcancel contextmenu",this._cancel,this),lt(document,"touchmove",this._onMove,this)},_onMove:function(t){var r=t.touches[0];this._newPos=new R(r.clientX,r.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(t,r){var a=new MouseEvent(t,{bubbles:!0,cancelable:!0,view:window,screenX:r.screenX,screenY:r.screenY,clientX:r.clientX,clientY:r.clientY});a._simulated=!0,r.target.dispatchEvent(a)}});rt.addInitHook("addHandler","tapHold",Xo),rt.mergeOptions({touchZoom:H.touch,bounceAtZoomLimits:!0});var Go=Xt.extend({addHooks:function(){et(this._map._container,"leaflet-touch-zoom"),Q(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){ft(this._map._container,"leaflet-touch-zoom"),lt(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(t){var r=this._map;if(!(!t.touches||t.touches.length!==2||r._animatingZoom||this._zooming)){var a=r.mouseEventToContainerPoint(t.touches[0]),u=r.mouseEventToContainerPoint(t.touches[1]);this._centerPoint=r.getSize()._divideBy(2),this._startLatLng=r.containerPointToLatLng(this._centerPoint),r.options.touchZoom!=="center"&&(this._pinchStartLatLng=r.containerPointToLatLng(a.add(u)._divideBy(2))),this._startDist=a.distanceTo(u),this._startZoom=r.getZoom(),this._moved=!1,this._zooming=!0,r._stop(),Q(document,"touchmove",this._onTouchMove,this),Q(document,"touchend touchcancel",this._onTouchEnd,this),wt(t)}},_onTouchMove:function(t){if(!(!t.touches||t.touches.length!==2||!this._zooming)){var r=this._map,a=r.mouseEventToContainerPoint(t.touches[0]),u=r.mouseEventToContainerPoint(t.touches[1]),p=a.distanceTo(u)/this._startDist;if(this._zoom=r.getScaleZoom(p,this._startZoom),!r.options.bounceAtZoomLimits&&(this._zoom<r.getMinZoom()&&p<1||this._zoom>r.getMaxZoom()&&p>1)&&(this._zoom=r._limitZoom(this._zoom)),r.options.touchZoom==="center"){if(this._center=this._startLatLng,p===1)return}else{var g=a._add(u)._divideBy(2)._subtract(this._centerPoint);if(p===1&&g.x===0&&g.y===0)return;this._center=r.unproject(r.project(this._pinchStartLatLng,this._zoom).subtract(g),this._zoom)}this._moved||(r._moveStart(!0,!1),this._moved=!0),$(this._animRequest);var M=l(r._move,r,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=Y(M,this,!0),wt(t)}},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=!1;return}this._zooming=!1,$(this._animRequest),lt(document,"touchmove",this._onTouchMove,this),lt(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))}});rt.addInitHook("addHandler","touchZoom",Go),rt.BoxZoom=Wo,rt.DoubleClickZoom=Uo,rt.Drag=Vo,rt.Keyboard=Yo,rt.ScrollWheelZoom=Ho,rt.TapHold=Xo,rt.TouchZoom=Go,n.Bounds=tt,n.Browser=H,n.CRS=Dt,n.Canvas=Zo,n.Circle=qn,n.CircleMarker=Fi,n.Class=y,n.Control=Ft,n.DivIcon=Ao,n.DivOverlay=Gt,n.DomEvent=Uh,n.DomUtil=jh,n.Draggable=ae,n.Evented=U,n.FeatureGroup=Kt,n.GeoJSON=Qt,n.GridLayer=ti,n.Handler=Xt,n.Icon=Me,n.ImageOverlay=Wi,n.LatLng=st,n.LatLngBounds=ut,n.Layer=Zt,n.LayerGroup=Pe,n.LineUtil=il,n.Map=rt,n.Marker=Oi,n.Mixin=$h,n.Path=he,n.Point=R,n.PolyUtil=Kh,n.Polygon=Le,n.Polyline=Jt,n.Popup=Ui,n.PosAnimation=go,n.Projection=nl,n.Rectangle=jo,n.Renderer=te,n.SVG=ii,n.SVGOverlay=Bo,n.TileLayer=Se,n.Tooltip=Vi,n.Transformation=xn,n.Util=X,n.VideoOverlay=Io,n.bind=l,n.bounds=J,n.canvas=Ro,n.circle=cl,n.circleMarker=ul,n.control=Ke,n.divIcon=wl,n.extend=s,n.featureGroup=al,n.geoJSON=zo,n.geoJson=pl,n.gridLayer=xl,n.icon=hl,n.imageOverlay=_l,n.latLng=nt,n.latLngBounds=ht,n.layerGroup=sl,n.map=Vh,n.marker=ll,n.point=N,n.polygon=fl,n.polyline=dl,n.popup=vl,n.rectangle=Ml,n.setOptions=C,n.stamp=d,n.svg=No,n.svgOverlay=gl,n.tileLayer=Oo,n.tooltip=yl,n.transformation=Ue,n.version=o,n.videoOverlay=ml;var Cl=window.L;n.noConflict=function(){return window.L=Cl,this},window.L=n})})(Lr,Lr.exports);var lh=Lr.exports;const Af=Vl(lh),Xs=Al({__proto__:null,default:Af},[lh]),Of="_button_6v7zm_1",Ff="_active_6v7zm_21",Zf="_hiddenOnMobile_6v7zm_26",cr={button:Of,active:Ff,hiddenOnMobile:Zf};function Rf(i){return i.toLowerCase().split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")}const Nf=({mode:i,currentMode:e,changeMode:n,label:o,hiddenOnTouch:s})=>{let h=cr.button;return s&&(h=`${cr.hiddenOnMobile} ${h}`),e===i&&(h=`${cr.active} ${h}`),dt("button",{id:i,class:h,onClick:()=>{n(i)},children:o||Rf(i)})},jf="_buttons_123u9_1",Wf={buttons:jf},Uf=({mode:i,changeMode:e})=>dt("div",{class:Wf.buttons,children:dt(Nf,{label:"Route Snap",mode:"routesnap",currentMode:i,changeMode:e})}),Vf="_button_1ipkx_1",Yf="_geolocation_1ipkx_25",Gs={button:Vf,geolocation:Yf},Hf="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADIAAAAyCAYAAAAeP4ixAAABhGlDQ1BJQ0MgcHJvZmlsZQAAKJF9kT1Iw0AcxV9TpSKVDnaQIpihOlkQFREnrUIRKoRaoVUHk+snNGlIUlwcBdeCgx+LVQcXZ10dXAVB8APE1cVJ0UVK/F9SaBHjwXE/3t173L0DhEaFqWbXGKBqlpFKxMVMdlUMvEJABCEMYUZmpj4nSUl4jq97+Ph6F+NZ3uf+HH25vMkAn0g8y3TDIt4gntq0dM77xGFWknPE58SjBl2Q+JHristvnIsOCzwzbKRT88RhYrHYwUoHs5KhEk8SR3OqRvlCxuUc5y3OaqXGWvfkLwzmtZVlrtMcRAKLWIIEEQpqKKMCCzFaNVJMpGg/7uGPOH6JXAq5ymDkWEAVKmTHD/4Hv7s1CxPjblIwDnS/2PbHMBDYBZp12/4+tu3mCeB/Bq60tr/aAKY/Sa+3tegRENoGLq7bmrIHXO4AA0+6bMiO5KcpFArA+xl9UxbovwV619zeWvs4fQDS1FXyBjg4BEaKlL3u8e6ezt7+PdPq7we7TnLE88ZFWQAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAAuIwAALiMBeKU/dgAAAAd0SU1FB+cCGg8jCU7Y7fkAAAAZdEVYdENvbW1lbnQAQ3JlYXRlZCB3aXRoIEdJTVBXgQ4XAAAC+UlEQVRo3u2aS2gUQRCGv/jInmIQshiMrqAHPZoYEImC8UGEiJeYo0HBk7kpqBgkwYtgwAd684EPkHgIaDyIinoSs8IGvGi8RVYRl6BoIE90vVQ8NNUzszM9k7jsD3Wp7qrqf6d75q9mIT70AkXDeuMqtoQyQZxEqsqFSLFciJTF1qoF0oo/LWOLFlVAM9APvANmlDfWvM3InH6JqVosBDqBnMfC/SwHHFxIEk3AcAQCpg0DjUk/hRPArEMS8zYLHE9iuy0DbgRY0G9gWvFPy5hf/HWpFQuWAgM+CxgBjgEZD4mSkTkjPrkGpKZzXPEo+h5oM+b3BdBabcAHj7yXXZPo9Ch2FUhFEI0p4JpHfmdvtDQwrhT4A3Q7VL/dktOMGbd8XEvGLcsvdSoGGX/aUutmVBIbgDnLQfSDdkb6AsQ9UOLmgPVRiFxSkn4H6gLEZoAWwzIB4uqkhln3YlgSy4FCiC3lAtoWK8iaSkarkuwXsCIBIrXAhFJ/ZxgZ36r4ngiZuPFTapnYFYZIk+J7nqCmexZwTf8EoG1xW4Eaw5cDfihz7wF3Qy64Czik+FcCWwzfBJD16q2jWpRrnl4Xa6j07BUiMXZ7Byzn5gKwyfCfkwNv4qNYGGwUM9EMnDV8o8DJUjvIOyR4dxtQq90Os7XeKL79CRJpV3zDYZWv1l9vToBEo+UeILQCfqskfJgAkUdK3WyUhEcsneGeALEdwH3DOgLE7bV0ioejEEkBeSXpZ6A+hg6xHviixOUt9wKBvyMzQI/ibwCGFC0WBTXAY2C1MnZG1hL5W/PUonGywCoHT6Tech6LUtvZzWODpVssAl8tr8qgRNolh5b7m+UJRcIOYMpDgQ5JXx70gm67xNjyTcmcWLAPmPSR1KPAeWBQGRuUsVGfHJNSK1Zs89hmLqwgNRLBGuBVDCReSu7ElXMXMOaAwJjkWlBUA0flVVwqgazEVrv4VV1irUiMFmA3sM4Y/wS8AF7LpUf+f2jaKv9FqRCpEKkQcY+/z6ggfksbhSoAAAAASUVORK5CYII=",Xf=({setLocation:i})=>{let e=Gs.button;return dt("button",{id:"geolocation",class:e,onClick:()=>{console.log("clicked",navigator.geolocation),navigator.geolocation.getCurrentPosition(n=>{i([n.coords.longitude,n.coords.latitude])},n=>{alert("Error getting geolocation"),console.error(n)})},children:dt("img",{class:Gs.geolocation,src:Hf})})},Gf=()=>{console.log("Home.tsx");const i={L:Xs,id:"leaflet-map",lng:-.0969151,lat:51.532831,zoom:16},e=bu(null),[n,o]=ir(),[s,h]=ir("static"),[l,c]=ir();us(()=>{fetch("./src/assets/network/network.json").then(f=>{f.json().then(m=>{c(m)})})},[]),us(()=>{o(Bf(i))},[]);const d=vn(()=>{if(n&&l){const f=Nc(n,Xs,l);return f.start(),f}},[n,l]),_=Pu(f=>{d&&(h(f),d.setMode(f))},[d]);return dt("div",{class:tr.home,children:dt("div",{ref:e,class:tr.map,id:i.id,children:[navigator.geolocation&&d?dt(Xf,{setLocation:f=>{n&&n.setView([f[1],f[0]],14)}}):null,d?dt(Uf,{mode:s,changeMode:_}):null,d?null:dt("div",{class:tr.loading,children:"Loading..."})]})})};console.log("App.tsx");const qf=()=>dt("div",{id:"app",children:[dt(gu,{}),dt(Gf,{})]});let _e,di;const $f=(i,e)=>{if(_e=void 0,e&&e.type==="click"){if(e.ctrlKey||e.metaKey||e.altKey||e.shiftKey||e.button!==0)return i;const n=e.target.closest("a[href]"),o=n&&n.getAttribute("href");if(!n||n.origin!=location.origin||/^#/.test(o)||!/^(_?self)?$/i.test(n.target)||di&&(typeof di=="string"?!o.startsWith(di):!di.test(o)))return i;_e=!0,e.preventDefault(),e=n.href.replace(location.origin,"")}else typeof e=="string"?_e=!0:e&&e.url?(_e=!e.replace,e=e.url):e=location.pathname+location.search;return _e===!0?history.pushState(null,"",e):_e===!1&&history.replaceState(null,"",e),e};function uh(i){const[e,n]=xa($f,i.url||location.pathname+location.search);i.scope&&(di=i.scope);const o=_e===!0,s=vn(()=>{const h=new URL(e,location.origin),l=h.pathname.replace(/\/+$/g,"")||"/";return{url:e,path:l,query:Object.fromEntries(h.searchParams),route:(c,d)=>n({url:c,replace:d}),wasPush:o}},[e]);return xu(()=>(addEventListener("click",n),addEventListener("popstate",n),()=>{removeEventListener("click",n),removeEventListener("popstate",n)}),[]),Re(uh.ctx.Provider,{value:s},i.children)}Promise.resolve();uh.ctx=Er({});Er({});const qs=q.__b;q.__b=i=>{i.type&&i.type._forwarded&&i.ref&&(i.props.ref=i.ref,i.ref=null),qs&&qs(i)};const $s=q.__e;q.__e=(i,e,n)=>{if(i&&i.then){let o=e;for(;o=o.__;)if(o.__c&&o.__c.__c)return e.__e==null&&(e.__c.__z=[n.__e],e.__e=n.__e,e.__k=n.__k),e.__k||(e.__k=[]),o.__c.__c(i,e)}$s&&$s(i,e,n)};let Ks;function Kf(i,e){if(typeof window>"u")return;let n=document.querySelector("script[type=isodata]");e=e||n&&n.parentNode||document.body,!Ks&&n?kr(i,e):Sr(i,e),Ks=!0}typeof window<"u"&&Kf(dt(qf,{}),document.getElementById("app"));
